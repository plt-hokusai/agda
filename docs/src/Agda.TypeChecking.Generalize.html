<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agda.TypeChecking.Generalize</span><span>
</span><span id="line-3"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#generalizeType"><span class="hs-identifier">generalizeType</span></a></span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#generalizeType%27"><span class="hs-identifier">generalizeType'</span></a></span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#generalizeTelescope"><span class="hs-identifier">generalizeTelescope</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntSet</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntSet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntSet</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partition</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html"><span class="hs-identifier">Agda.Syntax.Concrete.Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#LensInScope"><span class="hs-identifier">LensInScope</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Generic.html"><span class="hs-identifier">Agda.Syntax.Internal.Generic</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html"><span class="hs-identifier">Agda.Syntax.Internal.MetaVars</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html"><span class="hs-identifier">Agda.Syntax.Scope.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#bindVariable"><span class="hs-identifier">bindVariable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#outsideLocalVars"><span class="hs-identifier">outsideLocalVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#BindingSource"><span class="hs-identifier">BindingSource</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html"><span class="hs-identifier">Agda.TypeChecking.Constraints</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html"><span class="hs-identifier">Agda.TypeChecking.Conversion</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.html"><span class="hs-identifier">Agda.TypeChecking.Free</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Irrelevance.html"><span class="hs-identifier">Agda.TypeChecking.Irrelevance</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html"><span class="hs-identifier">Agda.TypeChecking.InstanceArguments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html#postponeInstanceConstraints"><span class="hs-identifier">postponeInstanceConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html"><span class="hs-identifier">Agda.TypeChecking.MetaVars</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html"><span class="hs-identifier">Agda.Benchmarking</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Benchmarking.html#Phase"><span class="hs-identifier">Phase</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Agda.Benchmarking.html#Typing"><span class="hs-identifier">Typing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html#Generalize"><span class="hs-identifier">Generalize</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html"><span class="hs-identifier">Agda.Utils.Benchmark</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List.html#hasElem"><span class="hs-identifier">hasElem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html"><span class="hs-identifier">Agda.Utils.Permutation</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Pretty.html"><span class="hs-identifier">Agda.Utils.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">-- | Generalize a telescope over a set of generalizable variables.</span><span>
</span><span id="line-58"></span><span id="local-6989586621680614117"><span class="annot"><a href="Agda.TypeChecking.Generalize.html#generalizeTelescope"><span class="hs-identifier hs-type">generalizeTelescope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680614585"><span class="annot"><a href="#local-6989586621680614585"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680614585"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680614585"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680614117"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680614117"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-59"></span><span id="generalizeTelescope"><span class="annot"><span class="annottext">generalizeTelescope :: Map QName Name
-&gt; (forall a. (Telescope -&gt; TCM a) -&gt; TCM a)
-&gt; ([Maybe Name] -&gt; Telescope -&gt; TCM a)
-&gt; TCM a
</span><a href="Agda.TypeChecking.Generalize.html#generalizeTelescope"><span class="hs-identifier hs-var hs-var">generalizeTelescope</span></a></span></span><span> </span><span id="local-6989586621680614116"><span class="annot"><span class="annottext">Map QName Name
</span><a href="#local-6989586621680614116"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span id="local-6989586621680614115"><span class="annot"><span class="annottext">forall a. (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="#local-6989586621680614115"><span class="hs-identifier hs-var">typecheckAction</span></a></span></span><span> </span><span id="local-6989586621680614114"><span class="annot"><span class="annottext">[Maybe Name] -&gt; Telescope -&gt; TCM a
</span><a href="#local-6989586621680614114"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Map QName Name -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map QName Name
</span><a href="#local-6989586621680614116"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; TCM a) -&gt; TCM a
forall a. (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="#local-6989586621680614115"><span class="hs-identifier hs-var">typecheckAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe Name] -&gt; Telescope -&gt; TCM a
</span><a href="#local-6989586621680614114"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#generalizeTelescope"><span class="hs-identifier hs-var">generalizeTelescope</span></a></span><span> </span><span id="local-6989586621680614112"><span class="annot"><span class="annottext">Map QName Name
</span><a href="#local-6989586621680614112"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span id="local-6989586621680614111"><span class="annot"><span class="annottext">forall a. (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="#local-6989586621680614111"><span class="hs-identifier hs-var">typecheckAction</span></a></span></span><span> </span><span id="local-6989586621680614110"><span class="annot"><span class="annottext">[Maybe Name] -&gt; Telescope -&gt; TCM a
</span><a href="#local-6989586621680614110"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO)) -&gt; TCM a -&gt; TCM a
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Typing"><span class="hs-identifier hs-var">Typing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Generalize"><span class="hs-identifier hs-var">Generalize</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCM a) -&gt; TCM a
forall a. (Type -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Generalize.html#withGenRecVar"><span class="hs-identifier hs-var">withGenRecVar</span></a></span><span> </span><span class="annot"><span class="annottext">((Type -&gt; TCM a) -&gt; TCM a) -&gt; (Type -&gt; TCM a) -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680614107"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614107"><span class="hs-identifier hs-var">genRecMeta</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680614106"><span class="annot"><span class="annottext">s :: Set QName
</span><a href="#local-6989586621680614106"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map QName Name -&gt; Set QName
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map QName Name
</span><a href="#local-6989586621680614112"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680614104"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680614104"><span class="hs-identifier hs-var">cxtNames</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614103"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614103"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614102"><span class="annot"><span class="annottext">[(Name, (Term, Dom Type))]
</span><a href="#local-6989586621680614102"><span class="hs-identifier hs-var">letbinds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614101"><span class="annot"><span class="annottext">Map MetaId QName
</span><a href="#local-6989586621680614101"><span class="hs-identifier hs-var">namedMetas</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614100"><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621680614100"><span class="hs-identifier hs-var">allmetas</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><span class="annottext">Set QName
-&gt; TCM ([Name], Telescope, [(Name, (Term, Dom Type))])
-&gt; TCM
     (([Name], Telescope, [(Name, (Term, Dom Type))]), Map MetaId QName,
      IntSet)
forall a. Set QName -&gt; TCM a -&gt; TCM (a, Map MetaId QName, IntSet)
</span><a href="Agda.TypeChecking.Generalize.html#createMetasAndTypeCheck"><span class="hs-identifier hs-var">createMetasAndTypeCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621680614106"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM ([Name], Telescope, [(Name, (Term, Dom Type))])
 -&gt; TCM
      (([Name], Telescope, [(Name, (Term, Dom Type))]), Map MetaId QName,
       IntSet))
-&gt; TCM ([Name], Telescope, [(Name, (Term, Dom Type))])
-&gt; TCM
     (([Name], Telescope, [(Name, (Term, Dom Type))]), Map MetaId QName,
      IntSet)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; TCM ([Name], Telescope, [(Name, (Term, Dom Type))]))
-&gt; TCM ([Name], Telescope, [(Name, (Term, Dom Type))])
forall a. (Telescope -&gt; TCM a) -&gt; TCM a
</span><a href="#local-6989586621680614111"><span class="hs-identifier hs-var">typecheckAction</span></a></span><span> </span><span class="annot"><span class="annottext">((Telescope -&gt; TCM ([Name], Telescope, [(Name, (Term, Dom Type))]))
 -&gt; TCM ([Name], Telescope, [(Name, (Term, Dom Type))]))
-&gt; (Telescope
    -&gt; TCM ([Name], Telescope, [(Name, (Term, Dom Type))]))
-&gt; TCM ([Name], Telescope, [(Name, (Term, Dom Type))])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680614098"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614098"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-64"></span><span>      </span><span id="local-6989586621680614097"><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680614097"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Dom (Name, Type)] -&gt; [Dom (Name, Type)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614098"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Dom (Name, Type)] -&gt; [Dom (Name, Type)])
-&gt; TCMT IO [Dom (Name, Type)] -&gt; TCMT IO [Dom (Name, Type)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO [Dom (Name, Type)]
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m [Dom (Name, Type)]
</span><a href="Agda.TypeChecking.Monad.Context.html#getContext"><span class="hs-identifier hs-var">getContext</span></a></span><span>
</span><span id="line-65"></span><span>      </span><span id="local-6989586621680614092"><span class="annot"><span class="annottext">[(Name, (Term, Dom Type))]
</span><a href="#local-6989586621680614092"><span class="hs-identifier hs-var">lbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO [(Name, (Term, Dom Type))]
forall (tcm :: * -&gt; *).
MonadTCM tcm =&gt;
tcm [(Name, (Term, Dom Type))]
</span><a href="Agda.TypeChecking.Monad.Context.html#getLetBindings"><span class="hs-identifier hs-var">getLetBindings</span></a></span><span> </span><span class="hs-comment">-- This gives let-bindings valid in the current context</span><span>
</span><span id="line-66"></span><span>      </span><span class="annot"><span class="annottext">([Name], Telescope, [(Name, (Term, Dom Type))])
-&gt; TCM ([Name], Telescope, [(Name, (Term, Dom Type))])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Dom (Name, Type) -&gt; Name) -&gt; [Dom (Name, Type)] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name, Type) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Name, Type) -&gt; Name)
-&gt; (Dom (Name, Type) -&gt; (Name, Type)) -&gt; Dom (Name, Type) -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dom (Name, Type) -&gt; (Name, Type)
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var hs-var">unDom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680614097"><span class="hs-identifier hs-var">cxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614098"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Name, (Term, Dom Type))]
</span><a href="#local-6989586621680614092"><span class="hs-identifier hs-var">lbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-comment">-- Translate the QName to the corresponding bound variable</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680614088"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614088"><span class="hs-identifier hs-var">genTel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614087"><span class="annot"><span class="annottext">[Maybe QName]
</span><a href="#local-6989586621680614087"><span class="hs-identifier hs-var">genTelNames</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614086"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680614086"><span class="hs-identifier hs-var">sub</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; Map MetaId QName
-&gt; IntSet
-&gt; TCM (Telescope, [Maybe QName], Substitution)
forall name.
Type
-&gt; Map MetaId name
-&gt; IntSet
-&gt; TCM (Telescope, [Maybe name], Substitution)
</span><a href="Agda.TypeChecking.Generalize.html#computeGeneralization"><span class="hs-identifier hs-var">computeGeneralization</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614107"><span class="hs-identifier hs-var">genRecMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Map MetaId QName
</span><a href="#local-6989586621680614101"><span class="hs-identifier hs-var">namedMetas</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621680614100"><span class="hs-identifier hs-var">allmetas</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680614084"><span class="annot"><span class="annottext">boundVar :: QName -&gt; Name
</span><a href="#local-6989586621680614084"><span class="hs-identifier hs-var hs-var">boundVar</span></a></span></span><span> </span><span id="local-6989586621680614083"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680614083"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name -&gt; Name
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Name
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Name -&gt; Name) -&gt; Maybe Name -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Map QName Name -&gt; Maybe Name
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680614083"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Map QName Name
</span><a href="#local-6989586621680614112"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-71"></span><span>      </span><span id="local-6989586621680614079"><span class="annot"><span class="annottext">genTelVars :: [Maybe Name]
</span><a href="#local-6989586621680614079"><span class="hs-identifier hs-var hs-var">genTelVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe QName -&gt; Maybe Name) -&gt; [Maybe QName] -&gt; [Maybe Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((Maybe QName -&gt; Maybe Name) -&gt; [Maybe QName] -&gt; [Maybe Name])
-&gt; ((QName -&gt; Name) -&gt; Maybe QName -&gt; Maybe Name)
-&gt; (QName -&gt; Name)
-&gt; [Maybe QName]
-&gt; [Maybe Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Name) -&gt; Maybe QName -&gt; Maybe Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="#local-6989586621680614084"><span class="hs-identifier hs-var">boundVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe QName]
</span><a href="#local-6989586621680614087"><span class="hs-identifier hs-var">genTelNames</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>  </span><span id="local-6989586621680614078"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614078"><span class="hs-identifier hs-var">tel'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Telescope) -&gt; Telescope -&gt; Telescope
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Telescope)
</span><a href="#local-6989586621680614086"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; Telescope) -&gt; TCMT IO Telescope -&gt; TCMT IO Telescope
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Telescope
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614103"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-comment">-- This is not so nice. When changing the context from &#915; (r : R) to &#915; &#916; we need to do this at the</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-comment">-- level of contexts (as a Context -&gt; Context function), so we repeat the name logic here. Take</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-comment">-- care to preserve the name of named generalized variables.</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680614075"><span class="annot"><span class="annottext">setName :: c -&gt; f (b, d) -&gt; f (c, d)
</span><a href="#local-6989586621680614075"><span class="hs-identifier hs-var hs-var">setName</span></a></span></span><span> </span><span id="local-6989586621680614074"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680614074"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680614073"><span class="annot"><span class="annottext">f (b, d)
</span><a href="#local-6989586621680614073"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; c) -&gt; (b, d) -&gt; (c, d)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">c -&gt; b -&gt; c
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680614074"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((b, d) -&gt; (c, d)) -&gt; f (b, d) -&gt; f (c, d)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">f (b, d)
</span><a href="#local-6989586621680614073"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-79"></span><span>      </span><span id="local-6989586621680614071"><span class="annot"><span class="annottext">cxtEntry :: (Maybe Name, Dom' t (b, d)) -&gt; m (Dom' t (Name, d))
</span><a href="#local-6989586621680614071"><span class="hs-identifier hs-var hs-var">cxtEntry</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680614070"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621680614070"><span class="hs-identifier hs-var">mname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614069"><span class="annot"><span class="annottext">Dom' t (b, d)
</span><a href="#local-6989586621680614069"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-80"></span><span>          </span><span id="local-6989586621680614068"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680614068"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Name -&gt; (Name -&gt; m Name) -&gt; Maybe Name -&gt; m Name
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
forall a. LensInScope a =&gt; a -&gt; a
</span><a href="Agda.Syntax.Concrete.Name.html#setNotInScope"><span class="hs-identifier hs-var">setNotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; m Name -&gt; m Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; m Name
forall a (m :: * -&gt; *).
(FreshName a, MonadFresh NameId m) =&gt;
a -&gt; m Name
</span><a href="Agda.TypeChecking.Monad.Base.html#freshName_"><span class="hs-identifier hs-var">freshName_</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680614064"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name -&gt; m Name
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621680614070"><span class="hs-identifier hs-var">mname</span></a></span><span>
</span><span id="line-81"></span><span>          </span><span class="annot"><span class="annottext">Dom' t (Name, d) -&gt; m (Dom' t (Name, d))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Dom' t (Name, d) -&gt; m (Dom' t (Name, d)))
-&gt; Dom' t (Name, d) -&gt; m (Dom' t (Name, d))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Dom' t (b, d) -&gt; Dom' t (Name, d)
forall (f :: * -&gt; *) c b d. Functor f =&gt; c -&gt; f (b, d) -&gt; f (c, d)
</span><a href="#local-6989586621680614075"><span class="hs-identifier hs-var">setName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680614068"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' t (b, d)
</span><a href="#local-6989586621680614069"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-82"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680614064"><span class="annot"><span class="annottext">s :: b
</span><a href="#local-6989586621680614064"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b, d) -&gt; b
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((b, d) -&gt; b) -&gt; (b, d) -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom' t (b, d) -&gt; (b, d)
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' t (b, d)
</span><a href="#local-6989586621680614069"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-83"></span><span>      </span><span id="local-6989586621680614063"><span class="annot"><span class="annottext">dropCxt :: Empty -&gt; m a -&gt; m a
</span><a href="#local-6989586621680614063"><span class="hs-identifier hs-var hs-var">dropCxt</span></a></span></span><span> </span><span id="local-6989586621680614062"><span class="annot"><span class="annottext">Empty
</span><a href="#local-6989586621680614062"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution
-&gt; ([Dom (Name, Type)] -&gt; [Dom (Name, Type)]) -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Substitution
-&gt; ([Dom (Name, Type)] -&gt; [Dom (Name, Type)]) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#updateContext"><span class="hs-identifier hs-var">updateContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Empty -&gt; Int -&gt; Substitution
forall a. Empty -&gt; Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#strengthenS"><span class="hs-identifier hs-var">strengthenS</span></a></span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="#local-6989586621680614062"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Dom (Name, Type)] -&gt; [Dom (Name, Type)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>  </span><span id="local-6989586621680614058"><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680614058"><span class="hs-identifier hs-var">genTelCxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Empty -&gt; TCMT IO [Dom (Name, Type)] -&gt; TCMT IO [Dom (Name, Type)]
forall (m :: * -&gt; *) a. MonadAddContext m =&gt; Empty -&gt; m a -&gt; m a
</span><a href="#local-6989586621680614063"><span class="hs-identifier hs-var">dropCxt</span></a></span><span> </span><span class="annot"><span class="annottext">Empty
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO [Dom (Name, Type)] -&gt; TCMT IO [Dom (Name, Type)])
-&gt; TCMT IO [Dom (Name, Type)] -&gt; TCMT IO [Dom (Name, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Maybe Name, Dom' Term (ArgName, Type))
 -&gt; TCMT IO (Dom (Name, Type)))
-&gt; [(Maybe Name, Dom' Term (ArgName, Type))]
-&gt; TCMT IO [Dom (Name, Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Name, Dom' Term (ArgName, Type))
-&gt; TCMT IO (Dom (Name, Type))
forall (m :: * -&gt; *) b t d.
(FreshName b, MonadFresh NameId m) =&gt;
(Maybe Name, Dom' t (b, d)) -&gt; m (Dom' t (Name, d))
</span><a href="#local-6989586621680614071"><span class="hs-identifier hs-var">cxtEntry</span></a></span><span> </span><span class="annot"><span class="annottext">([(Maybe Name, Dom' Term (ArgName, Type))]
 -&gt; TCMT IO [Dom (Name, Type)])
-&gt; [(Maybe Name, Dom' Term (ArgName, Type))]
-&gt; TCMT IO [Dom (Name, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Maybe Name, Dom' Term (ArgName, Type))]
-&gt; [(Maybe Name, Dom' Term (ArgName, Type))]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([(Maybe Name, Dom' Term (ArgName, Type))]
 -&gt; [(Maybe Name, Dom' Term (ArgName, Type))])
-&gt; [(Maybe Name, Dom' Term (ArgName, Type))]
-&gt; [(Maybe Name, Dom' Term (ArgName, Type))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Name]
-&gt; [Dom' Term (ArgName, Type)]
-&gt; [(Maybe Name, Dom' Term (ArgName, Type))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621680614079"><span class="hs-identifier hs-var">genTelVars</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)]
 -&gt; [(Maybe Name, Dom' Term (ArgName, Type))])
-&gt; [Dom' Term (ArgName, Type)]
-&gt; [(Maybe Name, Dom' Term (ArgName, Type))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614088"><span class="hs-identifier hs-var">genTel</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-comment">-- For the explicit module telescope we get the names from the typecheck</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-comment">-- action.</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680614054"><span class="annot"><span class="annottext">newTelCxt :: [Dom (Name, Type)]
</span><a href="#local-6989586621680614054"><span class="hs-identifier hs-var hs-var">newTelCxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Dom' Term (ArgName, Type) -&gt; Dom (Name, Type))
-&gt; [Name] -&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom (Name, Type)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Dom' Term (ArgName, Type) -&gt; Dom (Name, Type)
forall (f :: * -&gt; *) c b d. Functor f =&gt; c -&gt; f (b, d) -&gt; f (c, d)
</span><a href="#local-6989586621680614075"><span class="hs-identifier hs-var">setName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680614104"><span class="hs-identifier hs-var">cxtNames</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; [Dom (Name, Type)])
-&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom (Name, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)])
-&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614078"><span class="hs-identifier hs-var">tel'</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-comment">-- We are in context &#915; (r : R) and should call the continuation in context &#915; &#916; &#920;&#961; passing it &#916; &#920;&#961;</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-comment">-- We have</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-comment">--   &#915; (r : R) &#8866; &#920;            &#920; = tel</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-comment">--   &#915; &#8866; &#916;                    &#916; = genTel</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-comment">--   &#915; &#916; &#8866; &#961; : &#915; (r : R)      &#961; = sub</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-comment">--   &#915; &#8866; &#916; &#920;&#961;                 &#920;&#961; = tel'</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-comment">-- And we shouldn't forget about the let-bindings (#3470)</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-comment">--   &#915; (r : R) &#920; &#8866; letbinds</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-comment">--   &#915; &#916; &#920;&#961;      &#8866; letbinds' = letbinds(lift |&#920;| &#961;)</span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621680614052"><span class="annot"><span class="annottext">[(Name, (Term, Dom Type))]
</span><a href="#local-6989586621680614052"><span class="hs-identifier hs-var">letbinds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg [(Name, (Term, Dom Type))])
-&gt; [(Name, (Term, Dom Type))] -&gt; [(Name, (Term, Dom Type))]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#liftS"><span class="hs-identifier hs-var">liftS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614103"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680614086"><span class="hs-identifier hs-var">sub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Name, (Term, Dom Type))] -&gt; [(Name, (Term, Dom Type))])
-&gt; TCMT IO [(Name, (Term, Dom Type))]
-&gt; TCMT IO [(Name, (Term, Dom Type))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Name, (Term, Dom Type))] -&gt; TCMT IO [(Name, (Term, Dom Type))]
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, (Term, Dom Type))]
</span><a href="#local-6989586621680614102"><span class="hs-identifier hs-var">letbinds</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680614050"><span class="annot"><span class="annottext">addLet :: (Name, (Term, Dom Type)) -&gt; m a -&gt; m a
</span><a href="#local-6989586621680614050"><span class="hs-identifier hs-var hs-var">addLet</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680614049"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680614049"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680614048"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680614048"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614047"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621680614047"><span class="hs-identifier hs-var">dom</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Term -&gt; Dom Type -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Name -&gt; Term -&gt; Dom Type -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addLetBinding%27"><span class="hs-identifier hs-var">addLetBinding'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680614049"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680614048"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621680614047"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">Substitution
-&gt; ([Dom (Name, Type)] -&gt; [Dom (Name, Type)]) -&gt; TCM a -&gt; TCM a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Substitution
-&gt; ([Dom (Name, Type)] -&gt; [Dom (Name, Type)]) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#updateContext"><span class="hs-identifier hs-var">updateContext</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680614086"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680614058"><span class="hs-identifier hs-var">genTelCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)] -&gt; [Dom (Name, Type)] -&gt; [Dom (Name, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Dom (Name, Type)] -&gt; [Dom (Name, Type)])
-&gt; ([Dom (Name, Type)] -&gt; [Dom (Name, Type)])
-&gt; [Dom (Name, Type)]
-&gt; [Dom (Name, Type)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Dom (Name, Type)] -&gt; [Dom (Name, Type)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><span class="annottext">Substitution
-&gt; ([Dom (Name, Type)] -&gt; [Dom (Name, Type)]) -&gt; TCM a -&gt; TCM a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Substitution
-&gt; ([Dom (Name, Type)] -&gt; [Dom (Name, Type)]) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#updateContext"><span class="hs-identifier hs-var">updateContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Substitution
forall a. Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raiseS"><span class="hs-identifier hs-var">raiseS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614078"><span class="hs-identifier hs-var">tel'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680614054"><span class="hs-identifier hs-var">newTelCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)] -&gt; [Dom (Name, Type)] -&gt; [Dom (Name, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-104"></span><span>      </span><span class="annot"><span class="annottext">((Name, (Term, Dom Type)) -&gt; TCM a -&gt; TCM a)
-&gt; TCM a -&gt; [(Name, (Term, Dom Type))] -&gt; TCM a
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">(Name, (Term, Dom Type)) -&gt; TCM a -&gt; TCM a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
(Name, (Term, Dom Type)) -&gt; m a -&gt; m a
</span><a href="#local-6989586621680614050"><span class="hs-identifier hs-var">addLet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe Name] -&gt; Telescope -&gt; TCM a
</span><a href="#local-6989586621680614110"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621680614079"><span class="hs-identifier hs-var">genTelVars</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; TCM a) -&gt; Telescope -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Telescope -&gt; Telescope
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-var">abstract</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614088"><span class="hs-identifier hs-var">genTel</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614078"><span class="hs-identifier hs-var">tel'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, (Term, Dom Type))]
</span><a href="#local-6989586621680614052"><span class="hs-identifier hs-var">letbinds'</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Generalize a type over a set of (used) generalizable variables.</span><span>
</span><span id="line-108"></span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#generalizeType"><span class="hs-identifier hs-type">generalizeType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span id="generalizeType"><span class="annot"><span class="annottext">generalizeType :: Set QName -&gt; TCM Type -&gt; TCM ([Maybe QName], Type)
</span><a href="Agda.TypeChecking.Generalize.html#generalizeType"><span class="hs-identifier hs-var hs-var">generalizeType</span></a></span></span><span> </span><span id="local-6989586621680614042"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621680614042"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680614041"><span class="annot"><span class="annottext">TCM Type
</span><a href="#local-6989586621680614041"><span class="hs-identifier hs-var">typecheckAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680614040"><span class="annot"><span class="annottext">[Maybe QName]
</span><a href="#local-6989586621680614040"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614039"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614039"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; TCM (Type, ()) -&gt; TCM ([Maybe QName], Type, ())
forall a.
Set QName -&gt; TCM (Type, a) -&gt; TCM ([Maybe QName], Type, a)
</span><a href="Agda.TypeChecking.Generalize.html#generalizeType%27"><span class="hs-identifier hs-var">generalizeType'</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621680614042"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (Type, ()) -&gt; TCM ([Maybe QName], Type, ()))
-&gt; TCM (Type, ()) -&gt; TCM ([Maybe QName], Type, ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; (Type, ())) -&gt; TCM Type -&gt; TCM (Type, ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCM Type
</span><a href="#local-6989586621680614041"><span class="hs-identifier hs-var">typecheckAction</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="annottext">([Maybe QName], Type) -&gt; TCM ([Maybe QName], Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe QName]
</span><a href="#local-6989586621680614040"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614039"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | Allow returning additional information from the type checking action.</span><span>
</span><span id="line-114"></span><span id="local-6989586621680614464"><span class="annot"><a href="Agda.TypeChecking.Generalize.html#generalizeType%27"><span class="hs-identifier hs-type">generalizeType'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680614464"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680614464"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-115"></span><span id="generalizeType%27"><span class="annot"><span class="annottext">generalizeType' :: Set QName -&gt; TCM (Type, a) -&gt; TCM ([Maybe QName], Type, a)
</span><a href="Agda.TypeChecking.Generalize.html#generalizeType%27"><span class="hs-identifier hs-var hs-var">generalizeType'</span></a></span></span><span> </span><span id="local-6989586621680614038"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621680614038"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680614037"><span class="annot"><span class="annottext">TCM (Type, a)
</span><a href="#local-6989586621680614037"><span class="hs-identifier hs-var">typecheckAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCM ([Maybe QName], Type, a) -&gt; TCM ([Maybe QName], Type, a)
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Typing"><span class="hs-identifier hs-var">Typing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Generalize"><span class="hs-identifier hs-var">Generalize</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM ([Maybe QName], Type, a) -&gt; TCM ([Maybe QName], Type, a))
-&gt; TCM ([Maybe QName], Type, a) -&gt; TCM ([Maybe QName], Type, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCM ([Maybe QName], Type, a))
-&gt; TCM ([Maybe QName], Type, a)
forall a. (Type -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Generalize.html#withGenRecVar"><span class="hs-identifier hs-var">withGenRecVar</span></a></span><span> </span><span class="annot"><span class="annottext">((Type -&gt; TCM ([Maybe QName], Type, a))
 -&gt; TCM ([Maybe QName], Type, a))
-&gt; (Type -&gt; TCM ([Maybe QName], Type, a))
-&gt; TCM ([Maybe QName], Type, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680614036"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614036"><span class="hs-identifier hs-var">genRecMeta</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680614035"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614035"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614034"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680614034"><span class="hs-identifier hs-var">userdata</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614033"><span class="annot"><span class="annottext">Map MetaId QName
</span><a href="#local-6989586621680614033"><span class="hs-identifier hs-var">namedMetas</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614032"><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621680614032"><span class="hs-identifier hs-var">allmetas</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set QName
-&gt; TCM (Type, a) -&gt; TCM ((Type, a), Map MetaId QName, IntSet)
forall a. Set QName -&gt; TCM a -&gt; TCM (a, Map MetaId QName, IntSet)
</span><a href="Agda.TypeChecking.Generalize.html#createMetasAndTypeCheck"><span class="hs-identifier hs-var">createMetasAndTypeCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621680614038"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">TCM (Type, a)
</span><a href="#local-6989586621680614037"><span class="hs-identifier hs-var">typecheckAction</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680614031"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614031"><span class="hs-identifier hs-var">genTel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614030"><span class="annot"><span class="annottext">[Maybe QName]
</span><a href="#local-6989586621680614030"><span class="hs-identifier hs-var">genTelNames</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614029"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680614029"><span class="hs-identifier hs-var">sub</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; Map MetaId QName
-&gt; IntSet
-&gt; TCM (Telescope, [Maybe QName], Substitution)
forall name.
Type
-&gt; Map MetaId name
-&gt; IntSet
-&gt; TCM (Telescope, [Maybe name], Substitution)
</span><a href="Agda.TypeChecking.Generalize.html#computeGeneralization"><span class="hs-identifier hs-var">computeGeneralization</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614036"><span class="hs-identifier hs-var">genRecMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Map MetaId QName
</span><a href="#local-6989586621680614033"><span class="hs-identifier hs-var">namedMetas</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621680614032"><span class="hs-identifier hs-var">allmetas</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>  </span><span id="local-6989586621680614028"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614028"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Type -&gt; Type
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-var">abstract</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680614031"><span class="hs-identifier hs-var">genTel</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; (Type -&gt; Type) -&gt; Type -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Type) -&gt; Type -&gt; Type
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Type)
</span><a href="#local-6989586621680614029"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; TCM Type -&gt; TCM Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Type
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614035"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;generalized&quot;</span></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;t =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Empty -&gt; Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Empty -&gt; Int -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#escapeContext"><span class="hs-identifier hs-var">escapeContext</span></a></span><span> </span><span class="annot"><span class="annottext">Empty
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614028"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="annottext">([Maybe QName], Type, a) -&gt; TCM ([Maybe QName], Type, a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe QName]
</span><a href="#local-6989586621680614030"><span class="hs-identifier hs-var">genTelNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614028"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680614034"><span class="hs-identifier hs-var">userdata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- | Create metas for the generalizable variables and run the type check action.</span><span>
</span><span id="line-129"></span><span id="local-6989586621680614560"><span class="annot"><a href="Agda.TypeChecking.Generalize.html#createMetasAndTypeCheck"><span class="hs-identifier hs-type">createMetasAndTypeCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680614560"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680614560"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntSet</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-130"></span><span id="createMetasAndTypeCheck"><span class="annot"><span class="annottext">createMetasAndTypeCheck :: Set QName -&gt; TCM a -&gt; TCM (a, Map MetaId QName, IntSet)
</span><a href="Agda.TypeChecking.Generalize.html#createMetasAndTypeCheck"><span class="hs-identifier hs-var hs-var">createMetasAndTypeCheck</span></a></span></span><span> </span><span id="local-6989586621680614021"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621680614021"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680614020"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621680614020"><span class="hs-identifier hs-var">typecheckAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680614019"><span class="annot"><span class="annottext">Map MetaId QName
</span><a href="#local-6989586621680614019"><span class="hs-identifier hs-var">namedMetas</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614018"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680614018"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614017"><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621680614017"><span class="hs-identifier hs-var">allmetas</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Map MetaId QName, a)
-&gt; TCMT IO ((Map MetaId QName, a), IntSet)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; m a -&gt; m (a, IntSet)
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#metasCreatedBy"><span class="hs-identifier hs-var">metasCreatedBy</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Map MetaId QName, a)
 -&gt; TCMT IO ((Map MetaId QName, a), IntSet))
-&gt; TCMT IO (Map MetaId QName, a)
-&gt; TCMT IO ((Map MetaId QName, a), IntSet)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680614015"><span class="annot"><span class="annottext">Map MetaId QName
</span><a href="#local-6989586621680614015"><span class="hs-identifier hs-var">metamap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680614014"><span class="annot"><span class="annottext">Map QName GeneralizedValue
</span><a href="#local-6989586621680614014"><span class="hs-identifier hs-var">genvals</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; TCM (Map MetaId QName, Map QName GeneralizedValue)
</span><a href="Agda.TypeChecking.Generalize.html#createGenValues"><span class="hs-identifier hs-var">createGenValues</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621680614021"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621680614012"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680614012"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' (Map QName GeneralizedValue) TCEnv
-&gt; (Map QName GeneralizedValue -&gt; Map QName GeneralizedValue)
-&gt; TCM a
-&gt; TCM a
forall (m :: * -&gt; *) a b.
MonadTCEnv m =&gt;
Lens' a TCEnv -&gt; (a -&gt; a) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Base.html#locallyTC"><span class="hs-identifier hs-var">locallyTC</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (Map QName GeneralizedValue) TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#eGeneralizedVars"><span class="hs-identifier hs-var">eGeneralizedVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map QName GeneralizedValue
-&gt; Map QName GeneralizedValue -&gt; Map QName GeneralizedValue
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Map QName GeneralizedValue
</span><a href="#local-6989586621680614014"><span class="hs-identifier hs-var">genvals</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621680614020"><span class="hs-identifier hs-var">typecheckAction</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="annottext">(Map MetaId QName, a) -&gt; TCMT IO (Map MetaId QName, a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map MetaId QName
</span><a href="#local-6989586621680614015"><span class="hs-identifier hs-var">metamap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680614012"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><span class="annottext">(a, Map MetaId QName, IntSet) -&gt; TCM (a, Map MetaId QName, IntSet)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680614018"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map MetaId QName
</span><a href="#local-6989586621680614019"><span class="hs-identifier hs-var">namedMetas</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621680614017"><span class="hs-identifier hs-var">allmetas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- | Add a placeholder variable that will be substituted with a record value packing up all the</span><span>
</span><span id="line-138"></span><span class="hs-comment">--   generalized variables.</span><span>
</span><span id="line-139"></span><span id="local-6989586621680614568"><span class="annot"><a href="Agda.TypeChecking.Generalize.html#withGenRecVar"><span class="hs-identifier hs-type">withGenRecVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680614568"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680614568"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-140"></span><span id="withGenRecVar"><span class="annot"><span class="annottext">withGenRecVar :: (Type -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Generalize.html#withGenRecVar"><span class="hs-identifier hs-var hs-var">withGenRecVar</span></a></span></span><span> </span><span id="local-6989586621680614009"><span class="annot"><span class="annottext">Type -&gt; TCM a
</span><a href="#local-6989586621680614009"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-comment">-- Create a meta type (in Set&#8320;) for the telescope record. It won't</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-comment">-- necessarily fit in Set&#8320;, but since it's only used locally the sort</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-comment">-- shouldn't matter. Another option would be to put it in Set&#969;, which is a</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-comment">-- bit more honest, but this leads to performance problems (see #3306).</span><span>
</span><span id="line-145"></span><span>  </span><span id="local-6989586621680614008"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614008"><span class="hs-identifier hs-var">genRecMeta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; TCM Type
</span><a href="Agda.TypeChecking.MetaVars.html#newTypeMeta"><span class="hs-identifier hs-var">newTypeMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Sort
</span><a href="Agda.Syntax.Internal.html#mkType"><span class="hs-identifier hs-var">mkType</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="annottext">Dom' Term (ArgName, Type) -&gt; TCM a -&gt; TCM a
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ArgName, Type) -&gt; Dom' Term (ArgName, Type)
forall a. a -&gt; Dom a
</span><a href="Agda.Syntax.Internal.html#defaultDom"><span class="hs-identifier hs-var">defaultDom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;genTel&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614008"><span class="hs-identifier hs-var">genRecMeta</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM a
</span><a href="#local-6989586621680614009"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614008"><span class="hs-identifier hs-var">genRecMeta</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">-- | Compute the generalized telescope from metas created when checking the type/telescope to be</span><span>
</span><span id="line-149"></span><span class="hs-comment">--   generalized. Called in the context extended with the telescope record variable (whose type is</span><span>
</span><span id="line-150"></span><span class="hs-comment">--   the first argument). Returns the telescope of generalized variables and a substitution from</span><span>
</span><span id="line-151"></span><span class="hs-comment">--   this telescope to the current context.</span><span>
</span><span id="line-152"></span><span id="local-6989586621680614536"><span class="annot"><a href="Agda.TypeChecking.Generalize.html#computeGeneralization"><span class="hs-identifier hs-type">computeGeneralization</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680614536"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntSet</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680614536"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-153"></span><span id="computeGeneralization"><span class="annot"><span class="annottext">computeGeneralization :: Type
-&gt; Map MetaId name
-&gt; IntSet
-&gt; TCM (Telescope, [Maybe name], Substitution)
</span><a href="Agda.TypeChecking.Generalize.html#computeGeneralization"><span class="hs-identifier hs-var hs-var">computeGeneralization</span></a></span></span><span> </span><span id="local-6989586621680614002"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614002"><span class="hs-identifier hs-var">genRecMeta</span></a></span></span><span> </span><span id="local-6989586621680614001"><span class="annot"><span class="annottext">Map MetaId name
</span><a href="#local-6989586621680614001"><span class="hs-identifier hs-var">nameMap</span></a></span></span><span> </span><span id="local-6989586621680614000"><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621680614000"><span class="hs-identifier hs-var">allmetas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM (Telescope, [Maybe name], Substitution)
-&gt; TCM (Telescope, [Maybe name], Substitution)
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.InstanceArguments.html#postponeInstanceConstraints"><span class="hs-identifier hs-var">postponeInstanceConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (Telescope, [Maybe name], Substitution)
 -&gt; TCM (Telescope, [Maybe name], Substitution))
-&gt; TCM (Telescope, [Maybe name], Substitution)
-&gt; TCM (Telescope, [Maybe name], Substitution)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;computing generalization for type&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614002"><span class="hs-identifier hs-var">genRecMeta</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-comment">-- Pair metas with their metaInfo</span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621680613999"><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613999"><span class="hs-identifier hs-var">mvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; TCMT IO (MetaId, MetaVariable))
-&gt; [Int] -&gt; TCMT IO [(MetaId, MetaVariable)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680613998"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613998"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613998"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MetaVariable -&gt; (MetaId, MetaVariable))
-&gt; TCMT IO MetaVariable -&gt; TCMT IO (MetaId, MetaVariable)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaVariable
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupMeta"><span class="hs-identifier hs-var">lookupMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613998"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; TCMT IO (MetaId, MetaVariable))
-&gt; (Int -&gt; MetaId) -&gt; Int -&gt; TCMT IO (MetaId, MetaVariable)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; MetaId
</span><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-var">MetaId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; TCMT IO [(MetaId, MetaVariable)])
-&gt; [Int] -&gt; TCMT IO [(MetaId, MetaVariable)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; [Int]
</span><span class="hs-identifier hs-var">IntSet.toList</span></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621680614000"><span class="hs-identifier hs-var">allmetas</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621680613994"><span class="annot"><span class="annottext">[ProblemConstraint]
</span><a href="#local-6989586621680613994"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ProblemConstraint] -&gt; [ProblemConstraint] -&gt; [ProblemConstraint]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">(++)</span></span><span> </span><span class="annot"><span class="annottext">([ProblemConstraint] -&gt; [ProblemConstraint] -&gt; [ProblemConstraint])
-&gt; TCMT IO [ProblemConstraint]
-&gt; TCMT IO ([ProblemConstraint] -&gt; [ProblemConstraint])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' [ProblemConstraint] TCState -&gt; TCMT IO [ProblemConstraint]
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' a TCState -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' [ProblemConstraint] TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#stAwakeConstraints"><span class="hs-identifier hs-var">stAwakeConstraints</span></a></span><span>
</span><span id="line-161"></span><span>             </span><span class="annot"><span class="annottext">TCMT IO ([ProblemConstraint] -&gt; [ProblemConstraint])
-&gt; TCMT IO [ProblemConstraint] -&gt; TCMT IO [ProblemConstraint]
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' [ProblemConstraint] TCState -&gt; TCMT IO [ProblemConstraint]
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' a TCState -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' [ProblemConstraint] TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#stSleepingConstraints"><span class="hs-identifier hs-var">stSleepingConstraints</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;current constraints:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ProblemConstraint -&gt; TCM Doc) -&gt; [ProblemConstraint] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemConstraint]
</span><a href="#local-6989586621680613994"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621680613989"><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621680613989"><span class="hs-identifier hs-var">constrainedMetas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Set MetaId] -&gt; Set MetaId
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">Set.unions</span></span><span> </span><span class="annot"><span class="annottext">([Set MetaId] -&gt; Set MetaId)
-&gt; TCMT IO [Set MetaId] -&gt; TCMT IO (Set MetaId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ProblemConstraint -&gt; TCMT IO (Set MetaId))
-&gt; [ProblemConstraint] -&gt; TCMT IO [Set MetaId]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constraint -&gt; TCMT IO (Set MetaId)
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#constraintMetas"><span class="hs-identifier hs-var">constraintMetas</span></a></span><span> </span><span class="annot"><span class="annottext">(Constraint -&gt; TCMT IO (Set MetaId))
-&gt; (ProblemConstraint -&gt; Constraint)
-&gt; ProblemConstraint
-&gt; TCMT IO (Set MetaId)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Closure Constraint -&gt; Constraint
forall a. Closure a -&gt; a
</span><a href="Agda.TypeChecking.Monad.Base.html#clValue"><span class="hs-identifier hs-var hs-var">clValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure Constraint -&gt; Constraint)
-&gt; (ProblemConstraint -&gt; Closure Constraint)
-&gt; ProblemConstraint
-&gt; Constraint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ProblemConstraint -&gt; Closure Constraint
</span><a href="Agda.TypeChecking.Monad.Base.html#theConstraint"><span class="hs-identifier hs-var hs-var">theConstraint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ProblemConstraint]
</span><a href="#local-6989586621680613994"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;constrainedMetas     = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MetaId -&gt; TCM Doc) -&gt; [MetaId] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">([MetaId] -&gt; [TCM Doc]) -&gt; [MetaId] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set MetaId -&gt; [MetaId]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621680613989"><span class="hs-identifier hs-var">constrainedMetas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613982"><span class="annot"><span class="annottext">isConstrained :: MetaId -&gt; Bool
</span><a href="#local-6989586621680613982"><span class="hs-identifier hs-var hs-var">isConstrained</span></a></span></span><span> </span><span id="local-6989586621680613981"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613981"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Set MetaId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613981"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621680613989"><span class="hs-identifier hs-var">constrainedMetas</span></a></span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-comment">-- Note: Always generalize named metas even if they are constrained. We</span><span>
</span><span id="line-172"></span><span>      </span><span class="hs-comment">-- freeze them so they won't be instantiated by the constraint, and we do</span><span>
</span><span id="line-173"></span><span>      </span><span class="hs-comment">-- want the nice error from checking the constraint after generalization.</span><span>
</span><span id="line-174"></span><span>      </span><span class="hs-comment">-- See #3276.</span><span>
</span><span id="line-175"></span><span>      </span><span id="local-6989586621680613979"><span class="annot"><span class="annottext">isGeneralizable :: (MetaId, MetaVariable) -&gt; Bool
</span><a href="#local-6989586621680613979"><span class="hs-identifier hs-var hs-var">isGeneralizable</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613978"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613978"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613977"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613977"><span class="hs-identifier hs-var">mv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Map MetaId name -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.member</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613978"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map MetaId name
</span><a href="#local-6989586621680614001"><span class="hs-identifier hs-var">nameMap</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-176"></span><span>                                </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Bool
</span><a href="#local-6989586621680613982"><span class="hs-identifier hs-var">isConstrained</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613978"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DoGeneralize
</span><a href="Agda.TypeChecking.Monad.Base.html#YesGeneralize"><span class="hs-identifier hs-var">YesGeneralize</span></a></span><span> </span><span class="annot"><span class="annottext">DoGeneralize -&gt; DoGeneralize -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arg DoGeneralize -&gt; DoGeneralize
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var hs-var">unArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaInfo -&gt; Arg DoGeneralize
</span><a href="Agda.TypeChecking.Monad.Base.html#miGeneralizable"><span class="hs-identifier hs-var hs-var">miGeneralizable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInfo"><span class="hs-identifier hs-var hs-var">mvInfo</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613977"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>      </span><span id="local-6989586621680613968"><span class="annot"><span class="annottext">isSort :: (a, MetaVariable) -&gt; Bool
</span><a href="#local-6989586621680613968"><span class="hs-identifier hs-var hs-var">isSort</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#isSortMeta_"><span class="hs-identifier hs-var">isSortMeta_</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaVariable -&gt; Bool)
-&gt; ((a, MetaVariable) -&gt; MetaVariable) -&gt; (a, MetaVariable) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a, MetaVariable) -&gt; MetaVariable
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>
</span><span id="line-178"></span><span>      </span><span id="local-6989586621680613966"><span class="annot"><span class="annottext">isOpen :: (a, MetaVariable) -&gt; Bool
</span><a href="#local-6989586621680613966"><span class="hs-identifier hs-var hs-var">isOpen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInstantiation -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#isOpenMeta"><span class="hs-identifier hs-var">isOpenMeta</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaInstantiation -&gt; Bool)
-&gt; ((a, MetaVariable) -&gt; MetaInstantiation)
-&gt; (a, MetaVariable)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInstantiation
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInstantiation"><span class="hs-identifier hs-var hs-var">mvInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaVariable -&gt; MetaInstantiation)
-&gt; ((a, MetaVariable) -&gt; MetaVariable)
-&gt; (a, MetaVariable)
-&gt; MetaInstantiation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a, MetaVariable) -&gt; MetaVariable
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-comment">-- Split the generalizable metas in open and closed</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613963"><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613963"><span class="hs-identifier hs-var">generalizable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613962"><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613962"><span class="hs-identifier hs-var">nongeneralizable</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((MetaId, MetaVariable) -&gt; Bool)
-&gt; [(MetaId, MetaVariable)]
-&gt; ([(MetaId, MetaVariable)], [(MetaId, MetaVariable)])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="annot"><span class="annottext">(MetaId, MetaVariable) -&gt; Bool
</span><a href="#local-6989586621680613979"><span class="hs-identifier hs-var">isGeneralizable</span></a></span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613999"><span class="hs-identifier hs-var">mvs</span></a></span><span>
</span><span id="line-182"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680613961"><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613961"><span class="hs-identifier hs-var">generalizableOpen'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613960"><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613960"><span class="hs-identifier hs-var">generalizableClosed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((MetaId, MetaVariable) -&gt; Bool)
-&gt; [(MetaId, MetaVariable)]
-&gt; ([(MetaId, MetaVariable)], [(MetaId, MetaVariable)])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="annot"><span class="annottext">(MetaId, MetaVariable) -&gt; Bool
forall a. (a, MetaVariable) -&gt; Bool
</span><a href="#local-6989586621680613966"><span class="hs-identifier hs-var">isOpen</span></a></span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613963"><span class="hs-identifier hs-var">generalizable</span></a></span><span>
</span><span id="line-183"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680613959"><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613959"><span class="hs-identifier hs-var">openSortMetas</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613958"><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613958"><span class="hs-identifier hs-var">generalizableOpen</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((MetaId, MetaVariable) -&gt; Bool)
-&gt; [(MetaId, MetaVariable)]
-&gt; ([(MetaId, MetaVariable)], [(MetaId, MetaVariable)])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="annot"><span class="annottext">(MetaId, MetaVariable) -&gt; Bool
forall a. (a, MetaVariable) -&gt; Bool
</span><a href="#local-6989586621680613968"><span class="hs-identifier hs-var">isSort</span></a></span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613961"><span class="hs-identifier hs-var">generalizableOpen'</span></a></span><span>
</span><span id="line-184"></span><span>      </span><span id="local-6989586621680613957"><span class="annot"><span class="annottext">nongeneralizableOpen :: [(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613957"><span class="hs-identifier hs-var hs-var">nongeneralizableOpen</span></a></span></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((MetaId, MetaVariable) -&gt; Bool)
-&gt; [(MetaId, MetaVariable)] -&gt; [(MetaId, MetaVariable)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">(MetaId, MetaVariable) -&gt; Bool
forall a. (a, MetaVariable) -&gt; Bool
</span><a href="#local-6989586621680613966"><span class="hs-identifier hs-var">isOpen</span></a></span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613962"><span class="hs-identifier hs-var">nongeneralizable</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;generalizable        = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((MetaId, MetaVariable) -&gt; TCM Doc)
-&gt; [(MetaId, MetaVariable)] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; TCM Doc)
-&gt; ((MetaId, MetaVariable) -&gt; MetaId)
-&gt; (MetaId, MetaVariable)
-&gt; TCM Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(MetaId, MetaVariable) -&gt; MetaId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613963"><span class="hs-identifier hs-var">generalizable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;generalizableOpen    = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((MetaId, MetaVariable) -&gt; TCM Doc)
-&gt; [(MetaId, MetaVariable)] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; TCM Doc)
-&gt; ((MetaId, MetaVariable) -&gt; MetaId)
-&gt; (MetaId, MetaVariable)
-&gt; TCM Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(MetaId, MetaVariable) -&gt; MetaId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613958"><span class="hs-identifier hs-var">generalizableOpen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;openSortMetas        = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((MetaId, MetaVariable) -&gt; TCM Doc)
-&gt; [(MetaId, MetaVariable)] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; TCM Doc)
-&gt; ((MetaId, MetaVariable) -&gt; MetaId)
-&gt; (MetaId, MetaVariable)
-&gt; TCM Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(MetaId, MetaVariable) -&gt; MetaId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613959"><span class="hs-identifier hs-var">openSortMetas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-comment">-- Issue 3301: We can't generalize over sorts</span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
-&gt; ([(MetaId, MetaVariable)] -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613959"><span class="hs-identifier hs-var">openSortMetas</span></a></span><span> </span><span class="annot"><span class="annottext">(([(MetaId, MetaVariable)] -&gt; TCMT IO ()) -&gt; TCMT IO ())
-&gt; ([(MetaId, MetaVariable)] -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680613955"><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613955"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="annottext">Warning -&gt; TCMT IO ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCMT IO ()) -&gt; Warning -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[MetaId] -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#CantGeneralizeOverSorts"><span class="hs-identifier hs-var">CantGeneralizeOverSorts</span></a></span><span> </span><span class="annot"><span class="annottext">([MetaId] -&gt; Warning) -&gt; [MetaId] -&gt; Warning
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((MetaId, MetaVariable) -&gt; MetaId)
-&gt; [(MetaId, MetaVariable)] -&gt; [MetaId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(MetaId, MetaVariable) -&gt; MetaId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613955"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-comment">-- Any meta in the solution of a generalizable meta should be generalized over (if possible).</span><span>
</span><span id="line-197"></span><span>  </span><span id="local-6989586621680613952"><span class="annot"><span class="annottext">CheckpointId
</span><a href="#local-6989586621680613952"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' CheckpointId TCEnv -&gt; TCMT IO CheckpointId
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' a TCEnv -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' CheckpointId TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#eCurrentCheckpoint"><span class="hs-identifier hs-var">eCurrentCheckpoint</span></a></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613949"><span class="annot"><span class="annottext">canGeneralize :: MetaId -&gt; TCMT IO Bool
</span><a href="#local-6989586621680613949"><span class="hs-identifier hs-var hs-var">canGeneralize</span></a></span></span><span> </span><span id="local-6989586621680613948"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613948"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Bool
</span><a href="#local-6989586621680613982"><span class="hs-identifier hs-var">isConstrained</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613948"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-199"></span><span>      </span><span class="annot"><a href="#local-6989586621680613949"><span class="hs-identifier hs-var">canGeneralize</span></a></span><span> </span><span id="local-6989586621680613947"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613947"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>          </span><span id="local-6989586621680613946"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613946"><span class="hs-identifier hs-var">mv</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaVariable
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupMeta"><span class="hs-identifier hs-var">lookupMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613947"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-201"></span><span>          </span><span id="local-6989586621680613945"><span class="annot"><span class="annottext">Maybe Substitution
</span><a href="#local-6989586621680613945"><span class="hs-identifier hs-var">msub</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaVariable
-&gt; (Range -&gt; TCMT IO (Maybe Substitution))
-&gt; TCMT IO (Maybe Substitution)
forall (m :: * -&gt; *) a c b.
(MonadTCEnv m, ReadTCState m, LensClosure a c) =&gt;
c -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613946"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="annot"><span class="annottext">((Range -&gt; TCMT IO (Maybe Substitution))
 -&gt; TCMT IO (Maybe Substitution))
-&gt; (Range -&gt; TCMT IO (Maybe Substitution))
-&gt; TCMT IO (Maybe Substitution)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-202"></span><span>                    </span><span class="annot"><span class="annottext">CheckpointId -&gt; TCMT IO (Maybe Substitution)
forall (tcm :: * -&gt; *).
MonadTCEnv tcm =&gt;
CheckpointId -&gt; tcm (Maybe Substitution)
</span><a href="Agda.TypeChecking.Monad.Context.html#checkpointSubstitution%27"><span class="hs-identifier hs-var">checkpointSubstitution'</span></a></span><span> </span><span class="annot"><span class="annottext">CheckpointId
</span><a href="#local-6989586621680613952"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-203"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613942"><span class="annot"><span class="annottext">sameContext :: Bool
</span><a href="#local-6989586621680613942"><span class="hs-identifier hs-var hs-var">sameContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>                </span><span class="hs-comment">-- We can only generalize if the metavariable takes the context variables of the</span><span>
</span><span id="line-205"></span><span>                </span><span class="hs-comment">-- current context as arguments. This happens either when the context of the meta</span><span>
</span><span id="line-206"></span><span>                </span><span class="hs-comment">-- is the same as the current context and there is no pruning, or the meta context</span><span>
</span><span id="line-207"></span><span>                </span><span class="hs-comment">-- is a weakening but the extra variables have been pruned.</span><span>
</span><span id="line-208"></span><span>                </span><span class="hs-comment">-- It would be possible to generalize also in the case when some context variables</span><span>
</span><span id="line-209"></span><span>                </span><span class="hs-comment">-- (other than genTel) have been pruned, but it's hard to construct an example</span><span>
</span><span id="line-210"></span><span>                </span><span class="hs-comment">-- where this actually happens.</span><span>
</span><span id="line-211"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Substitution
</span><a href="#local-6989586621680613945"><span class="hs-identifier hs-var">msub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Permutation
</span><a href="Agda.TypeChecking.Monad.Base.html#mvPermutation"><span class="hs-identifier hs-var hs-var">mvPermutation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613946"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-212"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="Agda.Syntax.Internal.html#IdS"><span class="hs-identifier hs-var">IdS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#Perm"><span class="hs-identifier hs-type">Perm</span></a></span><span> </span><span id="local-6989586621680613938"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613938"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680613937"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680613937"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680613937"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613938"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Wk"><span class="hs-identifier hs-type">Wk</span></a></span><span> </span><span id="local-6989586621680613935"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613935"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="Agda.Syntax.Internal.html#IdS"><span class="hs-identifier hs-var">IdS</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#Perm"><span class="hs-identifier hs-type">Perm</span></a></span><span> </span><span id="local-6989586621680613934"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613934"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680613933"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680613933"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680613933"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613934"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613935"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>                  </span><span class="annot"><span class="annottext">(Maybe Substitution, Permutation)
</span><span class="hs-identifier">_</span></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-215"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680613942"><span class="hs-identifier hs-var">sameContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-216"></span><span>            </span><span id="local-6989586621680613931"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613931"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Type
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m) =&gt;
MetaId -&gt; m Type
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaType"><span class="hs-identifier hs-var">getMetaType</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613947"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-217"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#Perm"><span class="hs-identifier hs-type">Perm</span></a></span><span> </span><span id="local-6989586621680613929"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613929"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680613928"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680613928"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Permutation
</span><a href="Agda.TypeChecking.Monad.Base.html#mvPermutation"><span class="hs-identifier hs-var hs-var">mvPermutation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613946"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-218"></span><span>            </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-219"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;Don't know how to generalize over&quot;</span></span><span>
</span><span id="line-220"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613947"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613931"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-221"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;in context&quot;</span></span><span>
</span><span id="line-222"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc)
-&gt; (Telescope -&gt; TCM Doc) -&gt; Telescope -&gt; TCM Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; TCM Doc) -&gt; TCMT IO Telescope -&gt; TCM Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Telescope
forall (m :: * -&gt; *). (Applicative m, MonadTCEnv m) =&gt; m Telescope
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-var">getContextTelescope</span></a></span><span>
</span><span id="line-223"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;permutation:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, [Int]) -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613929"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680613928"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;subst:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Substitution -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Substitution
</span><a href="#local-6989586621680613945"><span class="hs-identifier hs-var">msub</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-225"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680613942"><span class="hs-identifier hs-var">sameContext</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span id="local-6989586621680613921"><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621680613921"><span class="hs-identifier hs-var">inherited</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([Set MetaId] -&gt; Set MetaId)
-&gt; TCMT IO [Set MetaId] -&gt; TCMT IO (Set MetaId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Set MetaId] -&gt; Set MetaId
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">Set.unions</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO [Set MetaId] -&gt; TCMT IO (Set MetaId))
-&gt; TCMT IO [Set MetaId] -&gt; TCMT IO (Set MetaId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
-&gt; ((MetaId, MetaVariable) -&gt; TCMT IO (Set MetaId))
-&gt; TCMT IO [Set MetaId]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613960"><span class="hs-identifier hs-var">generalizableClosed</span></a></span><span> </span><span class="annot"><span class="annottext">(((MetaId, MetaVariable) -&gt; TCMT IO (Set MetaId))
 -&gt; TCMT IO [Set MetaId])
-&gt; ((MetaId, MetaVariable) -&gt; TCMT IO (Set MetaId))
-&gt; TCMT IO [Set MetaId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613919"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613919"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613918"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613918"><span class="hs-identifier hs-var">mv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInstantiation
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInstantiation"><span class="hs-identifier hs-var hs-var">mvInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613918"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-228"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InstV"><span class="hs-identifier hs-type">InstV</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg ArgName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680613916"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613916"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>        </span><span id="local-6989586621680613915"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613915"><span class="hs-identifier hs-var">parentName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO ArgName
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m) =&gt;
MetaId -&gt; m ArgName
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaNameSuggestion"><span class="hs-identifier hs-var">getMetaNameSuggestion</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613919"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-230"></span><span>        </span><span id="local-6989586621680613913"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613913"><span class="hs-identifier hs-var">metas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; TCMT IO Bool) -&gt; [MetaId] -&gt; TCMT IO [MetaId]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Bool
</span><a href="#local-6989586621680613949"><span class="hs-identifier hs-var">canGeneralize</span></a></span><span> </span><span class="annot"><span class="annottext">([MetaId] -&gt; TCMT IO [MetaId])
-&gt; (Term -&gt; [MetaId]) -&gt; Term -&gt; TCMT IO [MetaId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [MetaId]
forall a. AllMetas a =&gt; a -&gt; [MetaId]
</span><a href="Agda.Syntax.Internal.MetaVars.html#allMetasList"><span class="hs-identifier hs-var">allMetasList</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; TCMT IO [MetaId]) -&gt; TCMT IO Term -&gt; TCMT IO [MetaId]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613916"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613910"><span class="annot"><span class="annottext">suggestNames :: Integer -&gt; [MetaId] -&gt; TCMT IO ()
</span><a href="#local-6989586621680613910"><span class="hs-identifier hs-var hs-var">suggestNames</span></a></span></span><span> </span><span id="local-6989586621680613909"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680613909"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>            </span><span class="annot"><a href="#local-6989586621680613910"><span class="hs-identifier hs-var">suggestNames</span></a></span><span> </span><span id="local-6989586621680613908"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680613908"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613907"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613907"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680613906"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613906"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>              </span><span id="local-6989586621680613905"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613905"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO ArgName
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m) =&gt;
MetaId -&gt; m ArgName
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaNameSuggestion"><span class="hs-identifier hs-var">getMetaNameSuggestion</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613907"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-234"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613905"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-235"></span><span>                </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>                  </span><span class="annot"><span class="annottext">MetaId -&gt; ArgName -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
MetaId -&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#setMetaNameSuggestion"><span class="hs-identifier hs-var">setMetaNameSuggestion</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613907"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613915"><span class="hs-identifier hs-var">parentName</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680613908"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>                  </span><span class="annot"><span class="annottext">Integer -&gt; [MetaId] -&gt; TCMT IO ()
</span><a href="#local-6989586621680613910"><span class="hs-identifier hs-var">suggestNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680613908"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613906"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-238"></span><span>                </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; [MetaId] -&gt; TCMT IO ()
</span><a href="#local-6989586621680613910"><span class="hs-identifier hs-var">suggestNames</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680613908"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613906"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MetaId] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613913"><span class="hs-identifier hs-var">metas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-240"></span><span>          </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;Inherited metas from &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613919"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MetaId -&gt; TCM Doc) -&gt; [MetaId] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613913"><span class="hs-identifier hs-var">metas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>        </span><span class="annot"><span class="annottext">[MetaId] -&gt; Set MetaId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613913"><span class="hs-identifier hs-var">metas</span></a></span><span> </span><span class="annot"><span class="annottext">Set MetaId -&gt; TCMT IO () -&gt; TCMT IO (Set MetaId)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; [MetaId] -&gt; TCMT IO ()
</span><a href="#local-6989586621680613910"><span class="hs-identifier hs-var">suggestNames</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613913"><span class="hs-identifier hs-var">metas</span></a></span><span>
</span><span id="line-242"></span><span>      </span><span class="annot"><span class="annottext">MetaInstantiation
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Set MetaId)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613898"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613898"><span class="hs-identifier hs-var">alsoGeneralize</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613897"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613897"><span class="hs-identifier hs-var">reallyDontGeneralize</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; Bool) -&gt; [MetaId] -&gt; ([MetaId], [MetaId])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Set MetaId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set MetaId
</span><a href="#local-6989586621680613921"><span class="hs-identifier hs-var">inherited</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([MetaId] -&gt; ([MetaId], [MetaId]))
-&gt; [MetaId] -&gt; ([MetaId], [MetaId])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((MetaId, MetaVariable) -&gt; MetaId)
-&gt; [(MetaId, MetaVariable)] -&gt; [MetaId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(MetaId, MetaVariable) -&gt; MetaId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613957"><span class="hs-identifier hs-var">nongeneralizableOpen</span></a></span><span>
</span><span id="line-245"></span><span>      </span><span id="local-6989586621680613896"><span class="annot"><span class="annottext">generalizeOver :: [MetaId]
</span><a href="#local-6989586621680613896"><span class="hs-identifier hs-var hs-var">generalizeOver</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((MetaId, MetaVariable) -&gt; MetaId)
-&gt; [(MetaId, MetaVariable)] -&gt; [MetaId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(MetaId, MetaVariable) -&gt; MetaId
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(MetaId, MetaVariable)]
</span><a href="#local-6989586621680613958"><span class="hs-identifier hs-var">generalizableOpen</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId] -&gt; [MetaId] -&gt; [MetaId]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613898"><span class="hs-identifier hs-var">alsoGeneralize</span></a></span><span>
</span><span id="line-246"></span><span>      </span><span id="local-6989586621680613895"><span class="annot"><span class="annottext">shouldGeneralize :: MetaId -&gt; Bool
</span><a href="#local-6989586621680613895"><span class="hs-identifier hs-var hs-var">shouldGeneralize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613896"><span class="hs-identifier hs-var">generalizeOver</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId] -&gt; MetaId -&gt; Bool
forall a. Ord a =&gt; [a] -&gt; a -&gt; Bool
</span><a href="Agda.Utils.List.html#hasElem"><span class="hs-operator hs-var">`hasElem`</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;alsoGeneralize       = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MetaId -&gt; TCM Doc) -&gt; [MetaId] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613898"><span class="hs-identifier hs-var">alsoGeneralize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;reallyDontGeneralize = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MetaId -&gt; TCM Doc) -&gt; [MetaId] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613897"><span class="hs-identifier hs-var">reallyDontGeneralize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;we're generalizing over&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MetaId -&gt; TCM Doc) -&gt; [MetaId] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613896"><span class="hs-identifier hs-var">generalizeOver</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-comment">-- Sort metas in dependency order. Include open metas that we are not</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-comment">-- generalizing over, since they will need to be pruned appropriately (see</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-comment">-- Issue 3672).</span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621680613894"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613894"><span class="hs-identifier hs-var">allSortedMetas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO [MetaId] -&gt; TCMT IO (Maybe [MetaId]) -&gt; TCMT IO [MetaId]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><a href="Agda.Utils.Maybe.html#fromMaybeM"><span class="hs-identifier hs-var">fromMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO [MetaId]
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#GeneralizeCyclicDependency"><span class="hs-identifier hs-var">GeneralizeCyclicDependency</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Maybe [MetaId]) -&gt; TCMT IO [MetaId])
-&gt; TCMT IO (Maybe [MetaId]) -&gt; TCMT IO [MetaId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><span class="annottext">[MetaId] -&gt; TCMT IO (Maybe [MetaId])
</span><a href="Agda.TypeChecking.MetaVars.html#dependencySortMetas"><span class="hs-identifier hs-var">dependencySortMetas</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613896"><span class="hs-identifier hs-var">generalizeOver</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId] -&gt; [MetaId] -&gt; [MetaId]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613897"><span class="hs-identifier hs-var">reallyDontGeneralize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613889"><span class="annot"><span class="annottext">sortedMetas :: [MetaId]
</span><a href="#local-6989586621680613889"><span class="hs-identifier hs-var hs-var">sortedMetas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; Bool) -&gt; [MetaId] -&gt; [MetaId]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Bool
</span><a href="#local-6989586621680613895"><span class="hs-identifier hs-var">shouldGeneralize</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613894"><span class="hs-identifier hs-var">allSortedMetas</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613888"><span class="annot"><span class="annottext">dropCxt :: Empty -&gt; m a -&gt; m a
</span><a href="#local-6989586621680613888"><span class="hs-identifier hs-var hs-var">dropCxt</span></a></span></span><span> </span><span id="local-6989586621680613887"><span class="annot"><span class="annottext">Empty
</span><a href="#local-6989586621680613887"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution
-&gt; ([Dom (Name, Type)] -&gt; [Dom (Name, Type)]) -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Substitution
-&gt; ([Dom (Name, Type)] -&gt; [Dom (Name, Type)]) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#updateContext"><span class="hs-identifier hs-var">updateContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Empty -&gt; Int -&gt; Substitution
forall a. Empty -&gt; Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#strengthenS"><span class="hs-identifier hs-var">strengthenS</span></a></span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="#local-6989586621680613887"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Dom (Name, Type)] -&gt; [Dom (Name, Type)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-comment">-- Create the pre-record type (we don't yet know the types of the fields)</span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680613886"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613886"><span class="hs-identifier hs-var">genRecName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613885"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613885"><span class="hs-identifier hs-var">genRecCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613884"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613884"><span class="hs-identifier hs-var">genRecFields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Empty
-&gt; TCMT IO (QName, ConHead, [QName])
-&gt; TCMT IO (QName, ConHead, [QName])
forall (m :: * -&gt; *) a. MonadAddContext m =&gt; Empty -&gt; m a -&gt; m a
</span><a href="#local-6989586621680613888"><span class="hs-identifier hs-var">dropCxt</span></a></span><span> </span><span class="annot"><span class="annottext">Empty
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (QName, ConHead, [QName])
 -&gt; TCMT IO (QName, ConHead, [QName]))
-&gt; TCMT IO (QName, ConHead, [QName])
-&gt; TCMT IO (QName, ConHead, [QName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-266"></span><span>      </span><span class="annot"><span class="annottext">Type -&gt; [MetaId] -&gt; TCMT IO (QName, ConHead, [QName])
</span><a href="Agda.TypeChecking.Generalize.html#createGenRecordType"><span class="hs-identifier hs-var">createGenRecordType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614002"><span class="hs-identifier hs-var">genRecMeta</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613889"><span class="hs-identifier hs-var">sortedMetas</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCM Doc] -&gt; TCM Doc) -&gt; [TCM Doc] -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;created genRecordType&quot;</span></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;genRecName   = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613886"><span class="hs-identifier hs-var">genRecName</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;genRecCon    = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613885"><span class="hs-identifier hs-var">genRecCon</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;genRecFields = &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName -&gt; TCM Doc) -&gt; [QName] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613884"><span class="hs-identifier hs-var">genRecFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-comment">-- Solve the generalizable metas. Each generalizable meta is solved by projecting the</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-comment">-- corresponding field from the genTel record.</span><span>
</span><span id="line-277"></span><span>  </span><span id="local-6989586621680613882"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613882"><span class="hs-identifier hs-var">cxtTel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Telescope
forall (m :: * -&gt; *). (Applicative m, MonadTCEnv m) =&gt; m Telescope
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-var">getContextTelescope</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613881"><span class="annot"><span class="annottext">solve :: MetaId -&gt; QName -&gt; TCMT IO ()
</span><a href="#local-6989586621680613881"><span class="hs-identifier hs-var hs-var">solve</span></a></span></span><span> </span><span id="local-6989586621680613880"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613880"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680613879"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613879"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;solving generalized meta&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-280"></span><span>          </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613880"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;:=&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Elim' Term
forall a. ProjOrigin -&gt; QName -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-var">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613879"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-comment">-- m should not be instantiated, but if we don't check constraints</span><span>
</span><span id="line-282"></span><span>        </span><span class="hs-comment">-- properly it could be (#3666 and #3667). Fail hard instead of</span><span>
</span><span id="line-283"></span><span>        </span><span class="hs-comment">-- generating bogus types.</span><span>
</span><span id="line-284"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Bool
forall a (m :: * -&gt; *).
(IsInstantiatedMeta a, MonadFail m, ReadTCState m) =&gt;
a -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#isInstantiatedMeta"><span class="hs-identifier hs-var">isInstantiatedMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613880"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-285"></span><span>        </span><span class="annot"><span class="annottext">MetaId -&gt; [Arg ArgName] -&gt; Term -&gt; TCMT IO ()
forall (m :: * -&gt; *).
(MonadMetaSolver m, MonadMetaSolver m) =&gt;
MetaId -&gt; [Arg ArgName] -&gt; Term -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#assignTerm%27"><span class="hs-identifier hs-var">assignTerm'</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613880"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; [Arg ArgName]
forall a. TelToArgs a =&gt; a -&gt; [Arg ArgName]
</span><a href="Agda.Syntax.Internal.html#telToArgs"><span class="hs-identifier hs-var">telToArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613882"><span class="hs-identifier hs-var">cxtTel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; TCMT IO ()) -&gt; Term -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Elim' Term
forall a. ProjOrigin -&gt; QName -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-var">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613879"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="annottext">(MetaId -&gt; QName -&gt; TCMT IO ())
-&gt; [MetaId] -&gt; [QName] -&gt; TCMT IO ()
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m ()
</span><span class="hs-identifier hs-var">zipWithM_</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; QName -&gt; TCMT IO ()
</span><a href="#local-6989586621680613881"><span class="hs-identifier hs-var">solve</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613889"><span class="hs-identifier hs-var">sortedMetas</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613884"><span class="hs-identifier hs-var">genRecFields</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-comment">-- Record the named variables in the telescope</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613870"><span class="annot"><span class="annottext">telNames :: [Maybe name]
</span><a href="#local-6989586621680613870"><span class="hs-identifier hs-var hs-var">telNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; Maybe name) -&gt; [MetaId] -&gt; [Maybe name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Map MetaId name -&gt; Maybe name
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-operator hs-var">`Map.lookup`</span></span><span> </span><span class="annot"><span class="annottext">Map MetaId name
</span><a href="#local-6989586621680614001"><span class="hs-identifier hs-var">nameMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613889"><span class="hs-identifier hs-var">sortedMetas</span></a></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-comment">-- Build the telescope of generalized metas</span><span>
</span><span id="line-292"></span><span>  </span><span id="local-6989586621680613869"><span class="annot"><span class="annottext">[(Arg ArgName, Type)]
</span><a href="#local-6989586621680613869"><span class="hs-identifier hs-var">teleTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>    </span><span id="local-6989586621680613868"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621680613868"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Args
forall (m :: * -&gt; *). (Applicative m, MonadTCEnv m) =&gt; m Args
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextArgs"><span class="hs-identifier hs-var">getContextArgs</span></a></span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><span class="annottext">([[(Arg ArgName, Type)]] -&gt; [(Arg ArgName, Type)])
-&gt; TCMT IO [[(Arg ArgName, Type)]] -&gt; TCMT IO [(Arg ArgName, Type)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[[(Arg ArgName, Type)]] -&gt; [(Arg ArgName, Type)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO [[(Arg ArgName, Type)]] -&gt; TCMT IO [(Arg ArgName, Type)])
-&gt; TCMT IO [[(Arg ArgName, Type)]] -&gt; TCMT IO [(Arg ArgName, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[MetaId]
-&gt; (MetaId -&gt; TCMT IO [(Arg ArgName, Type)])
-&gt; TCMT IO [[(Arg ArgName, Type)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613889"><span class="hs-identifier hs-var">sortedMetas</span></a></span><span> </span><span class="annot"><span class="annottext">((MetaId -&gt; TCMT IO [(Arg ArgName, Type)])
 -&gt; TCMT IO [[(Arg ArgName, Type)]])
-&gt; (MetaId -&gt; TCMT IO [(Arg ArgName, Type)])
-&gt; TCMT IO [[(Arg ArgName, Type)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680613865"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613865"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-295"></span><span>      </span><span id="local-6989586621680613864"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613864"><span class="hs-identifier hs-var">mv</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaVariable
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupMeta"><span class="hs-identifier hs-var">lookupMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613865"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-296"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613863"><span class="annot"><span class="annottext">info :: ArgInfo
</span><a href="#local-6989586621680613863"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-297"></span><span>            </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613865"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; [MetaId] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613898"><span class="hs-identifier hs-var">alsoGeneralize</span></a></span><span>
</span><span id="line-298"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Modality -&gt; ArgInfo -&gt; ArgInfo
forall a. LensModality a =&gt; Modality -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setModality"><span class="hs-identifier hs-var">setModality</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Agda.Syntax.Common.html#defaultModality"><span class="hs-identifier hs-var">defaultModality</span></a></span><span>
</span><span id="line-299"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; ArgInfo
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; ArgInfo) -&gt; ArgInfo -&gt; ArgInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-300"></span><span>            </span><span class="annot"><span class="annottext">ArgInfo -&gt; ArgInfo
forall a. LensHiding a =&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#hideOrKeepInstance"><span class="hs-identifier hs-var">hideOrKeepInstance</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; ArgInfo) -&gt; ArgInfo -&gt; ArgInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-301"></span><span>            </span><span class="annot"><span class="annottext">Arg DoGeneralize -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg DoGeneralize -&gt; ArgInfo) -&gt; Arg DoGeneralize -&gt; ArgInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; Arg DoGeneralize
</span><a href="Agda.TypeChecking.Monad.Base.html#miGeneralizable"><span class="hs-identifier hs-var hs-var">miGeneralizable</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaInfo -&gt; Arg DoGeneralize) -&gt; MetaInfo -&gt; Arg DoGeneralize
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInfo"><span class="hs-identifier hs-var hs-var">mvInfo</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613864"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-302"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#HasType"><span class="hs-identifier hs-type">HasType</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">jMetaType :: forall a. Judgement a -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#jMetaType"><span class="hs-identifier hs-var">jMetaType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680613854"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613854"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Judgement MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#mvJudgement"><span class="hs-identifier hs-var hs-var">mvJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613864"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-303"></span><span>          </span><span id="local-6989586621680613852"><span class="annot"><span class="annottext">perm :: Permutation
</span><a href="#local-6989586621680613852"><span class="hs-identifier hs-var hs-var">perm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Permutation
</span><a href="Agda.TypeChecking.Monad.Base.html#mvPermutation"><span class="hs-identifier hs-var hs-var">mvPermutation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613864"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-304"></span><span>      </span><span id="local-6989586621680613851"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613851"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Args -&gt; TCM Type
forall a (m :: * -&gt; *).
(PiApplyM a, MonadReduce m, HasBuiltins m) =&gt;
Type -&gt; a -&gt; m Type
</span><a href="Agda.TypeChecking.Telescope.html#piApplyM"><span class="hs-identifier hs-var">piApplyM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613854"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(Args -&gt; TCM Type) -&gt; Args -&gt; TCM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Permutation -&gt; Args -&gt; Args
forall a. Permutation -&gt; [a] -&gt; [a]
</span><a href="Agda.Utils.Permutation.html#permute"><span class="hs-identifier hs-var">permute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Permutation -&gt; Permutation
</span><a href="Agda.Utils.Permutation.html#takeP"><span class="hs-identifier hs-var">takeP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Args -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621680613868"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621680613852"><span class="hs-identifier hs-var">perm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621680613868"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-305"></span><span>      </span><span class="annot"><span class="annottext">[(Arg ArgName, Type)] -&gt; TCMT IO [(Arg ArgName, Type)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; ArgName -&gt; Arg ArgName
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621680613863"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; Arg ArgName) -&gt; ArgName -&gt; Arg ArgName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; ArgName
</span><a href="Agda.TypeChecking.Monad.Base.html#miNameSuggestion"><span class="hs-identifier hs-var hs-var">miNameSuggestion</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaInfo -&gt; ArgName) -&gt; MetaInfo -&gt; ArgName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInfo"><span class="hs-identifier hs-var hs-var">mvInfo</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613864"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613851"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613844"><span class="annot"><span class="annottext">genTel :: Telescope
</span><a href="#local-6989586621680613844"><span class="hs-identifier hs-var hs-var">genTel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; [(Arg ArgName, Type)] -&gt; Telescope
</span><a href="Agda.TypeChecking.Generalize.html#buildGeneralizeTel"><span class="hs-identifier hs-var">buildGeneralizeTel</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613885"><span class="hs-identifier hs-var">genRecCon</span></a></span><span> </span><span class="annot"><span class="annottext">[(Arg ArgName, Type)]
</span><a href="#local-6989586621680613869"><span class="hs-identifier hs-var">teleTypes</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;genTel =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613844"><span class="hs-identifier hs-var">genTel</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-comment">-- Now we need to prune the unsolved metas to make sure they respect the new</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-comment">-- dependencies (#3672). Also update interaction points to point to pruned metas.</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613842"><span class="annot"><span class="annottext">inscope :: (InteractionId, InteractionPoint) -&gt; [(MetaId, InteractionId)]
</span><a href="#local-6989586621680613842"><span class="hs-identifier hs-var hs-var">inscope</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613841"><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621680613841"><span class="hs-identifier hs-var">ii</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InteractionPoint"><span class="hs-identifier hs-type">InteractionPoint</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ipMeta :: InteractionPoint -&gt; Maybe MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#ipMeta"><span class="hs-identifier hs-var">ipMeta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680613838"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613838"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntSet -&gt; Bool
</span><span class="hs-identifier hs-var">IntSet.member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Int
</span><a href="Agda.Syntax.Common.html#metaId"><span class="hs-identifier hs-var hs-var">metaId</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613838"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621680614000"><span class="hs-identifier hs-var">allmetas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613838"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InteractionId
</span><a href="#local-6989586621680613841"><span class="hs-identifier hs-var">ii</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-315"></span><span>      </span><span class="annot"><a href="#local-6989586621680613842"><span class="hs-identifier hs-var">inscope</span></a></span><span> </span><span class="annot"><span class="annottext">(InteractionId, InteractionPoint)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-316"></span><span>  </span><span id="local-6989586621680613835"><span class="annot"><span class="annottext">Map MetaId InteractionId
</span><a href="#local-6989586621680613835"><span class="hs-identifier hs-var">ips</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(MetaId, InteractionId)] -&gt; Map MetaId InteractionId
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(MetaId, InteractionId)] -&gt; Map MetaId InteractionId)
-&gt; (Map InteractionId InteractionPoint
    -&gt; [(MetaId, InteractionId)])
-&gt; Map InteractionId InteractionPoint
-&gt; Map MetaId InteractionId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((InteractionId, InteractionPoint) -&gt; [(MetaId, InteractionId)])
-&gt; [(InteractionId, InteractionPoint)] -&gt; [(MetaId, InteractionId)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(InteractionId, InteractionPoint) -&gt; [(MetaId, InteractionId)]
</span><a href="#local-6989586621680613842"><span class="hs-identifier hs-var">inscope</span></a></span><span> </span><span class="annot"><span class="annottext">([(InteractionId, InteractionPoint)] -&gt; [(MetaId, InteractionId)])
-&gt; (Map InteractionId InteractionPoint
    -&gt; [(InteractionId, InteractionPoint)])
-&gt; Map InteractionId InteractionPoint
-&gt; [(MetaId, InteractionId)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map InteractionId InteractionPoint
-&gt; [(InteractionId, InteractionPoint)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map InteractionId InteractionPoint -&gt; Map MetaId InteractionId)
-&gt; TCMT IO (Map InteractionId InteractionPoint)
-&gt; TCMT IO (Map MetaId InteractionId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' (Map InteractionId InteractionPoint) TCState
-&gt; TCMT IO (Map InteractionId InteractionPoint)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' a TCState -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (Map InteractionId InteractionPoint) TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#stInteractionPoints"><span class="hs-identifier hs-var">stInteractionPoints</span></a></span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><span class="annottext">QName
-&gt; ConHead
-&gt; Telescope
-&gt; [QName]
-&gt; Map MetaId InteractionId
-&gt; (MetaId -&gt; Bool)
-&gt; [MetaId]
-&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Generalize.html#pruneUnsolvedMetas"><span class="hs-identifier hs-var">pruneUnsolvedMetas</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613886"><span class="hs-identifier hs-var">genRecName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613885"><span class="hs-identifier hs-var">genRecCon</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613844"><span class="hs-identifier hs-var">genTel</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613884"><span class="hs-identifier hs-var">genRecFields</span></a></span><span> </span><span class="annot"><span class="annottext">Map MetaId InteractionId
</span><a href="#local-6989586621680613835"><span class="hs-identifier hs-var">ips</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Bool
</span><a href="#local-6989586621680613895"><span class="hs-identifier hs-var">shouldGeneralize</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613894"><span class="hs-identifier hs-var">allSortedMetas</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-comment">-- Fill in the missing details of the telescope record.</span><span>
</span><span id="line-320"></span><span>  </span><span class="annot"><span class="annottext">Empty -&gt; TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) a. MonadAddContext m =&gt; Empty -&gt; m a -&gt; m a
</span><a href="#local-6989586621680613888"><span class="hs-identifier hs-var">dropCxt</span></a></span><span> </span><span class="annot"><span class="annottext">Empty
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; ConHead -&gt; [QName] -&gt; Type -&gt; Telescope -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Generalize.html#fillInGenRecordDetails"><span class="hs-identifier hs-var">fillInGenRecordDetails</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613886"><span class="hs-identifier hs-var">genRecName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613885"><span class="hs-identifier hs-var">genRecCon</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613884"><span class="hs-identifier hs-var">genRecFields</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680614002"><span class="hs-identifier hs-var">genRecMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613844"><span class="hs-identifier hs-var">genTel</span></a></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-comment">-- Now abstract over the telescope. We need to apply the substitution that subsitutes a record</span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-comment">-- value packing up the generalized variables for the genTel variable.</span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613828"><span class="annot"><span class="annottext">sub :: Substitution
</span><a href="#local-6989586621680613828"><span class="hs-identifier hs-var hs-var">sub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; [ArgInfo] -&gt; Int -&gt; Substitution
</span><a href="Agda.TypeChecking.Generalize.html#unpackSub"><span class="hs-identifier hs-var">unpackSub</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613885"><span class="hs-identifier hs-var">genRecCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Arg ArgName, Type) -&gt; ArgInfo)
-&gt; [(Arg ArgName, Type)] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg ArgName -&gt; ArgInfo
forall e. Arg e -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#argInfo"><span class="hs-identifier hs-var hs-var">argInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg ArgName -&gt; ArgInfo)
-&gt; ((Arg ArgName, Type) -&gt; Arg ArgName)
-&gt; (Arg ArgName, Type)
-&gt; ArgInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Arg ArgName, Type) -&gt; Arg ArgName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Arg ArgName, Type)]
</span><a href="#local-6989586621680613869"><span class="hs-identifier hs-var">teleTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Arg ArgName, Type)] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Arg ArgName, Type)]
</span><a href="#local-6989586621680613869"><span class="hs-identifier hs-var">teleTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>  </span><span class="annot"><span class="annottext">(Telescope, [Maybe name], Substitution)
-&gt; TCM (Telescope, [Maybe name], Substitution)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613844"><span class="hs-identifier hs-var">genTel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Maybe name]
</span><a href="#local-6989586621680613870"><span class="hs-identifier hs-var">telNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613828"><span class="hs-identifier hs-var">sub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">-- | Prune unsolved metas (#3672). The input includes also the generalized metas and is sorted in</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- dependency order. The telescope is the generalized telescope.</span><span>
</span><span id="line-330"></span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#pruneUnsolvedMetas"><span class="hs-identifier hs-type">pruneUnsolvedMetas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#InteractionId"><span class="hs-identifier hs-type">InteractionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span id="pruneUnsolvedMetas"><span class="annot"><span class="annottext">pruneUnsolvedMetas :: QName
-&gt; ConHead
-&gt; Telescope
-&gt; [QName]
-&gt; Map MetaId InteractionId
-&gt; (MetaId -&gt; Bool)
-&gt; [MetaId]
-&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Generalize.html#pruneUnsolvedMetas"><span class="hs-identifier hs-var hs-var">pruneUnsolvedMetas</span></a></span></span><span> </span><span id="local-6989586621680613825"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613825"><span class="hs-identifier hs-var">genRecName</span></a></span></span><span> </span><span id="local-6989586621680613824"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613824"><span class="hs-identifier hs-var">genRecCon</span></a></span></span><span> </span><span id="local-6989586621680613823"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613823"><span class="hs-identifier hs-var">genTel</span></a></span></span><span> </span><span id="local-6989586621680613822"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613822"><span class="hs-identifier hs-var">genRecFields</span></a></span></span><span> </span><span id="local-6989586621680613821"><span class="annot"><span class="annottext">Map MetaId InteractionId
</span><a href="#local-6989586621680613821"><span class="hs-identifier hs-var">interactionPoints</span></a></span></span><span> </span><span id="local-6989586621680613820"><span class="annot"><span class="annottext">MetaId -&gt; Bool
</span><a href="#local-6989586621680613820"><span class="hs-identifier hs-var">isGeneralized</span></a></span></span><span> </span><span id="local-6989586621680613819"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613819"><span class="hs-identifier hs-var">metas</span></a></span></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; Bool) -&gt; [MetaId] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Bool
</span><a href="#local-6989586621680613820"><span class="hs-identifier hs-var">isGeneralized</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613819"><span class="hs-identifier hs-var">metas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Telescope -&gt; [MetaId] -&gt; TCMT IO ()
</span><a href="#local-6989586621680613817"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613823"><span class="hs-identifier hs-var">genTel</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613819"><span class="hs-identifier hs-var">metas</span></a></span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>    </span><span id="local-6989586621680613817"><span class="annot"><span class="annottext">prune :: [Dom' Term (ArgName, Type)] -&gt; Telescope -&gt; [MetaId] -&gt; TCMT IO ()
</span><a href="#local-6989586621680613817"><span class="hs-identifier hs-var hs-var">prune</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><a href="#local-6989586621680613817"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span id="local-6989586621680613816"><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613816"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span id="local-6989586621680613815"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613815"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613814"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613814"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680613813"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613813"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Bool
</span><a href="#local-6989586621680613820"><span class="hs-identifier hs-var">isGeneralized</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613814"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-comment">-- If x is a blocked term we shouldn't instantiate it.</span><span>
</span><span id="line-338"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; TCMT IO Bool -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Bool
</span><a href="Agda.TypeChecking.MetaVars.html#isBlockedTerm"><span class="hs-identifier hs-var">isBlockedTerm</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613814"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>        </span><span id="local-6989586621680613811"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613811"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613815"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaId
</span><a href="#local-6989586621680613809"><span class="hs-identifier hs-var">prePrune</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613814"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-340"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613814"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><span class="annottext">Telescope -&gt; MetaId -&gt; TCMT IO ()
</span><a href="#local-6989586621680613808"><span class="hs-identifier hs-var">pruneMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Telescope
</span><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-var">telFromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; Telescope)
-&gt; [Dom' Term (ArgName, Type)] -&gt; Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613816"><span class="hs-identifier hs-var">cxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613811"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-342"></span><span>      </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Telescope -&gt; [MetaId] -&gt; TCMT IO ()
</span><a href="#local-6989586621680613817"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613816"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613815"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613813"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><a href="#local-6989586621680613817"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span id="local-6989586621680613806"><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613806"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span> </span><span id="local-6989586621680613804"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621680613804"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680613803"><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621680613803"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613802"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613802"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680613801"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613801"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Telescope -&gt; [MetaId] -&gt; TCMT IO ()
</span><a href="#local-6989586621680613817"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; (ArgName, Type)) -&gt; Dom Type -&gt; Dom' Term (ArgName, Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613800"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621680613804"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term (ArgName, Type)
-&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613806"><span class="hs-identifier hs-var">cxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Abs Telescope -&gt; Telescope
forall a. Abs a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unAbs"><span class="hs-identifier hs-var hs-var">unAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621680613803"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613801"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680613800"><span class="annot"><span class="annottext">x :: ArgName
</span><a href="#local-6989586621680613800"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Abs Telescope -&gt; ArgName
forall a. Abs a -&gt; ArgName
</span><a href="Agda.Syntax.Internal.html#absName"><span class="hs-identifier hs-var hs-var">absName</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621680613803"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><a href="#local-6989586621680613817"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621680613797"><span class="annot"><span class="annottext">sub :: Int -&gt; Substitution
</span><a href="#local-6989586621680613797"><span class="hs-identifier hs-var hs-var">sub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; [ArgInfo] -&gt; Int -&gt; Substitution
</span><a href="Agda.TypeChecking.Generalize.html#unpackSub"><span class="hs-identifier hs-var">unpackSub</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613824"><span class="hs-identifier hs-var">genRecCon</span></a></span><span> </span><span class="annot"><span class="annottext">([ArgInfo] -&gt; Int -&gt; Substitution)
-&gt; [ArgInfo] -&gt; Int -&gt; Substitution
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Dom' Term (ArgName, Type) -&gt; ArgInfo)
-&gt; [Dom' Term (ArgName, Type)] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term (ArgName, Type) -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; [ArgInfo])
-&gt; [Dom' Term (ArgName, Type)] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613823"><span class="hs-identifier hs-var">genTel</span></a></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621680614285"><span class="annot"><a href="#local-6989586621680613796"><span class="hs-identifier hs-type">prepruneError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680614285"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621680613796"><span class="annot"><span class="annottext">prepruneError :: MetaId -&gt; ArgName -&gt; TCM a
</span><a href="#local-6989586621680613796"><span class="hs-identifier hs-var hs-var">prepruneError</span></a></span></span><span> </span><span id="local-6989586621680613795"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613795"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680613794"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613794"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-351"></span><span>      </span><span id="local-6989586621680613793"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680613793"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Range
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m) =&gt;
MetaId -&gt; m Range
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaRange"><span class="hs-identifier hs-var">getMetaRange</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613795"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-352"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613791"><span class="annot"><span class="annottext">msg :: ArgName
</span><a href="#local-6989586621680613791"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;Congratulations! You have found an easter egg (#&quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613794"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;). &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-353"></span><span>                </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;Be the first to submit a self-contained test case (max 50 lines of code) &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-354"></span><span>                </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;producing this error message to https://github.com/agda/agda/issues/3672 &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-355"></span><span>                </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;to receive a small prize.&quot;</span></span><span>
</span><span id="line-356"></span><span>          </span><span id="local-6989586621680613790"><span class="annot"><span class="annottext">cause :: ArgName
</span><a href="#local-6989586621680613790"><span class="hs-identifier hs-var hs-var">cause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;The error is caused by complicated dependencies between unsolved &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-357"></span><span>                  </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;metavariables and generalized variables. In particular, this meta:&quot;</span></span><span>
</span><span id="line-358"></span><span>      </span><span class="annot"><span class="annottext">Doc -&gt; TCM a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
Doc -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#genericDocError"><span class="hs-identifier hs-var">genericDocError</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TCM a) -&gt; TCM Doc -&gt; TCM a
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span>
</span><span id="line-359"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fwords"><span class="hs-identifier hs-var">fwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613791"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%24%2B%24"><span class="hs-operator hs-var">$+$</span></a></span><span>
</span><span id="line-360"></span><span>         </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fwords"><span class="hs-identifier hs-var">fwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613790"><span class="hs-identifier hs-var">cause</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-var">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613795"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;at&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Range -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680613793"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-361"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-comment">-- If one of the fields depend on this meta, we have to make sure that this meta doesn't depend</span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-comment">-- on any variables introduced after the genRec. See test/Fail/Issue3672b.agda for a test case.</span><span>
</span><span id="line-365"></span><span>    </span><span id="local-6989586621680613809"><span class="annot"><span class="annottext">prePrune :: MetaId -&gt; TCMT IO MetaId
</span><a href="#local-6989586621680613809"><span class="hs-identifier hs-var hs-var">prePrune</span></a></span></span><span> </span><span id="local-6989586621680613784"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>      </span><span id="local-6989586621680613783"><span class="annot"><span class="annottext">CheckpointId
</span><a href="#local-6989586621680613783"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' CheckpointId TCEnv -&gt; TCMT IO CheckpointId
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' a TCEnv -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' CheckpointId TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#eCurrentCheckpoint"><span class="hs-identifier hs-var">eCurrentCheckpoint</span></a></span><span>
</span><span id="line-367"></span><span>      </span><span id="local-6989586621680613782"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613782"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaVariable
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupMeta"><span class="hs-identifier hs-var">lookupMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680613781"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613781"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613780"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613780"><span class="hs-identifier hs-var">_A</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaVariable
-&gt; (Range -&gt; TCMT IO (Int, Maybe Type))
-&gt; TCMT IO (Int, Maybe Type)
forall (m :: * -&gt; *) a c b.
(MonadTCEnv m, ReadTCState m, LensClosure a c) =&gt;
c -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613782"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="annot"><span class="annottext">((Range -&gt; TCMT IO (Int, Maybe Type)) -&gt; TCMT IO (Int, Maybe Type))
-&gt; (Range -&gt; TCMT IO (Int, Maybe Type))
-&gt; TCMT IO (Int, Maybe Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>        </span><span id="local-6989586621680613779"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613779"><span class="hs-identifier hs-var">&#948;</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CheckpointId -&gt; TCMT IO Substitution
forall (tcm :: * -&gt; *).
MonadTCEnv tcm =&gt;
CheckpointId -&gt; tcm Substitution
</span><a href="Agda.TypeChecking.Monad.Context.html#checkpointSubstitution"><span class="hs-identifier hs-var">checkpointSubstitution</span></a></span><span> </span><span class="annot"><span class="annottext">CheckpointId
</span><a href="#local-6989586621680613783"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-370"></span><span>        </span><span id="local-6989586621680613777"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613777"><span class="hs-identifier hs-var">_A</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Judgement MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#mvJudgement"><span class="hs-identifier hs-var hs-var">mvJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613782"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-371"></span><span>                </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IsSort"><span class="hs-identifier hs-type">IsSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; TCMT IO (Maybe Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-372"></span><span>                </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#HasType"><span class="hs-identifier hs-type">HasType</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Maybe Type) -&gt; TCM Type -&gt; TCMT IO (Maybe Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Type
forall (m :: * -&gt; *).
(MonadFail m, MonadTCEnv m, ReadTCState m, MonadReduce m,
 HasBuiltins m) =&gt;
MetaId -&gt; m Type
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaTypeInContext"><span class="hs-identifier hs-var">getMetaTypeInContext</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613779"><span class="hs-identifier hs-var">&#948;</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Wk"><span class="hs-identifier hs-type">Wk</span></a></span><span> </span><span id="local-6989586621680613774"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613774"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="Agda.Syntax.Internal.html#IdS"><span class="hs-identifier hs-var">IdS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, Maybe Type) -&gt; TCMT IO (Int, Maybe Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613774"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613777"><span class="hs-identifier hs-var">_A</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>          </span><span class="annot"><span class="annottext">Substitution
</span><a href="Agda.Syntax.Internal.html#IdS"><span class="hs-identifier hs-var">IdS</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, Maybe Type) -&gt; TCMT IO (Int, Maybe Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613777"><span class="hs-identifier hs-var">_A</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>          </span><span class="annot"><span class="annottext">Substitution
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; ArgName -&gt; TCMT IO (Int, Maybe Type)
forall a. MetaId -&gt; ArgName -&gt; TCM a
</span><a href="#local-6989586621680613796"><span class="hs-identifier hs-var">prepruneError</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;RFCX&quot;</span></span><span>
</span><span id="line-377"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613781"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-378"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize.prune.pre&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-379"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;prepruning&quot;</span></span><span>
</span><span id="line-380"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Judgement MetaId -&gt; Type
forall a. Judgement a -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#jMetaType"><span class="hs-identifier hs-var hs-var">jMetaType</span></a></span><span> </span><span class="annot"><span class="annottext">(Judgement MetaId -&gt; Type) -&gt; Judgement MetaId -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Judgement MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#mvJudgement"><span class="hs-identifier hs-var hs-var">mvJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613782"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;|&#916;| =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Show a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pshow"><span class="hs-identifier hs-var">pshow</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613781"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>        </span><span class="hs-comment">-- We have</span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-comment">--   &#915; (r : GenRec)            current context</span><span>
</span><span id="line-385"></span><span>        </span><span class="hs-comment">--   &#915; (r : GenRec) &#916; &#8866; x : A  with |&#916;| = i</span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-comment">-- and we need to get rid of the dependency on &#916;.</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>        </span><span class="hs-comment">-- We can only do this if A does not depend on &#916;, so check this first.</span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; Maybe (Int, IntSet)
</span><span class="hs-identifier hs-var">IntSet.minView</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Type -&gt; IntSet
forall t. Free t =&gt; t -&gt; IntSet
</span><a href="Agda.TypeChecking.Free.html#allFreeVars"><span class="hs-identifier hs-var">allFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613780"><span class="hs-identifier hs-var">_A</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-390"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613770"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613770"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IntSet
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613770"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613781"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; ArgName -&gt; TCMT IO ()
forall a. MetaId -&gt; ArgName -&gt; TCM a
</span><a href="#local-6989586621680613796"><span class="hs-identifier hs-var">prepruneError</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;FVTY&quot;</span></span><span>
</span><span id="line-391"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Int, IntSet)
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-comment">-- If it doesn't we can strenghten it to the current context (this is done by</span><span>
</span><span id="line-394"></span><span>        </span><span class="hs-comment">-- newMetaFromOld).</span><span>
</span><span id="line-395"></span><span>        </span><span class="hs-comment">--   &#915; (r : GenRec) &#8866; &#961; : &#915; (r : GenRec) &#916;</span><span>
</span><span id="line-396"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613768"><span class="annot"><span class="annottext">&#961; :: Substitution
</span><a href="#local-6989586621680613768"><span class="hs-identifier hs-var hs-var">&#961;</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Empty -&gt; Int -&gt; Substitution
forall a. Empty -&gt; Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#strengthenS"><span class="hs-identifier hs-var">strengthenS</span></a></span><span> </span><span class="annot"><span class="annottext">Empty
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613781"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-397"></span><span>            </span><span id="local-6989586621680613767"><span class="annot"><span class="annottext">&#961;' :: Substitution
</span><a href="#local-6989586621680613767"><span class="hs-identifier hs-var hs-var">&#961;'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution
forall a. Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raiseS"><span class="hs-identifier hs-var">raiseS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613781"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680613766"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613766"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613765"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613765"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Substitution -&gt; Maybe Type -&gt; TCM (MetaId, Term)
</span><a href="#local-6989586621680613764"><span class="hs-identifier hs-var">newMetaFromOld</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613782"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613768"><span class="hs-identifier hs-var">&#961;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613780"><span class="hs-identifier hs-var">_A</span></a></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613763"><span class="annot"><span class="annottext">u&#961;' :: Term
</span><a href="#local-6989586621680613763"><span class="hs-identifier hs-var hs-var">u&#961;'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Term) -&gt; Term -&gt; Term
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Term)
</span><a href="#local-6989586621680613767"><span class="hs-identifier hs-var">&#961;'</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613765"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize.prune.pre&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-404"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;u    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613765"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-405"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;u&#961;&#8315;&#185; =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613763"><span class="hs-identifier hs-var">u&#961;'</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>        </span><span class="hs-comment">-- To solve it we enter the context of x again</span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><span class="annottext">MetaVariable -&gt; (Range -&gt; TCMT IO MetaId) -&gt; TCMT IO MetaId
forall (m :: * -&gt; *) a c b.
(MonadTCEnv m, ReadTCState m, LensClosure a c) =&gt;
c -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613782"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="annot"><span class="annottext">((Range -&gt; TCMT IO MetaId) -&gt; TCMT IO MetaId)
-&gt; (Range -&gt; TCMT IO MetaId) -&gt; TCMT IO MetaId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-409"></span><span>          </span><span class="hs-comment">-- v is x applied to the context variables</span><span>
</span><span id="line-410"></span><span>          </span><span id="local-6989586621680613762"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613762"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613780"><span class="hs-identifier hs-var">_A</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-411"></span><span>                 </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-var">Sort</span></a></span><span> </span><span class="annot"><span class="annottext">(Sort -&gt; Term) -&gt; (Args -&gt; Sort) -&gt; Args -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; Sort
forall t. MetaId -&gt; [Elim' t] -&gt; Sort' t
</span><a href="Agda.Syntax.Internal.html#MetaS"><span class="hs-identifier hs-var">MetaS</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Sort) -&gt; (Args -&gt; Elims) -&gt; Args -&gt; Sort
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim' Term) -&gt; Args -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim' Term
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Args -&gt; Term) -&gt; TCMT IO Args -&gt; TCMT IO Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; TCMT IO Args
forall (m :: * -&gt; *). MonadTCEnv m =&gt; MetaVariable -&gt; m Args
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaContextArgs"><span class="hs-identifier hs-var">getMetaContextArgs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613782"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-412"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-var">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term) -&gt; (Args -&gt; Elims) -&gt; Args -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim' Term) -&gt; Args -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim' Term
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Args -&gt; Term) -&gt; TCMT IO Args -&gt; TCMT IO Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; TCMT IO Args
forall (m :: * -&gt; *). MonadTCEnv m =&gt; MetaVariable -&gt; m Args
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaContextArgs"><span class="hs-identifier hs-var">getMetaContextArgs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613782"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-413"></span><span>          </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#noConstraints"><span class="hs-identifier hs-var">noConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; MetaVariable -&gt; Maybe Type -&gt; Term -&gt; Term -&gt; TCMT IO ()
</span><a href="#local-6989586621680613756"><span class="hs-identifier hs-var">doPrune</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613782"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613780"><span class="hs-identifier hs-var">_A</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613762"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613763"><span class="hs-identifier hs-var">u&#961;'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO () -&gt; (TCErr -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; ArgName -&gt; TCMT IO ()
forall a. MetaId -&gt; ArgName -&gt; TCM a
</span><a href="#local-6989586621680613796"><span class="hs-identifier hs-var">prepruneError</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;INST&quot;</span></span><span>
</span><span id="line-414"></span><span>          </span><span class="annot"><span class="annottext">MetaId -&gt; MetaId -&gt; TCMT IO ()
</span><a href="#local-6989586621680613754"><span class="hs-identifier hs-var">setInteractionPoint</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613784"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613766"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-415"></span><span>          </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613766"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>    </span><span id="local-6989586621680613808"><span class="annot"><span class="annottext">pruneMeta :: Telescope -&gt; MetaId -&gt; TCMT IO ()
</span><a href="#local-6989586621680613808"><span class="hs-identifier hs-var hs-var">pruneMeta</span></a></span></span><span> </span><span id="local-6989586621680613753"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613753"><span class="hs-identifier hs-var">_&#920;</span></a></span></span><span> </span><span id="local-6989586621680613752"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613752"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-418"></span><span>      </span><span id="local-6989586621680613751"><span class="annot"><span class="annottext">CheckpointId
</span><a href="#local-6989586621680613751"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' CheckpointId TCEnv -&gt; TCMT IO CheckpointId
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' a TCEnv -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' CheckpointId TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#eCurrentCheckpoint"><span class="hs-identifier hs-var">eCurrentCheckpoint</span></a></span><span>
</span><span id="line-419"></span><span>      </span><span id="local-6989586621680613750"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613750"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaVariable
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupMeta"><span class="hs-identifier hs-var">lookupMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613752"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-comment">-- The reason we are doing all this inside the closure of x is so that if x is an interaction</span><span>
</span><span id="line-421"></span><span>      </span><span class="hs-comment">-- meta we get the right context for the pruned interaction meta.</span><span>
</span><span id="line-422"></span><span>      </span><span class="annot"><span class="annottext">MetaVariable -&gt; (Range -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall (m :: * -&gt; *) a c b.
(MonadTCEnv m, ReadTCState m, LensClosure a c) =&gt;
c -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613750"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="annot"><span class="annottext">((Range -&gt; TCMT IO ()) -&gt; TCMT IO ())
-&gt; (Range -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-comment">-- If we can't find the generalized record, it's already been pruned and we don't have to do</span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-comment">-- anything.</span><span>
</span><span id="line-425"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO (Maybe Int) -&gt; (Int -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Maybe a) -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJustM"><span class="hs-identifier hs-var">whenJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaVariable -&gt; TCMT IO (Maybe Int)
</span><a href="#local-6989586621680613748"><span class="hs-identifier hs-var">findGenRec</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613750"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; TCMT IO ()) -&gt; TCMT IO ())
-&gt; (Int -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680613747"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613747"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize.prune&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-428"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;pruning&quot;</span></span><span>
</span><span id="line-429"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Judgement MetaId -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaVariable -&gt; Judgement MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#mvJudgement"><span class="hs-identifier hs-var hs-var">mvJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613750"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;GenRecTel is var&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613747"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span>        </span><span id="local-6989586621680613746"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613746"><span class="hs-identifier hs-var">_&#915;r&#916;</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Telescope
forall (m :: * -&gt; *). (Applicative m, MonadTCEnv m) =&gt; m Telescope
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-var">getContextTelescope</span></a></span><span>
</span><span id="line-433"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613745"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613745"><span class="hs-identifier hs-var">_&#915;</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613744"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613744"><span class="hs-identifier hs-var">_&#916;</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Telescope
</span><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-var">telFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613743"><span class="hs-identifier hs-var">gs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Telescope
</span><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-var">telFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613742"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>              </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613743"><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613743"><span class="hs-identifier hs-var">gs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dom' Term (ArgName, Type)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680613742"><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613742"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [Dom' Term (ArgName, Type)]
-&gt; ([Dom' Term (ArgName, Type)], [Dom' Term (ArgName, Type)])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613746"><span class="hs-identifier hs-var">_&#915;r&#916;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613747"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613746"><span class="hs-identifier hs-var">_&#915;r&#916;</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span>        </span><span class="hs-comment">-- Get the type of x. By doing this here we let the checkpoint machinery sort out the</span><span>
</span><span id="line-437"></span><span>        </span><span id="local-6989586621680613740"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613740"><span class="hs-identifier hs-var">_A</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Judgement MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#mvJudgement"><span class="hs-identifier hs-var hs-var">mvJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613750"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-438"></span><span>                </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IsSort"><span class="hs-identifier hs-type">IsSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; TCMT IO (Maybe Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-439"></span><span>                </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#HasType"><span class="hs-identifier hs-type">HasType</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Maybe Type) -&gt; TCM Type -&gt; TCMT IO (Maybe Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Type
forall (m :: * -&gt; *).
(MonadFail m, MonadTCEnv m, ReadTCState m, MonadReduce m,
 HasBuiltins m) =&gt;
MetaId -&gt; m Type
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaTypeInContext"><span class="hs-identifier hs-var">getMetaTypeInContext</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613752"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span>        </span><span class="hs-comment">-- We have</span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-comment">--   &#915;  (r : GenTel) &#916;         current context</span><span>
</span><span id="line-443"></span><span>        </span><span class="hs-comment">--   &#915;&#8320; (r : GenTel)           top context</span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-comment">--   &#915;&#8320; &#8866; &#920;                    prefix of the generalized telescope currently in scope</span><span>
</span><span id="line-445"></span><span>        </span><span class="hs-comment">--   &#915; (r : GenTel) &#916; &#8866; x : A  the meta to prune</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>        </span><span class="hs-comment">-- Get the substitution from the point of generalization to the current context. This always</span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-comment">-- succeeds since if the meta depends on GenTel it must have been created inside the</span><span>
</span><span id="line-449"></span><span>        </span><span class="hs-comment">-- generalization:</span><span>
</span><span id="line-450"></span><span>        </span><span class="hs-comment">--   &#915; (r : GenTel) &#916; &#8866; &#948; : &#915;&#8320; (r : GenTel)</span><span>
</span><span id="line-451"></span><span>        </span><span id="local-6989586621680613739"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613739"><span class="hs-identifier hs-var">&#948;</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CheckpointId -&gt; TCMT IO Substitution
forall (tcm :: * -&gt; *).
MonadTCEnv tcm =&gt;
CheckpointId -&gt; tcm Substitution
</span><a href="Agda.TypeChecking.Monad.Context.html#checkpointSubstitution"><span class="hs-identifier hs-var">checkpointSubstitution</span></a></span><span> </span><span class="annot"><span class="annottext">CheckpointId
</span><a href="#local-6989586621680613751"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>        </span><span class="hs-comment">-- v is x applied to the context variables</span><span>
</span><span id="line-454"></span><span>        </span><span id="local-6989586621680613738"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613738"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613740"><span class="hs-identifier hs-var">_A</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-455"></span><span>               </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-var">Sort</span></a></span><span> </span><span class="annot"><span class="annottext">(Sort -&gt; Term) -&gt; (Args -&gt; Sort) -&gt; Args -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; Sort
forall t. MetaId -&gt; [Elim' t] -&gt; Sort' t
</span><a href="Agda.Syntax.Internal.html#MetaS"><span class="hs-identifier hs-var">MetaS</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613752"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Sort) -&gt; (Args -&gt; Elims) -&gt; Args -&gt; Sort
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim' Term) -&gt; Args -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim' Term
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Args -&gt; Term) -&gt; TCMT IO Args -&gt; TCMT IO Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; TCMT IO Args
forall (m :: * -&gt; *). MonadTCEnv m =&gt; MetaVariable -&gt; m Args
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaContextArgs"><span class="hs-identifier hs-var">getMetaContextArgs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613750"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-456"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-var">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613752"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term) -&gt; (Args -&gt; Elims) -&gt; Args -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim' Term) -&gt; Args -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim' Term
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">(Args -&gt; Term) -&gt; TCMT IO Args -&gt; TCMT IO Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; TCMT IO Args
forall (m :: * -&gt; *). MonadTCEnv m =&gt; MetaVariable -&gt; m Args
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaContextArgs"><span class="hs-identifier hs-var">getMetaContextArgs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613750"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span>        </span><span class="hs-comment">-- Now ultimately we want to create the fresh meta in the context</span><span>
</span><span id="line-459"></span><span>        </span><span class="hs-comment">--   &#915; &#920;&#947; &#916;&#963; where &#915;    &#8866; &#947; : &#915;&#8320;</span><span>
</span><span id="line-460"></span><span>        </span><span class="hs-comment">--                 &#915; &#920;&#947; &#8866; &#963; : &#915; (r : GenTel)</span><span>
</span><span id="line-461"></span><span>        </span><span class="hs-comment">-- &#963; is the unpacking substitution (which is polymorphic in &#915;)</span><span>
</span><span id="line-462"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613737"><span class="annot"><span class="annottext">&#963; :: Substitution
</span><a href="#local-6989586621680613737"><span class="hs-identifier hs-var hs-var">&#963;</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution
</span><a href="#local-6989586621680613797"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613753"><span class="hs-identifier hs-var">_&#920;</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>            </span><span class="hs-comment">--    &#915; &lt;- &#915; (r : GenTel) &#916; &lt;- &#915;&#8320; (r : GenTel) &lt;- &#915;&#8320;</span><span>
</span><span id="line-464"></span><span>            </span><span id="local-6989586621680613736"><span class="annot"><span class="annottext">&#947; :: Substitution
</span><a href="#local-6989586621680613736"><span class="hs-identifier hs-var hs-var">&#947;</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Empty -&gt; Int -&gt; Substitution
forall a. Empty -&gt; Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#strengthenS"><span class="hs-identifier hs-var">strengthenS</span></a></span><span> </span><span class="annot"><span class="annottext">Empty
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613747"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; Substitution -&gt; Substitution
forall a.
EndoSubst a =&gt;
Substitution' a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#composeS"><span class="hs-operator hs-var">`composeS`</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613739"><span class="hs-identifier hs-var">&#948;</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; Substitution -&gt; Substitution
forall a.
EndoSubst a =&gt;
Substitution' a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#composeS"><span class="hs-operator hs-var">`composeS`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution
forall a. Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raiseS"><span class="hs-identifier hs-var">raiseS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-465"></span><span>            </span><span id="local-6989586621680613734"><span class="annot"><span class="annottext">_&#920;&#947; :: Telescope
</span><a href="#local-6989586621680613734"><span class="hs-identifier hs-var hs-var">_&#920;&#947;</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Telescope) -&gt; Telescope -&gt; Telescope
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Telescope)
</span><a href="#local-6989586621680613736"><span class="hs-identifier hs-var">&#947;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613753"><span class="hs-identifier hs-var">_&#920;</span></a></span><span>
</span><span id="line-466"></span><span>            </span><span id="local-6989586621680613733"><span class="annot"><span class="annottext">_&#916;&#963; :: Telescope
</span><a href="#local-6989586621680613733"><span class="hs-identifier hs-var hs-var">_&#916;&#963;</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Telescope) -&gt; Telescope -&gt; Telescope
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Telescope)
</span><a href="#local-6989586621680613737"><span class="hs-identifier hs-var">&#963;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613744"><span class="hs-identifier hs-var">_&#916;</span></a></span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>        </span><span class="hs-comment">-- The substitution into the new context is simply lifting &#963; over &#916;:</span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-comment">--   &#915; &#920;&#947; &#916;&#963; &#8866; lift i &#963; : &#915; (r : GenTel) &#916;</span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613732"><span class="annot"><span class="annottext">&#961; :: Substitution
</span><a href="#local-6989586621680613732"><span class="hs-identifier hs-var hs-var">&#961;</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#liftS"><span class="hs-identifier hs-var">liftS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613747"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613737"><span class="hs-identifier hs-var">&#963;</span></a></span><span>
</span><span id="line-471"></span><span>            </span><span class="hs-comment">-- We also need &#961;&#8315;&#185;, which is a lot easier to construct.</span><span>
</span><span id="line-472"></span><span>            </span><span id="local-6989586621680613731"><span class="annot"><span class="annottext">&#961;' :: Substitution
</span><a href="#local-6989586621680613731"><span class="hs-identifier hs-var hs-var">&#961;'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#liftS"><span class="hs-identifier hs-var">liftS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613747"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Substitution -&gt; Substitution) -&gt; Substitution -&gt; Substitution
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Elim' Term
forall a. ProjOrigin -&gt; QName -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-var">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613730"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680613730"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613730"><span class="hs-identifier hs-var">fld</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; [QName]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; [QName]) -&gt; [QName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [QName] -&gt; [QName]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613753"><span class="hs-identifier hs-var">_&#920;</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; [QName]) -&gt; [QName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613822"><span class="hs-identifier hs-var">genRecFields</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Substitution -&gt; Substitution
forall a. DeBruijn a =&gt; [a] -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#%2B%2B%23"><span class="hs-operator hs-var">++#</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution
forall a. Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raiseS"><span class="hs-identifier hs-var">raiseS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize.prune&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-475"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;&#915;   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613745"><span class="hs-identifier hs-var">_&#915;</span></a></span><span>
</span><span id="line-476"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;&#920;   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613753"><span class="hs-identifier hs-var">_&#920;</span></a></span><span>
</span><span id="line-477"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;&#916;   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613744"><span class="hs-identifier hs-var">_&#916;</span></a></span><span>
</span><span id="line-478"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;&#963;   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613737"><span class="hs-identifier hs-var">&#963;</span></a></span><span>
</span><span id="line-479"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;&#947;   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613736"><span class="hs-identifier hs-var">&#947;</span></a></span><span>
</span><span id="line-480"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;&#948;   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613739"><span class="hs-identifier hs-var">&#948;</span></a></span><span>
</span><span id="line-481"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;&#961;   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613732"><span class="hs-identifier hs-var">&#961;</span></a></span><span>
</span><span id="line-482"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;&#961;&#8315;&#185; =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613731"><span class="hs-identifier hs-var">&#961;'</span></a></span><span>
</span><span id="line-483"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;&#920;&#947;  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613734"><span class="hs-identifier hs-var">_&#920;&#947;</span></a></span><span>
</span><span id="line-484"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;&#916;&#963;  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613733"><span class="hs-identifier hs-var">_&#916;&#963;</span></a></span><span>
</span><span id="line-485"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;_A  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613740"><span class="hs-identifier hs-var">_A</span></a></span><span>
</span><span id="line-486"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span>        </span><span class="hs-comment">-- When updating the context we also need to pick names for the variables. Get them from the</span><span>
</span><span id="line-489"></span><span>        </span><span class="hs-comment">-- current context and generate fresh ones for the generalized variables in &#920;.</span><span>
</span><span id="line-490"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680613728"><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613728"><span class="hs-identifier hs-var">newCxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613727"><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613727"><span class="hs-identifier hs-var">r&#920;</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-491"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621680613726"><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613726"><span class="hs-identifier hs-var">r&#916;</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dom (Name, Type)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680613725"><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613725"><span class="hs-identifier hs-var">r&#915;</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [Dom (Name, Type)] -&gt; ([Dom (Name, Type)], [Dom (Name, Type)])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613747"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom (Name, Type)] -&gt; ([Dom (Name, Type)], [Dom (Name, Type)]))
-&gt; TCMT IO [Dom (Name, Type)]
-&gt; TCMT IO ([Dom (Name, Type)], [Dom (Name, Type)])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO [Dom (Name, Type)]
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m [Dom (Name, Type)]
</span><a href="Agda.TypeChecking.Monad.Context.html#getContext"><span class="hs-identifier hs-var">getContext</span></a></span><span>
</span><span id="line-492"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613724"><span class="annot"><span class="annottext">setName :: Dom' Term (ArgName, t) -&gt; TCMT IO (Dom' Term (Name, t))
</span><a href="#local-6989586621680613724"><span class="hs-identifier hs-var hs-var">setName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ArgName, t) -&gt; TCMT IO (Name, t))
-&gt; Dom' Term (ArgName, t) -&gt; TCMT IO (Dom' Term (Name, t))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">(((ArgName, t) -&gt; TCMT IO (Name, t))
 -&gt; Dom' Term (ArgName, t) -&gt; TCMT IO (Dom' Term (Name, t)))
-&gt; ((ArgName, t) -&gt; TCMT IO (Name, t))
-&gt; Dom' Term (ArgName, t)
-&gt; TCMT IO (Dom' Term (Name, t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613722"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613722"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613721"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680613721"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680613721"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; (Name, t)) -&gt; TCMT IO Name -&gt; TCMT IO (Name, t)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Name
forall a (m :: * -&gt; *).
(FreshName a, MonadFresh NameId m) =&gt;
a -&gt; m Name
</span><a href="Agda.TypeChecking.Monad.Base.html#freshName_"><span class="hs-identifier hs-var">freshName_</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613722"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-493"></span><span>          </span><span id="local-6989586621680613720"><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613720"><span class="hs-identifier hs-var">r&#920;</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Dom' Term (ArgName, Type) -&gt; TCMT IO (Dom (Name, Type)))
-&gt; [Dom' Term (ArgName, Type)] -&gt; TCMT IO [Dom (Name, Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term (ArgName, Type) -&gt; TCMT IO (Dom (Name, Type))
forall t. Dom' Term (ArgName, t) -&gt; TCMT IO (Dom' Term (Name, t))
</span><a href="#local-6989586621680613724"><span class="hs-identifier hs-var">setName</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; TCMT IO [Dom (Name, Type)])
-&gt; [Dom' Term (ArgName, Type)] -&gt; TCMT IO [Dom (Name, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)])
-&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613734"><span class="hs-identifier hs-var">_&#920;&#947;</span></a></span><span>
</span><span id="line-494"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613719"><span class="annot"><span class="annottext">r&#916;&#963; :: [Dom (Name, Type)]
</span><a href="#local-6989586621680613719"><span class="hs-identifier hs-var hs-var">r&#916;&#963;</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Dom' Term (ArgName, Type) -&gt; Dom (Name, Type))
-&gt; [Name] -&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom (Name, Type)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680613718"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680613718"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680613717"><span class="annot"><span class="annottext">Dom' Term (ArgName, Type)
</span><a href="#local-6989586621680613717"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; Name) -&gt; (ArgName, Type) -&gt; (Name, Type)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ArgName -&gt; Name
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680613718"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ArgName, Type) -&gt; (Name, Type))
-&gt; Dom' Term (ArgName, Type) -&gt; Dom (Name, Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term (ArgName, Type)
</span><a href="#local-6989586621680613717"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Dom (Name, Type) -&gt; Name) -&gt; [Dom (Name, Type)] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name, Type) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Name, Type) -&gt; Name)
-&gt; (Dom (Name, Type) -&gt; (Name, Type)) -&gt; Dom (Name, Type) -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dom (Name, Type) -&gt; (Name, Type)
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var hs-var">unDom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613726"><span class="hs-identifier hs-var">r&#916;</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)])
-&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613733"><span class="hs-identifier hs-var">_&#916;&#963;</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>          </span><span class="annot"><span class="annottext">([Dom (Name, Type)], [Dom (Name, Type)])
-&gt; TCMT IO ([Dom (Name, Type)], [Dom (Name, Type)])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613719"><span class="hs-identifier hs-var">r&#916;&#963;</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)] -&gt; [Dom (Name, Type)] -&gt; [Dom (Name, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613720"><span class="hs-identifier hs-var">r&#920;</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)] -&gt; [Dom (Name, Type)] -&gt; [Dom (Name, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613725"><span class="hs-identifier hs-var">r&#915;</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613720"><span class="hs-identifier hs-var">r&#920;</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span>        </span><span class="hs-comment">-- Now we can enter the new context and create our meta variable.</span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680613716"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613716"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613715"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613715"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Substitution
-&gt; ([Dom (Name, Type)] -&gt; [Dom (Name, Type)])
-&gt; TCM (MetaId, Term)
-&gt; TCM (MetaId, Term)
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Substitution
-&gt; ([Dom (Name, Type)] -&gt; [Dom (Name, Type)]) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#updateContext"><span class="hs-identifier hs-var">updateContext</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613732"><span class="hs-identifier hs-var">&#961;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom (Name, Type)] -&gt; [Dom (Name, Type)] -&gt; [Dom (Name, Type)]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613728"><span class="hs-identifier hs-var">newCxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM (MetaId, Term) -&gt; TCM (MetaId, Term))
-&gt; TCM (MetaId, Term) -&gt; TCM (MetaId, Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM (MetaId, Term) -&gt; TCM (MetaId, Term)
forall a. TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.State.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (MetaId, Term) -&gt; TCM (MetaId, Term))
-&gt; TCM (MetaId, Term) -&gt; TCM (MetaId, Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span>          </span><span class="hs-comment">-- First, we add the named variables to the scope, to allow</span><span>
</span><span id="line-503"></span><span>          </span><span class="hs-comment">-- them to be used in holes (#3341). These should go outside &#916; (#3735).</span><span>
</span><span id="line-504"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO () -&gt; TCMT IO ()
forall a. Int -&gt; ScopeM a -&gt; ScopeM a
</span><a href="Agda.Syntax.Scope.Monad.html#outsideLocalVars"><span class="hs-identifier hs-var">outsideLocalVars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613747"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)] -&gt; TCMT IO ()
forall (t :: * -&gt; *) t b.
Foldable t =&gt;
t (Dom' t (Name, b)) -&gt; TCMT IO ()
</span><a href="#local-6989586621680613713"><span class="hs-identifier hs-var">addNamedVariablesToScope</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613727"><span class="hs-identifier hs-var">r&#920;</span></a></span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span>          </span><span class="hs-comment">-- Now we can create the new meta</span><span>
</span><span id="line-507"></span><span>          </span><span class="annot"><span class="annottext">MetaVariable -&gt; Substitution -&gt; Maybe Type -&gt; TCM (MetaId, Term)
</span><a href="#local-6989586621680613764"><span class="hs-identifier hs-var">newMetaFromOld</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613750"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613732"><span class="hs-identifier hs-var">&#961;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613740"><span class="hs-identifier hs-var">_A</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span>        </span><span class="hs-comment">-- Finally we solve x := y&#961;&#8315;&#185;. The reason for solving it this way instead of x&#961; := y is that</span><span>
</span><span id="line-510"></span><span>        </span><span class="hs-comment">-- &#961; contains dummy terms for the variables that are not in scope.</span><span>
</span><span id="line-511"></span><span>        </span><span class="hs-comment">-- If x has been instantiated by some constraint unblocked by previous pruning or</span><span>
</span><span id="line-512"></span><span>        </span><span class="hs-comment">-- generalization, use equalTerm instead of assigning to x. If this fails (see</span><span>
</span><span id="line-513"></span><span>        </span><span class="hs-comment">-- test/Fail/Issue3655b.agda for a test case), we need to give an error. This can happen if</span><span>
</span><span id="line-514"></span><span>        </span><span class="hs-comment">-- there are dependencies between generalized variables that are hidden by constraints and</span><span>
</span><span id="line-515"></span><span>        </span><span class="hs-comment">-- the dependency sorting happens to pick the wrong order. For instance, if we have</span><span>
</span><span id="line-516"></span><span>        </span><span class="hs-comment">--    &#945; : Nat   (unsolved meta)</span><span>
</span><span id="line-517"></span><span>        </span><span class="hs-comment">--    t : F &#945;   (named variable)</span><span>
</span><span id="line-518"></span><span>        </span><span class="hs-comment">--    n : Nat   (named variable)</span><span>
</span><span id="line-519"></span><span>        </span><span class="hs-comment">-- and a constraint F &#945; == F n, where F does some pattern matching preventing the constraint</span><span>
</span><span id="line-520"></span><span>        </span><span class="hs-comment">-- to be solved when n is still a meta. If t appears before n in the type these will be sorted</span><span>
</span><span id="line-521"></span><span>        </span><span class="hs-comment">-- as &#945;, t, n, but we will solve &#945; := n before we get to the pruning here. It's good that we</span><span>
</span><span id="line-522"></span><span>        </span><span class="hs-comment">-- solve first though, because that means we can give a more informative error message than</span><span>
</span><span id="line-523"></span><span>        </span><span class="hs-comment">-- the &quot;Cannot instantiate...&quot; we would otherwise get.</span><span>
</span><span id="line-524"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613712"><span class="annot"><span class="annottext">u&#961;' :: Term
</span><a href="#local-6989586621680613712"><span class="hs-identifier hs-var hs-var">u&#961;'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Term) -&gt; Term -&gt; Term
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Term)
</span><a href="#local-6989586621680613731"><span class="hs-identifier hs-var">&#961;'</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613715"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-525"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize.prune&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-526"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;solving&quot;</span></span><span>
</span><span id="line-527"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613738"><span class="hs-identifier hs-var">v</span></a></span><span>   </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;==&quot;</span></span><span>
</span><span id="line-528"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613712"><span class="hs-identifier hs-var">u&#961;'</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-529"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613740"><span class="hs-identifier hs-var">_A</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-530"></span><span>        </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#noConstraints"><span class="hs-identifier hs-var">noConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; MetaVariable -&gt; Maybe Type -&gt; Term -&gt; Term -&gt; TCMT IO ()
</span><a href="#local-6989586621680613756"><span class="hs-identifier hs-var">doPrune</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613752"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613750"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613740"><span class="hs-identifier hs-var">_A</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613738"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613712"><span class="hs-identifier hs-var">u&#961;'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO () -&gt; (TCErr -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; TCErr -&gt; TCMT IO ()
</span><a href="#local-6989586621680613711"><span class="hs-identifier hs-var">niceError</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613752"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613738"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize.prune&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-533"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;solved&quot;</span></span><span>
</span><span id="line-534"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;v    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; TCM Doc) -&gt; TCMT IO Term -&gt; TCM Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613738"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;u&#961;&#8315;&#185; =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; TCM Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; TCM Doc) -&gt; TCMT IO Term -&gt; TCM Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613712"><span class="hs-identifier hs-var">u&#961;'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span>        </span><span class="annot"><span class="annottext">MetaId -&gt; MetaId -&gt; TCMT IO ()
</span><a href="#local-6989586621680613754"><span class="hs-identifier hs-var">setInteractionPoint</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613752"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613716"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span>    </span><span class="annot"><a href="#local-6989586621680613748"><span class="hs-identifier hs-type">findGenRec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MetaVariable"><span class="hs-identifier hs-type">MetaVariable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>    </span><span id="local-6989586621680613748"><span class="annot"><span class="annottext">findGenRec :: MetaVariable -&gt; TCMT IO (Maybe Int)
</span><a href="#local-6989586621680613748"><span class="hs-identifier hs-var hs-var">findGenRec</span></a></span></span><span> </span><span id="local-6989586621680613710"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613710"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-541"></span><span>      </span><span id="local-6989586621680613709"><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613709"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)] -&gt; TCMT IO [Dom (Name, Type)]
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom (Name, Type)] -&gt; TCMT IO [Dom (Name, Type)])
-&gt; TCMT IO [Dom (Name, Type)] -&gt; TCMT IO [Dom (Name, Type)]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO [Dom (Name, Type)]
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m [Dom (Name, Type)]
</span><a href="Agda.TypeChecking.Monad.Context.html#getContext"><span class="hs-identifier hs-var">getContext</span></a></span><span>
</span><span id="line-542"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613708"><span class="annot"><span class="annottext">notPruned :: [Int]
</span><a href="#local-6989586621680613708"><span class="hs-identifier hs-var hs-var">notPruned</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Permutation -&gt; [Int] -&gt; [Int]
forall a. Permutation -&gt; [a] -&gt; [a]
</span><a href="Agda.Utils.Permutation.html#permute"><span class="hs-identifier hs-var">permute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Permutation -&gt; Permutation
</span><a href="Agda.Utils.Permutation.html#takeP"><span class="hs-identifier hs-var">takeP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom (Name, Type)] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613709"><span class="hs-identifier hs-var">cxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Permutation -&gt; Permutation) -&gt; Permutation -&gt; Permutation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Permutation
</span><a href="Agda.TypeChecking.Monad.Base.html#mvPermutation"><span class="hs-identifier hs-var hs-var">mvPermutation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613710"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-543"></span><span>               </span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Dom (Name, Type) -&gt; Int)
-&gt; [Int] -&gt; [Dom (Name, Type)] -&gt; [Int]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Dom (Name, Type) -&gt; Int
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613709"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-544"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613707"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613707"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613707"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621680613703"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613703"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Dom (Name, Type)] -&gt; [(Int, Dom (Name, Type))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)]
</span><a href="#local-6989586621680613709"><span class="hs-identifier hs-var">cxt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-545"></span><span>                 </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613703"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613825"><span class="hs-identifier hs-var">genRecName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613707"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680613708"><span class="hs-identifier hs-var">notPruned</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-546"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; TCMT IO (Maybe Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-547"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Int]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe Int)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-548"></span><span>        </span><span class="hs-special">[</span><span id="local-6989586621680613702"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613702"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; TCMT IO (Maybe Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613702"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>                                                    </span><span class="hs-comment">-- Nothing if sort meta</span><span>
</span><span id="line-550"></span><span>    </span><span class="annot"><a href="#local-6989586621680613764"><span class="hs-identifier hs-type">newMetaFromOld</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MetaVariable"><span class="hs-identifier hs-type">MetaVariable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>    </span><span id="local-6989586621680613764"><span class="annot"><span class="annottext">newMetaFromOld :: MetaVariable -&gt; Substitution -&gt; Maybe Type -&gt; TCM (MetaId, Term)
</span><a href="#local-6989586621680613764"><span class="hs-identifier hs-var hs-var">newMetaFromOld</span></a></span></span><span> </span><span id="local-6989586621680613701"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613701"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span id="local-6989586621680613700"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613700"><span class="hs-identifier hs-var">&#961;</span></a></span></span><span> </span><span id="local-6989586621680613699"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613699"><span class="hs-identifier hs-var">mA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; TCM (MetaId, Term) -&gt; TCM (MetaId, Term)
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613701"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (MetaId, Term) -&gt; TCM (MetaId, Term))
-&gt; TCM (MetaId, Term) -&gt; TCM (MetaId, Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-552"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613699"><span class="hs-identifier hs-var">mA</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-553"></span><span>        </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-554"></span><span>          </span><span id="local-6989586621680613697"><span class="annot"><span class="annottext">s :: Sort
</span><a href="#local-6989586621680613697"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaS"><span class="hs-identifier hs-type">MetaS</span></a></span><span> </span><span id="local-6989586621680613696"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613696"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Sort
forall (m :: * -&gt; *). MonadMetaSolver m =&gt; m Sort
</span><a href="Agda.TypeChecking.MetaVars.html#newSortMeta"><span class="hs-identifier hs-var">newSortMeta</span></a></span><span>
</span><span id="line-555"></span><span>          </span><span class="annot"><span class="annottext">(MetaId, Term) -&gt; TCM (MetaId, Term)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613696"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-var">Sort</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621680613697"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680613694"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613694"><span class="hs-identifier hs-var">_A</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-557"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613693"><span class="annot"><span class="annottext">_A&#961; :: Type
</span><a href="#local-6989586621680613693"><span class="hs-identifier hs-var hs-var">_A&#961;</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Type) -&gt; Type -&gt; Type
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Type)
</span><a href="#local-6989586621680613700"><span class="hs-identifier hs-var">&#961;</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613694"><span class="hs-identifier hs-var">_A</span></a></span><span>
</span><span id="line-558"></span><span>          </span><span class="annot"><span class="annottext">RunMetaOccursCheck
-&gt; ArgName -&gt; Comparison -&gt; Type -&gt; TCM (MetaId, Term)
forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
RunMetaOccursCheck
-&gt; ArgName -&gt; Comparison -&gt; Type -&gt; m (MetaId, Term)
</span><a href="Agda.TypeChecking.MetaVars.html#newNamedValueMeta"><span class="hs-identifier hs-var">newNamedValueMeta</span></a></span><span> </span><span class="annot"><span class="annottext">RunMetaOccursCheck
</span><a href="Agda.TypeChecking.Monad.Base.html#DontRunMetaOccursCheck"><span class="hs-identifier hs-var">DontRunMetaOccursCheck</span></a></span><span>
</span><span id="line-559"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaInfo -&gt; ArgName
</span><a href="Agda.TypeChecking.Monad.Base.html#miNameSuggestion"><span class="hs-identifier hs-var hs-var">miNameSuggestion</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaInfo -&gt; ArgName) -&gt; MetaInfo -&gt; ArgName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInfo"><span class="hs-identifier hs-var hs-var">mvInfo</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613701"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Judgement MetaId -&gt; Comparison
forall a. Judgement a -&gt; Comparison
</span><a href="Agda.TypeChecking.Monad.Base.html#jComparison"><span class="hs-identifier hs-var hs-var">jComparison</span></a></span><span> </span><span class="annot"><span class="annottext">(Judgement MetaId -&gt; Comparison) -&gt; Judgement MetaId -&gt; Comparison
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Judgement MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#mvJudgement"><span class="hs-identifier hs-var hs-var">mvJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613701"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613693"><span class="hs-identifier hs-var">_A&#961;</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span>    </span><span class="hs-comment">-- If x is a hole, update the hole to point to y instead.</span><span>
</span><span id="line-563"></span><span>    </span><span id="local-6989586621680613754"><span class="annot"><span class="annottext">setInteractionPoint :: MetaId -&gt; MetaId -&gt; TCMT IO ()
</span><a href="#local-6989586621680613754"><span class="hs-identifier hs-var hs-var">setInteractionPoint</span></a></span></span><span> </span><span id="local-6989586621680613689"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613689"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680613688"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613688"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-564"></span><span>      </span><span class="annot"><span class="annottext">Maybe InteractionId -&gt; (InteractionId -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-var">whenJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Map MetaId InteractionId -&gt; Maybe InteractionId
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613689"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map MetaId InteractionId
</span><a href="#local-6989586621680613821"><span class="hs-identifier hs-var">interactionPoints</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractionId -&gt; MetaId -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadInteractionPoints m =&gt;
InteractionId -&gt; MetaId -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#connectInteractionPoint"><span class="hs-operator hs-var">`connectInteractionPoint`</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613688"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span>    </span><span class="annot"><a href="#local-6989586621680613756"><span class="hs-identifier hs-type">doPrune</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MetaVariable"><span class="hs-identifier hs-type">MetaVariable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>    </span><span id="local-6989586621680613756"><span class="annot"><span class="annottext">doPrune :: MetaId -&gt; MetaVariable -&gt; Maybe Type -&gt; Term -&gt; Term -&gt; TCMT IO ()
</span><a href="#local-6989586621680613756"><span class="hs-identifier hs-var hs-var">doPrune</span></a></span></span><span> </span><span id="local-6989586621680613685"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613685"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680613684"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613684"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span id="local-6989586621680613683"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613683"><span class="hs-identifier hs-var">mt</span></a></span></span><span> </span><span id="local-6989586621680613682"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613682"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680613681"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613681"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-568"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613683"><span class="hs-identifier hs-var">mt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-569"></span><span>        </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680613680"><span class="hs-identifier hs-var">isOpen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompareDirection
-&gt; MetaId -&gt; Args -&gt; Term -&gt; CompareAs -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.MetaVars.html#assign"><span class="hs-identifier hs-var">assign</span></a></span><span> </span><span class="annot"><span class="annottext">CompareDirection
</span><a href="Agda.TypeChecking.Monad.Base.html#DirEq"><span class="hs-identifier hs-var">DirEq</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613685"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Args
</span><a href="#local-6989586621680613677"><span class="hs-identifier hs-var">getArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613682"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613681"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(CompareAs -&gt; TCMT IO ()) -&gt; CompareAs -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CompareAs -&gt; (Type -&gt; CompareAs) -&gt; Maybe Type -&gt; CompareAs
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">CompareAs
</span><a href="Agda.TypeChecking.Monad.Base.html#AsTypes"><span class="hs-identifier hs-var">AsTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; CompareAs
</span><a href="Agda.TypeChecking.Monad.Base.html#AsTermsOf"><span class="hs-identifier hs-var">AsTermsOf</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621680613683"><span class="hs-identifier hs-var">mt</span></a></span><span>
</span><span id="line-570"></span><span>        </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; Sort -&gt; TCMT IO ()
forall (m :: * -&gt; *). MonadConversion m =&gt; Sort -&gt; Sort -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#equalSort"><span class="hs-identifier hs-var">equalSort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Sort
</span><a href="#local-6989586621680613673"><span class="hs-identifier hs-var">unwrapSort</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613682"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Sort
</span><a href="#local-6989586621680613673"><span class="hs-identifier hs-var">unwrapSort</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613681"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680613672"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613672"><span class="hs-identifier hs-var">t</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term -&gt; Term -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadConversion m =&gt;
Type -&gt; Term -&gt; Term -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#equalTerm"><span class="hs-identifier hs-var">equalTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613672"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613682"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613681"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-572"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-573"></span><span>        </span><span id="local-6989586621680613680"><span class="annot"><span class="annottext">isOpen :: Bool
</span><a href="#local-6989586621680613680"><span class="hs-identifier hs-var hs-var">isOpen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInstantiation -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#isOpenMeta"><span class="hs-identifier hs-var">isOpenMeta</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaInstantiation -&gt; Bool) -&gt; MetaInstantiation -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInstantiation
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInstantiation"><span class="hs-identifier hs-var hs-var">mvInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613684"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-574"></span><span>        </span><span id="local-6989586621680613677"><span class="annot"><span class="annottext">getArgs :: Term -&gt; Args
</span><a href="#local-6989586621680613677"><span class="hs-identifier hs-var hs-var">getArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-575"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaS"><span class="hs-identifier hs-type">MetaS</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680613670"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621680613670"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621680613670"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-576"></span><span>            </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680613668"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621680613668"><span class="hs-identifier hs-var">es</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Args -&gt; Maybe Args -&gt; Args
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Args -&gt; Args) -&gt; Maybe Args -&gt; Args
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe Args
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621680613668"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-577"></span><span>            </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Args
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-578"></span><span>        </span><span id="local-6989586621680613673"><span class="annot"><span class="annottext">unwrapSort :: Term -&gt; Sort
</span><a href="#local-6989586621680613673"><span class="hs-identifier hs-var hs-var">unwrapSort</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span id="local-6989586621680613667"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621680613667"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621680613667"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-579"></span><span>        </span><span class="annot"><a href="#local-6989586621680613673"><span class="hs-identifier hs-var">unwrapSort</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sort
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>    </span><span id="local-6989586621680613711"><span class="annot"><span class="annottext">niceError :: MetaId -&gt; Term -&gt; TCErr -&gt; TCMT IO ()
</span><a href="#local-6989586621680613711"><span class="hs-identifier hs-var hs-var">niceError</span></a></span></span><span> </span><span id="local-6989586621680613666"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613666"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680613665"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613665"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621680613664"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621680613664"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-582"></span><span>      </span><span id="local-6989586621680613663"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613663"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613665"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-583"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613662"><span class="annot"><span class="annottext">err' :: TCErr
</span><a href="#local-6989586621680613662"><span class="hs-identifier hs-var hs-var">err'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621680613664"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-584"></span><span>                   </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">tcErrClosErr :: TCErr -&gt; Closure TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#tcErrClosErr"><span class="hs-identifier hs-var">tcErrClosErr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680613659"><span class="annot"><span class="annottext">Closure TypeError
</span><a href="#local-6989586621680613659"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-585"></span><span>                     </span><span class="hs-comment">-- Remove the 'when' part from the error since it's most like the same as ours.</span><span>
</span><span id="line-586"></span><span>                     </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621680613664"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcErrClosErr :: Closure TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#tcErrClosErr"><span class="hs-identifier hs-var">tcErrClosErr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Closure TypeError
</span><a href="#local-6989586621680613659"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">clEnv :: TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#clEnv"><span class="hs-identifier hs-var">clEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Closure TypeError -&gt; TCEnv
forall a. Closure a -&gt; TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#clEnv"><span class="hs-identifier hs-var hs-var">clEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Closure TypeError
</span><a href="#local-6989586621680613659"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envCall :: Maybe (Closure Call)
</span><a href="Agda.TypeChecking.Monad.Base.html#envCall"><span class="hs-identifier hs-var">envCall</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Closure Call)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-587"></span><span>                   </span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621680613664"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-588"></span><span>          </span><span id="local-6989586621680613656"><span class="annot"><span class="annottext">telList :: [Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613656"><span class="hs-identifier hs-var hs-var">telList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613823"><span class="hs-identifier hs-var">genTel</span></a></span><span>
</span><span id="line-589"></span><span>          </span><span id="local-6989586621680613655"><span class="annot"><span class="annottext">names :: [ArgName]
</span><a href="#local-6989586621680613655"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom' Term (ArgName, Type) -&gt; ArgName)
-&gt; [Dom' Term (ArgName, Type)] -&gt; [ArgName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ArgName, Type) -&gt; ArgName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((ArgName, Type) -&gt; ArgName)
-&gt; (Dom' Term (ArgName, Type) -&gt; (ArgName, Type))
-&gt; Dom' Term (ArgName, Type)
-&gt; ArgName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term (ArgName, Type) -&gt; (ArgName, Type)
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var hs-var">unDom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613656"><span class="hs-identifier hs-var">telList</span></a></span><span>
</span><span id="line-590"></span><span>          </span><span id="local-6989586621680613654"><span class="annot"><span class="annottext">late :: [ArgName]
</span><a href="#local-6989586621680613654"><span class="hs-identifier hs-var hs-var">late</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom' Term (ArgName, Type) -&gt; ArgName)
-&gt; [Dom' Term (ArgName, Type)] -&gt; [ArgName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ArgName, Type) -&gt; ArgName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((ArgName, Type) -&gt; ArgName)
-&gt; (Dom' Term (ArgName, Type) -&gt; (ArgName, Type))
-&gt; Dom' Term (ArgName, Type)
-&gt; ArgName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term (ArgName, Type) -&gt; (ArgName, Type)
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var hs-var">unDom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; [ArgName])
-&gt; [Dom' Term (ArgName, Type)] -&gt; [ArgName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Dom' Term (ArgName, Type) -&gt; Bool)
-&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Any -&gt; Bool
</span><span class="hs-identifier hs-var hs-var">getAny</span></span><span> </span><span class="annot"><span class="annottext">(Any -&gt; Bool)
-&gt; (Dom' Term (ArgName, Type) -&gt; Any)
-&gt; Dom' Term (ArgName, Type)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; Any) -&gt; Dom' Term (ArgName, Type) -&gt; Any
forall t m. (AllMetas t, Monoid m) =&gt; (MetaId -&gt; m) -&gt; t -&gt; m
</span><a href="Agda.Syntax.Internal.MetaVars.html#allMetas"><span class="hs-identifier hs-var">allMetas</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Any
</span><span class="hs-identifier hs-var">Any</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Any) -&gt; (MetaId -&gt; Bool) -&gt; MetaId -&gt; Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; MetaId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613666"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)]
</span><a href="#local-6989586621680613656"><span class="hs-identifier hs-var">telList</span></a></span><span>
</span><span id="line-591"></span><span>          </span><span id="local-6989586621680613650"><span class="annot"><span class="annottext">projs :: Elim' Term -&gt; Set ArgName
</span><a href="#local-6989586621680613650"><span class="hs-identifier hs-var hs-var">projs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680613649"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613649"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613649"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [QName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613822"><span class="hs-identifier hs-var">genRecFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ArgName] -&gt; Set ArgName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([ArgName] -&gt; Set ArgName) -&gt; [ArgName] -&gt; Set ArgName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe ArgName] -&gt; [ArgName]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QName -&gt; Maybe ArgName
</span><a href="Agda.TypeChecking.Monad.Base.html#getGeneralizedFieldName"><span class="hs-identifier hs-var">getGeneralizedFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613649"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-593"></span><span>          </span><span class="annot"><a href="#local-6989586621680613650"><span class="hs-identifier hs-var">projs</span></a></span><span> </span><span class="annot"><span class="annottext">Elim' Term
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set ArgName
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-594"></span><span>          </span><span id="local-6989586621680613645"><span class="annot"><span class="annottext">early :: [ArgName]
</span><a href="#local-6989586621680613645"><span class="hs-identifier hs-var hs-var">early</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set ArgName -&gt; [ArgName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set ArgName -&gt; [ArgName]) -&gt; Set ArgName -&gt; [ArgName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Term -&gt; Set ArgName) -&gt; Term -&gt; Set ArgName)
-&gt; Term -&gt; (Term -&gt; Set ArgName) -&gt; Set ArgName
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Set ArgName) -&gt; Term -&gt; Set ArgName
forall a m. (TermLike a, Monoid m) =&gt; (Term -&gt; m) -&gt; a -&gt; m
</span><a href="Agda.Syntax.Internal.Generic.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613663"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">((Term -&gt; Set ArgName) -&gt; Set ArgName)
-&gt; (Term -&gt; Set ArgName) -&gt; Set ArgName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">case</span><span>
</span><span id="line-595"></span><span>                  </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680613642"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621680613642"><span class="hs-identifier hs-var">es</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Elim' Term -&gt; Set ArgName) -&gt; Elims -&gt; Set ArgName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">Elim' Term -&gt; Set ArgName
</span><a href="#local-6989586621680613650"><span class="hs-identifier hs-var">projs</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621680613642"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-596"></span><span>                  </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680613640"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621680613640"><span class="hs-identifier hs-var">es</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Elim' Term -&gt; Set ArgName) -&gt; Elims -&gt; Set ArgName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">Elim' Term -&gt; Set ArgName
</span><a href="#local-6989586621680613650"><span class="hs-identifier hs-var">projs</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621680613640"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-597"></span><span>                  </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680613639"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621680613639"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Elim' Term -&gt; Set ArgName) -&gt; Elims -&gt; Set ArgName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">Elim' Term -&gt; Set ArgName
</span><a href="#local-6989586621680613650"><span class="hs-identifier hs-var">projs</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621680613639"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-598"></span><span>                  </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set ArgName
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-599"></span><span>          </span><span id="local-6989586621680613638"><span class="annot"><span class="annottext">commas :: [ArgName] -&gt; ArgName
</span><a href="#local-6989586621680613638"><span class="hs-identifier hs-var hs-var">commas</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-600"></span><span>          </span><span class="annot"><a href="#local-6989586621680613638"><span class="hs-identifier hs-var">commas</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621680613637"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613637"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613637"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-601"></span><span>          </span><span class="annot"><a href="#local-6989586621680613638"><span class="hs-identifier hs-var">commas</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621680613636"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613636"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613635"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613635"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613636"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;, and &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613635"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-602"></span><span>          </span><span class="annot"><a href="#local-6989586621680613638"><span class="hs-identifier hs-var">commas</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613634"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613634"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680613633"><span class="annot"><span class="annottext">[ArgName]
</span><a href="#local-6989586621680613633"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613634"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ArgName] -&gt; ArgName
</span><a href="#local-6989586621680613638"><span class="hs-identifier hs-var">commas</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgName]
</span><a href="#local-6989586621680613633"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-603"></span><span>          </span><span id="local-6989586621680613632"><span class="annot"><span class="annottext">cause :: ArgName
</span><a href="#local-6989586621680613632"><span class="hs-identifier hs-var hs-var">cause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;There were unsolved constraints that obscured the &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-604"></span><span>                  </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;dependencies between the generalized variables.&quot;</span></span><span>
</span><span id="line-605"></span><span>          </span><span id="local-6989586621680613631"><span class="annot"><span class="annottext">solution :: ArgName
</span><a href="#local-6989586621680613631"><span class="hs-identifier hs-var hs-var">solution</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;The most reliable solution is to provide enough information to make the dependencies &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-606"></span><span>                     </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;clear, but simply mentioning the variables in the right order should also work.&quot;</span></span><span>
</span><span id="line-607"></span><span>          </span><span id="local-6989586621680613630"><span class="annot"><span class="annottext">order :: TCM Doc
</span><a href="#local-6989586621680613630"><span class="hs-identifier hs-var hs-var">order</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fwords"><span class="hs-identifier hs-var">fwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;Dependency analysis suggested this (likely incorrect) order:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-608"></span><span>                        </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fwords"><span class="hs-identifier hs-var">fwords</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ArgName] -&gt; ArgName
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="annot"><span class="annottext">[ArgName]
</span><a href="#local-6989586621680613655"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-609"></span><span>          </span><span id="local-6989586621680613628"><span class="annot"><span class="annottext">guess :: ArgName
</span><a href="#local-6989586621680613628"><span class="hs-identifier hs-var hs-var">guess</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;After constraint solving it looks like &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ArgName] -&gt; ArgName
</span><a href="#local-6989586621680613638"><span class="hs-identifier hs-var">commas</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgName]
</span><a href="#local-6989586621680613654"><span class="hs-identifier hs-var">late</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot; actually depend&quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613627"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-610"></span><span>                  </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot; on &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ArgName] -&gt; ArgName
</span><a href="#local-6989586621680613638"><span class="hs-identifier hs-var">commas</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgName]
</span><a href="#local-6989586621680613645"><span class="hs-identifier hs-var">early</span></a></span><span>
</span><span id="line-611"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-612"></span><span>              </span><span id="local-6989586621680613627"><span class="annot"><span class="annottext">s :: ArgName
</span><a href="#local-6989586621680613627"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[ArgName] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ArgName]
</span><a href="#local-6989586621680613654"><span class="hs-identifier hs-var">late</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;s&quot;</span></span><span>
</span><span id="line-613"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-614"></span><span>      </span><span class="annot"><span class="annottext">Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
Doc -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#genericDocError"><span class="hs-identifier hs-var">genericDocError</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-615"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fwords"><span class="hs-identifier hs-var">fwords</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCM Doc) -&gt; ArgName -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;Variable generalization failed.&quot;</span></span><span>
</span><span id="line-616"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;- Probable cause&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fwords"><span class="hs-identifier hs-var">fwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613632"><span class="hs-identifier hs-var">cause</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-617"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;- Suggestion&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fwords"><span class="hs-identifier hs-var">fwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613631"><span class="hs-identifier hs-var">solution</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-618"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="annot"><span class="annottext">([TCM Doc] -&gt; TCM Doc) -&gt; [TCM Doc] -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;- Further information&quot;</span></span><span>
</span><span id="line-619"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><a href="#local-6989586621680613630"><span class="hs-identifier hs-var">order</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; [TCM Doc] -&gt; [TCM Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-620"></span><span>                         </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fwords"><span class="hs-identifier hs-var">fwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613628"><span class="hs-identifier hs-var">guess</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ArgName] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgName]
</span><a href="#local-6989586621680613654"><span class="hs-identifier hs-var">late</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ArgName] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgName]
</span><a href="#local-6989586621680613645"><span class="hs-identifier hs-var">early</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; [TCM Doc] -&gt; [TCM Doc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-621"></span><span>                         </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fwords"><span class="hs-identifier hs-var">fwords</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;The dependency I error is&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621680613662"><span class="hs-identifier hs-var">err'</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-622"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span>    </span><span id="local-6989586621680613713"><span class="annot"><span class="annottext">addNamedVariablesToScope :: t (Dom' t (Name, b)) -&gt; TCMT IO ()
</span><a href="#local-6989586621680613713"><span class="hs-identifier hs-var hs-var">addNamedVariablesToScope</span></a></span></span><span> </span><span id="local-6989586621680613626"><span class="annot"><span class="annottext">t (Dom' t (Name, b))
</span><a href="#local-6989586621680613626"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-625"></span><span>      </span><span class="annot"><span class="annottext">t (Dom' t (Name, b))
-&gt; (Dom' t (Name, b) -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">t (Dom' t (Name, b))
</span><a href="#local-6989586621680613626"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">((Dom' t (Name, b) -&gt; TCMT IO ()) -&gt; TCMT IO ())
-&gt; (Dom' t (Name, b) -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613624"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680613624"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-626"></span><span>        </span><span class="hs-comment">-- Recognize named variables by lack of '.' (TODO: hacky!)</span><span>
</span><span id="line-627"></span><span>        </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; ArgName -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize.eta.scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO ()) -&gt; ArgName -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;Adding (or not) &quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680613624"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot; to the scope&quot;</span></span><span>
</span><span id="line-628"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TCMT IO () -&gt; TCMT IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; ArgName -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680613624"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-629"></span><span>          </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; ArgName -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize.eta.scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;  (added)&quot;</span></span><span>
</span><span id="line-630"></span><span>          </span><span class="annot"><span class="annottext">BindingSource -&gt; Name -&gt; Name -&gt; TCMT IO ()
</span><a href="Agda.Syntax.Scope.Monad.html#bindVariable"><span class="hs-identifier hs-var">bindVariable</span></a></span><span> </span><span class="annot"><span class="annottext">BindingSource
</span><a href="Agda.Syntax.Scope.Base.html#LambdaBound"><span class="hs-identifier hs-var">LambdaBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680613624"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680613624"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span class="hs-comment">-- | Create a substition from a context where the i first record fields are variables to a context</span><span>
</span><span id="line-633"></span><span class="hs-comment">--   where you have a single variable of the record type. Packs up the field variables in a record</span><span>
</span><span id="line-634"></span><span class="hs-comment">--   constructor and pads with __DUMMY_TERM__s for the missing fields. Important that you apply this</span><span>
</span><span id="line-635"></span><span class="hs-comment">--   to terms that only projects the defined fields from the record variable.</span><span>
</span><span id="line-636"></span><span class="hs-comment">--   Used with partial record values when building the telescope of generalized variables in which</span><span>
</span><span id="line-637"></span><span class="hs-comment">--   case we have done the dependency analysis that guarantees it is safe.</span><span>
</span><span id="line-638"></span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#unpackSub"><span class="hs-identifier hs-type">unpackSub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span>
</span><span id="line-639"></span><span id="unpackSub"><span class="annot"><span class="annottext">unpackSub :: ConHead -&gt; [ArgInfo] -&gt; Int -&gt; Substitution
</span><a href="Agda.TypeChecking.Generalize.html#unpackSub"><span class="hs-identifier hs-var hs-var">unpackSub</span></a></span></span><span> </span><span id="local-6989586621680613618"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613618"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621680613617"><span class="annot"><span class="annottext">[ArgInfo]
</span><a href="#local-6989586621680613617"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span id="local-6989586621680613616"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613616"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621680613615"><span class="hs-identifier hs-var">recSub</span></a></span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-641"></span><span>    </span><span id="local-6989586621680613614"><span class="annot"><span class="annottext">ar :: Int
</span><a href="#local-6989586621680613614"><span class="hs-identifier hs-var hs-var">ar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ArgInfo] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ArgInfo]
</span><a href="#local-6989586621680613617"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-642"></span><span>    </span><span id="local-6989586621680613613"><span class="annot"><span class="annottext">appl :: ArgInfo -&gt; a -&gt; Elim' a
</span><a href="#local-6989586621680613613"><span class="hs-identifier hs-var hs-var">appl</span></a></span></span><span> </span><span id="local-6989586621680613612"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621680613612"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621680613611"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680613611"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg a -&gt; Elim' a
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; a -&gt; Arg a
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621680613612"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680613611"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>    </span><span id="local-6989586621680613610"><span class="annot"><span class="annottext">recVal :: Term
</span><a href="#local-6989586621680613610"><span class="hs-identifier hs-var hs-var">recVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613618"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConOSystem"><span class="hs-identifier hs-var">ConOSystem</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term) -&gt; Elims -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; Term -&gt; Elim' Term) -&gt; [ArgInfo] -&gt; [Term] -&gt; Elims
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Elim' Term
forall a. ArgInfo -&gt; a -&gt; Elim' a
</span><a href="#local-6989586621680613613"><span class="hs-identifier hs-var">appl</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgInfo]
</span><a href="#local-6989586621680613617"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="annot"><span class="annottext">([Term] -&gt; Elims) -&gt; [Term] -&gt; Elims
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613606"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680613606"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613606"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613616"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613616"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; [Term] -&gt; [Term]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; [Term]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613614"><span class="hs-identifier hs-var">ar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613616"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
HasCallStack =&gt; Term
</span><a href="Agda.Syntax.Internal.html#__DUMMY_TERM__"><span class="hs-identifier hs-var">__DUMMY_TERM__</span></a></span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>    </span><span class="hs-comment">-- want: &#915; &#916;&#7522; &#8866; recSub i : &#915; (r : R)</span><span>
</span><span id="line-646"></span><span>    </span><span class="hs-comment">-- have:</span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-comment">-- &#915; &#916;&#7522; &#8866; recVal i :# &#963; : &#920; (r : R),  if &#915; &#916;&#7522; &#8866; &#963; : &#920;</span><span>
</span><span id="line-648"></span><span>    </span><span class="hs-comment">-- &#915; &#916;&#7522; &#8866; WkS i IdS : &#915;</span><span>
</span><span id="line-649"></span><span>    </span><span id="local-6989586621680613615"><span class="annot"><span class="annottext">recSub :: Substitution
</span><a href="#local-6989586621680613615"><span class="hs-identifier hs-var hs-var">recSub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613610"><span class="hs-identifier hs-var">recVal</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Substitution -&gt; Substitution
forall a. a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.Syntax.Internal.html#%3A%23"><span class="hs-operator hs-var">:#</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.Syntax.Internal.html#Wk"><span class="hs-identifier hs-var">Wk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613616"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
forall a. Substitution' a
</span><a href="Agda.Syntax.Internal.html#IdS"><span class="hs-identifier hs-var">IdS</span></a></span><span>
</span><span id="line-650"></span><span>
</span><span id="line-651"></span><span class="hs-comment">-- | Takes the list of types</span><span>
</span><span id="line-652"></span><span class="hs-comment">--    A&#8321; []</span><span>
</span><span id="line-653"></span><span class="hs-comment">--    A&#8322; [r.f&#8321;]</span><span>
</span><span id="line-654"></span><span class="hs-comment">--    A&#8323; [r.f&#8322;, r.f&#8323;]</span><span>
</span><span id="line-655"></span><span class="hs-comment">--    ...</span><span>
</span><span id="line-656"></span><span class="hs-comment">--   And builds the telescope</span><span>
</span><span id="line-657"></span><span class="hs-comment">--    (x&#8321; : A&#8321; [ r := c _       .. _ ])</span><span>
</span><span id="line-658"></span><span class="hs-comment">--    (x&#8322; : A&#8322; [ r := c x&#8321; _    .. _ ])</span><span>
</span><span id="line-659"></span><span class="hs-comment">--    (x&#8323; : A&#8323; [ r := c x&#8321; x&#8322; _ .. _ ])</span><span>
</span><span id="line-660"></span><span class="hs-comment">--    ...</span><span>
</span><span id="line-661"></span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#buildGeneralizeTel"><span class="hs-identifier hs-type">buildGeneralizeTel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>
</span><span id="line-662"></span><span id="buildGeneralizeTel"><span class="annot"><span class="annottext">buildGeneralizeTel :: ConHead -&gt; [(Arg ArgName, Type)] -&gt; Telescope
</span><a href="Agda.TypeChecking.Generalize.html#buildGeneralizeTel"><span class="hs-identifier hs-var hs-var">buildGeneralizeTel</span></a></span></span><span> </span><span id="local-6989586621680613602"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613602"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621680613601"><span class="annot"><span class="annottext">[(Arg ArgName, Type)]
</span><a href="#local-6989586621680613601"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Arg ArgName, Type)] -&gt; Telescope
</span><a href="#local-6989586621680613600"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[(Arg ArgName, Type)]
</span><a href="#local-6989586621680613601"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-663"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-664"></span><span>    </span><span id="local-6989586621680613599"><span class="annot"><span class="annottext">infos :: [ArgInfo]
</span><a href="#local-6989586621680613599"><span class="hs-identifier hs-var hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Arg ArgName, Type) -&gt; ArgInfo)
-&gt; [(Arg ArgName, Type)] -&gt; [ArgInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg ArgName -&gt; ArgInfo
forall e. Arg e -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#argInfo"><span class="hs-identifier hs-var hs-var">argInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg ArgName -&gt; ArgInfo)
-&gt; ((Arg ArgName, Type) -&gt; Arg ArgName)
-&gt; (Arg ArgName, Type)
-&gt; ArgInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Arg ArgName, Type) -&gt; Arg ArgName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Arg ArgName, Type)]
</span><a href="#local-6989586621680613601"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-665"></span><span>    </span><span id="local-6989586621680613598"><span class="annot"><span class="annottext">recSub :: Int -&gt; Substitution
</span><a href="#local-6989586621680613598"><span class="hs-identifier hs-var hs-var">recSub</span></a></span></span><span> </span><span id="local-6989586621680613597"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613597"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; [ArgInfo] -&gt; Int -&gt; Substitution
</span><a href="Agda.TypeChecking.Generalize.html#unpackSub"><span class="hs-identifier hs-var">unpackSub</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613602"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgInfo]
</span><a href="#local-6989586621680613599"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613597"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-666"></span><span>    </span><span id="local-6989586621680613600"><span class="annot"><span class="annottext">go :: Int -&gt; [(Arg ArgName, Type)] -&gt; Telescope
</span><a href="#local-6989586621680613600"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope
forall a. Tele a
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span>
</span><span id="line-667"></span><span>    </span><span class="annot"><a href="#local-6989586621680613600"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680613595"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613595"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680613594"><span class="annot"><span class="annottext">Arg ArgName
</span><a href="#local-6989586621680613594"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613593"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613593"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680613592"><span class="annot"><span class="annottext">[(Arg ArgName, Type)]
</span><a href="#local-6989586621680613592"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Abs Telescope -&gt; Telescope
forall a. a -&gt; Abs (Tele a) -&gt; Tele a
</span><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-var">ExtendTel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Dom Type
</span><a href="#local-6989586621680613591"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613590"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Abs Telescope -&gt; Telescope) -&gt; Abs Telescope -&gt; Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Telescope -&gt; Abs Telescope
forall a. ArgName -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-var">Abs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg ArgName -&gt; ArgName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg ArgName
</span><a href="#local-6989586621680613594"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; Abs Telescope) -&gt; Telescope -&gt; Abs Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Arg ArgName, Type)] -&gt; Telescope
</span><a href="#local-6989586621680613600"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613595"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Arg ArgName, Type)]
</span><a href="#local-6989586621680613592"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-668"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680613590"><span class="annot"><span class="annottext">ty' :: Type
</span><a href="#local-6989586621680613590"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Type) -&gt; Type -&gt; Type
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Substitution
</span><a href="#local-6989586621680613598"><span class="hs-identifier hs-var">recSub</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613595"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613593"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-669"></span><span>            </span><span id="local-6989586621680613591"><span class="annot"><span class="annottext">dom :: Type -&gt; Dom Type
</span><a href="#local-6989586621680613591"><span class="hs-identifier hs-var hs-var">dom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; ArgName -&gt; Type -&gt; Dom Type
forall a. ArgInfo -&gt; ArgName -&gt; a -&gt; Dom a
</span><a href="Agda.Syntax.Internal.html#defaultNamedArgDom"><span class="hs-identifier hs-var">defaultNamedArgDom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg ArgName -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Arg ArgName
</span><a href="#local-6989586621680613594"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg ArgName -&gt; ArgName
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg ArgName
</span><a href="#local-6989586621680613594"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span class="hs-comment">-- | Create metas for all used generalizable variables and their dependencies.</span><span>
</span><span id="line-672"></span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#createGenValues"><span class="hs-identifier hs-type">createGenValues</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GeneralizedValue"><span class="hs-identifier hs-type">GeneralizedValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span id="createGenValues"><span class="annot"><span class="annottext">createGenValues :: Set QName -&gt; TCM (Map MetaId QName, Map QName GeneralizedValue)
</span><a href="Agda.TypeChecking.Generalize.html#createGenValues"><span class="hs-identifier hs-var hs-var">createGenValues</span></a></span></span><span> </span><span id="local-6989586621680613587"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621680613587"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-674"></span><span>  </span><span id="local-6989586621680613586"><span class="annot"><span class="annottext">[(QName, MetaId, GeneralizedValue)]
</span><a href="#local-6989586621680613586"><span class="hs-identifier hs-var">genvals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' DoGeneralize TCEnv
-&gt; (DoGeneralize -&gt; DoGeneralize)
-&gt; TCMT IO [(QName, MetaId, GeneralizedValue)]
-&gt; TCMT IO [(QName, MetaId, GeneralizedValue)]
forall (m :: * -&gt; *) a b.
MonadTCEnv m =&gt;
Lens' a TCEnv -&gt; (a -&gt; a) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Base.html#locallyTC"><span class="hs-identifier hs-var">locallyTC</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' DoGeneralize TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#eGeneralizeMetas"><span class="hs-identifier hs-var">eGeneralizeMetas</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DoGeneralize -&gt; DoGeneralize -&gt; DoGeneralize
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">DoGeneralize
</span><a href="Agda.TypeChecking.Monad.Base.html#YesGeneralize"><span class="hs-identifier hs-var">YesGeneralize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO [(QName, MetaId, GeneralizedValue)]
 -&gt; TCMT IO [(QName, MetaId, GeneralizedValue)])
-&gt; TCMT IO [(QName, MetaId, GeneralizedValue)]
-&gt; TCMT IO [(QName, MetaId, GeneralizedValue)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-675"></span><span>               </span><span class="annot"><span class="annottext">[QName]
-&gt; (QName -&gt; TCMT IO (QName, MetaId, GeneralizedValue))
-&gt; TCMT IO [(QName, MetaId, GeneralizedValue)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QName -&gt; QName -&gt; Ordering) -&gt; [QName] -&gt; [QName]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Range -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(Range -&gt; Range -&gt; Ordering)
-&gt; (QName -&gt; Range) -&gt; QName -&gt; QName -&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; [QName]) -&gt; [QName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; [QName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621680613587"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO (QName, MetaId, GeneralizedValue)
</span><a href="Agda.TypeChecking.Generalize.html#createGenValue"><span class="hs-identifier hs-var">createGenValue</span></a></span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613581"><span class="annot"><span class="annottext">metaMap :: Map MetaId QName
</span><a href="#local-6989586621680613581"><span class="hs-identifier hs-var hs-var">metaMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(MetaId, QName)] -&gt; Map MetaId QName
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613580"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613579"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613579"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613579"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613580"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613580"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GeneralizedValue
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(QName, MetaId, GeneralizedValue)]
</span><a href="#local-6989586621680613586"><span class="hs-identifier hs-var">genvals</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-677"></span><span>      </span><span id="local-6989586621680613578"><span class="annot"><span class="annottext">nameMap :: Map QName GeneralizedValue
</span><a href="#local-6989586621680613578"><span class="hs-identifier hs-var hs-var">nameMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(QName, GeneralizedValue)] -&gt; Map QName GeneralizedValue
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613577"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GeneralizedValue
</span><a href="#local-6989586621680613576"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613577"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613577"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetaId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613576"><span class="annot"><span class="annottext">GeneralizedValue
</span><a href="#local-6989586621680613576"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(QName, MetaId, GeneralizedValue)]
</span><a href="#local-6989586621680613586"><span class="hs-identifier hs-var">genvals</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-678"></span><span>  </span><span class="annot"><span class="annottext">(Map MetaId QName, Map QName GeneralizedValue)
-&gt; TCM (Map MetaId QName, Map QName GeneralizedValue)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map MetaId QName
</span><a href="#local-6989586621680613581"><span class="hs-identifier hs-var">metaMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map QName GeneralizedValue
</span><a href="#local-6989586621680613578"><span class="hs-identifier hs-var">nameMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span class="hs-comment">-- | Create a generalisable meta for a generalisable variable.</span><span>
</span><span id="line-681"></span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#createGenValue"><span class="hs-identifier hs-type">createGenValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GeneralizedValue"><span class="hs-identifier hs-type">GeneralizedValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span id="createGenValue"><span class="annot"><span class="annottext">createGenValue :: QName -&gt; TCMT IO (QName, MetaId, GeneralizedValue)
</span><a href="Agda.TypeChecking.Generalize.html#createGenValue"><span class="hs-identifier hs-var hs-var">createGenValue</span></a></span></span><span> </span><span id="local-6989586621680613575"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613575"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; TCMT IO (QName, MetaId, GeneralizedValue)
-&gt; TCMT IO (QName, MetaId, GeneralizedValue)
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613575"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (QName, MetaId, GeneralizedValue)
 -&gt; TCMT IO (QName, MetaId, GeneralizedValue))
-&gt; TCMT IO (QName, MetaId, GeneralizedValue)
-&gt; TCMT IO (QName, MetaId, GeneralizedValue)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-683"></span><span>  </span><span id="local-6989586621680613574"><span class="annot"><span class="annottext">CheckpointId
</span><a href="#local-6989586621680613574"><span class="hs-identifier hs-var">cp</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' CheckpointId TCEnv -&gt; TCMT IO CheckpointId
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' a TCEnv -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' CheckpointId TCEnv
</span><a href="Agda.TypeChecking.Monad.Base.html#eCurrentCheckpoint"><span class="hs-identifier hs-var">eCurrentCheckpoint</span></a></span><span>
</span><span id="line-684"></span><span>  </span><span id="local-6989586621680613573"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621680613573"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; TCMT IO Definition
forall (m :: * -&gt; *).
(Functor m, HasConstInfo m, HasOptions m, ReadTCState m,
 MonadTCEnv m, MonadDebug m) =&gt;
Definition -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#instantiateDef"><span class="hs-identifier hs-var">instantiateDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCMT IO Definition)
-&gt; TCMT IO Definition -&gt; TCMT IO Definition
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613575"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-685"></span><span>                   </span><span class="hs-comment">-- Only prefix of generalizable arguments (for now?)</span><span>
</span><span id="line-686"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613570"><span class="annot"><span class="annottext">nGen :: Int
</span><a href="#local-6989586621680613570"><span class="hs-identifier hs-var hs-var">nGen</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; NumGeneralizableArgs
</span><a href="Agda.TypeChecking.Monad.Base.html#defArgGeneralizable"><span class="hs-identifier hs-var hs-var">defArgGeneralizable</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621680613573"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-687"></span><span>                     </span><span class="annot"><span class="annottext">NumGeneralizableArgs
</span><a href="Agda.TypeChecking.Monad.Base.html#NoGeneralizableArgs"><span class="hs-identifier hs-var">NoGeneralizableArgs</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-688"></span><span>                     </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#SomeGeneralizableArgs"><span class="hs-identifier hs-type">SomeGeneralizableArgs</span></a></span><span> </span><span id="local-6989586621680613566"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613566"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613566"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-689"></span><span>      </span><span id="local-6989586621680613565"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621680613565"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621680613573"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-690"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621680613562"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613562"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TelV Type
</span><a href="Agda.TypeChecking.Substitute.html#telView%27"><span class="hs-identifier hs-var">telView'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613565"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-691"></span><span>      </span><span class="hs-comment">-- Generalizable variables are never explicit, so if they're given as</span><span>
</span><span id="line-692"></span><span>      </span><span class="hs-comment">-- explicit we default to hidden.</span><span>
</span><span id="line-693"></span><span>      </span><span id="local-6989586621680613560"><span class="annot"><span class="annottext">hideExplicit :: p -&gt; p
</span><a href="#local-6989586621680613560"><span class="hs-identifier hs-var hs-var">hideExplicit</span></a></span></span><span> </span><span id="local-6989586621680613559"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680613559"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">p -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680613559"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p -&gt; p
forall a. LensHiding a =&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#hide"><span class="hs-identifier hs-var">hide</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680613559"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-694"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680613559"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-695"></span><span>      </span><span id="local-6989586621680613556"><span class="annot"><span class="annottext">argTel :: Telescope
</span><a href="#local-6989586621680613556"><span class="hs-identifier hs-var hs-var">argTel</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dom' Term (ArgName, Type)] -&gt; Telescope
</span><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-var">telFromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; Telescope)
-&gt; [Dom' Term (ArgName, Type)] -&gt; Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Dom' Term (ArgName, Type) -&gt; Dom' Term (ArgName, Type))
-&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom' Term (ArgName, Type) -&gt; Dom' Term (ArgName, Type)
forall a. LensHiding a =&gt; a -&gt; a
</span><a href="#local-6989586621680613560"><span class="hs-identifier hs-var">hideExplicit</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)])
-&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613570"><span class="hs-identifier hs-var">nGen</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)])
-&gt; [Dom' Term (ArgName, Type)] -&gt; [Dom' Term (ArgName, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613562"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span>  </span><span id="local-6989586621680613555"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621680613555"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; TCMT IO Args
forall (m :: * -&gt; *). MonadMetaSolver m =&gt; Telescope -&gt; m Args
</span><a href="Agda.TypeChecking.MetaVars.html#newTelMeta"><span class="hs-identifier hs-var">newTelMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613556"><span class="hs-identifier hs-var">argTel</span></a></span><span>
</span><span id="line-698"></span><span>  </span><span id="local-6989586621680613553"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613553"><span class="hs-identifier hs-var">metaType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Args -&gt; TCM Type
forall a (m :: * -&gt; *).
(PiApplyM a, MonadReduce m, HasBuiltins m) =&gt;
Type -&gt; a -&gt; m Type
</span><a href="Agda.TypeChecking.Telescope.html#piApplyM"><span class="hs-identifier hs-var">piApplyM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613565"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621680613555"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613552"><span class="annot"><span class="annottext">name :: ArgName
</span><a href="#local-6989586621680613552"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; Name -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613575"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680613550"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613550"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613549"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613549"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RunMetaOccursCheck
-&gt; ArgName -&gt; Comparison -&gt; Type -&gt; TCM (MetaId, Term)
forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
RunMetaOccursCheck
-&gt; ArgName -&gt; Comparison -&gt; Type -&gt; m (MetaId, Term)
</span><a href="Agda.TypeChecking.MetaVars.html#newNamedValueMeta"><span class="hs-identifier hs-var">newNamedValueMeta</span></a></span><span> </span><span class="annot"><span class="annottext">RunMetaOccursCheck
</span><a href="Agda.TypeChecking.Monad.Base.html#DontRunMetaOccursCheck"><span class="hs-identifier hs-var">DontRunMetaOccursCheck</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613552"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.html#CmpLeq"><span class="hs-identifier hs-var">CmpLeq</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613553"><span class="hs-identifier hs-var">metaType</span></a></span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-comment">-- Freeze the meta to prevent named generalizable metas to be instantiated.</span><span>
</span><span id="line-704"></span><span>  </span><span class="annot"><span class="annottext">MetaId -&gt; (MetaVariable -&gt; MetaVariable) -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
MetaId -&gt; (MetaVariable -&gt; MetaVariable) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#updateMetaVar"><span class="hs-identifier hs-var">updateMetaVar</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613550"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">((MetaVariable -&gt; MetaVariable) -&gt; TCMT IO ())
-&gt; (MetaVariable -&gt; MetaVariable) -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680613546"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613546"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621680613546"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mvFrozen :: Frozen
</span><a href="Agda.TypeChecking.Monad.Base.html#mvFrozen"><span class="hs-identifier hs-var">mvFrozen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Frozen
</span><a href="Agda.TypeChecking.Monad.Base.html#Frozen"><span class="hs-identifier hs-var">Frozen</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-comment">-- Set up names of arg metas</span><span>
</span><span id="line-707"></span><span>  </span><span class="annot"><span class="annottext">[(Integer, Term, Dom' Term (ArgName, Type))]
-&gt; ((Integer, Term, Dom' Term (ArgName, Type)) -&gt; TCMT IO ())
-&gt; TCMT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Integer]
-&gt; [Term]
-&gt; [Dom' Term (ArgName, Type)]
-&gt; [(Integer, Term, Dom' Term (ArgName, Type))]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><span class="hs-identifier hs-var">zip3</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Term -&gt; Term) -&gt; Args -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621680613555"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; [Dom' Term (ArgName, Type)]
forall t. Tele (Dom t) -&gt; [Dom (ArgName, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613556"><span class="hs-identifier hs-var">argTel</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Integer, Term, Dom' Term (ArgName, Type)) -&gt; TCMT IO ())
 -&gt; TCMT IO ())
-&gt; ((Integer, Term, Dom' Term (ArgName, Type)) -&gt; TCMT IO ())
-&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">case</span><span>
</span><span id="line-708"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680613542"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680613542"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span id="local-6989586621680613541"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613541"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">unDom :: forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613540"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613540"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-709"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613539"><span class="annot"><span class="annottext">suf :: ArgName -&gt; ArgName
</span><a href="#local-6989586621680613539"><span class="hs-identifier hs-var hs-var">suf</span></a></span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680613542"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-710"></span><span>          </span><span class="annot"><a href="#local-6989586621680613539"><span class="hs-identifier hs-var">suf</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;&quot;</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ArgName
forall a. Show a =&gt; a -&gt; ArgName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680613542"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-711"></span><span>          </span><span class="annot"><a href="#local-6989586621680613539"><span class="hs-identifier hs-var">suf</span></a></span><span> </span><span id="local-6989586621680613538"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613538"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613538"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-712"></span><span>      </span><span class="annot"><span class="annottext">MetaId -&gt; ArgName -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
MetaId -&gt; ArgName -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#setMetaNameSuggestion"><span class="hs-identifier hs-var">setMetaNameSuggestion</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613541"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613552"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName
</span><a href="#local-6989586621680613539"><span class="hs-identifier hs-var">suf</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613540"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>    </span><span class="annot"><span class="annottext">(Integer, Term, Dom' Term (ArgName, Type))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- eta expanded</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-comment">-- Update the ArgInfos for the named meta. The argument metas are</span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-comment">-- created with the correct ArgInfo.</span><span>
</span><span id="line-717"></span><span>  </span><span class="annot"><span class="annottext">MetaId -&gt; ArgInfo -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
MetaId -&gt; ArgInfo -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#setMetaArgInfo"><span class="hs-identifier hs-var">setMetaArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613550"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; TCMT IO ()) -&gt; ArgInfo -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; ArgInfo
forall a. LensHiding a =&gt; a -&gt; a
</span><a href="#local-6989586621680613560"><span class="hs-identifier hs-var">hideExplicit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; ArgInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#defArgInfo"><span class="hs-identifier hs-var hs-var">defArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621680613573"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-720"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;created metas for generalized variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613575"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-721"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;top  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613549"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-722"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;args =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Args -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621680613555"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613549"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-725"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-726"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
Doc -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#genericDocError"><span class="hs-identifier hs-var">genericDocError</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;Cannot generalize over&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613575"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc
</span><span class="hs-string">&quot;of eta-expandable type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span>
</span><span id="line-727"></span><span>                                    </span><span class="annot"><span class="annottext">Type -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613553"><span class="hs-identifier hs-var">metaType</span></a></span><span>
</span><span id="line-728"></span><span>  </span><span class="annot"><span class="annottext">(QName, MetaId, GeneralizedValue)
-&gt; TCMT IO (QName, MetaId, GeneralizedValue)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613575"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613550"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GeneralizedValue :: CheckpointId -&gt; Term -&gt; Type -&gt; GeneralizedValue
</span><a href="Agda.TypeChecking.Monad.Base.html#GeneralizedValue"><span class="hs-identifier hs-type">GeneralizedValue</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">genvalCheckpoint :: CheckpointId
</span><a href="Agda.TypeChecking.Monad.Base.html#genvalCheckpoint"><span class="hs-identifier hs-var">genvalCheckpoint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheckpointId
</span><a href="#local-6989586621680613574"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-729"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">genvalTerm :: Term
</span><a href="Agda.TypeChecking.Monad.Base.html#genvalTerm"><span class="hs-identifier hs-var">genvalTerm</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621680613549"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-730"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">genvalType :: Type
</span><a href="Agda.TypeChecking.Monad.Base.html#genvalType"><span class="hs-identifier hs-var">genvalType</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613553"><span class="hs-identifier hs-var">metaType</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span class="hs-comment">-- | Create a not-yet correct record type for the generalized telescope. It's not yet correct since</span><span>
</span><span id="line-733"></span><span class="hs-comment">--   we haven't computed the telescope yet, and we need the record type to do it.</span><span>
</span><span id="line-734"></span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#createGenRecordType"><span class="hs-identifier hs-type">createGenRecordType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-735"></span><span id="createGenRecordType"><span class="annot"><span class="annottext">createGenRecordType :: Type -&gt; [MetaId] -&gt; TCMT IO (QName, ConHead, [QName])
</span><a href="Agda.TypeChecking.Generalize.html#createGenRecordType"><span class="hs-identifier hs-var hs-var">createGenRecordType</span></a></span></span><span> </span><span id="local-6989586621680613531"><span class="annot"><span class="annottext">genRecMeta :: Type
</span><a href="#local-6989586621680613531"><span class="hs-identifier hs-var">genRecMeta</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span id="local-6989586621680613530"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621680613530"><span class="hs-identifier hs-var">genRecSort</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680613529"><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613529"><span class="hs-identifier hs-var">sortedMetas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-736"></span><span>  </span><span id="local-6989586621680613528"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680613528"><span class="hs-identifier hs-var">current</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO ModuleName
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m ModuleName
</span><a href="Agda.TypeChecking.Monad.Env.html#currentModule"><span class="hs-identifier hs-var">currentModule</span></a></span><span>
</span><span id="line-737"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613526"><span class="annot"><span class="annottext">freshQName :: ArgName -&gt; TCMT IO QName
</span><a href="#local-6989586621680613526"><span class="hs-identifier hs-var hs-var">freshQName</span></a></span></span><span> </span><span id="local-6989586621680613525"><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613525"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Name -&gt; QName
</span><a href="Agda.Syntax.Abstract.Name.html#qualify"><span class="hs-identifier hs-var">qualify</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680613528"><span class="hs-identifier hs-var">current</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; QName) -&gt; TCMT IO Name -&gt; TCMT IO QName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO Name
forall a (m :: * -&gt; *).
(FreshName a, MonadFresh NameId m) =&gt;
a -&gt; m Name
</span><a href="Agda.TypeChecking.Monad.Base.html#freshName_"><span class="hs-identifier hs-var">freshName_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName
</span><a href="#local-6989586621680613525"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>      </span><span id="local-6989586621680613523"><span class="annot"><span class="annottext">mkFieldName :: MetaId -&gt; TCMT IO QName
</span><a href="#local-6989586621680613523"><span class="hs-identifier hs-var hs-var">mkFieldName</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO QName
</span><a href="#local-6989586621680613526"><span class="hs-identifier hs-var">freshQName</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO QName)
-&gt; (ArgName -&gt; ArgName) -&gt; ArgName -&gt; TCMT IO QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName
</span><a href="Agda.TypeChecking.Monad.Base.html#generalizedFieldName"><span class="hs-identifier hs-var">generalizedFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; ArgName -&gt; ArgName
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCMT IO QName)
-&gt; (MetaId -&gt; TCMT IO ArgName) -&gt; MetaId -&gt; TCMT IO QName
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO ArgName
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m) =&gt;
MetaId -&gt; m ArgName
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaNameSuggestion"><span class="hs-identifier hs-var">getMetaNameSuggestion</span></a></span><span>
</span><span id="line-739"></span><span>  </span><span id="local-6989586621680613520"><span class="annot"><span class="annottext">[Dom QName]
</span><a href="#local-6989586621680613520"><span class="hs-identifier hs-var">genRecFields</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MetaId -&gt; TCMT IO (Dom QName)) -&gt; [MetaId] -&gt; TCMT IO [Dom QName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Dom QName
forall a. a -&gt; Dom a
</span><a href="Agda.Syntax.Internal.html#defaultDom"><span class="hs-identifier hs-var">defaultDom</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Dom QName)
-&gt; (MetaId -&gt; TCMT IO QName) -&gt; MetaId -&gt; TCMT IO (Dom QName)
forall (m :: * -&gt; *) b c a.
Functor m =&gt;
(b -&gt; c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="Agda.Utils.Functor.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO QName
</span><a href="#local-6989586621680613523"><span class="hs-identifier hs-var">mkFieldName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613529"><span class="hs-identifier hs-var">sortedMetas</span></a></span><span>
</span><span id="line-740"></span><span>  </span><span id="local-6989586621680613518"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613518"><span class="hs-identifier hs-var">genRecName</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO QName
</span><a href="#local-6989586621680613526"><span class="hs-identifier hs-var">freshQName</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;GeneralizeTel&quot;</span></span><span>
</span><span id="line-741"></span><span>  </span><span id="local-6989586621680613517"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613517"><span class="hs-identifier hs-var">genRecCon</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCMT IO QName
</span><a href="#local-6989586621680613526"><span class="hs-identifier hs-var">freshQName</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;mkGeneralizeTel&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO QName -&gt; (QName -&gt; ConHead) -&gt; TCMT IO ConHead
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><a href="Agda.Utils.Functor.html#%3C%26%3E"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680613515"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613515"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConHead :: QName -&gt; DataOrRecord -&gt; Induction -&gt; [Arg QName] -&gt; ConHead
</span><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span>
</span><span id="line-742"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">conName :: QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613515"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-743"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conDataRecord :: DataOrRecord
</span><a href="Agda.Syntax.Internal.html#conDataRecord"><span class="hs-identifier hs-var">conDataRecord</span></a></span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternOrCopattern -&gt; DataOrRecord
</span><a href="Agda.Syntax.Internal.html#IsRecord"><span class="hs-identifier hs-var">IsRecord</span></a></span><span> </span><span class="annot"><span class="annottext">PatternOrCopattern
</span><a href="Agda.Syntax.Common.html#CopatternMatching"><span class="hs-identifier hs-var">CopatternMatching</span></a></span><span>
</span><span id="line-744"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conInductive :: Induction
</span><a href="Agda.Syntax.Internal.html#conInductive"><span class="hs-identifier hs-var">conInductive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Induction
</span><a href="Agda.Syntax.Common.html#Inductive"><span class="hs-identifier hs-var">Inductive</span></a></span><span>
</span><span id="line-745"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conFields :: [Arg QName]
</span><a href="Agda.Syntax.Internal.html#conFields"><span class="hs-identifier hs-var">conFields</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dom QName -&gt; Arg QName) -&gt; [Dom QName] -&gt; [Arg QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom QName -&gt; Arg QName
forall t a. Dom' t a -&gt; Arg a
</span><a href="Agda.Syntax.Internal.html#argFromDom"><span class="hs-identifier hs-var">argFromDom</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom QName]
</span><a href="#local-6989586621680613520"><span class="hs-identifier hs-var">genRecFields</span></a></span><span>
</span><span id="line-746"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-747"></span><span>  </span><span id="local-6989586621680613505"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613505"><span class="hs-identifier hs-var">projIx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int)
-&gt; ([Dom (Name, Type)] -&gt; Int) -&gt; [Dom (Name, Type)] -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Dom (Name, Type)] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">([Dom (Name, Type)] -&gt; Int)
-&gt; TCMT IO [Dom (Name, Type)] -&gt; TCMT IO Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO [Dom (Name, Type)]
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m [Dom (Name, Type)]
</span><a href="Agda.TypeChecking.Monad.Context.html#getContext"><span class="hs-identifier hs-var">getContext</span></a></span><span>
</span><span id="line-748"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO ()
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(MetaId, Dom QName)]
-&gt; ((MetaId, Dom QName) -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MetaId] -&gt; [Dom QName] -&gt; [(MetaId, Dom QName)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[MetaId]
</span><a href="#local-6989586621680613529"><span class="hs-identifier hs-var">sortedMetas</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom QName]
</span><a href="#local-6989586621680613520"><span class="hs-identifier hs-var">genRecFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((MetaId, Dom QName) -&gt; TCMT IO ()) -&gt; TCMT IO ())
-&gt; ((MetaId, Dom QName) -&gt; TCMT IO ()) -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613503"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613503"><span class="hs-identifier hs-var">meta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680613502"><span class="annot"><span class="annottext">Dom QName
</span><a href="#local-6989586621680613502"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-749"></span><span>    </span><span id="local-6989586621680613501"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613501"><span class="hs-identifier hs-var">fieldTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCM Type
forall (m :: * -&gt; *).
(MonadFail m, ReadTCState m) =&gt;
MetaId -&gt; m Type
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#getMetaType"><span class="hs-identifier hs-var">getMetaType</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621680613503"><span class="hs-identifier hs-var">meta</span></a></span><span>
</span><span id="line-750"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613500"><span class="annot"><span class="annottext">field :: QName
</span><a href="#local-6989586621680613500"><span class="hs-identifier hs-var hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom QName -&gt; QName
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom QName
</span><a href="#local-6989586621680613502"><span class="hs-identifier hs-var">fld</span></a></span><span>
</span><span id="line-751"></span><span>    </span><span class="annot"><span class="annottext">QName -&gt; Definition -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Monad.Signature.html#addConstant"><span class="hs-identifier hs-var">addConstant</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613500"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCMT IO ()) -&gt; Definition -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; QName -&gt; Type -&gt; Defn -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.Base.html#defaultDefn"><span class="hs-identifier hs-var">defaultDefn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom QName -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Dom QName
</span><a href="#local-6989586621680613502"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613500"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613501"><span class="hs-identifier hs-var">fieldTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; Definition) -&gt; Defn -&gt; Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-752"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613497"><span class="annot"><span class="annottext">proj :: Projection
</span><a href="#local-6989586621680613497"><span class="hs-identifier hs-var hs-var">proj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Projection :: Maybe QName -&gt; QName -&gt; Arg QName -&gt; Int -&gt; ProjLams -&gt; Projection
</span><a href="Agda.TypeChecking.Monad.Base.html#Projection"><span class="hs-identifier hs-type">Projection</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">projProper :: Maybe QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projProper"><span class="hs-identifier hs-var">projProper</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613518"><span class="hs-identifier hs-var">genRecName</span></a></span><span>
</span><span id="line-753"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">projOrig :: QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projOrig"><span class="hs-identifier hs-var">projOrig</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613500"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-754"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">projFromType :: Arg QName
</span><a href="Agda.TypeChecking.Monad.Base.html#projFromType"><span class="hs-identifier hs-var">projFromType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Arg QName
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613518"><span class="hs-identifier hs-var">genRecName</span></a></span><span>
</span><span id="line-755"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">projIndex :: Int
</span><a href="Agda.TypeChecking.Monad.Base.html#projIndex"><span class="hs-identifier hs-var">projIndex</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680613505"><span class="hs-identifier hs-var">projIx</span></a></span><span>
</span><span id="line-756"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">projLams :: ProjLams
</span><a href="Agda.TypeChecking.Monad.Base.html#projLams"><span class="hs-identifier hs-var">projLams</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg ArgName] -&gt; ProjLams
</span><a href="Agda.TypeChecking.Monad.Base.html#ProjLams"><span class="hs-identifier hs-var">ProjLams</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ArgName -&gt; Arg ArgName
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;gtel&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-757"></span><span>      </span><span class="annot"><span class="annottext">Function :: [Clause]
-&gt; Maybe CompiledClauses
-&gt; Maybe SplitTree
-&gt; Maybe Compiled
-&gt; [Clause]
-&gt; FunctionInverse
-&gt; Maybe [QName]
-&gt; IsAbstract
-&gt; Delayed
-&gt; Maybe Projection
-&gt; Set FunctionFlag
-&gt; Maybe Bool
-&gt; Maybe ExtLamInfo
-&gt; Maybe QName
-&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funClauses :: [Clause]
</span><a href="#local-6989586621680613487"><span class="hs-identifier hs-var">funClauses</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-758"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funCompiled :: Maybe CompiledClauses
</span><a href="#local-6989586621680613486"><span class="hs-identifier hs-var">funCompiled</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CompiledClauses
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-759"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funSplitTree :: Maybe SplitTree
</span><a href="#local-6989586621680613485"><span class="hs-identifier hs-var">funSplitTree</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SplitTree
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-760"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funTreeless :: Maybe Compiled
</span><a href="#local-6989586621680613484"><span class="hs-identifier hs-var">funTreeless</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Compiled
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-761"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funInv :: FunctionInverse
</span><a href="#local-6989586621680613483"><span class="hs-identifier hs-var">funInv</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunctionInverse
forall c. FunctionInverse' c
</span><a href="Agda.TypeChecking.Monad.Base.html#NotInjective"><span class="hs-identifier hs-var">NotInjective</span></a></span><span>
</span><span id="line-762"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funMutual :: Maybe [QName]
</span><a href="#local-6989586621680613481"><span class="hs-identifier hs-var">funMutual</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; Maybe [QName]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-763"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funAbstr :: IsAbstract
</span><a href="#local-6989586621680613480"><span class="hs-identifier hs-var">funAbstr</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsAbstract
</span><a href="Agda.Syntax.Common.html#ConcreteDef"><span class="hs-identifier hs-var">ConcreteDef</span></a></span><span>
</span><span id="line-764"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funDelayed :: Delayed
</span><a href="#local-6989586621680613478"><span class="hs-identifier hs-var">funDelayed</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delayed
</span><a href="Agda.Syntax.Common.html#NotDelayed"><span class="hs-identifier hs-var">NotDelayed</span></a></span><span>
</span><span id="line-765"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funProjection :: Maybe Projection
</span><a href="#local-6989586621680613476"><span class="hs-identifier hs-var">funProjection</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Projection -&gt; Maybe Projection
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Projection
</span><a href="#local-6989586621680613497"><span class="hs-identifier hs-var">proj</span></a></span><span>
</span><span id="line-766"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funFlags :: Set FunctionFlag
</span><a href="#local-6989586621680613475"><span class="hs-identifier hs-var">funFlags</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set FunctionFlag
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-767"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funTerminates :: Maybe Bool
</span><a href="#local-6989586621680613474"><span class="hs-identifier hs-var">funTerminates</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-768"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funExtLam :: Maybe ExtLamInfo
</span><a href="#local-6989586621680613473"><span class="hs-identifier hs-var">funExtLam</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ExtLamInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-769"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funWith :: Maybe QName
</span><a href="#local-6989586621680613472"><span class="hs-identifier hs-var">funWith</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe QName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-770"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funCovering :: [Clause]
</span><a href="#local-6989586621680613471"><span class="hs-identifier hs-var">funCovering</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-771"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-772"></span><span>  </span><span class="annot"><span class="annottext">QName -&gt; Definition -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Monad.Signature.html#addConstant"><span class="hs-identifier hs-var">addConstant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613517"><span class="hs-identifier hs-var">genRecCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCMT IO ()) -&gt; Definition -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; QName -&gt; Type -&gt; Defn -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.Base.html#defaultDefn"><span class="hs-identifier hs-var">defaultDefn</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-var">defaultArgInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613517"><span class="hs-identifier hs-var">genRecCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
HasCallStack =&gt; Type
</span><a href="Agda.Syntax.Internal.html#__DUMMY_TYPE__"><span class="hs-identifier hs-var">__DUMMY_TYPE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; Definition) -&gt; Defn -&gt; Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">-- Filled in later</span><span>
</span><span id="line-773"></span><span>    </span><span class="annot"><span class="annottext">Constructor :: Int
-&gt; Int
-&gt; ConHead
-&gt; QName
-&gt; IsAbstract
-&gt; Induction
-&gt; CompKit
-&gt; Maybe [QName]
-&gt; [IsForced]
-&gt; Maybe [Bool]
-&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">conPars :: Int
</span><a href="#local-6989586621680613467"><span class="hs-identifier hs-var">conPars</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-774"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conArity :: Int
</span><a href="#local-6989586621680613466"><span class="hs-identifier hs-var">conArity</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dom QName] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Dom QName]
</span><a href="#local-6989586621680613520"><span class="hs-identifier hs-var">genRecFields</span></a></span><span>
</span><span id="line-775"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conSrcCon :: ConHead
</span><a href="#local-6989586621680613465"><span class="hs-identifier hs-var">conSrcCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613517"><span class="hs-identifier hs-var">genRecCon</span></a></span><span>
</span><span id="line-776"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conData :: QName
</span><a href="#local-6989586621680613464"><span class="hs-identifier hs-var">conData</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613518"><span class="hs-identifier hs-var">genRecName</span></a></span><span>
</span><span id="line-777"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conAbstr :: IsAbstract
</span><a href="#local-6989586621680613463"><span class="hs-identifier hs-var">conAbstr</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsAbstract
</span><a href="Agda.Syntax.Common.html#ConcreteDef"><span class="hs-identifier hs-var">ConcreteDef</span></a></span><span>
</span><span id="line-778"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conInd :: Induction
</span><a href="#local-6989586621680613462"><span class="hs-identifier hs-var">conInd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Induction
</span><a href="Agda.Syntax.Common.html#Inductive"><span class="hs-identifier hs-var">Inductive</span></a></span><span>
</span><span id="line-779"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conComp :: CompKit
</span><a href="#local-6989586621680613461"><span class="hs-identifier hs-var">conComp</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompKit
</span><a href="Agda.TypeChecking.Monad.Base.html#emptyCompKit"><span class="hs-identifier hs-var">emptyCompKit</span></a></span><span>
</span><span id="line-780"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conProj :: Maybe [QName]
</span><a href="#local-6989586621680613459"><span class="hs-identifier hs-var">conProj</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [QName]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-781"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conForced :: [IsForced]
</span><a href="#local-6989586621680613458"><span class="hs-identifier hs-var">conForced</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-782"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">conErased :: Maybe [Bool]
</span><a href="#local-6989586621680613457"><span class="hs-identifier hs-var">conErased</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Bool]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-783"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-784"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613456"><span class="annot"><span class="annottext">dummyTel :: t -&gt; Telescope
</span><a href="#local-6989586621680613456"><span class="hs-identifier hs-var hs-var">dummyTel</span></a></span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope
forall a. Tele a
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span>
</span><span id="line-785"></span><span>      </span><span class="annot"><a href="#local-6989586621680613456"><span class="hs-identifier hs-var">dummyTel</span></a></span><span> </span><span id="local-6989586621680613455"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680613455"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Abs Telescope -&gt; Telescope
forall a. a -&gt; Abs (Tele a) -&gt; Tele a
</span><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-var">ExtendTel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Dom Type
forall a. a -&gt; Dom a
</span><a href="Agda.Syntax.Internal.html#defaultDom"><span class="hs-identifier hs-var">defaultDom</span></a></span><span> </span><span class="annot"><span class="annottext">Type
HasCallStack =&gt; Type
</span><a href="Agda.Syntax.Internal.html#__DUMMY_TYPE__"><span class="hs-identifier hs-var">__DUMMY_TYPE__</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Abs Telescope -&gt; Telescope) -&gt; Abs Telescope -&gt; Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; Telescope -&gt; Abs Telescope
forall a. ArgName -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-var">Abs</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; Abs Telescope) -&gt; Telescope -&gt; Abs Telescope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; Telescope
</span><a href="#local-6989586621680613456"><span class="hs-identifier hs-var">dummyTel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680613455"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>  </span><span class="annot"><span class="annottext">QName -&gt; Definition -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Monad.Signature.html#addConstant"><span class="hs-identifier hs-var">addConstant</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613518"><span class="hs-identifier hs-var">genRecName</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCMT IO ()) -&gt; Definition -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; QName -&gt; Type -&gt; Defn -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.Base.html#defaultDefn"><span class="hs-identifier hs-var">defaultDefn</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-var">defaultArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613518"><span class="hs-identifier hs-var">genRecName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sort -&gt; Type
</span><a href="Agda.TypeChecking.Substitute.html#sort"><span class="hs-identifier hs-var">sort</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621680613530"><span class="hs-identifier hs-var">genRecSort</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; Definition) -&gt; Defn -&gt; Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-787"></span><span>    </span><span class="annot"><span class="annottext">Record :: Int
-&gt; Maybe Clause
-&gt; ConHead
-&gt; Bool
-&gt; [Dom QName]
-&gt; Telescope
-&gt; Maybe [QName]
-&gt; EtaEquality
-&gt; PatternOrCopattern
-&gt; Maybe Induction
-&gt; IsAbstract
-&gt; CompKit
-&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recPars :: Int
</span><a href="#local-6989586621680613452"><span class="hs-identifier hs-var">recPars</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-788"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recClause :: Maybe Clause
</span><a href="#local-6989586621680613451"><span class="hs-identifier hs-var">recClause</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Clause
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-789"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recConHead :: ConHead
</span><a href="#local-6989586621680613450"><span class="hs-identifier hs-var">recConHead</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613517"><span class="hs-identifier hs-var">genRecCon</span></a></span><span>
</span><span id="line-790"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recNamedCon :: Bool
</span><a href="#local-6989586621680613449"><span class="hs-identifier hs-var">recNamedCon</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-791"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recFields :: [Dom QName]
</span><a href="#local-6989586621680613448"><span class="hs-identifier hs-var">recFields</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dom QName]
</span><a href="#local-6989586621680613520"><span class="hs-identifier hs-var">genRecFields</span></a></span><span>
</span><span id="line-792"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recTel :: Telescope
</span><a href="Agda.TypeChecking.Monad.Base.html#recTel"><span class="hs-identifier hs-var">recTel</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Telescope
forall t. (Eq t, Num t) =&gt; t -&gt; Telescope
</span><a href="#local-6989586621680613456"><span class="hs-identifier hs-var">dummyTel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom QName] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Dom QName]
</span><a href="#local-6989586621680613520"><span class="hs-identifier hs-var">genRecFields</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Filled in later</span><span>
</span><span id="line-793"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recMutual :: Maybe [QName]
</span><a href="#local-6989586621680613446"><span class="hs-identifier hs-var">recMutual</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; Maybe [QName]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-794"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recEtaEquality' :: EtaEquality
</span><a href="#local-6989586621680613445"><span class="hs-identifier hs-var">recEtaEquality'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasEta -&gt; EtaEquality
</span><a href="Agda.TypeChecking.Monad.Base.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a></span><span> </span><span class="annot"><span class="annottext">HasEta
forall a. HasEta' a
</span><a href="Agda.Syntax.Common.html#YesEta"><span class="hs-identifier hs-var">YesEta</span></a></span><span>
</span><span id="line-795"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recPatternMatching :: PatternOrCopattern
</span><a href="#local-6989586621680613442"><span class="hs-identifier hs-var">recPatternMatching</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatternOrCopattern
</span><a href="Agda.Syntax.Common.html#CopatternMatching"><span class="hs-identifier hs-var">CopatternMatching</span></a></span><span>
</span><span id="line-796"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recInduction :: Maybe Induction
</span><a href="#local-6989586621680613441"><span class="hs-identifier hs-var">recInduction</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Induction
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-797"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recAbstr :: IsAbstract
</span><a href="#local-6989586621680613440"><span class="hs-identifier hs-var">recAbstr</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsAbstract
</span><a href="Agda.Syntax.Common.html#ConcreteDef"><span class="hs-identifier hs-var">ConcreteDef</span></a></span><span>
</span><span id="line-798"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recComp :: CompKit
</span><a href="#local-6989586621680613439"><span class="hs-identifier hs-var">recComp</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompKit
</span><a href="Agda.TypeChecking.Monad.Base.html#emptyCompKit"><span class="hs-identifier hs-var">emptyCompKit</span></a></span><span>
</span><span id="line-799"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-800"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-801"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;created genRec&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Dom QName -&gt; TCM Doc) -&gt; [Dom QName] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgName -&gt; TCM Doc)
-&gt; (Dom QName -&gt; ArgName) -&gt; Dom QName -&gt; TCM Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; ArgName) -&gt; (Dom QName -&gt; QName) -&gt; Dom QName -&gt; ArgName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dom QName -&gt; QName
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var hs-var">unDom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dom QName]
</span><a href="#local-6989586621680613520"><span class="hs-identifier hs-var">genRecFields</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-802"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-803"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;created genRec&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom QName] -&gt; ArgName
forall a. Pretty a =&gt; a -&gt; ArgName
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom QName]
</span><a href="#local-6989586621680613520"><span class="hs-identifier hs-var">genRecFields</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-comment">-- Solve the genRecMeta</span><span>
</span><span id="line-805"></span><span>  </span><span id="local-6989586621680613438"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621680613438"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Args
forall (m :: * -&gt; *). (Applicative m, MonadTCEnv m) =&gt; m Args
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextArgs"><span class="hs-identifier hs-var">getContextArgs</span></a></span><span>
</span><span id="line-806"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613437"><span class="annot"><span class="annottext">genRecTy :: Type
</span><a href="#local-6989586621680613437"><span class="hs-identifier hs-var hs-var">genRecTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; Term -&gt; Type
forall t a. Sort' t -&gt; a -&gt; Type'' t a
</span><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-var">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621680613530"><span class="hs-identifier hs-var">genRecSort</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Type) -&gt; Term -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613518"><span class="hs-identifier hs-var">genRecName</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term) -&gt; Elims -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim' Term) -&gt; Args -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim' Term
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621680613438"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-807"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO () -&gt; TCMT IO ()
forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#noConstraints"><span class="hs-identifier hs-var">noConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO () -&gt; TCMT IO ()) -&gt; TCMT IO () -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TCMT IO ()
forall (m :: * -&gt; *). MonadConversion m =&gt; Type -&gt; Type -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#equalType"><span class="hs-identifier hs-var">equalType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613437"><span class="hs-identifier hs-var">genRecTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613531"><span class="hs-identifier hs-var">genRecMeta</span></a></span><span>
</span><span id="line-808"></span><span>  </span><span class="annot"><span class="annottext">(QName, ConHead, [QName]) -&gt; TCMT IO (QName, ConHead, [QName])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613518"><span class="hs-identifier hs-var">genRecName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613517"><span class="hs-identifier hs-var">genRecCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Dom QName -&gt; QName) -&gt; [Dom QName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dom QName -&gt; QName
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom QName]
</span><a href="#local-6989586621680613520"><span class="hs-identifier hs-var">genRecFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span class="hs-comment">-- | Once we have the generalized telescope we can fill in the missing details of the record type.</span><span>
</span><span id="line-811"></span><span class="annot"><a href="Agda.TypeChecking.Generalize.html#fillInGenRecordDetails"><span class="hs-identifier hs-type">fillInGenRecordDetails</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConHead"><span class="hs-identifier hs-type">ConHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-812"></span><span id="fillInGenRecordDetails"><span class="annot"><span class="annottext">fillInGenRecordDetails :: QName -&gt; ConHead -&gt; [QName] -&gt; Type -&gt; Telescope -&gt; TCMT IO ()
</span><a href="Agda.TypeChecking.Generalize.html#fillInGenRecordDetails"><span class="hs-identifier hs-var hs-var">fillInGenRecordDetails</span></a></span></span><span> </span><span id="local-6989586621680613435"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613435"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680613434"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613434"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621680613433"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613433"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span id="local-6989586621680613432"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613432"><span class="hs-identifier hs-var">recTy</span></a></span></span><span> </span><span id="local-6989586621680613431"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613431"><span class="hs-identifier hs-var">fieldTel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-813"></span><span>  </span><span id="local-6989586621680613430"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613430"><span class="hs-identifier hs-var">cxtTel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Dom Type -&gt; Dom Type) -&gt; Telescope -&gt; Telescope
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Dom Type
forall a. (LensHiding a, LensRelevance a) =&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Irrelevance.html#hideAndRelParams"><span class="hs-identifier hs-var">hideAndRelParams</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope -&gt; Telescope) -&gt; TCMT IO Telescope -&gt; TCMT IO Telescope
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Telescope
forall (m :: * -&gt; *). (Applicative m, MonadTCEnv m) =&gt; m Telescope
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-var">getContextTelescope</span></a></span><span>
</span><span id="line-814"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613428"><span class="annot"><span class="annottext">fullTel :: Telescope
</span><a href="#local-6989586621680613428"><span class="hs-identifier hs-var hs-var">fullTel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613430"><span class="hs-identifier hs-var">cxtTel</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Telescope -&gt; Telescope
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-operator hs-var">`abstract`</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613431"><span class="hs-identifier hs-var">fieldTel</span></a></span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-comment">-- Field types</span><span>
</span><span id="line-816"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613427"><span class="annot"><span class="annottext">mkFieldTypes :: [QName] -&gt; Telescope -&gt; [Type]
</span><a href="#local-6989586621680613427"><span class="hs-identifier hs-var hs-var">mkFieldTypes</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-var">EmptyTel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-817"></span><span>      </span><span class="annot"><a href="#local-6989586621680613427"><span class="hs-identifier hs-var">mkFieldTypes</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680613426"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613426"><span class="hs-identifier hs-var">fld</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680613425"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613425"><span class="hs-identifier hs-var">flds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span> </span><span id="local-6989586621680613424"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621680613424"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680613423"><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621680613423"><span class="hs-identifier hs-var">ftel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-818"></span><span>          </span><span class="annot"><span class="annottext">Telescope -&gt; Type -&gt; Type
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-var">abstract</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613430"><span class="hs-identifier hs-var">cxtTel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sort -&gt; Term -&gt; Type
forall t a. Sort' t -&gt; a -&gt; Type'' t a
</span><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-var">El</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621680613422"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Type) -&gt; Term -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Abs Type -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-var">Pi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Dom Type
forall a. a -&gt; Dom a
</span><a href="Agda.Syntax.Internal.html#defaultDom"><span class="hs-identifier hs-var">defaultDom</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613432"><span class="hs-identifier hs-var">recTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; Type -&gt; Abs Type
forall a. ArgName -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-var">Abs</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;r&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Abs Type) -&gt; Type -&gt; Abs Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621680613424"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-819"></span><span>          </span><span class="annot"><span class="annottext">[QName] -&gt; Telescope -&gt; [Type]
</span><a href="#local-6989586621680613427"><span class="hs-identifier hs-var">mkFieldTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613425"><span class="hs-identifier hs-var">flds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Abs Telescope -&gt; SubstArg Telescope -&gt; Telescope
forall a. Subst a =&gt; Abs a -&gt; SubstArg a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absApp"><span class="hs-identifier hs-var">absApp</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Telescope
</span><a href="#local-6989586621680613423"><span class="hs-identifier hs-var">ftel</span></a></span><span> </span><span class="annot"><span class="annottext">Term
SubstArg Telescope
</span><a href="#local-6989586621680613419"><span class="hs-identifier hs-var">proj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-821"></span><span>          </span><span id="local-6989586621680613422"><span class="annot"><span class="annottext">s :: Sort
</span><a href="#local-6989586621680613422"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Abs Type -&gt; Sort
</span><a href="Agda.TypeChecking.Substitute.html#mkPiSort"><span class="hs-identifier hs-var">mkPiSort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Dom Type
forall a. a -&gt; Dom a
</span><a href="Agda.Syntax.Internal.html#defaultDom"><span class="hs-identifier hs-var">defaultDom</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613432"><span class="hs-identifier hs-var">recTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgName -&gt; Type -&gt; Abs Type
forall a. ArgName -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-var">Abs</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;r&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Abs Type) -&gt; Type -&gt; Abs Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Type
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621680613424"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>          </span><span id="local-6989586621680613419"><span class="annot"><span class="annottext">proj :: Term
</span><a href="#local-6989586621680613419"><span class="hs-identifier hs-var hs-var">proj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProjOrigin -&gt; QName -&gt; Elim' Term
forall a. ProjOrigin -&gt; QName -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-var">Proj</span></a></span><span> </span><span class="annot"><span class="annottext">ProjOrigin
</span><a href="Agda.Syntax.Common.html#ProjSystem"><span class="hs-identifier hs-var">ProjSystem</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613426"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-823"></span><span>      </span><span class="annot"><a href="#local-6989586621680613427"><span class="hs-identifier hs-var">mkFieldTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613417"><span class="annot"><span class="annottext">fieldTypes :: [Type]
</span><a href="#local-6989586621680613417"><span class="hs-identifier hs-var hs-var">fieldTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; Telescope -&gt; [Type]
</span><a href="#local-6989586621680613427"><span class="hs-identifier hs-var">mkFieldTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613433"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Telescope -&gt; Telescope
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613431"><span class="hs-identifier hs-var">fieldTel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;Field types:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCM Doc) -&gt; TCM Doc -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCM Doc] -&gt; TCM Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCM Doc] -&gt; TCM Doc) -&gt; [TCM Doc] -&gt; TCM Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCM Doc) -&gt; [Type] -&gt; [TCM Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680613417"><span class="hs-identifier hs-var">fieldTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>  </span><span class="annot"><span class="annottext">(QName -&gt; Type -&gt; TCMT IO ()) -&gt; [QName] -&gt; [Type] -&gt; TCMT IO ()
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m ()
</span><span class="hs-identifier hs-var">zipWithM_</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Type -&gt; TCMT IO ()
forall (m :: * -&gt; *). MonadTCState m =&gt; QName -&gt; Type -&gt; m ()
</span><a href="#local-6989586621680613415"><span class="hs-identifier hs-var">setType</span></a></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621680613433"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680613417"><span class="hs-identifier hs-var">fieldTypes</span></a></span><span>
</span><span id="line-827"></span><span>  </span><span class="hs-comment">-- Constructor type</span><span>
</span><span id="line-828"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680613414"><span class="annot"><span class="annottext">conType :: Type
</span><a href="#local-6989586621680613414"><span class="hs-identifier hs-var hs-var">conType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613428"><span class="hs-identifier hs-var">fullTel</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope -&gt; Type -&gt; Type
forall t. Abstract t =&gt; Telescope -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-operator hs-var">`abstract`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Type
forall a. Subst a =&gt; Int -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Telescope -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613431"><span class="hs-identifier hs-var">fieldTel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613432"><span class="hs-identifier hs-var">recTy</span></a></span><span>
</span><span id="line-829"></span><span>  </span><span class="annot"><span class="annottext">ArgName -&gt; Int -&gt; TCM Doc -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
ArgName -&gt; Int -&gt; TCM Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;tc.generalize&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">(TCM Doc -&gt; TCMT IO ()) -&gt; TCM Doc -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgName -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; ArgName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">ArgName
</span><span class="hs-string">&quot;Final genRecCon type:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc -&gt; TCM Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCM Doc -&gt; TCM Doc
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TCM Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613414"><span class="hs-identifier hs-var">conType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>  </span><span class="annot"><span class="annottext">QName -&gt; Type -&gt; TCMT IO ()
forall (m :: * -&gt; *). MonadTCState m =&gt; QName -&gt; Type -&gt; m ()
</span><a href="#local-6989586621680613415"><span class="hs-identifier hs-var">setType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621680613434"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613414"><span class="hs-identifier hs-var">conType</span></a></span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-comment">-- Record telescope: Includes both parameters and fields.</span><span>
</span><span id="line-832"></span><span>  </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; Definition) -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
QName -&gt; (Definition -&gt; Definition) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyGlobalDefinition"><span class="hs-identifier hs-var">modifyGlobalDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613435"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">((Definition -&gt; Definition) -&gt; TCMT IO ())
-&gt; (Definition -&gt; Definition) -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680613412"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621680613412"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-833"></span><span>    </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621680613412"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">theDef :: Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621680613412"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recTel :: Telescope
</span><a href="Agda.TypeChecking.Monad.Base.html#recTel"><span class="hs-identifier hs-var">recTel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621680613428"><span class="hs-identifier hs-var">fullTel</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-834"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-835"></span><span>    </span><span id="local-6989586621680613415"><span class="annot"><span class="annottext">setType :: QName -&gt; Type -&gt; m ()
</span><a href="#local-6989586621680613415"><span class="hs-identifier hs-var hs-var">setType</span></a></span></span><span> </span><span id="local-6989586621680613410"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613410"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680613409"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613409"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; Definition) -&gt; m ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
QName -&gt; (Definition -&gt; Definition) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyGlobalDefinition"><span class="hs-identifier hs-var">modifyGlobalDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680613410"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">((Definition -&gt; Definition) -&gt; m ())
-&gt; (Definition -&gt; Definition) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680613408"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621680613408"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621680613408"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">defType :: Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680613409"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-836"></span></pre></body></html>