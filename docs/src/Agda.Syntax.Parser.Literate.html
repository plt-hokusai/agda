<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- | Preprocessors for literate code formats.</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agda.Syntax.Parser.Literate</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateProcessors"><span class="hs-identifier">literateProcessors</span></a></span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateExtsShortList"><span class="hs-identifier">literateExtsShortList</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateSrcFile"><span class="hs-identifier">literateSrcFile</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateTeX"><span class="hs-identifier">literateTeX</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateRsT"><span class="hs-identifier">literateRsT</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateMd"><span class="hs-identifier">literateMd</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateOrg"><span class="hs-identifier">literateOrg</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#illiterate"><span class="hs-identifier">illiterate</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#atomizeLayers"><span class="hs-identifier">atomizeLayers</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Processor"><span class="hs-identifier">Processor</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layers"><span class="hs-identifier">Layers</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier">Layer</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier">LayerRole</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#isCode"><span class="hs-identifier">isCode</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#isCodeLayer"><span class="hs-identifier">isCodeLayer</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getLine</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;=&lt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isSpace</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isPrefixOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Regex.TDFA</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">-- | Role of a character in the file.</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">data</span><span> </span><span id="LayerRole"><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-var">LayerRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Markup"><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Comment"><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Code"><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Code"><span class="hs-identifier hs-var">Code</span></a></span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624524"><span id="local-6989586621680624526"><span id="local-6989586621680624528"><span class="annot"><span class="annottext">Int -&gt; LayerRole -&gt; ShowS
[LayerRole] -&gt; ShowS
LayerRole -&gt; String
(Int -&gt; LayerRole -&gt; ShowS)
-&gt; (LayerRole -&gt; String)
-&gt; ([LayerRole] -&gt; ShowS)
-&gt; Show LayerRole
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [LayerRole] -&gt; ShowS
$cshowList :: [LayerRole] -&gt; ShowS
show :: LayerRole -&gt; String
$cshow :: LayerRole -&gt; String
showsPrec :: Int -&gt; LayerRole -&gt; ShowS
$cshowsPrec :: Int -&gt; LayerRole -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624519"><span id="local-6989586621680624521"><span class="annot"><span class="annottext">LayerRole -&gt; LayerRole -&gt; Bool
(LayerRole -&gt; LayerRole -&gt; Bool)
-&gt; (LayerRole -&gt; LayerRole -&gt; Bool) -&gt; Eq LayerRole
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: LayerRole -&gt; LayerRole -&gt; Bool
$c/= :: LayerRole -&gt; LayerRole -&gt; Bool
== :: LayerRole -&gt; LayerRole -&gt; Bool
$c== :: LayerRole -&gt; LayerRole -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">-- | A sequence of characters in a file playing the same role.</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">data</span><span> </span><span id="Layer"><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-var">Layer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Layer"><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-var">Layer</span></a></span></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="layerRole"><span class="annot"><span class="annottext">Layer -&gt; LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#layerRole"><span class="hs-identifier hs-var hs-var">layerRole</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="interval"><span class="annot"><span class="annottext">Layer -&gt; Interval
</span><a href="Agda.Syntax.Parser.Literate.html#interval"><span class="hs-identifier hs-var hs-var">interval</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Interval"><span class="hs-identifier hs-type">Interval</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="layerContent"><span class="annot"><span class="annottext">Layer -&gt; String
</span><a href="Agda.Syntax.Parser.Literate.html#layerContent"><span class="hs-identifier hs-var hs-var">layerContent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680624508"><span id="local-6989586621680624510"><span id="local-6989586621680624512"><span class="annot"><span class="annottext">Int -&gt; Layer -&gt; ShowS
[Layer] -&gt; ShowS
Layer -&gt; String
(Int -&gt; Layer -&gt; ShowS)
-&gt; (Layer -&gt; String) -&gt; ([Layer] -&gt; ShowS) -&gt; Show Layer
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Layer] -&gt; ShowS
$cshowList :: [Layer] -&gt; ShowS
show :: Layer -&gt; String
$cshow :: Layer -&gt; String
showsPrec :: Int -&gt; Layer -&gt; ShowS
$cshowsPrec :: Int -&gt; Layer -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">-- | A list of contiguous layers.</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">type</span><span> </span><span id="Layers"><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layers"><span class="hs-identifier hs-var">Layers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#HasRange"><span class="hs-identifier hs-type">HasRange</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-52"></span><span>  </span><span id="local-6989586621680624505"><span class="annot"><span class="annottext">getRange :: Layer -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var hs-var hs-var hs-var">getRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interval -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">(Interval -&gt; Range) -&gt; (Layer -&gt; Interval) -&gt; Layer -&gt; Range
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Layer -&gt; Interval
</span><a href="Agda.Syntax.Parser.Literate.html#interval"><span class="hs-identifier hs-var hs-var">interval</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">-- | Annotates a tokenized string with position information.</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#mkLayers"><span class="hs-identifier hs-type">mkLayers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layers"><span class="hs-identifier hs-type">Layers</span></a></span><span>
</span><span id="line-57"></span><span id="mkLayers"><span class="annot"><span class="annottext">mkLayers :: Position -&gt; [(LayerRole, String)] -&gt; [Layer]
</span><a href="Agda.Syntax.Parser.Literate.html#mkLayers"><span class="hs-identifier hs-var hs-var">mkLayers</span></a></span></span><span> </span><span id="local-6989586621680624501"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624501"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [Layer]
</span><a href="Agda.Syntax.Parser.Literate.html#emptyLiterate"><span class="hs-identifier hs-var">emptyLiterate</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624501"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-58"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#mkLayers"><span class="hs-identifier hs-var">mkLayers</span></a></span><span> </span><span id="local-6989586621680624499"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624499"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680624498"><span class="annot"><span class="annottext">[(LayerRole, String)]
</span><a href="#local-6989586621680624498"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [(LayerRole, String)] -&gt; [Layer]
</span><a href="Agda.Syntax.Parser.Literate.html#mkLayers"><span class="hs-identifier hs-var">mkLayers</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624499"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">[(LayerRole, String)]
</span><a href="#local-6989586621680624498"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-59"></span><span>                             </span><span class="hs-comment">-- Empty layers are ignored.</span><span>
</span><span id="line-60"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#mkLayers"><span class="hs-identifier hs-var">mkLayers</span></a></span><span> </span><span id="local-6989586621680624497"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624497"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680624496"><span class="annot"><span class="annottext">LayerRole
</span><a href="#local-6989586621680624496"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680624495"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624495"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680624494"><span class="annot"><span class="annottext">[(LayerRole, String)]
</span><a href="#local-6989586621680624494"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><span class="annottext">LayerRole -&gt; Interval -&gt; String -&gt; Layer
</span><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-var">Layer</span></a></span><span> </span><span class="annot"><span class="annottext">LayerRole
</span><a href="#local-6989586621680624496"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; Position -&gt; Interval
forall a. Position' a -&gt; Position' a -&gt; Interval' a
</span><a href="Agda.Syntax.Position.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624497"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624492"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624495"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Layer -&gt; [Layer] -&gt; [Layer]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [(LayerRole, String)] -&gt; [Layer]
</span><a href="Agda.Syntax.Parser.Literate.html#mkLayers"><span class="hs-identifier hs-var">mkLayers</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624492"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[(LayerRole, String)]
</span><a href="#local-6989586621680624494"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-63"></span><span>  </span><span id="local-6989586621680624492"><span class="annot"><span class="annottext">next :: Position
</span><a href="#local-6989586621680624492"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; String -&gt; Position
forall a. Position' a -&gt; String -&gt; Position' a
</span><a href="Agda.Syntax.Position.html#movePosByString"><span class="hs-identifier hs-var">movePosByString</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624497"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624495"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#unMkLayers"><span class="hs-identifier hs-type">unMkLayers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layers"><span class="hs-identifier hs-type">Layers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-66"></span><span id="unMkLayers"><span class="annot"><span class="annottext">unMkLayers :: [Layer] -&gt; [(LayerRole, String)]
</span><a href="Agda.Syntax.Parser.Literate.html#unMkLayers"><span class="hs-identifier hs-var hs-var">unMkLayers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Layer -&gt; (LayerRole, String)) -&gt; [Layer] -&gt; [(LayerRole, String)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole -&gt; String -&gt; (LayerRole, String))
-&gt; (Layer -&gt; LayerRole) -&gt; Layer -&gt; String -&gt; (LayerRole, String)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Layer -&gt; LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#layerRole"><span class="hs-identifier hs-var hs-var">layerRole</span></a></span><span> </span><span class="annot"><span class="annottext">(Layer -&gt; String -&gt; (LayerRole, String))
-&gt; (Layer -&gt; String) -&gt; Layer -&gt; (LayerRole, String)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Layer -&gt; String
</span><a href="Agda.Syntax.Parser.Literate.html#layerContent"><span class="hs-identifier hs-var hs-var">layerContent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#atomizeLayers"><span class="hs-identifier hs-type">atomizeLayers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layers"><span class="hs-identifier hs-type">Layers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-69"></span><span id="atomizeLayers"><span class="annot"><span class="annottext">atomizeLayers :: [Layer] -&gt; [(LayerRole, Char)]
</span><a href="Agda.Syntax.Parser.Literate.html#atomizeLayers"><span class="hs-identifier hs-var hs-var">atomizeLayers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; (LayerRole, Char)) -&gt; String -&gt; [(LayerRole, Char)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Char -&gt; (LayerRole, Char)) -&gt; String -&gt; [(LayerRole, Char)])
-&gt; ((LayerRole, String) -&gt; Char -&gt; (LayerRole, Char))
-&gt; (LayerRole, String)
-&gt; String
-&gt; [(LayerRole, Char)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole -&gt; Char -&gt; (LayerRole, Char))
-&gt; ((LayerRole, String) -&gt; LayerRole)
-&gt; (LayerRole, String)
-&gt; Char
-&gt; (LayerRole, Char)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LayerRole, String) -&gt; LayerRole
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((LayerRole, String) -&gt; String -&gt; [(LayerRole, Char)])
-&gt; ((LayerRole, String) -&gt; String)
-&gt; (LayerRole, String)
-&gt; [(LayerRole, Char)]
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(LayerRole, String) -&gt; String
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((LayerRole, String) -&gt; [(LayerRole, Char)])
-&gt; ([Layer] -&gt; [(LayerRole, String)])
-&gt; [Layer]
-&gt; [(LayerRole, Char)]
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">[Layer] -&gt; [(LayerRole, String)]
</span><a href="Agda.Syntax.Parser.Literate.html#unMkLayers"><span class="hs-identifier hs-var">unMkLayers</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- | Type of a literate preprocessor:</span><span>
</span><span id="line-72"></span><span class="hs-comment">--   Invariants:</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">--   &gt; f : Processor</span><span>
</span><span id="line-75"></span><span class="hs-comment">--</span><span>
</span><span id="line-76"></span><span class="hs-comment">--   prop&gt; f pos s /= []</span><span>
</span><span id="line-77"></span><span class="hs-comment">--</span><span>
</span><span id="line-78"></span><span class="hs-comment">--   prop&gt; f pos s &gt;&gt;= layerContent == s</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">type</span><span> </span><span id="Processor"><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Processor"><span class="hs-identifier hs-var">Processor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateSrcFile"><span class="hs-identifier hs-type">literateSrcFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#SrcFile"><span class="hs-identifier hs-type">SrcFile</span></a></span><span>
</span><span id="line-83"></span><span id="literateSrcFile"><span class="annot"><span class="annottext">literateSrcFile :: [Layer] -&gt; SrcFile
</span><a href="Agda.Syntax.Parser.Literate.html#literateSrcFile"><span class="hs-identifier hs-var hs-var">literateSrcFile</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcFile
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateSrcFile"><span class="hs-identifier hs-var">literateSrcFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span class="hs-special">{</span><span id="local-6989586621680624487"><span class="annot"><span class="annottext">Interval
interval :: Interval
interval :: Layer -&gt; Interval
</span><a href="#local-6989586621680624487"><span class="hs-identifier hs-var hs-var">interval</span></a></span></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Layer]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interval -&gt; SrcFile
forall a. Interval' a -&gt; a
</span><a href="Agda.Syntax.Position.html#getIntervalFile"><span class="hs-identifier hs-var">getIntervalFile</span></a></span><span> </span><span class="annot"><span class="annottext">Interval
</span><a href="#local-6989586621680624487"><span class="hs-identifier hs-var">interval</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- | List of valid extensions for literate Agda files, and their</span><span>
</span><span id="line-87"></span><span class="hs-comment">--   corresponding preprocessors.</span><span>
</span><span id="line-88"></span><span class="hs-comment">--</span><span>
</span><span id="line-89"></span><span class="hs-comment">--   If you add new extensions, remember to update test/Utils.hs so</span><span>
</span><span id="line-90"></span><span class="hs-comment">--   that test cases ending in the new extensions are found.</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateProcessors"><span class="hs-identifier hs-type">literateProcessors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Processor"><span class="hs-identifier hs-type">Processor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#FileType"><span class="hs-identifier hs-type">FileType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-93"></span><span id="literateProcessors"><span class="annot"><span class="annottext">literateProcessors :: [(String, (Processor, FileType))]
</span><a href="Agda.Syntax.Parser.Literate.html#literateProcessors"><span class="hs-identifier hs-var hs-var">literateProcessors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; (Processor, FileType) -&gt; (String, (Processor, FileType)))
-&gt; ((String, (Processor, FileType)) -&gt; String)
-&gt; (String, (Processor, FileType))
-&gt; (Processor, FileType)
-&gt; (String, (Processor, FileType))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.lagda&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShowS
-&gt; ((String, (Processor, FileType)) -&gt; String)
-&gt; (String, (Processor, FileType))
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String, (Processor, FileType)) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((String, (Processor, FileType))
 -&gt; (Processor, FileType) -&gt; (String, (Processor, FileType)))
-&gt; ((String, (Processor, FileType)) -&gt; (Processor, FileType))
-&gt; (String, (Processor, FileType))
-&gt; (String, (Processor, FileType))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(String, (Processor, FileType)) -&gt; (Processor, FileType)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((String, (Processor, FileType))
 -&gt; (String, (Processor, FileType)))
-&gt; [(String, (Processor, FileType))]
-&gt; [(String, (Processor, FileType))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Processor
</span><a href="Agda.Syntax.Parser.Literate.html#literateTeX"><span class="hs-identifier hs-var">literateTeX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FileType
</span><a href="Agda.Syntax.Common.html#TexFileType"><span class="hs-identifier hs-var">TexFileType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.rst&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Processor
</span><a href="Agda.Syntax.Parser.Literate.html#literateRsT"><span class="hs-identifier hs-var">literateRsT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FileType
</span><a href="Agda.Syntax.Common.html#RstFileType"><span class="hs-identifier hs-var">RstFileType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.tex&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Processor
</span><a href="Agda.Syntax.Parser.Literate.html#literateTeX"><span class="hs-identifier hs-var">literateTeX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FileType
</span><a href="Agda.Syntax.Common.html#TexFileType"><span class="hs-identifier hs-var">TexFileType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.md&quot;</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Processor
</span><a href="Agda.Syntax.Parser.Literate.html#literateMd"><span class="hs-identifier hs-var">literateMd</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">FileType
</span><a href="Agda.Syntax.Common.html#MdFileType"><span class="hs-identifier hs-var">MdFileType</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.org&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Processor
</span><a href="Agda.Syntax.Parser.Literate.html#literateOrg"><span class="hs-identifier hs-var">literateOrg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FileType
</span><a href="Agda.Syntax.Common.html#OrgFileType"><span class="hs-identifier hs-var">OrgFileType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- | Returns @True@ if the role corresponds to Agda code.</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#isCode"><span class="hs-identifier hs-type">isCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-105"></span><span id="isCode"><span class="annot"><span class="annottext">isCode :: LayerRole -&gt; Bool
</span><a href="Agda.Syntax.Parser.Literate.html#isCode"><span class="hs-identifier hs-var hs-var">isCode</span></a></span></span><span> </span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Code"><span class="hs-identifier hs-var">Code</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#isCode"><span class="hs-identifier hs-var">isCode</span></a></span><span> </span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-107"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#isCode"><span class="hs-identifier hs-var">isCode</span></a></span><span> </span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | Returns @True@ if the layer contains Agda code.</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#isCodeLayer"><span class="hs-identifier hs-type">isCodeLayer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-112"></span><span id="isCodeLayer"><span class="annot"><span class="annottext">isCodeLayer :: Layer -&gt; Bool
</span><a href="Agda.Syntax.Parser.Literate.html#isCodeLayer"><span class="hs-identifier hs-var hs-var">isCodeLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LayerRole -&gt; Bool
</span><a href="Agda.Syntax.Parser.Literate.html#isCode"><span class="hs-identifier hs-var">isCode</span></a></span><span> </span><span class="annot"><span class="annottext">(LayerRole -&gt; Bool) -&gt; (Layer -&gt; LayerRole) -&gt; Layer -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Layer -&gt; LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#layerRole"><span class="hs-identifier hs-var hs-var">layerRole</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | Blanks the non-code parts of a given file, preserving positions of</span><span>
</span><span id="line-115"></span><span class="hs-comment">--   characters corresponding to code. This way, there is a direct</span><span>
</span><span id="line-116"></span><span class="hs-comment">--   correspondence between source positions and positions in the</span><span>
</span><span id="line-117"></span><span class="hs-comment">--   processed result.</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#illiterate"><span class="hs-identifier hs-type">illiterate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-120"></span><span id="illiterate"><span class="annot"><span class="annottext">illiterate :: [Layer] -&gt; String
</span><a href="Agda.Syntax.Parser.Literate.html#illiterate"><span class="hs-identifier hs-var hs-var">illiterate</span></a></span></span><span> </span><span id="local-6989586621680624481"><span class="annot"><span class="annottext">[Layer]
</span><a href="#local-6989586621680624481"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LayerRole -&gt; Bool
</span><a href="Agda.Syntax.Parser.Literate.html#isCode"><span class="hs-identifier hs-var">isCode</span></a></span><span> </span><span class="annot"><span class="annottext">LayerRole
</span><a href="#local-6989586621680624479"><span class="hs-identifier hs-var">layerRole</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ShowS
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="Agda.Syntax.Parser.Literate.html#bleach"><span class="hs-identifier hs-var">bleach</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624476"><span class="hs-identifier hs-var">layerContent</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span class="hs-special">{</span><span id="local-6989586621680624479"><span class="annot"><span class="annottext">LayerRole
layerRole :: LayerRole
layerRole :: Layer -&gt; LayerRole
</span><a href="#local-6989586621680624479"><span class="hs-identifier hs-var hs-var">layerRole</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624476"><span class="annot"><span class="annottext">String
layerContent :: String
layerContent :: Layer -&gt; String
</span><a href="#local-6989586621680624476"><span class="hs-identifier hs-var hs-var">layerContent</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Layer]
</span><a href="#local-6989586621680624481"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-comment">-- | Replaces non-space characters in a string with spaces.</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#bleach"><span class="hs-identifier hs-type">bleach</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-128"></span><span id="bleach"><span class="annot"><span class="annottext">bleach :: ShowS
</span><a href="Agda.Syntax.Parser.Literate.html#bleach"><span class="hs-identifier hs-var hs-var">bleach</span></a></span></span><span> </span><span id="local-6989586621680624475"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624475"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; ShowS
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><a href="#local-6989586621680624474"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624475"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>  </span><span id="local-6989586621680624474"><span class="annot"><span class="annottext">go :: Char -&gt; Char
</span><a href="#local-6989586621680624474"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680624473"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680624473"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSpace</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680624473"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680624473"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><a href="#local-6989586621680624474"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-comment">-- | Check if a character is a blank character.</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#isBlank"><span class="hs-identifier hs-type">isBlank</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-136"></span><span id="isBlank"><span class="annot"><span class="annottext">isBlank :: Char -&gt; Bool
</span><a href="Agda.Syntax.Parser.Literate.html#isBlank"><span class="hs-identifier hs-var hs-var">isBlank</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">(&amp;&amp;)</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool -&gt; Bool) -&gt; (Char -&gt; Bool) -&gt; Char -&gt; Bool -&gt; Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSpace</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool -&gt; Bool) -&gt; (Char -&gt; Bool) -&gt; Char -&gt; Bool
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | Short list of extensions for literate Agda files.</span><span>
</span><span id="line-139"></span><span class="hs-comment">--   For display purposes.</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateExtsShortList"><span class="hs-identifier hs-type">literateExtsShortList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-142"></span><span id="literateExtsShortList"><span class="annot"><span class="annottext">literateExtsShortList :: [String]
</span><a href="Agda.Syntax.Parser.Literate.html#literateExtsShortList"><span class="hs-identifier hs-var hs-var">literateExtsShortList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.lagda&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">-- | Breaks a list just /after/ an element satisfying the predicate is</span><span>
</span><span id="line-145"></span><span class="hs-comment">--   found.</span><span>
</span><span id="line-146"></span><span class="hs-comment">--</span><span>
</span><span id="line-147"></span><span class="hs-comment">--   &gt;&gt;&gt; break1 even [1,3,5,2,4,7,8]</span><span>
</span><span id="line-148"></span><span class="hs-comment">--   ([1,3,5,2],[4,7,8])</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span id="local-6989586621680624579"><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#break1"><span class="hs-identifier hs-type">break1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680624579"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680624579"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680624579"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680624579"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-151"></span><span id="break1"><span class="annot"><span class="annottext">break1 :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="Agda.Syntax.Parser.Literate.html#break1"><span class="hs-identifier hs-var hs-var">break1</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>           </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#break1"><span class="hs-identifier hs-var">break1</span></a></span><span> </span><span id="local-6989586621680624468"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621680624468"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624467"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680624467"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680624466"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680624466"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621680624468"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680624467"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680624467"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680624466"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#break1"><span class="hs-identifier hs-var">break1</span></a></span><span> </span><span id="local-6989586621680624465"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621680624465"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624464"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680624464"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680624463"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680624463"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624462"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680624462"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680624461"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680624461"><span class="hs-identifier hs-var">zs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="Agda.Syntax.Parser.Literate.html#break1"><span class="hs-identifier hs-var">break1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621680624465"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680624463"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680624464"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680624462"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680624461"><span class="hs-identifier hs-var">zs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-comment">-- | Returns a tuple consisting of the first line of the input, and the rest</span><span>
</span><span id="line-156"></span><span class="hs-comment">--   of the input.</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-type">getLine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span id="getLine"><span class="annot"><span class="annottext">getLine :: String -&gt; (String, String)
</span><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-var hs-var">getLine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; (String, String)
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="Agda.Syntax.Parser.Literate.html#break1"><span class="hs-identifier hs-var">break1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- | Canonical decomposition of an empty literate file.</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#emptyLiterate"><span class="hs-identifier hs-type">emptyLiterate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span id="emptyLiterate"><span class="annot"><span class="annottext">emptyLiterate :: Position -&gt; [Layer]
</span><a href="Agda.Syntax.Parser.Literate.html#emptyLiterate"><span class="hs-identifier hs-var hs-var">emptyLiterate</span></a></span></span><span> </span><span id="local-6989586621680624459"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624459"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LayerRole -&gt; Interval -&gt; String -&gt; Layer
</span><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-var">Layer</span></a></span><span> </span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; Position -&gt; Interval
forall a. Position' a -&gt; Position' a -&gt; Interval' a
</span><a href="Agda.Syntax.Position.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624459"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624459"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">-- | Create a regular expression that:</span><span>
</span><span id="line-167"></span><span class="hs-comment">--   - Must match the whole string</span><span>
</span><span id="line-168"></span><span class="hs-comment">--   - Works across line boundaries</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#rex"><span class="hs-identifier hs-type">rex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Regex</span></span><span>
</span><span id="line-171"></span><span id="rex"><span class="annot"><span class="annottext">rex :: String -&gt; Regex
</span><a href="Agda.Syntax.Parser.Literate.html#rex"><span class="hs-identifier hs-var hs-var">rex</span></a></span></span><span> </span><span id="local-6989586621680624457"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624457"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><span class="annottext">CompOption -&gt; ExecOption -&gt; String -&gt; Regex
forall regex compOpt execOpt source.
RegexMaker regex compOpt execOpt source =&gt;
compOpt -&gt; execOpt -&gt; source -&gt; regex
</span><span class="hs-identifier hs-var">makeRegexOpts</span></span><span> </span><span class="annot"><span class="annottext">CompOption
forall regex compOpt execOpt.
RegexOptions regex compOpt execOpt =&gt;
compOpt
</span><span class="hs-identifier hs-var">blankCompOpt</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">newSyntax :: Bool
</span><span class="hs-identifier hs-var">newSyntax</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">ExecOption
forall regex compOpt execOpt.
RegexOptions regex compOpt execOpt =&gt;
execOpt
</span><span class="hs-identifier hs-var">blankExecOpt</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Regex) -&gt; String -&gt; Regex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\`&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624457"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\'&quot;</span></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- | Preprocessor for literate TeX.</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateTeX"><span class="hs-identifier hs-type">literateTeX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-178"></span><span id="literateTeX"><span class="annot"><span class="annottext">literateTeX :: Processor
</span><a href="Agda.Syntax.Parser.Literate.html#literateTeX"><span class="hs-identifier hs-var hs-var">literateTeX</span></a></span></span><span> </span><span id="local-6989586621680624452"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624452"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621680624451"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624451"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [(LayerRole, String)] -&gt; [Layer]
</span><a href="Agda.Syntax.Parser.Literate.html#mkLayers"><span class="hs-identifier hs-var">mkLayers</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624452"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624450"><span class="hs-identifier hs-var">tex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624451"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><a href="#local-6989586621680624450"><span class="hs-identifier hs-type">tex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621680624450"><span class="annot"><span class="annottext">tex :: String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624450"><span class="hs-identifier hs-var hs-var">tex</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><a href="#local-6989586621680624450"><span class="hs-identifier hs-var">tex</span></a></span><span> </span><span id="local-6989586621680624449"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624449"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624448"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624448"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624447"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624447"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-var">getLine</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624449"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621680624446"><span class="hs-identifier hs-var">r_begin</span></a></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Maybe (AllTextSubmatches [] String)
forall regex source target (m :: * -&gt; *).
(RegexContext regex source target, MonadFail m) =&gt;
regex -&gt; source -&gt; m target
</span><span class="hs-operator hs-var">`matchM`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624448"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-185"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllTextSubmatches [] String -&gt; [String]
forall (f :: * -&gt; *) b. AllTextSubmatches f b -&gt; f b
</span><span class="hs-identifier hs-var hs-var">getAllTextSubmatches</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624443"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624443"><span class="hs-identifier hs-var">pre</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624442"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624442"><span class="hs-identifier hs-var">markup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624441"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624441"><span class="hs-identifier hs-var">whitespace</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624443"><span class="hs-identifier hs-var">pre</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624442"><span class="hs-identifier hs-var">markup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Code"><span class="hs-identifier hs-var">Code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624441"><span class="hs-identifier hs-var">whitespace</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624440"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624447"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-188"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">AllTextSubmatches [] String
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(LayerRole, String)]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><span class="annottext">Maybe (AllTextSubmatches [] String)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624448"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624450"><span class="hs-identifier hs-var">tex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624447"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>  </span><span id="local-6989586621680624446"><span class="annot"><span class="annottext">r_begin :: Regex
</span><a href="#local-6989586621680624446"><span class="hs-identifier hs-var hs-var">r_begin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
</span><a href="Agda.Syntax.Parser.Literate.html#rex"><span class="hs-identifier hs-var">rex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(([^\\%]|\\\\.)*)(\\\\begin\\{code\\}[^\n]*)(\n)?&quot;</span></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><a href="#local-6989586621680624440"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span>  </span><span id="local-6989586621680624440"><span class="annot"><span class="annottext">code :: String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624440"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-195"></span><span>  </span><span class="annot"><a href="#local-6989586621680624440"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span id="local-6989586621680624439"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624439"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624438"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624438"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624437"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624437"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-var">getLine</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624439"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621680624436"><span class="hs-identifier hs-var">r_end</span></a></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Maybe (AllTextSubmatches [] String)
forall regex source target (m :: * -&gt; *).
(RegexContext regex source target, MonadFail m) =&gt;
regex -&gt; source -&gt; m target
</span><span class="hs-operator hs-var">`matchM`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624438"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-198"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllTextSubmatches [] String -&gt; [String]
forall (f :: * -&gt; *) b. AllTextSubmatches f b -&gt; f b
</span><span class="hs-identifier hs-var hs-var">getAllTextSubmatches</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624435"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624435"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624434"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624434"><span class="hs-identifier hs-var">markup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624433"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624433"><span class="hs-identifier hs-var">post</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Code"><span class="hs-identifier hs-var">Code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624435"><span class="hs-identifier hs-var">code</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624434"><span class="hs-identifier hs-var">markup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624433"><span class="hs-identifier hs-var">post</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624450"><span class="hs-identifier hs-var">tex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624437"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">AllTextSubmatches [] String
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(LayerRole, String)]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-201"></span><span>      </span><span class="annot"><span class="annottext">Maybe (AllTextSubmatches [] String)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Code"><span class="hs-identifier hs-var">Code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624438"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624440"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624437"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621680624436"><span class="annot"><span class="annottext">r_end :: Regex
</span><a href="#local-6989586621680624436"><span class="hs-identifier hs-var hs-var">r_end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
</span><a href="Agda.Syntax.Parser.Literate.html#rex"><span class="hs-identifier hs-var">rex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;([[:blank:]]*)(\\\\end\\{code\\})(.*)&quot;</span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- | Preprocessor for Markdown.</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateMd"><span class="hs-identifier hs-type">literateMd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-208"></span><span id="literateMd"><span class="annot"><span class="annottext">literateMd :: Processor
</span><a href="Agda.Syntax.Parser.Literate.html#literateMd"><span class="hs-identifier hs-var hs-var">literateMd</span></a></span></span><span> </span><span id="local-6989586621680624432"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624432"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621680624431"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624431"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [(LayerRole, String)] -&gt; [Layer]
</span><a href="Agda.Syntax.Parser.Literate.html#mkLayers"><span class="hs-identifier hs-var">mkLayers</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624432"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">([(LayerRole, String)] -&gt; [Layer])
-&gt; [(LayerRole, String)] -&gt; [Layer]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624430"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624431"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="#local-6989586621680624430"><span class="hs-identifier hs-type">md</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-211"></span><span>  </span><span id="local-6989586621680624430"><span class="annot"><span class="annottext">md :: String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624430"><span class="hs-identifier hs-var hs-var">md</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="#local-6989586621680624430"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span id="local-6989586621680624429"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624429"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624428"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624428"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624427"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624427"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-var">getLine</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624429"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621680624426"><span class="hs-identifier hs-var">md_begin</span></a></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Maybe (AllTextSubmatches [] String)
forall regex source target (m :: * -&gt; *).
(RegexContext regex source target, MonadFail m) =&gt;
regex -&gt; source -&gt; m target
</span><span class="hs-operator hs-var">`matchM`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624428"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-215"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllTextSubmatches [] String -&gt; [String]
forall (f :: * -&gt; *) b. AllTextSubmatches f b -&gt; f b
</span><span class="hs-identifier hs-var hs-var">getAllTextSubmatches</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624425"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624425"><span class="hs-identifier hs-var">pre</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624424"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624424"><span class="hs-identifier hs-var">markup</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624425"><span class="hs-identifier hs-var">pre</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624424"><span class="hs-identifier hs-var">markup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624423"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624427"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-217"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">AllTextSubmatches [] String
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(LayerRole, String)]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-218"></span><span>      </span><span class="annot"><span class="annottext">Maybe (AllTextSubmatches [] String)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624428"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621680624422"><span class="hs-identifier hs-var">md_begin_other</span></a></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Bool
forall regex source target.
RegexContext regex source target =&gt;
regex -&gt; source -&gt; target
</span><span class="hs-operator hs-var">`match`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624428"><span class="hs-identifier hs-var">line</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624420"><span class="hs-identifier hs-var">code_other</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624427"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624430"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624427"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621680624426"><span class="annot"><span class="annottext">md_begin :: Regex
</span><a href="#local-6989586621680624426"><span class="hs-identifier hs-var hs-var">md_begin</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
</span><a href="Agda.Syntax.Parser.Literate.html#rex"><span class="hs-identifier hs-var">rex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(.*)([[:space:]]*```(agda)?[[:space:]]*)&quot;</span></span><span>
</span><span id="line-225"></span><span>  </span><span id="local-6989586621680624422"><span class="annot"><span class="annottext">md_begin_other :: Regex
</span><a href="#local-6989586621680624422"><span class="hs-identifier hs-var hs-var">md_begin_other</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
</span><a href="Agda.Syntax.Parser.Literate.html#rex"><span class="hs-identifier hs-var">rex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[[:space:]]*```[a-zA-Z0-9-]*[[:space:]]*&quot;</span></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><a href="#local-6989586621680624423"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>  </span><span id="local-6989586621680624423"><span class="annot"><span class="annottext">code :: String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624423"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><a href="#local-6989586621680624423"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span id="local-6989586621680624419"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624419"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624418"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624418"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624417"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624417"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-var">getLine</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624419"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621680624416"><span class="hs-identifier hs-var">md_end</span></a></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Maybe (AllTextSubmatches [] String)
forall regex source target (m :: * -&gt; *).
(RegexContext regex source target, MonadFail m) =&gt;
regex -&gt; source -&gt; m target
</span><span class="hs-operator hs-var">`matchM`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624418"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-232"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllTextSubmatches [] String -&gt; [String]
forall (f :: * -&gt; *) b. AllTextSubmatches f b -&gt; f b
</span><span class="hs-identifier hs-var hs-var">getAllTextSubmatches</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624415"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624415"><span class="hs-identifier hs-var">markup</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-233"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624415"><span class="hs-identifier hs-var">markup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624430"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624417"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-234"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">AllTextSubmatches [] String
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(LayerRole, String)]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><span class="annottext">Maybe (AllTextSubmatches [] String)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Code"><span class="hs-identifier hs-var">Code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624418"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624423"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624417"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-comment">-- A non-Agda code block.</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><a href="#local-6989586621680624420"><span class="hs-identifier hs-type">code_other</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621680624420"><span class="annot"><span class="annottext">code_other :: String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624420"><span class="hs-identifier hs-var hs-var">code_other</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><a href="#local-6989586621680624420"><span class="hs-identifier hs-var">code_other</span></a></span><span> </span><span id="local-6989586621680624414"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624414"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624413"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624413"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624412"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624412"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-var">getLine</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624414"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624413"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621680624416"><span class="hs-identifier hs-var">md_end</span></a></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Bool
forall regex source target.
RegexContext regex source target =&gt;
regex -&gt; source -&gt; target
</span><span class="hs-operator hs-var">`match`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624413"><span class="hs-identifier hs-var">line</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624430"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624412"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624420"><span class="hs-identifier hs-var">code_other</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624412"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>  </span><span id="local-6989586621680624416"><span class="annot"><span class="annottext">md_end :: Regex
</span><a href="#local-6989586621680624416"><span class="hs-identifier hs-var hs-var">md_end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
</span><a href="Agda.Syntax.Parser.Literate.html#rex"><span class="hs-identifier hs-var">rex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;([[:space:]]*```[[:space:]]*)&quot;</span></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-comment">-- | Preprocessor for reStructuredText.</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateRsT"><span class="hs-identifier hs-type">literateRsT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-252"></span><span id="literateRsT"><span class="annot"><span class="annottext">literateRsT :: Processor
</span><a href="Agda.Syntax.Parser.Literate.html#literateRsT"><span class="hs-identifier hs-var hs-var">literateRsT</span></a></span></span><span> </span><span id="local-6989586621680624411"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624411"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621680624410"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624410"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [(LayerRole, String)] -&gt; [Layer]
</span><a href="Agda.Syntax.Parser.Literate.html#mkLayers"><span class="hs-identifier hs-var">mkLayers</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624411"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">([(LayerRole, String)] -&gt; [Layer])
-&gt; [(LayerRole, String)] -&gt; [Layer]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624409"><span class="hs-identifier hs-var">rst</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624410"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><a href="#local-6989586621680624409"><span class="hs-identifier hs-type">rst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-255"></span><span>  </span><span id="local-6989586621680624409"><span class="annot"><span class="annottext">rst :: String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624409"><span class="hs-identifier hs-var hs-var">rst</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-256"></span><span>  </span><span class="annot"><a href="#local-6989586621680624409"><span class="hs-identifier hs-var">rst</span></a></span><span> </span><span id="local-6989586621680624408"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624408"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624407"><span class="hs-identifier hs-var">maybe_code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624408"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621680624407"><span class="annot"><span class="annottext">maybe_code :: String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624407"><span class="hs-identifier hs-var hs-var">maybe_code</span></a></span></span><span> </span><span id="local-6989586621680624406"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624406"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621680624405"><span class="hs-identifier hs-var">r_comment</span></a></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Bool
forall regex source target.
RegexContext regex source target =&gt;
regex -&gt; source -&gt; target
</span><span class="hs-operator hs-var">`match`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624404"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><span class="annottext">[(LayerRole, String)]
</span><a href="#local-6989586621680624403"><span class="hs-identifier hs-var">not_code</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621680624402"><span class="hs-identifier hs-var">r_code</span></a></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; [[String]]
forall regex source target.
RegexContext regex source target =&gt;
regex -&gt; source -&gt; target
</span><span class="hs-operator hs-var">`match`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624404"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-262"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(LayerRole, String)]
</span><a href="#local-6989586621680624403"><span class="hs-identifier hs-var">not_code</span></a></span><span>
</span><span id="line-263"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624401"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624401"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;::&quot;</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624400"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624400"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-comment">-- Code starts</span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624401"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="Agda.Syntax.Parser.Literate.html#isBlank"><span class="hs-identifier hs-var">isBlank</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Char
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624401"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-266"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624404"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624396"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624395"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-268"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624401"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624400"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624396"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624395"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-269"></span><span>      </span><span class="annot"><span class="annottext">[[String]]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(LayerRole, String)]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680624404"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624404"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624395"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624395"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-var">getLine</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624406"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621680624403"><span class="annot"><span class="annottext">not_code :: [(LayerRole, String)]
</span><a href="#local-6989586621680624403"><span class="hs-identifier hs-var hs-var">not_code</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624404"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624409"><span class="hs-identifier hs-var">rst</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624395"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-comment">-- Finds the next indented block in the input.</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><a href="#local-6989586621680624396"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-276"></span><span>  </span><span id="local-6989586621680624396"><span class="annot"><span class="annottext">code :: String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624396"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><a href="#local-6989586621680624396"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span id="local-6989586621680624394"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624394"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624393"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624393"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624392"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624392"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-var">getLine</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624394"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSpace</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624393"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-280"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624393"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624396"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624392"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-282"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680624390"><span class="annot"><span class="annottext">xs :: String
</span><a href="#local-6989586621680624390"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ShowS
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">takeWhile</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="Agda.Syntax.Parser.Literate.html#isBlank"><span class="hs-identifier hs-var">isBlank</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624393"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624390"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-284"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624407"><span class="hs-identifier hs-var">maybe_code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624394"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-285"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Code"><span class="hs-identifier hs-var">Code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624393"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624388"><span class="hs-identifier hs-var">indented</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624390"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624392"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-comment">-- Process an indented block.</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><a href="#local-6989586621680624388"><span class="hs-identifier hs-type">indented</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-289"></span><span>  </span><span id="local-6989586621680624388"><span class="annot"><span class="annottext">indented :: String -&gt; String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624388"><span class="hs-identifier hs-var hs-var">indented</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><a href="#local-6989586621680624388"><span class="hs-identifier hs-var">indented</span></a></span><span> </span><span id="local-6989586621680624387"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624387"><span class="hs-identifier hs-var">ind</span></a></span></span><span> </span><span id="local-6989586621680624386"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624386"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624385"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624385"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624384"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624384"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-var">getLine</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624386"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isSpace</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624385"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624387"><span class="hs-identifier hs-var">ind</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624385"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Code"><span class="hs-identifier hs-var">Code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624385"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624388"><span class="hs-identifier hs-var">indented</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624387"><span class="hs-identifier hs-var">ind</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624384"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-294"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624407"><span class="hs-identifier hs-var">maybe_code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624386"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-comment">-- Beginning of a code block.</span><span>
</span><span id="line-297"></span><span>  </span><span id="local-6989586621680624402"><span class="annot"><span class="annottext">r_code :: Regex
</span><a href="#local-6989586621680624402"><span class="hs-identifier hs-var hs-var">r_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
</span><a href="Agda.Syntax.Parser.Literate.html#rex"><span class="hs-identifier hs-var">rex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(.*)(::)([[:space:]]*)&quot;</span></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-comment">-- Beginning of a comment block.</span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621680624405"><span class="annot"><span class="annottext">r_comment :: Regex
</span><a href="#local-6989586621680624405"><span class="hs-identifier hs-var hs-var">r_comment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
</span><a href="Agda.Syntax.Parser.Literate.html#rex"><span class="hs-identifier hs-var">rex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[[:space:]]*\\.\\.([[:space:]].*)?&quot;</span></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">-- | Preprocessor for Org mode documents.</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#literateOrg"><span class="hs-identifier hs-type">literateOrg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#Layer"><span class="hs-identifier hs-type">Layer</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-305"></span><span id="literateOrg"><span class="annot"><span class="annottext">literateOrg :: Processor
</span><a href="Agda.Syntax.Parser.Literate.html#literateOrg"><span class="hs-identifier hs-var hs-var">literateOrg</span></a></span></span><span> </span><span id="local-6989586621680624383"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624383"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621680624382"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624382"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [(LayerRole, String)] -&gt; [Layer]
</span><a href="Agda.Syntax.Parser.Literate.html#mkLayers"><span class="hs-identifier hs-var">mkLayers</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680624383"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">([(LayerRole, String)] -&gt; [Layer])
-&gt; [(LayerRole, String)] -&gt; [Layer]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624381"><span class="hs-identifier hs-var">org</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624382"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>  </span><span class="annot"><a href="#local-6989586621680624381"><span class="hs-identifier hs-type">org</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-308"></span><span>  </span><span id="local-6989586621680624381"><span class="annot"><span class="annottext">org :: String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624381"><span class="hs-identifier hs-var hs-var">org</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-309"></span><span>  </span><span class="annot"><a href="#local-6989586621680624381"><span class="hs-identifier hs-var">org</span></a></span><span> </span><span id="local-6989586621680624380"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624380"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624379"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624379"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624378"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624378"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-var">getLine</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624380"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621680624377"><span class="hs-identifier hs-var">org_begin</span></a></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Bool
forall regex source target.
RegexContext regex source target =&gt;
regex -&gt; source -&gt; target
</span><span class="hs-operator hs-var">`match`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624379"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-312"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624379"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624376"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624378"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-314"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624379"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624381"><span class="hs-identifier hs-var">org</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624378"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-comment">-- Valid: #+begin_src agda2 :tangle yes</span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-comment">-- Valid: #+begin_src agda2</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-comment">-- Invalid: #+begin_src adga2-foo</span><span>
</span><span id="line-319"></span><span>  </span><span id="local-6989586621680624377"><span class="annot"><span class="annottext">org_begin :: Regex
</span><a href="#local-6989586621680624377"><span class="hs-identifier hs-var hs-var">org_begin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
</span><a href="#local-6989586621680624375"><span class="hs-identifier hs-var">rex'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\`(.*)([[:space:]]*\\#\\+begin_src agda2[[:space:]]+)&quot;</span></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>  </span><span class="annot"><a href="#local-6989586621680624376"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Parser.Literate.html#LayerRole"><span class="hs-identifier hs-type">LayerRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-322"></span><span>  </span><span id="local-6989586621680624376"><span class="annot"><span class="annottext">code :: String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624376"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-323"></span><span>  </span><span class="annot"><a href="#local-6989586621680624376"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span id="local-6989586621680624374"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624374"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680624373"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624373"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680624372"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624372"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><a href="Agda.Syntax.Parser.Literate.html#getLine"><span class="hs-identifier hs-var">getLine</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624374"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621680624371"><span class="hs-identifier hs-var">org_end</span></a></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Bool
forall regex source target.
RegexContext regex source target =&gt;
regex -&gt; source -&gt; target
</span><span class="hs-operator hs-var">`match`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624373"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Markup"><span class="hs-identifier hs-var">Markup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624373"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624381"><span class="hs-identifier hs-var">org</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624372"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-328"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LayerRole
</span><a href="Agda.Syntax.Parser.Literate.html#Code"><span class="hs-identifier hs-var">Code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624373"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LayerRole, String)
-&gt; [(LayerRole, String)] -&gt; [(LayerRole, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(LayerRole, String)]
</span><a href="#local-6989586621680624376"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680624372"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>  </span><span id="local-6989586621680624371"><span class="annot"><span class="annottext">org_end :: Regex
</span><a href="#local-6989586621680624371"><span class="hs-identifier hs-var hs-var">org_end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
</span><a href="#local-6989586621680624375"><span class="hs-identifier hs-var">rex'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\`([[:space:]]*\\#\\+end_src[[:space:]]*)(.*)&quot;</span></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-comment">-- Explicit type annotation required to disambiguate source.</span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><a href="#local-6989586621680624375"><span class="hs-identifier hs-type">rex'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Regex</span></span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-comment">-- Source blocks start with `#+begin_src` but the casing does not matter.</span><span>
</span><span id="line-335"></span><span>  </span><span id="local-6989586621680624375"><span class="annot"><span class="annottext">rex' :: String -&gt; Regex
</span><a href="#local-6989586621680624375"><span class="hs-identifier hs-var hs-var">rex'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompOption -&gt; ExecOption -&gt; String -&gt; Regex
forall regex compOpt execOpt source.
RegexMaker regex compOpt execOpt source =&gt;
compOpt -&gt; execOpt -&gt; source -&gt; regex
</span><span class="hs-identifier hs-var">makeRegexOpts</span></span><span> </span><span class="annot"><span class="annottext">CompOption
forall regex compOpt execOpt.
RegexOptions regex compOpt execOpt =&gt;
compOpt
</span><span class="hs-identifier hs-var">blankCompOpt</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">newSyntax :: Bool
</span><span class="hs-identifier hs-var">newSyntax</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">caseSensitive :: Bool
</span><span class="hs-identifier hs-var">caseSensitive</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">ExecOption
forall regex compOpt execOpt.
RegexOptions regex compOpt execOpt =&gt;
execOpt
</span><span class="hs-identifier hs-var">blankExecOpt</span></span><span>
</span><span id="line-336"></span></pre></body></html>