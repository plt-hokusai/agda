<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">{-| The scope monad with operations.
-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agda.Syntax.Scope.Monad</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(***)</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">all</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">traverse_</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Traversable</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">for</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Warnings.html"><span class="hs-identifier">Agda.Interaction.Options.Warnings</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Fixity.html"><span class="hs-identifier">Agda.Syntax.Fixity</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Notation.html"><span class="hs-identifier">Agda.Syntax.Notation</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html"><span class="hs-identifier">Agda.Syntax.Abstract.Name</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ScopeCopyInfo"><span class="hs-identifier">ScopeCopyInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html"><span class="hs-identifier">Agda.Syntax.Concrete</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Fixity.html"><span class="hs-identifier">Agda.Syntax.Concrete.Fixity</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Definitions.html"><span class="hs-identifier">Agda.Syntax.Concrete.Definitions</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Definitions.Errors.html#DeclarationWarning"><span class="hs-identifier">DeclarationWarning</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span class="annot"><a href="Agda.Syntax.Concrete.Definitions.Errors.html#DeclarationWarning%27"><span class="hs-identifier">DeclarationWarning'</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-comment">-- TODO: move the relevant warnings out of there</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Base</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Builtin</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#HasBuiltins"><span class="hs-identifier">HasBuiltins</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltinName%27"><span class="hs-identifier">getBuiltinName'</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Builtin.html#builtinSet"><span class="hs-identifier">builtinSet</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Builtin.html#builtinProp"><span class="hs-identifier">builtinProp</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Builtin.html#builtinSetOmega"><span class="hs-identifier">builtinSetOmega</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Builtin.html#builtinSSetOmega"><span class="hs-identifier">builtinSSetOmega</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Debug</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html"><span class="hs-identifier">Agda.TypeChecking.Monad.State</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Trace</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html"><span class="hs-identifier">Agda.TypeChecking.Positivity.Occurrence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier">Occurrence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier">warning</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warning%27"><span class="hs-identifier">warning'</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.AssocList.html"><span class="hs-identifier">Agda.Utils.AssocList</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AssocList</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.CallStack.html"><span class="hs-identifier">Agda.Utils.CallStack</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">CallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.CallStack.Base.html#withCallerCallStack"><span class="hs-identifier">withCallerCallStack</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier">List1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><span class="hs-operator">(:|)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">nonEmpty</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Pretty.html"><span class="hs-identifier">Agda.Utils.Pretty</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Suffix.html"><span class="hs-identifier">Agda.Utils.Suffix</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- * The scope checking monad</span><span>
</span><span id="line-68"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | To simplify interaction between scope checking and type checking (in</span><span>
</span><span id="line-71"></span><span class="hs-comment">--   particular when chasing imports), we use the same monad.</span><span>
</span><span id="line-72"></span><span class="hs-keyword">type</span><span> </span><span id="ScopeM"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-var">ScopeM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- Debugging</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#printLocals"><span class="hs-identifier hs-type">printLocals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span id="printLocals"><span class="annot"><span class="annottext">printLocals :: Int -&gt; String -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#printLocals"><span class="hs-identifier hs-var hs-var">printLocals</span></a></span></span><span> </span><span id="local-6989586621680701069"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680701069"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680701068"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680701068"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; ScopeM () -&gt; ScopeM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; String -&gt; Int -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-var">verboseS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scope.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680701069"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; ScopeM ()) -&gt; ScopeM () -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-78"></span><span>  </span><span id="local-6989586621680701066"><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680701066"><span class="hs-identifier hs-var">locals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO LocalVars
forall (m :: * -&gt; *). ReadTCState m =&gt; m LocalVars
</span><a href="Agda.Syntax.Scope.Monad.html#getLocalVars"><span class="hs-identifier hs-var">getLocalVars</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scope.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680701069"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ScopeM ()) -&gt; String -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680701068"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">LocalVars -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680701066"><span class="hs-identifier hs-var">locals</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#scopeWarning%27"><span class="hs-identifier hs-type">scopeWarning'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CallStack</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Definitions.Errors.html#DeclarationWarning%27"><span class="hs-identifier hs-type">DeclarationWarning'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span id="scopeWarning%27"><span class="annot"><span class="annottext">scopeWarning' :: CallStack -&gt; DeclarationWarning' -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#scopeWarning%27"><span class="hs-identifier hs-var hs-var">scopeWarning'</span></a></span></span><span> </span><span id="local-6989586621680701061"><span class="annot"><span class="annottext">CallStack
</span><a href="#local-6989586621680701061"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CallStack -&gt; Warning -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadWarning m =&gt;
CallStack -&gt; Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning%27"><span class="hs-identifier hs-var">warning'</span></a></span><span> </span><span class="annot"><span class="annottext">CallStack
</span><a href="#local-6989586621680701061"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; ScopeM ())
-&gt; (DeclarationWarning' -&gt; Warning)
-&gt; DeclarationWarning'
-&gt; ScopeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DeclarationWarning -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#NicifierIssue"><span class="hs-identifier hs-var">NicifierIssue</span></a></span><span> </span><span class="annot"><span class="annottext">(DeclarationWarning -&gt; Warning)
-&gt; (DeclarationWarning' -&gt; DeclarationWarning)
-&gt; DeclarationWarning'
-&gt; Warning
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CallStack -&gt; DeclarationWarning' -&gt; DeclarationWarning
</span><a href="Agda.Syntax.Concrete.Definitions.Errors.html#DeclarationWarning"><span class="hs-identifier hs-var">DeclarationWarning</span></a></span><span> </span><span class="annot"><span class="annottext">CallStack
</span><a href="#local-6989586621680701061"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#scopeWarning"><span class="hs-identifier hs-type">scopeWarning</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Definitions.Errors.html#DeclarationWarning%27"><span class="hs-identifier hs-type">DeclarationWarning'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span id="scopeWarning"><span class="annot"><span class="annottext">scopeWarning :: DeclarationWarning' -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#scopeWarning"><span class="hs-identifier hs-var hs-var">scopeWarning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CallStack -&gt; DeclarationWarning' -&gt; ScopeM ())
-&gt; DeclarationWarning' -&gt; ScopeM ()
forall b. HasCallStack =&gt; (CallStack -&gt; b) -&gt; b
</span><a href="Agda.Utils.CallStack.Base.html#withCallerCallStack"><span class="hs-identifier hs-var">withCallerCallStack</span></a></span><span> </span><span class="annot"><span class="annottext">CallStack -&gt; DeclarationWarning' -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#scopeWarning%27"><span class="hs-identifier hs-var">scopeWarning'</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- * General operations</span><span>
</span><span id="line-89"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span id="local-6989586621680701056"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#isDatatypeModule"><span class="hs-identifier hs-type">isDatatypeModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701056"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701056"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#DataOrRecordModule"><span class="hs-identifier hs-type">DataOrRecordModule</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-92"></span><span id="isDatatypeModule"><span class="annot"><span class="annottext">isDatatypeModule :: ModuleName -&gt; m (Maybe DataOrRecordModule)
</span><a href="Agda.Syntax.Scope.Monad.html#isDatatypeModule"><span class="hs-identifier hs-var hs-var">isDatatypeModule</span></a></span></span><span> </span><span id="local-6989586621680701054"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701054"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-93"></span><span>   </span><span class="annot"><span class="annottext">Scope -&gt; Maybe DataOrRecordModule
</span><a href="Agda.Syntax.Scope.Base.html#scopeDatatypeModule"><span class="hs-identifier hs-var hs-var">scopeDatatypeModule</span></a></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; Maybe DataOrRecordModule)
-&gt; (Map ModuleName Scope -&gt; Scope)
-&gt; Map ModuleName Scope
-&gt; Maybe DataOrRecordModule
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Scope -&gt; ModuleName -&gt; Map ModuleName Scope -&gt; Scope
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">Map.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">Scope
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701054"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(Map ModuleName Scope -&gt; Maybe DataOrRecordModule)
-&gt; m (Map ModuleName Scope) -&gt; m (Maybe DataOrRecordModule)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' (Map ModuleName Scope) ScopeInfo -&gt; m (Map ModuleName Scope)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' a ScopeInfo -&gt; m a
</span><a href="Agda.TypeChecking.Monad.State.html#useScope"><span class="hs-identifier hs-var">useScope</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (Map ModuleName Scope) ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopeModules"><span class="hs-identifier hs-var">scopeModules</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span id="local-6989586621680701483"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#getCurrentModule"><span class="hs-identifier hs-type">getCurrentModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701483"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701483"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span></span><span>
</span><span id="line-96"></span><span id="getCurrentModule"><span class="annot"><span class="annottext">getCurrentModule :: m ModuleName
</span><a href="Agda.Syntax.Scope.Monad.html#getCurrentModule"><span class="hs-identifier hs-var hs-var">getCurrentModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range -&gt; ModuleName -&gt; ModuleName
forall a. SetRange a =&gt; Range -&gt; a -&gt; a
</span><a href="Agda.Syntax.Position.html#setRange"><span class="hs-identifier hs-var">setRange</span></a></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; ModuleName) -&gt; m ModuleName -&gt; m ModuleName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' ModuleName ScopeInfo -&gt; m ModuleName
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' a ScopeInfo -&gt; m a
</span><a href="Agda.TypeChecking.Monad.State.html#useScope"><span class="hs-identifier hs-var">useScope</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ModuleName ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopeCurrent"><span class="hs-identifier hs-var">scopeCurrent</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span id="local-6989586621680701482"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#setCurrentModule"><span class="hs-identifier hs-type">setCurrentModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701482"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701482"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-99"></span><span id="setCurrentModule"><span class="annot"><span class="annottext">setCurrentModule :: ModuleName -&gt; m ()
</span><a href="Agda.Syntax.Scope.Monad.html#setCurrentModule"><span class="hs-identifier hs-var hs-var">setCurrentModule</span></a></span></span><span> </span><span id="local-6989586621680701042"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701042"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyScope"><span class="hs-identifier hs-var">modifyScope</span></a></span><span> </span><span class="annot"><span class="annottext">((ScopeInfo -&gt; ScopeInfo) -&gt; m ())
-&gt; (ScopeInfo -&gt; ScopeInfo) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' ModuleName ScopeInfo -&gt; LensSet ModuleName ScopeInfo
forall i o. Lens' i o -&gt; LensSet i o
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ModuleName ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopeCurrent"><span class="hs-identifier hs-var">scopeCurrent</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701042"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span id="local-6989586621680701038"><span id="local-6989586621680701039"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#withCurrentModule"><span class="hs-identifier hs-type">withCurrentModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701039"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCState"><span class="hs-identifier hs-type">MonadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701039"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701039"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701038"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701039"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701038"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-102"></span><span id="withCurrentModule"><span class="annot"><span class="annottext">withCurrentModule :: ModuleName -&gt; m a -&gt; m a
</span><a href="Agda.Syntax.Scope.Monad.html#withCurrentModule"><span class="hs-identifier hs-var hs-var">withCurrentModule</span></a></span></span><span> </span><span id="local-6989586621680701036"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701036"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621680701035"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621680701035"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621680701034"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701034"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleName
</span><a href="Agda.Syntax.Scope.Monad.html#getCurrentModule"><span class="hs-identifier hs-var">getCurrentModule</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="annottext">ModuleName -&gt; m ()
forall (m :: * -&gt; *). MonadTCState m =&gt; ModuleName -&gt; m ()
</span><a href="Agda.Syntax.Scope.Monad.html#setCurrentModule"><span class="hs-identifier hs-var">setCurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701036"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621680701033"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680701033"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621680701035"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><span class="annottext">ModuleName -&gt; m ()
forall (m :: * -&gt; *). MonadTCState m =&gt; ModuleName -&gt; m ()
</span><a href="Agda.Syntax.Scope.Monad.html#setCurrentModule"><span class="hs-identifier hs-var">setCurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701034"><span class="hs-identifier hs-var">old</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680701033"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span id="local-6989586621680701215"><span id="local-6989586621680701216"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#withCurrentModule%27"><span class="hs-identifier hs-type">withCurrentModule'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="#local-6989586621680701216"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680701216"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701216"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701215"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701216"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701215"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-110"></span><span id="withCurrentModule%27"><span class="annot"><span class="annottext">withCurrentModule' :: ModuleName -&gt; t ScopeM a -&gt; t ScopeM a
</span><a href="Agda.Syntax.Scope.Monad.html#withCurrentModule%27"><span class="hs-identifier hs-var hs-var">withCurrentModule'</span></a></span></span><span> </span><span id="local-6989586621680701031"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701031"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621680701030"><span class="annot"><span class="annottext">t ScopeM a
</span><a href="#local-6989586621680701030"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>  </span><span id="local-6989586621680701029"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701029"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName -&gt; t ScopeM ModuleName
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleName
</span><a href="Agda.Syntax.Scope.Monad.html#getCurrentModule"><span class="hs-identifier hs-var">getCurrentModule</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="annottext">ScopeM () -&gt; t ScopeM ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; t ScopeM ()) -&gt; ScopeM () -&gt; t ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ScopeM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; ModuleName -&gt; m ()
</span><a href="Agda.Syntax.Scope.Monad.html#setCurrentModule"><span class="hs-identifier hs-var">setCurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701031"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span id="local-6989586621680701027"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680701027"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t ScopeM a
</span><a href="#local-6989586621680701030"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><span class="annottext">ScopeM () -&gt; t ScopeM ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; t ScopeM ()) -&gt; ScopeM () -&gt; t ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ScopeM ()
forall (m :: * -&gt; *). MonadTCState m =&gt; ModuleName -&gt; m ()
</span><a href="Agda.Syntax.Scope.Monad.html#setCurrentModule"><span class="hs-identifier hs-var">setCurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701029"><span class="hs-identifier hs-var">old</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; t ScopeM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680701027"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#getNamedScope"><span class="hs-identifier hs-type">getNamedScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span>
</span><span id="line-118"></span><span id="getNamedScope"><span class="annot"><span class="annottext">getNamedScope :: ModuleName -&gt; ScopeM Scope
</span><a href="Agda.Syntax.Scope.Monad.html#getNamedScope"><span class="hs-identifier hs-var hs-var">getNamedScope</span></a></span></span><span> </span><span id="local-6989586621680701025"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701025"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>  </span><span id="local-6989586621680701024"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621680701024"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO ScopeInfo
forall (m :: * -&gt; *). ReadTCState m =&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-var">getScope</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Map ModuleName Scope -&gt; Maybe Scope
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701025"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621680701024"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
-&gt; Lens' (Map ModuleName Scope) ScopeInfo -&gt; Map ModuleName Scope
forall o i. o -&gt; Lens' i o -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (Map ModuleName Scope) ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopeModules"><span class="hs-identifier hs-var">scopeModules</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680701020"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680701020"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; ScopeM Scope
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680701020"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">Maybe Scope
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ScopeM ()) -&gt; String -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ERROR: In scope\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621680701024"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nNO SUCH SCOPE &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701025"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-124"></span><span>      </span><span class="annot"><span class="annottext">ScopeM Scope
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#getCurrentScope"><span class="hs-identifier hs-type">getCurrentScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span>
</span><span id="line-127"></span><span id="getCurrentScope"><span class="annot"><span class="annottext">getCurrentScope :: ScopeM Scope
</span><a href="Agda.Syntax.Scope.Monad.html#getCurrentScope"><span class="hs-identifier hs-var hs-var">getCurrentScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ScopeM Scope
</span><a href="Agda.Syntax.Scope.Monad.html#getNamedScope"><span class="hs-identifier hs-var">getNamedScope</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; ScopeM Scope) -&gt; ScopeM ModuleName -&gt; ScopeM Scope
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleName
</span><a href="Agda.Syntax.Scope.Monad.html#getCurrentModule"><span class="hs-identifier hs-var">getCurrentModule</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- | Create a new module with an empty scope.</span><span>
</span><span id="line-130"></span><span class="hs-comment">--   If the module is not new (e.g. duplicate @import@),</span><span>
</span><span id="line-131"></span><span class="hs-comment">--   don't erase its contents.</span><span>
</span><span id="line-132"></span><span class="hs-comment">--   (@Just@ if it is a datatype or record module.)</span><span>
</span><span id="line-133"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#createModule"><span class="hs-identifier hs-type">createModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#DataOrRecordModule"><span class="hs-identifier hs-type">DataOrRecordModule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span id="createModule"><span class="annot"><span class="annottext">createModule :: Maybe DataOrRecordModule -&gt; ModuleName -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#createModule"><span class="hs-identifier hs-var hs-var">createModule</span></a></span></span><span> </span><span id="local-6989586621680701016"><span class="annot"><span class="annottext">Maybe DataOrRecordModule
</span><a href="#local-6989586621680701016"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680701015"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701015"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scope.createModule&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ScopeM ()) -&gt; String -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;createModule &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701015"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span id="local-6989586621680701014"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680701014"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScopeM Scope
</span><a href="Agda.Syntax.Scope.Monad.html#getCurrentScope"><span class="hs-identifier hs-var">getCurrentScope</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680701013"><span class="annot"><span class="annottext">parents :: [ModuleName]
</span><a href="#local-6989586621680701013"><span class="hs-identifier hs-var hs-var">parents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#scopeName"><span class="hs-identifier hs-var hs-var">scopeName</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680701014"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [ModuleName] -&gt; [ModuleName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Scope -&gt; [ModuleName]
</span><a href="Agda.Syntax.Scope.Base.html#scopeParents"><span class="hs-identifier hs-var hs-var">scopeParents</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680701014"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-138"></span><span>      </span><span id="local-6989586621680701010"><span class="annot"><span class="annottext">sm :: Scope
</span><a href="#local-6989586621680701010"><span class="hs-identifier hs-var hs-var">sm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="Agda.Syntax.Scope.Base.html#emptyScope"><span class="hs-identifier hs-var">emptyScope</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scopeName :: ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#scopeName"><span class="hs-identifier hs-var">scopeName</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701015"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-139"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scopeParents :: [ModuleName]
</span><a href="Agda.Syntax.Scope.Base.html#scopeParents"><span class="hs-identifier hs-var">scopeParents</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621680701013"><span class="hs-identifier hs-var">parents</span></a></span><span>
</span><span id="line-140"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scopeDatatypeModule :: Maybe DataOrRecordModule
</span><a href="Agda.Syntax.Scope.Base.html#scopeDatatypeModule"><span class="hs-identifier hs-var">scopeDatatypeModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DataOrRecordModule
</span><a href="#local-6989586621680701016"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-comment">-- Andreas, 2015-07-02: internal error if module is not new.</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-comment">-- Ulf, 2016-02-15: It's not new if multiple imports (#1770).</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-comment">-- Andreas, 2020-05-18, issue #3933:</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-comment">-- If it is not new (but apparently did not clash),</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-comment">-- we do not erase its contents for reasons of monotonicity.</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="annottext">(Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyScopes"><span class="hs-identifier hs-var">modifyScopes</span></a></span><span> </span><span class="annot"><span class="annottext">((Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ())
-&gt; (Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; Scope -&gt; Scope)
-&gt; ModuleName
-&gt; Scope
-&gt; Map ModuleName Scope
-&gt; Map ModuleName Scope
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span> </span><span class="annot"><span class="annottext">Scope -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#mergeScope"><span class="hs-identifier hs-var">mergeScope</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701015"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680701010"><span class="hs-identifier hs-var">sm</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">-- | Apply a function to the scope map.</span><span>
</span><span id="line-149"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#modifyScopes"><span class="hs-identifier hs-type">modifyScopes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span id="modifyScopes"><span class="annot"><span class="annottext">modifyScopes :: (Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyScopes"><span class="hs-identifier hs-var hs-var">modifyScopes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyScope"><span class="hs-identifier hs-var">modifyScope</span></a></span><span> </span><span class="annot"><span class="annottext">((ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ())
-&gt; ((Map ModuleName Scope -&gt; Map ModuleName Scope)
    -&gt; ScopeInfo -&gt; ScopeInfo)
-&gt; (Map ModuleName Scope -&gt; Map ModuleName Scope)
-&gt; ScopeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Lens' (Map ModuleName Scope) ScopeInfo
-&gt; (Map ModuleName Scope -&gt; Map ModuleName Scope)
-&gt; ScopeInfo
-&gt; ScopeInfo
forall i o. Lens' i o -&gt; LensMap i o
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (Map ModuleName Scope) ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopeModules"><span class="hs-identifier hs-var">scopeModules</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- | Apply a function to the given scope.</span><span>
</span><span id="line-153"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#modifyNamedScope"><span class="hs-identifier hs-type">modifyNamedScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span id="modifyNamedScope"><span class="annot"><span class="annottext">modifyNamedScope :: ModuleName -&gt; (Scope -&gt; Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyNamedScope"><span class="hs-identifier hs-var hs-var">modifyNamedScope</span></a></span></span><span> </span><span id="local-6989586621680701003"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701003"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680701002"><span class="annot"><span class="annottext">Scope -&gt; Scope
</span><a href="#local-6989586621680701002"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyScopes"><span class="hs-identifier hs-var">modifyScopes</span></a></span><span> </span><span class="annot"><span class="annottext">((Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ())
-&gt; (Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; Scope)
-&gt; ModuleName -&gt; Map ModuleName Scope -&gt; Map ModuleName Scope
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.adjust</span></span><span> </span><span class="annot"><span class="annottext">Scope -&gt; Scope
</span><a href="#local-6989586621680701002"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680701003"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#setNamedScope"><span class="hs-identifier hs-type">setNamedScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span id="setNamedScope"><span class="annot"><span class="annottext">setNamedScope :: ModuleName -&gt; Scope -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#setNamedScope"><span class="hs-identifier hs-var hs-var">setNamedScope</span></a></span></span><span> </span><span id="local-6989586621680700999"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700999"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680700998"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700998"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; (Scope -&gt; Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyNamedScope"><span class="hs-identifier hs-var">modifyNamedScope</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700999"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">((Scope -&gt; Scope) -&gt; ScopeM ()) -&gt; (Scope -&gt; Scope) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scope -&gt; Scope -&gt; Scope
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700998"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | Apply a monadic function to the top scope.</span><span>
</span><span id="line-160"></span><span id="local-6989586621680701451"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#modifyNamedScopeM"><span class="hs-identifier hs-type">modifyNamedScopeM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680701451"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701451"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-161"></span><span id="modifyNamedScopeM"><span class="annot"><span class="annottext">modifyNamedScopeM :: ModuleName -&gt; (Scope -&gt; ScopeM (a, Scope)) -&gt; ScopeM a
</span><a href="Agda.Syntax.Scope.Monad.html#modifyNamedScopeM"><span class="hs-identifier hs-var hs-var">modifyNamedScopeM</span></a></span></span><span> </span><span id="local-6989586621680700995"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700995"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680700994"><span class="annot"><span class="annottext">Scope -&gt; ScopeM (a, Scope)
</span><a href="#local-6989586621680700994"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680700993"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680700993"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700992"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700992"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; ScopeM (a, Scope)
</span><a href="#local-6989586621680700994"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; ScopeM (a, Scope)) -&gt; ScopeM Scope -&gt; ScopeM (a, Scope)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ScopeM Scope
</span><a href="Agda.Syntax.Scope.Monad.html#getNamedScope"><span class="hs-identifier hs-var">getNamedScope</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700995"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">ModuleName -&gt; Scope -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#setNamedScope"><span class="hs-identifier hs-var">setNamedScope</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700995"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700992"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; ScopeM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680700993"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">-- | Apply a function to the current scope.</span><span>
</span><span id="line-167"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentScope"><span class="hs-identifier hs-type">modifyCurrentScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span id="modifyCurrentScope"><span class="annot"><span class="annottext">modifyCurrentScope :: (Scope -&gt; Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentScope"><span class="hs-identifier hs-var hs-var">modifyCurrentScope</span></a></span></span><span> </span><span id="local-6989586621680700990"><span class="annot"><span class="annottext">Scope -&gt; Scope
</span><a href="#local-6989586621680700990"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleName
</span><a href="Agda.Syntax.Scope.Monad.html#getCurrentModule"><span class="hs-identifier hs-var">getCurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName -&gt; (ModuleName -&gt; ScopeM ()) -&gt; ScopeM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; (Scope -&gt; Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyNamedScope"><span class="hs-operator hs-var">`modifyNamedScope`</span></a></span><span> </span><span class="annot"><span class="annottext">Scope -&gt; Scope
</span><a href="#local-6989586621680700990"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="local-6989586621680700989"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentScopeM"><span class="hs-identifier hs-type">modifyCurrentScopeM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680700989"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700989"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-171"></span><span id="modifyCurrentScopeM"><span class="annot"><span class="annottext">modifyCurrentScopeM :: (Scope -&gt; ScopeM (a, Scope)) -&gt; ScopeM a
</span><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentScopeM"><span class="hs-identifier hs-var hs-var">modifyCurrentScopeM</span></a></span></span><span> </span><span id="local-6989586621680700987"><span class="annot"><span class="annottext">Scope -&gt; ScopeM (a, Scope)
</span><a href="#local-6989586621680700987"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleName
</span><a href="Agda.Syntax.Scope.Monad.html#getCurrentModule"><span class="hs-identifier hs-var">getCurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName -&gt; (ModuleName -&gt; ScopeM a) -&gt; ScopeM a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; (Scope -&gt; ScopeM (a, Scope)) -&gt; ScopeM a
forall a. ModuleName -&gt; (Scope -&gt; ScopeM (a, Scope)) -&gt; ScopeM a
</span><a href="Agda.Syntax.Scope.Monad.html#modifyNamedScopeM"><span class="hs-operator hs-var">`modifyNamedScopeM`</span></a></span><span> </span><span class="annot"><span class="annottext">Scope -&gt; ScopeM (a, Scope)
</span><a href="#local-6989586621680700987"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">-- | Apply a function to the public or private name space.</span><span>
</span><span id="line-174"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentNameSpace"><span class="hs-identifier hs-type">modifyCurrentNameSpace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#NameSpaceId"><span class="hs-identifier hs-type">NameSpaceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#NameSpace"><span class="hs-identifier hs-type">NameSpace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#NameSpace"><span class="hs-identifier hs-type">NameSpace</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span id="modifyCurrentNameSpace"><span class="annot"><span class="annottext">modifyCurrentNameSpace :: NameSpaceId -&gt; (NameSpace -&gt; NameSpace) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentNameSpace"><span class="hs-identifier hs-var hs-var">modifyCurrentNameSpace</span></a></span></span><span> </span><span id="local-6989586621680700985"><span class="annot"><span class="annottext">NameSpaceId
</span><a href="#local-6989586621680700985"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680700984"><span class="annot"><span class="annottext">NameSpace -&gt; NameSpace
</span><a href="#local-6989586621680700984"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentScope"><span class="hs-identifier hs-var">modifyCurrentScope</span></a></span><span> </span><span class="annot"><span class="annottext">((Scope -&gt; Scope) -&gt; ScopeM ()) -&gt; (Scope -&gt; Scope) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ScopeNameSpaces -&gt; ScopeNameSpaces) -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#updateScopeNameSpaces"><span class="hs-identifier hs-var">updateScopeNameSpaces</span></a></span><span> </span><span class="annot"><span class="annottext">((ScopeNameSpaces -&gt; ScopeNameSpaces) -&gt; Scope -&gt; Scope)
-&gt; (ScopeNameSpaces -&gt; ScopeNameSpaces) -&gt; Scope -&gt; Scope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><span class="annottext">NameSpaceId
-&gt; (NameSpace -&gt; NameSpace) -&gt; ScopeNameSpaces -&gt; ScopeNameSpaces
forall k v. Eq k =&gt; k -&gt; (v -&gt; v) -&gt; AssocList k v -&gt; AssocList k v
</span><a href="Agda.Utils.AssocList.html#updateAt"><span class="hs-identifier hs-var">AssocList.updateAt</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpaceId
</span><a href="#local-6989586621680700985"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; NameSpace
</span><a href="#local-6989586621680700984"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#setContextPrecedence"><span class="hs-identifier hs-type">setContextPrecedence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Fixity.html#PrecedenceStack"><span class="hs-identifier hs-type">PrecedenceStack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span id="setContextPrecedence"><span class="annot"><span class="annottext">setContextPrecedence :: PrecedenceStack -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#setContextPrecedence"><span class="hs-identifier hs-var hs-var">setContextPrecedence</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyScope_"><span class="hs-identifier hs-var">modifyScope_</span></a></span><span> </span><span class="annot"><span class="annottext">((ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ())
-&gt; (PrecedenceStack -&gt; ScopeInfo -&gt; ScopeInfo)
-&gt; PrecedenceStack
-&gt; ScopeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Lens' PrecedenceStack ScopeInfo
-&gt; PrecedenceStack -&gt; ScopeInfo -&gt; ScopeInfo
forall i o. Lens' i o -&gt; LensSet i o
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' PrecedenceStack ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopePrecedence"><span class="hs-identifier hs-var">scopePrecedence</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span id="local-6989586621680700977"><span id="local-6989586621680700978"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#withContextPrecedence"><span class="hs-identifier hs-type">withContextPrecedence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700978"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Fixity.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680700978"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700977"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680700978"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700977"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-182"></span><span id="withContextPrecedence"><span class="annot"><span class="annottext">withContextPrecedence :: Precedence -&gt; m a -&gt; m a
</span><a href="Agda.Syntax.Scope.Monad.html#withContextPrecedence"><span class="hs-identifier hs-var hs-var">withContextPrecedence</span></a></span></span><span> </span><span id="local-6989586621680700975"><span class="annot"><span class="annottext">Precedence
</span><a href="#local-6989586621680700975"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><span class="annottext">Lens' PrecedenceStack TCState
-&gt; (PrecedenceStack -&gt; PrecedenceStack) -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a b.
ReadTCState m =&gt;
Lens' a TCState -&gt; (a -&gt; a) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Base.html#locallyTCState"><span class="hs-identifier hs-var">locallyTCState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ScopeInfo -&gt; f ScopeInfo) -&gt; TCState -&gt; f TCState
Lens' ScopeInfo TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#stScope"><span class="hs-identifier hs-var">stScope</span></a></span><span> </span><span class="annot"><span class="annottext">((ScopeInfo -&gt; f ScopeInfo) -&gt; TCState -&gt; f TCState)
-&gt; ((PrecedenceStack -&gt; f PrecedenceStack)
    -&gt; ScopeInfo -&gt; f ScopeInfo)
-&gt; (PrecedenceStack -&gt; f PrecedenceStack)
-&gt; TCState
-&gt; f TCState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PrecedenceStack -&gt; f PrecedenceStack) -&gt; ScopeInfo -&gt; f ScopeInfo
Lens' PrecedenceStack ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopePrecedence"><span class="hs-identifier hs-var">scopePrecedence</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PrecedenceStack -&gt; PrecedenceStack) -&gt; m a -&gt; m a)
-&gt; (PrecedenceStack -&gt; PrecedenceStack) -&gt; m a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Precedence -&gt; PrecedenceStack -&gt; PrecedenceStack
</span><a href="Agda.Syntax.Fixity.html#pushPrecedence"><span class="hs-identifier hs-var">pushPrecedence</span></a></span><span> </span><span class="annot"><span class="annottext">Precedence
</span><a href="#local-6989586621680700975"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span id="local-6989586621680701528"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#getLocalVars"><span class="hs-identifier hs-type">getLocalVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701528"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701528"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#LocalVars"><span class="hs-identifier hs-type">LocalVars</span></a></span></span><span>
</span><span id="line-186"></span><span id="getLocalVars"><span class="annot"><span class="annottext">getLocalVars :: m LocalVars
</span><a href="Agda.Syntax.Scope.Monad.html#getLocalVars"><span class="hs-identifier hs-var hs-var">getLocalVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' LocalVars ScopeInfo -&gt; m LocalVars
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' a ScopeInfo -&gt; m a
</span><a href="Agda.TypeChecking.Monad.State.html#useScope"><span class="hs-identifier hs-var">useScope</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' LocalVars ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopeLocals"><span class="hs-identifier hs-var">scopeLocals</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#modifyLocalVars"><span class="hs-identifier hs-type">modifyLocalVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#LocalVars"><span class="hs-identifier hs-type">LocalVars</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#LocalVars"><span class="hs-identifier hs-type">LocalVars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span id="modifyLocalVars"><span class="annot"><span class="annottext">modifyLocalVars :: (LocalVars -&gt; LocalVars) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyLocalVars"><span class="hs-identifier hs-var hs-var">modifyLocalVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyScope_"><span class="hs-identifier hs-var">modifyScope_</span></a></span><span> </span><span class="annot"><span class="annottext">((ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ())
-&gt; ((LocalVars -&gt; LocalVars) -&gt; ScopeInfo -&gt; ScopeInfo)
-&gt; (LocalVars -&gt; LocalVars)
-&gt; ScopeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LocalVars -&gt; LocalVars) -&gt; ScopeInfo -&gt; ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#updateScopeLocals"><span class="hs-identifier hs-var">updateScopeLocals</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#setLocalVars"><span class="hs-identifier hs-type">setLocalVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#LocalVars"><span class="hs-identifier hs-type">LocalVars</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span id="setLocalVars"><span class="annot"><span class="annottext">setLocalVars :: LocalVars -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#setLocalVars"><span class="hs-identifier hs-var hs-var">setLocalVars</span></a></span></span><span> </span><span id="local-6989586621680700967"><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700967"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocalVars -&gt; LocalVars) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyLocalVars"><span class="hs-identifier hs-var">modifyLocalVars</span></a></span><span> </span><span class="annot"><span class="annottext">((LocalVars -&gt; LocalVars) -&gt; ScopeM ())
-&gt; (LocalVars -&gt; LocalVars) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LocalVars -&gt; LocalVars -&gt; LocalVars
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700967"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">-- | Run a computation without changing the local variables.</span><span>
</span><span id="line-195"></span><span id="local-6989586621680700966"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#withLocalVars"><span class="hs-identifier hs-type">withLocalVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700966"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700966"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-196"></span><span id="withLocalVars"><span class="annot"><span class="annottext">withLocalVars :: ScopeM a -&gt; ScopeM a
</span><a href="Agda.Syntax.Scope.Monad.html#withLocalVars"><span class="hs-identifier hs-var hs-var">withLocalVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO LocalVars
-&gt; (LocalVars -&gt; ScopeM ()) -&gt; ScopeM a -&gt; ScopeM a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a -&gt; (a -&gt; m ()) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO LocalVars
forall (m :: * -&gt; *). ReadTCState m =&gt; m LocalVars
</span><a href="Agda.Syntax.Scope.Monad.html#getLocalVars"><span class="hs-identifier hs-var">getLocalVars</span></a></span><span> </span><span class="annot"><span class="annottext">LocalVars -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#setLocalVars"><span class="hs-identifier hs-var">setLocalVars</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">-- | Run a computation outside some number of local variables and add them back afterwards. This</span><span>
</span><span id="line-199"></span><span class="hs-comment">--   lets you bind variables in the middle of the context and is used when binding generalizable</span><span>
</span><span id="line-200"></span><span class="hs-comment">--   variables (#3735).</span><span>
</span><span id="line-201"></span><span id="local-6989586621680700963"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#outsideLocalVars"><span class="hs-identifier hs-type">outsideLocalVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700963"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700963"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-202"></span><span id="outsideLocalVars"><span class="annot"><span class="annottext">outsideLocalVars :: Int -&gt; ScopeM a -&gt; ScopeM a
</span><a href="Agda.Syntax.Scope.Monad.html#outsideLocalVars"><span class="hs-identifier hs-var hs-var">outsideLocalVars</span></a></span></span><span> </span><span id="local-6989586621680700961"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680700961"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680700960"><span class="annot"><span class="annottext">ScopeM a
</span><a href="#local-6989586621680700960"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621680700959"><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700959"><span class="hs-identifier hs-var">inner</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocalVars -&gt; LocalVars
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680700961"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(LocalVars -&gt; LocalVars) -&gt; TCMT IO LocalVars -&gt; TCMT IO LocalVars
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO LocalVars
forall (m :: * -&gt; *). ReadTCState m =&gt; m LocalVars
</span><a href="Agda.Syntax.Scope.Monad.html#getLocalVars"><span class="hs-identifier hs-var">getLocalVars</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><span class="annottext">(LocalVars -&gt; LocalVars) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyLocalVars"><span class="hs-identifier hs-var">modifyLocalVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; LocalVars -&gt; LocalVars
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680700961"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621680700956"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680700956"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScopeM a
</span><a href="#local-6989586621680700960"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><span class="annottext">(LocalVars -&gt; LocalVars) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyLocalVars"><span class="hs-identifier hs-var">modifyLocalVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700959"><span class="hs-identifier hs-var">inner</span></a></span><span> </span><span class="annot"><span class="annottext">LocalVars -&gt; LocalVars -&gt; LocalVars
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; ScopeM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680700956"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- | Check that the newly added variable have unique names.</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span id="local-6989586621680700955"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#withCheckNoShadowing"><span class="hs-identifier hs-type">withCheckNoShadowing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700955"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700955"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-212"></span><span id="withCheckNoShadowing"><span class="annot"><span class="annottext">withCheckNoShadowing :: ScopeM a -&gt; ScopeM a
</span><a href="Agda.Syntax.Scope.Monad.html#withCheckNoShadowing"><span class="hs-identifier hs-var hs-var">withCheckNoShadowing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO LocalVars
-&gt; (LocalVars -&gt; ScopeM ()) -&gt; ScopeM a -&gt; ScopeM a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a -&gt; (a -&gt; m ()) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO LocalVars
forall (m :: * -&gt; *). ReadTCState m =&gt; m LocalVars
</span><a href="Agda.Syntax.Scope.Monad.html#getLocalVars"><span class="hs-identifier hs-var">getLocalVars</span></a></span><span> </span><span class="annot"><span class="annottext">((LocalVars -&gt; ScopeM ()) -&gt; ScopeM a -&gt; ScopeM a)
-&gt; (LocalVars -&gt; ScopeM ()) -&gt; ScopeM a -&gt; ScopeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700953"><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700953"><span class="hs-identifier hs-var">lvarsOld</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><span class="annottext">LocalVars -&gt; LocalVars -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#checkNoShadowing"><span class="hs-identifier hs-var">checkNoShadowing</span></a></span><span> </span><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700953"><span class="hs-identifier hs-var">lvarsOld</span></a></span><span> </span><span class="annot"><span class="annottext">(LocalVars -&gt; ScopeM ()) -&gt; TCMT IO LocalVars -&gt; ScopeM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO LocalVars
forall (m :: * -&gt; *). ReadTCState m =&gt; m LocalVars
</span><a href="Agda.Syntax.Scope.Monad.html#getLocalVars"><span class="hs-identifier hs-var">getLocalVars</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#checkNoShadowing"><span class="hs-identifier hs-type">checkNoShadowing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#LocalVars"><span class="hs-identifier hs-type">LocalVars</span></a></span><span>  </span><span class="hs-comment">-- ^ Old local scope</span><span>
</span><span id="line-216"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#LocalVars"><span class="hs-identifier hs-type">LocalVars</span></a></span><span>  </span><span class="hs-comment">-- ^ New local scope</span><span>
</span><span id="line-217"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span id="checkNoShadowing"><span class="annot"><span class="annottext">checkNoShadowing :: LocalVars -&gt; LocalVars -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#checkNoShadowing"><span class="hs-identifier hs-var hs-var">checkNoShadowing</span></a></span></span><span> </span><span id="local-6989586621680700951"><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700951"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span id="local-6989586621680700950"><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700950"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>  </span><span id="local-6989586621680700949"><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621680700949"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO PragmaOptions
forall (m :: * -&gt; *). HasOptions m =&gt; m PragmaOptions
</span><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-var">pragmaOptions</span></a></span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ScopeM () -&gt; ScopeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningName
</span><a href="Agda.Interaction.Options.Warnings.html#ShadowingInTelescope_"><span class="hs-identifier hs-var">ShadowingInTelescope_</span></a></span><span> </span><span class="annot"><span class="annottext">WarningName -&gt; Set WarningName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span>
</span><span id="line-221"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PragmaOptions -&gt; WarningMode
</span><a href="Agda.Interaction.Options.Base.html#optWarningMode"><span class="hs-identifier hs-var hs-var">optWarningMode</span></a></span><span> </span><span class="annot"><span class="annottext">PragmaOptions
</span><a href="#local-6989586621680700949"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMode
-&gt; Lens' (Set WarningName) WarningMode -&gt; Set WarningName
forall o i. o -&gt; Lens' i o -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (Set WarningName) WarningMode
</span><a href="Agda.Interaction.Options.Warnings.html#warningSet"><span class="hs-identifier hs-var">warningSet</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; ScopeM ()) -&gt; ScopeM () -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-comment">-- LocalVars is currnently an AssocList so the difference between</span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-comment">-- two local scope is the left part of the new one.</span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700942"><span class="annot"><span class="annottext">diff :: LocalVars
</span><a href="#local-6989586621680700942"><span class="hs-identifier hs-var hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocalVars -&gt; LocalVars
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="Agda.Utils.List.html#dropEnd"><span class="hs-identifier hs-var">dropEnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalVars -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700951"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700950"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-comment">-- Filter out the underscores.</span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700939"><span class="annot"><span class="annottext">newNames :: [Name]
</span><a href="#local-6989586621680700939"><span class="hs-identifier hs-var hs-var">newNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; [Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Name -&gt; Bool) -&gt; Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
forall a. IsNoName a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Concrete.Name.html#isNoName"><span class="hs-identifier hs-var">isNoName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [Name]) -&gt; [Name] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LocalVars -&gt; [Name]
forall k v. AssocList k v -&gt; [k]
</span><a href="Agda.Utils.AssocList.html#keys"><span class="hs-identifier hs-var">AssocList.keys</span></a></span><span> </span><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700942"><span class="hs-identifier hs-var">diff</span></a></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-comment">-- Associate each name to its occurrences.</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700935"><span class="annot"><span class="annottext">nameOccs :: [(Name, [Range])]
</span><a href="#local-6989586621680700935"><span class="hs-identifier hs-var hs-var">nameOccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Name [Range] -&gt; [(Name, [Range])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Name [Range] -&gt; [(Name, [Range])])
-&gt; Map Name [Range] -&gt; [(Name, [Range])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Range] -&gt; [Range] -&gt; [Range])
-&gt; [(Name, [Range])] -&gt; Map Name [Range]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">[Range] -&gt; [Range] -&gt; [Range]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">(++)</span></span><span> </span><span class="annot"><span class="annottext">([(Name, [Range])] -&gt; Map Name [Range])
-&gt; [(Name, [Range])] -&gt; Map Name [Range]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; (Name, [Range])) -&gt; [Name] -&gt; [(Name, [Range])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; (Name, [Range])
</span><a href="#local-6989586621680700932"><span class="hs-identifier hs-var">pairWithRange</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680700939"><span class="hs-identifier hs-var">newNames</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-comment">-- Warn if we have two or more occurrences of the same name.</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">[(Name, [Range])] -&gt; ([(Name, [Range])] -&gt; ScopeM ()) -&gt; ScopeM ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, [Range]) -&gt; Bool) -&gt; [(Name, [Range])] -&gt; [(Name, [Range])]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Range] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="#local-6989586621680700930"><span class="hs-identifier hs-var">atLeastTwo</span></a></span><span> </span><span class="annot"><span class="annottext">([Range] -&gt; Bool)
-&gt; ((Name, [Range]) -&gt; [Range]) -&gt; (Name, [Range]) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, [Range]) -&gt; [Range]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, [Range])]
</span><a href="#local-6989586621680700935"><span class="hs-identifier hs-var">nameOccs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([(Name, [Range])] -&gt; ScopeM ()) -&gt; ScopeM ())
-&gt; ([(Name, [Range])] -&gt; ScopeM ()) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700929"><span class="annot"><span class="annottext">[(Name, [Range])]
</span><a href="#local-6989586621680700929"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>      </span><span class="annot"><span class="annottext">HasCallStack =&gt; DeclarationWarning' -&gt; ScopeM ()
DeclarationWarning' -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#scopeWarning"><span class="hs-identifier hs-var">scopeWarning</span></a></span><span> </span><span class="annot"><span class="annottext">(DeclarationWarning' -&gt; ScopeM ())
-&gt; DeclarationWarning' -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Name, [Range])] -&gt; DeclarationWarning'
</span><a href="Agda.Syntax.Concrete.Definitions.Errors.html#ShadowingInTelescope"><span class="hs-identifier hs-var">ShadowingInTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, [Range])]
</span><a href="#local-6989586621680700929"><span class="hs-identifier hs-var">conflicts</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><a href="#local-6989586621680700932"><span class="hs-identifier hs-type">pairWithRange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621680700932"><span class="annot"><span class="annottext">pairWithRange :: Name -&gt; (Name, [Range])
</span><a href="#local-6989586621680700932"><span class="hs-identifier hs-var hs-var">pairWithRange</span></a></span></span><span> </span><span id="local-6989586621680700927"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700927"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700927"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700927"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621680701402"><span class="annot"><a href="#local-6989586621680700930"><span class="hs-identifier hs-type">atLeastTwo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680701402"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621680700930"><span class="annot"><span class="annottext">atLeastTwo :: [a] -&gt; Bool
</span><a href="#local-6989586621680700930"><span class="hs-identifier hs-var hs-var">atLeastTwo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="#local-6989586621680700930"><span class="hs-identifier hs-var">atLeastTwo</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#getVarsToBind"><span class="hs-identifier hs-type">getVarsToBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#LocalVars"><span class="hs-identifier hs-type">LocalVars</span></a></span><span>
</span><span id="line-241"></span><span id="getVarsToBind"><span class="annot"><span class="annottext">getVarsToBind :: TCMT IO LocalVars
</span><a href="Agda.Syntax.Scope.Monad.html#getVarsToBind"><span class="hs-identifier hs-var hs-var">getVarsToBind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' LocalVars ScopeInfo -&gt; TCMT IO LocalVars
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' a ScopeInfo -&gt; m a
</span><a href="Agda.TypeChecking.Monad.State.html#useScope"><span class="hs-identifier hs-var">useScope</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' LocalVars ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopeVarsToBind"><span class="hs-identifier hs-var">scopeVarsToBind</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#addVarToBind"><span class="hs-identifier hs-type">addVarToBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#LocalVar"><span class="hs-identifier hs-type">LocalVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span id="addVarToBind"><span class="annot"><span class="annottext">addVarToBind :: Name -&gt; LocalVar -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#addVarToBind"><span class="hs-identifier hs-var hs-var">addVarToBind</span></a></span></span><span> </span><span id="local-6989586621680700922"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700922"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700921"><span class="annot"><span class="annottext">LocalVar
</span><a href="#local-6989586621680700921"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyScope_"><span class="hs-identifier hs-var">modifyScope_</span></a></span><span> </span><span class="annot"><span class="annottext">((ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ())
-&gt; (ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LocalVars -&gt; LocalVars) -&gt; ScopeInfo -&gt; ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#updateVarsToBind"><span class="hs-identifier hs-var">updateVarsToBind</span></a></span><span> </span><span class="annot"><span class="annottext">((LocalVars -&gt; LocalVars) -&gt; ScopeInfo -&gt; ScopeInfo)
-&gt; (LocalVars -&gt; LocalVars) -&gt; ScopeInfo -&gt; ScopeInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; LocalVar -&gt; LocalVars -&gt; LocalVars
forall k v. k -&gt; v -&gt; AssocList k v -&gt; AssocList k v
</span><a href="Agda.Utils.AssocList.html#insert"><span class="hs-identifier hs-var">AssocList.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700922"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LocalVar
</span><a href="#local-6989586621680700921"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-comment">-- | After collecting some variable names in the scopeVarsToBind,</span><span>
</span><span id="line-247"></span><span class="hs-comment">--   bind them all simultaneously.</span><span>
</span><span id="line-248"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#bindVarsToBind"><span class="hs-identifier hs-type">bindVarsToBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span id="bindVarsToBind"><span class="annot"><span class="annottext">bindVarsToBind :: ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#bindVarsToBind"><span class="hs-identifier hs-var hs-var">bindVarsToBind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>  </span><span id="local-6989586621680700917"><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700917"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO LocalVars
</span><a href="Agda.Syntax.Scope.Monad.html#getVarsToBind"><span class="hs-identifier hs-var">getVarsToBind</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><span class="annottext">(LocalVars -&gt; LocalVars) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyLocalVars"><span class="hs-identifier hs-var">modifyLocalVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalVars
</span><a href="#local-6989586621680700917"><span class="hs-identifier hs-var">vars</span></a></span><span class="annot"><span class="annottext">LocalVars -&gt; LocalVars -&gt; LocalVars
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; String -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#printLocals"><span class="hs-identifier hs-var">printLocals</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bound variables:&quot;</span></span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(ScopeInfo -&gt; ScopeInfo) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifyScope_"><span class="hs-identifier hs-var">modifyScope_</span></a></span><span> </span><span class="annot"><span class="annottext">((ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ())
-&gt; (ScopeInfo -&gt; ScopeInfo) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LocalVars -&gt; ScopeInfo -&gt; ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#setVarsToBind"><span class="hs-identifier hs-var">setVarsToBind</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- * Names</span><span>
</span><span id="line-257"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-comment">-- | Create a fresh abstract name from a concrete name.</span><span>
</span><span id="line-260"></span><span class="hs-comment">--</span><span>
</span><span id="line-261"></span><span class="hs-comment">--   This function is used when we translate a concrete name</span><span>
</span><span id="line-262"></span><span class="hs-comment">--   in a binder.  The 'Range' of the concrete name is</span><span>
</span><span id="line-263"></span><span class="hs-comment">--   saved as the 'nameBindingSite' of the abstract name.</span><span>
</span><span id="line-264"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#freshAbstractName"><span class="hs-identifier hs-type">freshAbstractName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Fixity%27"><span class="hs-identifier hs-type">Fixity'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">A.Name</span></a></span><span>
</span><span id="line-265"></span><span id="freshAbstractName"><span class="annot"><span class="annottext">freshAbstractName :: Fixity' -&gt; Name -&gt; ScopeM Name
</span><a href="Agda.Syntax.Scope.Monad.html#freshAbstractName"><span class="hs-identifier hs-var hs-var">freshAbstractName</span></a></span></span><span> </span><span id="local-6989586621680700914"><span class="annot"><span class="annottext">Fixity'
</span><a href="#local-6989586621680700914"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621680700913"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700913"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-266"></span><span>  </span><span id="local-6989586621680700912"><span class="annot"><span class="annottext">NameId
</span><a href="#local-6989586621680700912"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO NameId
forall i (m :: * -&gt; *). MonadFresh i m =&gt; m i
</span><a href="Agda.TypeChecking.Monad.Base.html#fresh"><span class="hs-identifier hs-var">fresh</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span class="annot"><span class="annottext">Name -&gt; ScopeM Name
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; ScopeM Name) -&gt; Name -&gt; ScopeM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name :: NameId -&gt; Name -&gt; Name -&gt; Range -&gt; Fixity' -&gt; Bool -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">A.Name</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nameId :: NameId
</span><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier hs-var">nameId</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameId
</span><a href="#local-6989586621680700912"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nameConcrete :: Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">nameConcrete</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700913"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nameCanonical :: Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameCanonical"><span class="hs-identifier hs-var">nameCanonical</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700913"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nameBindingSite :: Range
</span><a href="Agda.Syntax.Abstract.Name.html#nameBindingSite"><span class="hs-identifier hs-var">nameBindingSite</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700913"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nameFixity :: Fixity'
</span><a href="Agda.Syntax.Abstract.Name.html#nameFixity"><span class="hs-identifier hs-var">nameFixity</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Fixity'
</span><a href="#local-6989586621680700914"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nameIsRecordName :: Bool
</span><a href="Agda.Syntax.Abstract.Name.html#nameIsRecordName"><span class="hs-identifier hs-var">nameIsRecordName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">-- | @freshAbstractName_ = freshAbstractName noFixity'@</span><span>
</span><span id="line-277"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#freshAbstractName_"><span class="hs-identifier hs-type">freshAbstractName_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">A.Name</span></a></span><span>
</span><span id="line-278"></span><span id="freshAbstractName_"><span class="annot"><span class="annottext">freshAbstractName_ :: Name -&gt; ScopeM Name
</span><a href="Agda.Syntax.Scope.Monad.html#freshAbstractName_"><span class="hs-identifier hs-var hs-var">freshAbstractName_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Fixity' -&gt; Name -&gt; ScopeM Name
</span><a href="Agda.Syntax.Scope.Monad.html#freshAbstractName"><span class="hs-identifier hs-var">freshAbstractName</span></a></span><span> </span><span class="annot"><span class="annottext">Fixity'
</span><a href="Agda.Syntax.Common.html#noFixity%27"><span class="hs-identifier hs-var">noFixity'</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="hs-comment">-- | Create a fresh abstract qualified name.</span><span>
</span><span id="line-281"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#freshAbstractQName"><span class="hs-identifier hs-type">freshAbstractQName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Fixity%27"><span class="hs-identifier hs-type">Fixity'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span>
</span><span id="line-282"></span><span id="freshAbstractQName"><span class="annot"><span class="annottext">freshAbstractQName :: Fixity' -&gt; Name -&gt; ScopeM QName
</span><a href="Agda.Syntax.Scope.Monad.html#freshAbstractQName"><span class="hs-identifier hs-var hs-var">freshAbstractQName</span></a></span></span><span> </span><span id="local-6989586621680700900"><span class="annot"><span class="annottext">Fixity'
</span><a href="#local-6989586621680700900"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621680700899"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700899"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-283"></span><span>  </span><span id="local-6989586621680700898"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700898"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Fixity' -&gt; Name -&gt; ScopeM Name
</span><a href="Agda.Syntax.Scope.Monad.html#freshAbstractName"><span class="hs-identifier hs-var">freshAbstractName</span></a></span><span> </span><span class="annot"><span class="annottext">Fixity'
</span><a href="#local-6989586621680700900"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700899"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span id="local-6989586621680700897"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700897"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleName
</span><a href="Agda.Syntax.Scope.Monad.html#getCurrentModule"><span class="hs-identifier hs-var">getCurrentModule</span></a></span><span>
</span><span id="line-285"></span><span>  </span><span class="annot"><span class="annottext">QName -&gt; ScopeM QName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; ScopeM QName) -&gt; QName -&gt; ScopeM QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Name -&gt; QName
</span><a href="Agda.Syntax.Abstract.Name.html#qualify"><span class="hs-identifier hs-var">A.qualify</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700897"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700898"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#freshAbstractQName%27"><span class="hs-identifier hs-type">freshAbstractQName'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span>
</span><span id="line-288"></span><span id="freshAbstractQName%27"><span class="annot"><span class="annottext">freshAbstractQName' :: Name -&gt; ScopeM QName
</span><a href="Agda.Syntax.Scope.Monad.html#freshAbstractQName%27"><span class="hs-identifier hs-var hs-var">freshAbstractQName'</span></a></span></span><span> </span><span id="local-6989586621680700894"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700894"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-289"></span><span>  </span><span id="local-6989586621680700893"><span class="annot"><span class="annottext">Fixity'
</span><a href="#local-6989586621680700893"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ScopeM Fixity'
</span><a href="Agda.Syntax.Scope.Monad.html#getConcreteFixity"><span class="hs-identifier hs-var">getConcreteFixity</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700894"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><span class="annottext">Fixity' -&gt; Name -&gt; ScopeM QName
</span><a href="Agda.Syntax.Scope.Monad.html#freshAbstractQName"><span class="hs-identifier hs-var">freshAbstractQName</span></a></span><span> </span><span class="annot"><span class="annottext">Fixity'
</span><a href="#local-6989586621680700893"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700894"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- | Create a concrete name that is not yet in scope.</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- | NOTE: See @chooseName@ in @Agda.Syntax.Translation.AbstractToConcrete@ for similar logic.</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- | NOTE: See @withName@ in @Agda.Syntax.Translation.ReflectedToAbstract@ for similar logic.</span><span>
</span><span id="line-295"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#freshConcreteName"><span class="hs-identifier hs-type">freshConcreteName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span>
</span><span id="line-296"></span><span id="freshConcreteName"><span class="annot"><span class="annottext">freshConcreteName :: Range -&gt; Int -&gt; String -&gt; ScopeM Name
</span><a href="Agda.Syntax.Scope.Monad.html#freshConcreteName"><span class="hs-identifier hs-var hs-var">freshConcreteName</span></a></span></span><span> </span><span id="local-6989586621680700890"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700890"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680700889"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680700889"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680700888"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680700888"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700887"><span class="annot"><span class="annottext">cname :: Name
</span><a href="#local-6989586621680700887"><span class="hs-identifier hs-var hs-var">cname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range -&gt; NameInScope -&gt; NameParts -&gt; Name
</span><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-var">C.Name</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700890"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">NameInScope
</span><a href="Agda.Syntax.Concrete.Name.html#NotInScope"><span class="hs-identifier hs-var">C.NotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">(NameParts -&gt; Name) -&gt; NameParts -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamePart -&gt; NameParts
forall el coll. Singleton el coll =&gt; el -&gt; coll
</span><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(NamePart -&gt; NameParts) -&gt; NamePart -&gt; NameParts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; NamePart
</span><a href="Agda.Syntax.Concrete.Name.html#Id"><span class="hs-identifier hs-var">Id</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; NamePart) -&gt; String -&gt; NamePart
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Agda.Syntax.Common.html#stringToRawName"><span class="hs-identifier hs-var">stringToRawName</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680700888"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680700889"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><span class="annottext">QName -&gt; ScopeM ResolvedName
</span><a href="Agda.Syntax.Scope.Monad.html#resolveName"><span class="hs-identifier hs-var">resolveName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; QName
</span><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-var">C.QName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700887"><span class="hs-identifier hs-var">cname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeM ResolvedName -&gt; (ResolvedName -&gt; ScopeM Name) -&gt; ScopeM Name
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">ResolvedName
</span><a href="Agda.Syntax.Scope.Base.html#UnknownName"><span class="hs-identifier hs-var">UnknownName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ScopeM Name
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700887"><span class="hs-identifier hs-var">cname</span></a></span><span>
</span><span id="line-300"></span><span>    </span><span class="annot"><span class="annottext">ResolvedName
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Int -&gt; String -&gt; ScopeM Name
</span><a href="Agda.Syntax.Scope.Monad.html#freshConcreteName"><span class="hs-identifier hs-var">freshConcreteName</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700890"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680700889"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680700888"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- * Resolving names</span><span>
</span><span id="line-304"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-comment">-- | Look up the abstract name referred to by a given concrete name.</span><span>
</span><span id="line-307"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#resolveName"><span class="hs-identifier hs-type">resolveName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ResolvedName"><span class="hs-identifier hs-type">ResolvedName</span></a></span><span>
</span><span id="line-308"></span><span id="resolveName"><span class="annot"><span class="annottext">resolveName :: QName -&gt; ScopeM ResolvedName
</span><a href="Agda.Syntax.Scope.Monad.html#resolveName"><span class="hs-identifier hs-var hs-var">resolveName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KindsOfNames -&gt; Maybe (Set Name) -&gt; QName -&gt; ScopeM ResolvedName
</span><a href="Agda.Syntax.Scope.Monad.html#resolveName%27"><span class="hs-identifier hs-var">resolveName'</span></a></span><span> </span><span class="annot"><span class="annottext">KindsOfNames
</span><a href="Agda.Syntax.Scope.Base.html#allKindsOfNames"><span class="hs-identifier hs-var">allKindsOfNames</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Set Name)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-comment">-- | Look up the abstract name corresponding to a concrete name of</span><span>
</span><span id="line-311"></span><span class="hs-comment">--   a certain kind and/or from a given set of names.</span><span>
</span><span id="line-312"></span><span class="hs-comment">--   Sometimes we know already that we are dealing with a constructor</span><span>
</span><span id="line-313"></span><span class="hs-comment">--   or pattern synonym (e.g. when we have parsed a pattern).</span><span>
</span><span id="line-314"></span><span class="hs-comment">--   Then, we can ignore conflicting definitions of that name</span><span>
</span><span id="line-315"></span><span class="hs-comment">--   of a different kind. (See issue 822.)</span><span>
</span><span id="line-316"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#resolveName%27"><span class="hs-identifier hs-type">resolveName'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#KindsOfNames"><span class="hs-identifier hs-type">KindsOfNames</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">A.Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ResolvedName"><span class="hs-identifier hs-type">ResolvedName</span></a></span><span>
</span><span id="line-318"></span><span id="resolveName%27"><span class="annot"><span class="annottext">resolveName' :: KindsOfNames -&gt; Maybe (Set Name) -&gt; QName -&gt; ScopeM ResolvedName
</span><a href="Agda.Syntax.Scope.Monad.html#resolveName%27"><span class="hs-identifier hs-var hs-var">resolveName'</span></a></span></span><span> </span><span id="local-6989586621680700874"><span class="annot"><span class="annottext">KindsOfNames
</span><a href="#local-6989586621680700874"><span class="hs-identifier hs-var">kinds</span></a></span></span><span> </span><span id="local-6989586621680700873"><span class="annot"><span class="annottext">Maybe (Set Name)
</span><a href="#local-6989586621680700873"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621680700872"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700872"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT (List1 QName) ScopeM ResolvedName
-&gt; TCMT IO (Either (List1 QName) ResolvedName)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindsOfNames
-&gt; Maybe (Set Name)
-&gt; QName
-&gt; ExceptT (List1 QName) ScopeM ResolvedName
forall (m :: * -&gt; *).
(ReadTCState m, HasBuiltins m, MonadError (List1 QName) m) =&gt;
KindsOfNames -&gt; Maybe (Set Name) -&gt; QName -&gt; m ResolvedName
</span><a href="Agda.Syntax.Scope.Monad.html#tryResolveName"><span class="hs-identifier hs-var">tryResolveName</span></a></span><span> </span><span class="annot"><span class="annottext">KindsOfNames
</span><a href="#local-6989586621680700874"><span class="hs-identifier hs-var">kinds</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Set Name)
</span><a href="#local-6989586621680700873"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700872"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Either (List1 QName) ResolvedName)
-&gt; (Either (List1 QName) ResolvedName -&gt; ScopeM ResolvedName)
-&gt; ScopeM ResolvedName
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-319"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680700869"><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621680700869"><span class="hs-identifier hs-var">ys</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Call -&gt; ScopeM ResolvedName -&gt; ScopeM ResolvedName
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#SetRange"><span class="hs-identifier hs-var">SetRange</span></a></span><span> </span><span class="annot"><span class="annottext">(Range -&gt; Call) -&gt; Range -&gt; Call
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700872"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeM ResolvedName -&gt; ScopeM ResolvedName)
-&gt; ScopeM ResolvedName -&gt; ScopeM ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ScopeM ResolvedName
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ScopeM ResolvedName)
-&gt; TypeError -&gt; ScopeM ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; List1 QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#AmbiguousName"><span class="hs-identifier hs-var">AmbiguousName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700872"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">List1 QName
</span><a href="#local-6989586621680700869"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680700864"><span class="annot"><span class="annottext">ResolvedName
</span><a href="#local-6989586621680700864"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResolvedName -&gt; ScopeM ResolvedName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ResolvedName
</span><a href="#local-6989586621680700864"><span class="hs-identifier hs-var">x'</span></a></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span id="local-6989586621680701370"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#tryResolveName"><span class="hs-identifier hs-type">tryResolveName</span></a></span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ReadTCState"><span class="hs-identifier hs-type">ReadTCState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701370"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#HasBuiltins"><span class="hs-identifier hs-type">HasBuiltins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701370"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680701370"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#KindsOfNames"><span class="hs-identifier hs-type">KindsOfNames</span></a></span><span>       </span><span class="hs-comment">-- ^ Restrict search to these kinds of names.</span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">A.Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Unless 'Nothing', restrict search to match any of these names.</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span>            </span><span class="hs-comment">-- ^ Name to be resolved</span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701370"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ResolvedName"><span class="hs-identifier hs-type">ResolvedName</span></a></span><span>     </span><span class="hs-comment">-- ^ If illegally ambiguous, throw error with the ambiguous name.</span></span><span>
</span><span id="line-328"></span><span id="tryResolveName"><span class="annot"><span class="annottext">tryResolveName :: KindsOfNames -&gt; Maybe (Set Name) -&gt; QName -&gt; m ResolvedName
</span><a href="Agda.Syntax.Scope.Monad.html#tryResolveName"><span class="hs-identifier hs-var hs-var">tryResolveName</span></a></span></span><span> </span><span id="local-6989586621680700863"><span class="annot"><span class="annottext">KindsOfNames
</span><a href="#local-6989586621680700863"><span class="hs-identifier hs-var">kinds</span></a></span></span><span> </span><span id="local-6989586621680700862"><span class="annot"><span class="annottext">Maybe (Set Name)
</span><a href="#local-6989586621680700862"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621680700861"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700861"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>  </span><span id="local-6989586621680700860"><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621680700860"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ScopeInfo
forall (m :: * -&gt; *). ReadTCState m =&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-var">getScope</span></a></span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700859"><span class="annot"><span class="annottext">vars :: AssocList QName LocalVar
</span><a href="#local-6989586621680700859"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; QName) -&gt; LocalVars -&gt; AssocList QName LocalVar
forall k k' v. (k -&gt; k') -&gt; AssocList k v -&gt; AssocList k' v
</span><a href="Agda.Utils.AssocList.html#mapKeysMonotonic"><span class="hs-identifier hs-var">AssocList.mapKeysMonotonic</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; QName
</span><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-var">C.QName</span></a></span><span> </span><span class="annot"><span class="annottext">(LocalVars -&gt; AssocList QName LocalVar)
-&gt; LocalVars -&gt; AssocList QName LocalVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621680700860"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; Lens' LocalVars ScopeInfo -&gt; LocalVars
forall o i. o -&gt; Lens' i o -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' LocalVars ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopeLocals"><span class="hs-identifier hs-var">scopeLocals</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QName -&gt; AssocList QName LocalVar -&gt; Maybe LocalVar
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700861"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">AssocList QName LocalVar
</span><a href="#local-6989586621680700859"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-comment">-- Case: we have a local variable x, but is (perhaps) shadowed by some imports ys.</span><span>
</span><span id="line-333"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#LocalVar"><span class="hs-identifier hs-type">LocalVar</span></a></span><span> </span><span id="local-6989586621680700855"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700855"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621680700854"><span class="annot"><span class="annottext">BindingSource
</span><a href="#local-6989586621680700854"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680700853"><span class="annot"><span class="annottext">[AbstractName]
</span><a href="#local-6989586621680700853"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-comment">-- We may ignore the imports filtered out by the @names@ filter.</span><span>
</span><span id="line-335"></span><span>      </span><span class="annot"><span class="annottext">[AbstractName]
-&gt; m ResolvedName
-&gt; ([AbstractName] -&gt; m ResolvedName)
-&gt; m ResolvedName
forall a b. Null a =&gt; a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Null.html#ifNull"><span class="hs-identifier hs-var">ifNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AbstractName -&gt; AbstractName) -&gt; [AbstractName] -&gt; [AbstractName]
forall a. (a -&gt; AbstractName) -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621680700851"><span class="hs-identifier hs-var">filterNames</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; AbstractName
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">[AbstractName]
</span><a href="#local-6989586621680700853"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-comment">{-then-}</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResolvedName -&gt; m ResolvedName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ResolvedName -&gt; m ResolvedName) -&gt; ResolvedName -&gt; m ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; BindingSource -&gt; ResolvedName
</span><a href="Agda.Syntax.Scope.Base.html#VarName"><span class="hs-identifier hs-var">VarName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700855"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nameConcrete :: Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">nameConcrete</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Concrete.Name.html#unqualify"><span class="hs-identifier hs-var">unqualify</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700861"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">BindingSource
</span><a href="#local-6989586621680700854"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-comment">{-else-}</span><span> </span><span class="annot"><span class="annottext">(([AbstractName] -&gt; m ResolvedName) -&gt; m ResolvedName)
-&gt; ([AbstractName] -&gt; m ResolvedName) -&gt; m ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700847"><span class="annot"><span class="annottext">[AbstractName]
</span><a href="#local-6989586621680700847"><span class="hs-identifier hs-var">ys'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-338"></span><span>          </span><span class="annot"><span class="annottext">List1 QName -&gt; m ResolvedName
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(List1 QName -&gt; m ResolvedName) -&gt; List1 QName -&gt; m ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; QName
</span><a href="Agda.Syntax.Abstract.Name.html#qualify_"><span class="hs-identifier hs-var">A.qualify_</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700855"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [QName] -&gt; List1 QName
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; QName) -&gt; [AbstractName] -&gt; [QName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var hs-var">anameName</span></a></span><span> </span><span class="annot"><span class="annottext">[AbstractName]
</span><a href="#local-6989586621680700847"><span class="hs-identifier hs-var">ys'</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-comment">-- Case: we do not have a local variable x.</span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><span class="annottext">Maybe LocalVar
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-comment">-- Consider only names that are in the given set of names and</span><span>
</span><span id="line-342"></span><span>      </span><span class="hs-comment">-- are of one of the given kinds</span><span>
</span><span id="line-343"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700843"><span class="annot"><span class="annottext">filtKind :: [(AbstractName, Access)] -&gt; [(AbstractName, Access)]
</span><a href="#local-6989586621680700843"><span class="hs-identifier hs-var hs-var">filtKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((AbstractName, Access) -&gt; Bool)
-&gt; [(AbstractName, Access)] -&gt; [(AbstractName, Access)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">(((AbstractName, Access) -&gt; Bool)
 -&gt; [(AbstractName, Access)] -&gt; [(AbstractName, Access)])
-&gt; ((AbstractName, Access) -&gt; Bool)
-&gt; [(AbstractName, Access)]
-&gt; [(AbstractName, Access)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindOfName -&gt; KindsOfNames -&gt; Bool
</span><a href="Agda.Syntax.Scope.Base.html#elemKindsOfNames"><span class="hs-operator hs-var">`elemKindsOfNames`</span></a></span><span> </span><span class="annot"><span class="annottext">KindsOfNames
</span><a href="#local-6989586621680700863"><span class="hs-identifier hs-var">kinds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KindOfName -&gt; Bool)
-&gt; ((AbstractName, Access) -&gt; KindOfName)
-&gt; (AbstractName, Access)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#anameKind"><span class="hs-identifier hs-var hs-var">anameKind</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; KindOfName)
-&gt; ((AbstractName, Access) -&gt; AbstractName)
-&gt; (AbstractName, Access)
-&gt; KindOfName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName, Access) -&gt; AbstractName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-344"></span><span>          </span><span id="local-6989586621680700840"><span class="annot"><span class="annottext">possibleNames :: QName -&gt; [(AbstractName, Access)]
</span><a href="#local-6989586621680700840"><span class="hs-identifier hs-var hs-var">possibleNames</span></a></span></span><span> </span><span id="local-6989586621680700839"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700839"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(AbstractName, Access)] -&gt; [(AbstractName, Access)]
</span><a href="#local-6989586621680700843"><span class="hs-identifier hs-var">filtKind</span></a></span><span> </span><span class="annot"><span class="annottext">([(AbstractName, Access)] -&gt; [(AbstractName, Access)])
-&gt; [(AbstractName, Access)] -&gt; [(AbstractName, Access)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((AbstractName, Access) -&gt; AbstractName)
-&gt; [(AbstractName, Access)] -&gt; [(AbstractName, Access)]
forall a. (a -&gt; AbstractName) -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621680700851"><span class="hs-identifier hs-var">filterNames</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName, Access) -&gt; AbstractName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(AbstractName, Access)] -&gt; [(AbstractName, Access)])
-&gt; [(AbstractName, Access)] -&gt; [(AbstractName, Access)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; ScopeInfo -&gt; [(AbstractName, Access)]
forall a. InScope a =&gt; QName -&gt; ScopeInfo -&gt; [(a, Access)]
</span><a href="Agda.Syntax.Scope.Base.html#scopeLookup%27"><span class="hs-identifier hs-var">scopeLookup'</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700839"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeInfo
</span><a href="#local-6989586621680700860"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-345"></span><span>      </span><span class="hs-comment">-- If the name has a suffix, also consider the possibility that</span><span>
</span><span id="line-346"></span><span>      </span><span class="hs-comment">-- the base name is in scope (e.g. the builtin sorts `Set` and `Prop`).</span><span>
</span><span id="line-347"></span><span>      </span><span id="local-6989586621680700837"><span class="annot"><span class="annottext">QName -&gt; Bool
</span><a href="#local-6989586621680700837"><span class="hs-identifier hs-var">canHaveSuffix</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (QName -&gt; Bool)
forall (m :: * -&gt; *). HasBuiltins m =&gt; m (QName -&gt; Bool)
</span><a href="Agda.Syntax.Scope.Monad.html#canHaveSuffixTest"><span class="hs-identifier hs-var">canHaveSuffixTest</span></a></span><span>
</span><span id="line-348"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700835"><span class="annot"><span class="annottext">Maybe Suffix
</span><a href="#local-6989586621680700835"><span class="hs-identifier hs-var">xsuffix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700834"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700834"><span class="hs-identifier hs-var">xbase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; (Maybe Suffix, Name)) -&gt; QName -&gt; (Maybe Suffix, QName)
Lens' Name QName
</span><a href="Agda.Syntax.Concrete.Name.html#lensQNameName"><span class="hs-identifier hs-var">C.lensQNameName</span></a></span><span> </span><span class="annot"><span class="annottext">((Name -&gt; (Maybe Suffix, Name)) -&gt; QName -&gt; (Maybe Suffix, QName))
-&gt; ((Maybe Suffix -&gt; (Maybe Suffix, Maybe Suffix))
    -&gt; Name -&gt; (Maybe Suffix, Name))
-&gt; (Maybe Suffix -&gt; (Maybe Suffix, Maybe Suffix))
-&gt; QName
-&gt; (Maybe Suffix, QName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Suffix -&gt; (Maybe Suffix, Maybe Suffix))
-&gt; Name -&gt; (Maybe Suffix, Name)
Lens' (Maybe Suffix) Name
</span><a href="Agda.Syntax.Concrete.Name.html#nameSuffix"><span class="hs-identifier hs-var">nameSuffix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span class="annot"><span class="annottext">Maybe Suffix
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700861"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-349"></span><span>          </span><span id="local-6989586621680700831"><span class="annot"><span class="annottext">possibleBaseNames :: [(AbstractName, Access)]
</span><a href="#local-6989586621680700831"><span class="hs-identifier hs-var hs-var">possibleBaseNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((AbstractName, Access) -&gt; Bool)
-&gt; [(AbstractName, Access)] -&gt; [(AbstractName, Access)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Bool
</span><a href="#local-6989586621680700837"><span class="hs-identifier hs-var">canHaveSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Bool)
-&gt; ((AbstractName, Access) -&gt; QName)
-&gt; (AbstractName, Access)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var hs-var">anameName</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; QName)
-&gt; ((AbstractName, Access) -&gt; AbstractName)
-&gt; (AbstractName, Access)
-&gt; QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName, Access) -&gt; AbstractName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(AbstractName, Access)] -&gt; [(AbstractName, Access)])
-&gt; [(AbstractName, Access)] -&gt; [(AbstractName, Access)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [(AbstractName, Access)]
</span><a href="#local-6989586621680700840"><span class="hs-identifier hs-var">possibleNames</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700834"><span class="hs-identifier hs-var">xbase</span></a></span><span>
</span><span id="line-350"></span><span>          </span><span id="local-6989586621680700830"><span class="annot"><span class="annottext">suffixedNames :: Maybe (Suffix, NonEmpty (AbstractName, Access))
</span><a href="#local-6989586621680700830"><span class="hs-identifier hs-var hs-var">suffixedNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Suffix
 -&gt; NonEmpty (AbstractName, Access)
 -&gt; (Suffix, NonEmpty (AbstractName, Access)))
-&gt; Maybe Suffix
-&gt; Maybe
     (NonEmpty (AbstractName, Access)
      -&gt; (Suffix, NonEmpty (AbstractName, Access)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Suffix -&gt; Maybe Suffix
</span><a href="#local-6989586621680700829"><span class="hs-identifier hs-var">fromConcreteSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Suffix
</span><a href="#local-6989586621680700835"><span class="hs-identifier hs-var">xsuffix</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (NonEmpty (AbstractName, Access)
   -&gt; (Suffix, NonEmpty (AbstractName, Access)))
-&gt; Maybe (NonEmpty (AbstractName, Access))
-&gt; Maybe (Suffix, NonEmpty (AbstractName, Access))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(AbstractName, Access)] -&gt; Maybe (NonEmpty (AbstractName, Access))
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><span class="hs-identifier hs-var">nonEmpty</span></span><span> </span><span class="annot"><span class="annottext">[(AbstractName, Access)]
</span><a href="#local-6989586621680700831"><span class="hs-identifier hs-var">possibleBaseNames</span></a></span><span>
</span><span id="line-351"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(AbstractName, Access)] -&gt; Maybe (NonEmpty (AbstractName, Access))
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><span class="hs-identifier hs-var">nonEmpty</span></span><span> </span><span class="annot"><span class="annottext">([(AbstractName, Access)]
 -&gt; Maybe (NonEmpty (AbstractName, Access)))
-&gt; [(AbstractName, Access)]
-&gt; Maybe (NonEmpty (AbstractName, Access))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [(AbstractName, Access)]
</span><a href="#local-6989586621680700840"><span class="hs-identifier hs-var">possibleNames</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700861"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-352"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680700828"><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700828"><span class="hs-identifier hs-var">ds</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700827"><span class="annot"><span class="annottext">ks :: NonEmpty (Maybe Induction)
</span><a href="#local-6989586621680700827"><span class="hs-identifier hs-var hs-var">ks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((AbstractName, Access) -&gt; Maybe Induction)
-&gt; NonEmpty (AbstractName, Access) -&gt; NonEmpty (Maybe Induction)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindOfName -&gt; Maybe Induction
</span><a href="Agda.Syntax.Scope.Base.html#isConName"><span class="hs-identifier hs-var">isConName</span></a></span><span> </span><span class="annot"><span class="annottext">(KindOfName -&gt; Maybe Induction)
-&gt; ((AbstractName, Access) -&gt; KindOfName)
-&gt; (AbstractName, Access)
-&gt; Maybe Induction
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#anameKind"><span class="hs-identifier hs-var hs-var">anameKind</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; KindOfName)
-&gt; ((AbstractName, Access) -&gt; AbstractName)
-&gt; (AbstractName, Access)
-&gt; KindOfName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName, Access) -&gt; AbstractName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700828"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-353"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Maybe Induction -&gt; Bool) -&gt; NonEmpty (Maybe Induction) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Maybe Induction -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Maybe Induction)
</span><a href="#local-6989586621680700827"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-354"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access))
</span><a href="#local-6989586621680700830"><span class="hs-identifier hs-var">suffixedNames</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-355"></span><span>          </span><span class="annot"><span class="annottext">ResolvedName -&gt; m ResolvedName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ResolvedName -&gt; m ResolvedName) -&gt; ResolvedName -&gt; m ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Induction -&gt; List1 AbstractName -&gt; ResolvedName
</span><a href="Agda.Syntax.Scope.Base.html#ConstructorName"><span class="hs-identifier hs-var">ConstructorName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Induction] -&gt; Set Induction
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Induction] -&gt; Set Induction) -&gt; [Induction] -&gt; Set Induction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Maybe Induction) -&gt; [Induction]
forall a. List1 (Maybe a) -&gt; [a]
</span><a href="Agda.Utils.List1.html#catMaybes"><span class="hs-identifier hs-var">List1.catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Maybe Induction)
</span><a href="#local-6989586621680700827"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(List1 AbstractName -&gt; ResolvedName)
-&gt; List1 AbstractName -&gt; ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((AbstractName, Access) -&gt; AbstractName)
-&gt; NonEmpty (AbstractName, Access) -&gt; List1 AbstractName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractName -&gt; AbstractName
</span><a href="#local-6989586621680700820"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; AbstractName)
-&gt; ((AbstractName, Access) -&gt; AbstractName)
-&gt; (AbstractName, Access)
-&gt; AbstractName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName, Access) -&gt; AbstractName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700828"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680700819"><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700819"><span class="hs-identifier hs-var">ds</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">((AbstractName, Access) -&gt; Bool)
-&gt; NonEmpty (AbstractName, Access) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#FldName"><span class="hs-identifier hs-var">FldName</span></a></span><span> </span><span class="annot"><span class="annottext">KindOfName -&gt; KindOfName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KindOfName -&gt; Bool)
-&gt; ((AbstractName, Access) -&gt; KindOfName)
-&gt; (AbstractName, Access)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#anameKind"><span class="hs-identifier hs-var hs-var">anameKind</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; KindOfName)
-&gt; ((AbstractName, Access) -&gt; AbstractName)
-&gt; (AbstractName, Access)
-&gt; KindOfName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName, Access) -&gt; AbstractName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700819"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access))
</span><a href="#local-6989586621680700830"><span class="hs-identifier hs-var">suffixedNames</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-358"></span><span>          </span><span class="annot"><span class="annottext">ResolvedName -&gt; m ResolvedName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ResolvedName -&gt; m ResolvedName) -&gt; ResolvedName -&gt; m ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 AbstractName -&gt; ResolvedName
</span><a href="Agda.Syntax.Scope.Base.html#FieldName"><span class="hs-identifier hs-var">FieldName</span></a></span><span> </span><span class="annot"><span class="annottext">(List1 AbstractName -&gt; ResolvedName)
-&gt; List1 AbstractName -&gt; ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((AbstractName, Access) -&gt; AbstractName)
-&gt; NonEmpty (AbstractName, Access) -&gt; List1 AbstractName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractName -&gt; AbstractName
</span><a href="#local-6989586621680700820"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; AbstractName)
-&gt; ((AbstractName, Access) -&gt; AbstractName)
-&gt; (AbstractName, Access)
-&gt; AbstractName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName, Access) -&gt; AbstractName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700819"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680700816"><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700816"><span class="hs-identifier hs-var">ds</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">((AbstractName, Access) -&gt; Bool)
-&gt; NonEmpty (AbstractName, Access) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#PatternSynName"><span class="hs-identifier hs-var">PatternSynName</span></a></span><span> </span><span class="annot"><span class="annottext">KindOfName -&gt; KindOfName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KindOfName -&gt; Bool)
-&gt; ((AbstractName, Access) -&gt; KindOfName)
-&gt; (AbstractName, Access)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#anameKind"><span class="hs-identifier hs-var hs-var">anameKind</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; KindOfName)
-&gt; ((AbstractName, Access) -&gt; AbstractName)
-&gt; (AbstractName, Access)
-&gt; KindOfName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName, Access) -&gt; AbstractName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700816"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access))
</span><a href="#local-6989586621680700830"><span class="hs-identifier hs-var">suffixedNames</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-361"></span><span>          </span><span class="annot"><span class="annottext">ResolvedName -&gt; m ResolvedName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ResolvedName -&gt; m ResolvedName) -&gt; ResolvedName -&gt; m ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 AbstractName -&gt; ResolvedName
</span><a href="Agda.Syntax.Scope.Base.html#PatternSynResName"><span class="hs-identifier hs-var">PatternSynResName</span></a></span><span> </span><span class="annot"><span class="annottext">(List1 AbstractName -&gt; ResolvedName)
-&gt; List1 AbstractName -&gt; ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((AbstractName, Access) -&gt; AbstractName)
-&gt; NonEmpty (AbstractName, Access) -&gt; List1 AbstractName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractName -&gt; AbstractName
</span><a href="#local-6989586621680700820"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; AbstractName)
-&gt; ((AbstractName, Access) -&gt; AbstractName)
-&gt; (AbstractName, Access)
-&gt; AbstractName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName, Access) -&gt; AbstractName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700816"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680700813"><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700813"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700812"><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700812"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access))
</span><a href="#local-6989586621680700830"><span class="hs-identifier hs-var">suffixedNames</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-364"></span><span>          </span><span class="annot"><span class="annottext">ResolvedName -&gt; m ResolvedName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ResolvedName -&gt; m ResolvedName) -&gt; ResolvedName -&gt; m ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Access -&gt; AbstractName -&gt; Suffix -&gt; ResolvedName
</span><a href="Agda.Syntax.Scope.Base.html#DefinedName"><span class="hs-identifier hs-var">DefinedName</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700812"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractName -&gt; AbstractName
</span><a href="#local-6989586621680700820"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700813"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Suffix
</span><a href="Agda.Syntax.Abstract.Name.html#NoSuffix"><span class="hs-identifier hs-var">A.NoSuffix</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680700809"><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700809"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">List1 QName -&gt; m ResolvedName
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(List1 QName -&gt; m ResolvedName) -&gt; List1 QName -&gt; m ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((AbstractName, Access) -&gt; QName)
-&gt; NonEmpty (AbstractName, Access) -&gt; List1 QName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var hs-var">anameName</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; QName)
-&gt; ((AbstractName, Access) -&gt; AbstractName)
-&gt; (AbstractName, Access)
-&gt; QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName, Access) -&gt; AbstractName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NonEmpty (AbstractName, Access) -&gt; List1 QName)
-&gt; NonEmpty (AbstractName, Access) -&gt; List1 QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access))
-&gt; (NonEmpty (AbstractName, Access)
    -&gt; NonEmpty (AbstractName, Access))
-&gt; ((Suffix, NonEmpty (AbstractName, Access))
    -&gt; NonEmpty (AbstractName, Access)
    -&gt; NonEmpty (AbstractName, Access))
-&gt; NonEmpty (AbstractName, Access)
-&gt; NonEmpty (AbstractName, Access)
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access))
</span><a href="#local-6989586621680700830"><span class="hs-identifier hs-var">suffixedNames</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access) -&gt; NonEmpty (AbstractName, Access)
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
-&gt; NonEmpty (AbstractName, Access)
-&gt; NonEmpty (AbstractName, Access)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (AbstractName, Access)
 -&gt; NonEmpty (AbstractName, Access)
 -&gt; NonEmpty (AbstractName, Access))
-&gt; ((Suffix, NonEmpty (AbstractName, Access))
    -&gt; NonEmpty (AbstractName, Access))
-&gt; (Suffix, NonEmpty (AbstractName, Access))
-&gt; NonEmpty (AbstractName, Access)
-&gt; NonEmpty (AbstractName, Access)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Suffix, NonEmpty (AbstractName, Access))
-&gt; NonEmpty (AbstractName, Access)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700809"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span>        </span><span class="annot"><span class="annottext">Maybe (NonEmpty (AbstractName, Access))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access))
</span><a href="#local-6989586621680700830"><span class="hs-identifier hs-var">suffixedNames</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-369"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Suffix, NonEmpty (AbstractName, Access))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResolvedName -&gt; m ResolvedName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ResolvedName
</span><a href="Agda.Syntax.Scope.Base.html#UnknownName"><span class="hs-identifier hs-var">UnknownName</span></a></span><span>
</span><span id="line-370"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700807"><span class="annot"><span class="annottext">Suffix
</span><a href="#local-6989586621680700807"><span class="hs-identifier hs-var">suffix</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700806"><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700806"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700805"><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700805"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResolvedName -&gt; m ResolvedName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ResolvedName -&gt; m ResolvedName) -&gt; ResolvedName -&gt; m ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Access -&gt; AbstractName -&gt; Suffix -&gt; ResolvedName
</span><a href="Agda.Syntax.Scope.Base.html#DefinedName"><span class="hs-identifier hs-var">DefinedName</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700805"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractName -&gt; AbstractName
</span><a href="#local-6989586621680700820"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700806"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Suffix
</span><a href="#local-6989586621680700807"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-371"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700804"><span class="annot"><span class="annottext">Suffix
</span><a href="#local-6989586621680700804"><span class="hs-identifier hs-var">suffix</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700803"><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700803"><span class="hs-identifier hs-var">sds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">List1 QName -&gt; m ResolvedName
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(List1 QName -&gt; m ResolvedName) -&gt; List1 QName -&gt; m ResolvedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((AbstractName, Access) -&gt; QName)
-&gt; NonEmpty (AbstractName, Access) -&gt; List1 QName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var hs-var">anameName</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; QName)
-&gt; ((AbstractName, Access) -&gt; AbstractName)
-&gt; (AbstractName, Access)
-&gt; QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName, Access) -&gt; AbstractName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (AbstractName, Access)
</span><a href="#local-6989586621680700803"><span class="hs-identifier hs-var">sds</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-comment">-- @names@ intended semantics: a filter on names.</span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-comment">-- @Nothing@: don't filter out anything.</span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-comment">-- @Just ns@: filter by membership in @ns@.</span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><a href="#local-6989586621680700851"><span class="hs-identifier hs-type">filterNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680701349"><span class="annot"><a href="#local-6989586621680701349"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680701349"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractName"><span class="hs-identifier hs-type">AbstractName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680701349"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680701349"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-378"></span><span>  </span><span id="local-6989586621680700851"><span class="annot"><span class="annottext">filterNames :: (a -&gt; AbstractName) -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621680700851"><span class="hs-identifier hs-var hs-var">filterNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Set Name)
</span><a href="#local-6989586621680700862"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-379"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Set Name)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700802"><span class="annot"><span class="annottext">a -&gt; AbstractName
</span><a href="#local-6989586621680700802"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-380"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680700801"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680700801"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700800"><span class="annot"><span class="annottext">a -&gt; AbstractName
</span><a href="#local-6989586621680700800"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; [a] -&gt; [a]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">((a -&gt; Bool) -&gt; [a] -&gt; [a]) -&gt; (a -&gt; Bool) -&gt; [a] -&gt; [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Set Name -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680700801"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; (a -&gt; Name) -&gt; a -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var hs-var">A.qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Name) -&gt; (a -&gt; QName) -&gt; a -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var hs-var">anameName</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; QName) -&gt; (a -&gt; AbstractName) -&gt; a -&gt; QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; AbstractName
</span><a href="#local-6989586621680700800"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-comment">-- lambda-dropped style by intention</span><span>
</span><span id="line-382"></span><span>  </span><span id="local-6989586621680700820"><span class="annot"><span class="annottext">upd :: AbstractName -&gt; AbstractName
</span><a href="#local-6989586621680700820"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span id="local-6989586621680700798"><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700798"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; Name -&gt; AbstractName
</span><a href="#local-6989586621680700797"><span class="hs-identifier hs-var">updateConcreteName</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700798"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; AbstractName) -&gt; Name -&gt; AbstractName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Concrete.Name.html#unqualify"><span class="hs-identifier hs-var">unqualify</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700861"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span class="annot"><a href="#local-6989586621680700797"><span class="hs-identifier hs-type">updateConcreteName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractName"><span class="hs-identifier hs-type">AbstractName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractName"><span class="hs-identifier hs-type">AbstractName</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span id="local-6989586621680700797"><span class="annot"><span class="annottext">updateConcreteName :: AbstractName -&gt; Name -&gt; AbstractName
</span><a href="#local-6989586621680700797"><span class="hs-identifier hs-var hs-var">updateConcreteName</span></a></span></span><span> </span><span id="local-6989586621680700796"><span class="annot"><span class="annottext">d :: AbstractName
</span><a href="#local-6989586621680700796"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbsName"><span class="hs-identifier hs-type">AbsName</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">anameName :: AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var">anameName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span> </span><span id="local-6989586621680700793"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700793"><span class="hs-identifier hs-var">qm</span></a></span></span><span> </span><span id="local-6989586621680700792"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700792"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680700791"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700791"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700796"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">anameName :: QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var">anameName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Name -&gt; QName
</span><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-var">A.QName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; ModuleName -&gt; ModuleName
forall a. SetRange a =&gt; Range -&gt; a -&gt; a
</span><a href="Agda.Syntax.Position.html#setRange"><span class="hs-identifier hs-var">setRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700791"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700793"><span class="hs-identifier hs-var">qm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700792"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nameConcrete :: Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">nameConcrete</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700791"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-386"></span><span>  </span><span id="local-6989586621680700829"><span class="annot"><span class="annottext">fromConcreteSuffix :: Maybe Suffix -&gt; Maybe Suffix
</span><a href="#local-6989586621680700829"><span class="hs-identifier hs-var hs-var">fromConcreteSuffix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><span class="annottext">Maybe Suffix
</span><span class="hs-identifier hs-var">Nothing</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Suffix
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-388"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Agda.Utils.Suffix.html#Prime"><span class="hs-identifier hs-type">C.Prime</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Suffix
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-389"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Suffix.html#Index"><span class="hs-identifier hs-type">C.Index</span></a></span><span> </span><span id="local-6989586621680700788"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680700788"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Suffix -&gt; Maybe Suffix
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Suffix -&gt; Maybe Suffix) -&gt; Suffix -&gt; Maybe Suffix
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Suffix
</span><a href="Agda.Syntax.Abstract.Name.html#Suffix"><span class="hs-identifier hs-var">A.Suffix</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Suffix) -&gt; Integer -&gt; Suffix
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680700788"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Suffix.html#Subscript"><span class="hs-identifier hs-type">C.Subscript</span></a></span><span> </span><span id="local-6989586621680700785"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680700785"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Suffix -&gt; Maybe Suffix
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Suffix -&gt; Maybe Suffix) -&gt; Suffix -&gt; Maybe Suffix
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Suffix
</span><a href="Agda.Syntax.Abstract.Name.html#Suffix"><span class="hs-identifier hs-var">A.Suffix</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Suffix) -&gt; Integer -&gt; Suffix
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680700785"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="hs-comment">-- | Test if a given abstract name can appear with a suffix. Currently</span><span>
</span><span id="line-393"></span><span class="hs-comment">--   only true for the names of builtin sorts @Set@ and @Prop@.</span><span>
</span><span id="line-394"></span><span id="local-6989586621680701336"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#canHaveSuffixTest"><span class="hs-identifier hs-type">canHaveSuffixTest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#HasBuiltins"><span class="hs-identifier hs-type">HasBuiltins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701336"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701336"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-395"></span><span id="canHaveSuffixTest"><span class="annot"><span class="annottext">canHaveSuffixTest :: m (QName -&gt; Bool)
</span><a href="Agda.Syntax.Scope.Monad.html#canHaveSuffixTest"><span class="hs-identifier hs-var hs-var">canHaveSuffixTest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-396"></span><span>  </span><span id="local-6989586621680700784"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621680700784"><span class="hs-identifier hs-var">builtinSet</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; m (Maybe QName)
forall (m :: * -&gt; *). HasBuiltins m =&gt; String -&gt; m (Maybe QName)
</span><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltinName%27"><span class="hs-identifier hs-var">getBuiltinName'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Agda.Syntax.Builtin.html#builtinSet"><span class="hs-identifier hs-var">builtinSet</span></a></span><span>
</span><span id="line-397"></span><span>  </span><span id="local-6989586621680700783"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621680700783"><span class="hs-identifier hs-var">builtinProp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; m (Maybe QName)
forall (m :: * -&gt; *). HasBuiltins m =&gt; String -&gt; m (Maybe QName)
</span><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltinName%27"><span class="hs-identifier hs-var">getBuiltinName'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Agda.Syntax.Builtin.html#builtinProp"><span class="hs-identifier hs-var">builtinProp</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span id="local-6989586621680700782"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621680700782"><span class="hs-identifier hs-var">builtinSetOmega</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; m (Maybe QName)
forall (m :: * -&gt; *). HasBuiltins m =&gt; String -&gt; m (Maybe QName)
</span><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltinName%27"><span class="hs-identifier hs-var">getBuiltinName'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Agda.Syntax.Builtin.html#builtinSetOmega"><span class="hs-identifier hs-var">builtinSetOmega</span></a></span><span>
</span><span id="line-399"></span><span>  </span><span id="local-6989586621680700781"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621680700781"><span class="hs-identifier hs-var">builtinSSetOmega</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; m (Maybe QName)
forall (m :: * -&gt; *). HasBuiltins m =&gt; String -&gt; m (Maybe QName)
</span><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltinName%27"><span class="hs-identifier hs-var">getBuiltinName'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Agda.Syntax.Builtin.html#builtinSSetOmega"><span class="hs-identifier hs-var">builtinSSetOmega</span></a></span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="annottext">(QName -&gt; Bool) -&gt; m (QName -&gt; Bool)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((QName -&gt; Bool) -&gt; m (QName -&gt; Bool))
-&gt; (QName -&gt; Bool) -&gt; m (QName -&gt; Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680700780"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700780"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700780"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; [Maybe QName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621680700784"><span class="hs-identifier hs-var">builtinSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621680700783"><span class="hs-identifier hs-var">builtinProp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621680700782"><span class="hs-identifier hs-var">builtinSetOmega</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621680700781"><span class="hs-identifier hs-var">builtinSSetOmega</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="hs-comment">-- | Look up a module in the scope.</span><span>
</span><span id="line-403"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#resolveModule"><span class="hs-identifier hs-type">resolveModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractModule"><span class="hs-identifier hs-type">AbstractModule</span></a></span><span>
</span><span id="line-404"></span><span id="resolveModule"><span class="annot"><span class="annottext">resolveModule :: QName -&gt; ScopeM AbstractModule
</span><a href="Agda.Syntax.Scope.Monad.html#resolveModule"><span class="hs-identifier hs-var hs-var">resolveModule</span></a></span></span><span> </span><span id="local-6989586621680700777"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700777"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>  </span><span id="local-6989586621680700776"><span class="annot"><span class="annottext">[AbstractModule]
</span><a href="#local-6989586621680700776"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; ScopeInfo -&gt; [AbstractModule]
forall a. InScope a =&gt; QName -&gt; ScopeInfo -&gt; [a]
</span><a href="Agda.Syntax.Scope.Base.html#scopeLookup"><span class="hs-identifier hs-var">scopeLookup</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700777"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; [AbstractModule])
-&gt; TCMT IO ScopeInfo -&gt; TCMT IO [AbstractModule]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO ScopeInfo
forall (m :: * -&gt; *). ReadTCState m =&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-var">getScope</span></a></span><span>
</span><span id="line-406"></span><span>  </span><span class="annot"><span class="annottext">Maybe (NonEmpty AbstractModule)
-&gt; ScopeM AbstractModule
-&gt; (NonEmpty AbstractModule -&gt; ScopeM AbstractModule)
-&gt; ScopeM AbstractModule
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[AbstractModule] -&gt; Maybe (NonEmpty AbstractModule)
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><span class="hs-identifier hs-var">nonEmpty</span></span><span> </span><span class="annot"><span class="annottext">[AbstractModule]
</span><a href="#local-6989586621680700776"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeError -&gt; ScopeM AbstractModule
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ScopeM AbstractModule)
-&gt; TypeError -&gt; ScopeM AbstractModule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#NoSuchModule"><span class="hs-identifier hs-var">NoSuchModule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700777"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((NonEmpty AbstractModule -&gt; ScopeM AbstractModule)
 -&gt; ScopeM AbstractModule)
-&gt; (NonEmpty AbstractModule -&gt; ScopeM AbstractModule)
-&gt; ScopeM AbstractModule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">case</span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbsModule"><span class="hs-identifier hs-type">AbsModule</span></a></span><span> </span><span id="local-6989586621680700772"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700772"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680700771"><span class="annot"><span class="annottext">WhyInScope
</span><a href="#local-6989586621680700771"><span class="hs-identifier hs-var">why</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AbstractModule -&gt; ScopeM AbstractModule
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(AbstractModule -&gt; ScopeM AbstractModule)
-&gt; AbstractModule -&gt; ScopeM AbstractModule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; WhyInScope -&gt; AbstractModule
</span><a href="Agda.Syntax.Scope.Base.html#AbsModule"><span class="hs-identifier hs-var">AbsModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700772"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; QName -&gt; ModuleName
forall t u. (SetRange t, HasRange u) =&gt; t -&gt; u -&gt; t
</span><a href="Agda.Syntax.Position.html#withRangeOf"><span class="hs-operator hs-var">`withRangeOf`</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700777"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WhyInScope
</span><a href="#local-6989586621680700771"><span class="hs-identifier hs-var">why</span></a></span><span>
</span><span id="line-408"></span><span>    </span><span id="local-6989586621680700769"><span class="annot"><span class="annottext">NonEmpty AbstractModule
</span><a href="#local-6989586621680700769"><span class="hs-identifier hs-var">ms</span></a></span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ScopeM AbstractModule
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ScopeM AbstractModule)
-&gt; TypeError -&gt; ScopeM AbstractModule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; List1 ModuleName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#AmbiguousModule"><span class="hs-identifier hs-var">AmbiguousModule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700777"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AbstractModule -&gt; ModuleName)
-&gt; NonEmpty AbstractModule -&gt; List1 ModuleName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">AbstractModule -&gt; ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#amodName"><span class="hs-identifier hs-var hs-var">amodName</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty AbstractModule
</span><a href="#local-6989586621680700769"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-comment">-- | Get the fixity of a not yet bound name.</span><span>
</span><span id="line-411"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#getConcreteFixity"><span class="hs-identifier hs-type">getConcreteFixity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Fixity%27"><span class="hs-identifier hs-type">Fixity'</span></a></span><span>
</span><span id="line-412"></span><span id="getConcreteFixity"><span class="annot"><span class="annottext">getConcreteFixity :: Name -&gt; ScopeM Fixity'
</span><a href="Agda.Syntax.Scope.Monad.html#getConcreteFixity"><span class="hs-identifier hs-var hs-var">getConcreteFixity</span></a></span></span><span> </span><span id="local-6989586621680700766"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700766"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Fixity' -&gt; Name -&gt; Map Name Fixity' -&gt; Fixity'
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">Map.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">Fixity'
</span><a href="Agda.Syntax.Common.html#noFixity%27"><span class="hs-identifier hs-var">noFixity'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700766"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name Fixity' -&gt; Fixity')
-&gt; TCMT IO (Map Name Fixity') -&gt; ScopeM Fixity'
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' (Map Name Fixity') ScopeInfo -&gt; TCMT IO (Map Name Fixity')
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' a ScopeInfo -&gt; m a
</span><a href="Agda.TypeChecking.Monad.State.html#useScope"><span class="hs-identifier hs-var">useScope</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (Map Name Fixity') ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopeFixities"><span class="hs-identifier hs-var">scopeFixities</span></a></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="hs-comment">-- | Get the polarities of a not yet bound name.</span><span>
</span><span id="line-415"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#getConcretePolarity"><span class="hs-identifier hs-type">getConcretePolarity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.TypeChecking.Positivity.Occurrence.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span id="getConcretePolarity"><span class="annot"><span class="annottext">getConcretePolarity :: Name -&gt; ScopeM (Maybe [Occurrence])
</span><a href="Agda.Syntax.Scope.Monad.html#getConcretePolarity"><span class="hs-identifier hs-var hs-var">getConcretePolarity</span></a></span></span><span> </span><span id="local-6989586621680700763"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700763"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Map Name [Occurrence] -&gt; Maybe [Occurrence]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700763"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name [Occurrence] -&gt; Maybe [Occurrence])
-&gt; TCMT IO (Map Name [Occurrence]) -&gt; ScopeM (Maybe [Occurrence])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' (Map Name [Occurrence]) ScopeInfo
-&gt; TCMT IO (Map Name [Occurrence])
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' a ScopeInfo -&gt; m a
</span><a href="Agda.TypeChecking.Monad.State.html#useScope"><span class="hs-identifier hs-var">useScope</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (Map Name [Occurrence]) ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopePolarities"><span class="hs-identifier hs-var">scopePolarities</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Fixity.html#MonadFixityError"><span class="hs-identifier hs-type">MonadFixityError</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-419"></span><span>  </span><span id="local-6989586621680700753"><span class="annot"><span class="annottext">throwMultipleFixityDecls :: [(Name, [Fixity'])] -&gt; ScopeM a
</span><a href="Agda.Syntax.Concrete.Fixity.html#throwMultipleFixityDecls"><span class="hs-identifier hs-var hs-var hs-var hs-var">throwMultipleFixityDecls</span></a></span></span><span> </span><span id="local-6989586621680700751"><span class="annot"><span class="annottext">[(Name, [Fixity'])]
</span><a href="#local-6989586621680700751"><span class="hs-identifier hs-var">xs</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Name, [Fixity'])]
</span><a href="#local-6989586621680700751"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-420"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680700750"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700750"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Fixity']
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(Name, [Fixity'])]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Range -&gt; ScopeM a -&gt; ScopeM a
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700750"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeM a -&gt; ScopeM a) -&gt; ScopeM a -&gt; ScopeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ScopeM a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ScopeM a) -&gt; TypeError -&gt; ScopeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Name, [Fixity'])] -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#MultipleFixityDecls"><span class="hs-identifier hs-var">MultipleFixityDecls</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, [Fixity'])]
</span><a href="#local-6989586621680700751"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeM a
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span id="local-6989586621680700747"><span class="annot"><span class="annottext">throwMultiplePolarityPragmas :: [Name] -&gt; ScopeM a
</span><a href="Agda.Syntax.Concrete.Fixity.html#throwMultiplePolarityPragmas"><span class="hs-identifier hs-var hs-var hs-var hs-var">throwMultiplePolarityPragmas</span></a></span></span><span> </span><span id="local-6989586621680700745"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680700745"><span class="hs-identifier hs-var">xs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680700745"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-423"></span><span>    </span><span id="local-6989586621680700744"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700744"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Range -&gt; ScopeM a -&gt; ScopeM a
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700744"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeM a -&gt; ScopeM a) -&gt; ScopeM a -&gt; ScopeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ScopeM a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ScopeM a) -&gt; TypeError -&gt; ScopeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#MultiplePolarityPragmas"><span class="hs-identifier hs-var">MultiplePolarityPragmas</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680700745"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeM a
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-425"></span><span>  </span><span id="local-6989586621680700742"><span class="annot"><span class="annottext">warnUnknownNamesInFixityDecl :: [Name] -&gt; ScopeM ()
</span><a href="Agda.Syntax.Concrete.Fixity.html#warnUnknownNamesInFixityDecl"><span class="hs-identifier hs-var hs-var hs-var hs-var">warnUnknownNamesInFixityDecl</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; DeclarationWarning' -&gt; ScopeM ()
DeclarationWarning' -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#scopeWarning"><span class="hs-identifier hs-var">scopeWarning</span></a></span><span> </span><span class="annot"><span class="annottext">(DeclarationWarning' -&gt; ScopeM ())
-&gt; ([Name] -&gt; DeclarationWarning') -&gt; [Name] -&gt; ScopeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; DeclarationWarning'
</span><a href="Agda.Syntax.Concrete.Definitions.Errors.html#UnknownNamesInFixityDecl"><span class="hs-identifier hs-var">UnknownNamesInFixityDecl</span></a></span><span>
</span><span id="line-426"></span><span>  </span><span id="local-6989586621680700739"><span class="annot"><span class="annottext">warnUnknownNamesInPolarityPragmas :: [Name] -&gt; ScopeM ()
</span><a href="Agda.Syntax.Concrete.Fixity.html#warnUnknownNamesInPolarityPragmas"><span class="hs-identifier hs-var hs-var hs-var hs-var">warnUnknownNamesInPolarityPragmas</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; DeclarationWarning' -&gt; ScopeM ()
DeclarationWarning' -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#scopeWarning"><span class="hs-identifier hs-var">scopeWarning</span></a></span><span> </span><span class="annot"><span class="annottext">(DeclarationWarning' -&gt; ScopeM ())
-&gt; ([Name] -&gt; DeclarationWarning') -&gt; [Name] -&gt; ScopeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; DeclarationWarning'
</span><a href="Agda.Syntax.Concrete.Definitions.Errors.html#UnknownNamesInPolarityPragmas"><span class="hs-identifier hs-var">UnknownNamesInPolarityPragmas</span></a></span><span>
</span><span id="line-427"></span><span>  </span><span id="local-6989586621680700736"><span class="annot"><span class="annottext">warnUnknownFixityInMixfixDecl :: [Name] -&gt; ScopeM ()
</span><a href="Agda.Syntax.Concrete.Fixity.html#warnUnknownFixityInMixfixDecl"><span class="hs-identifier hs-var hs-var hs-var hs-var">warnUnknownFixityInMixfixDecl</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; DeclarationWarning' -&gt; ScopeM ()
DeclarationWarning' -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#scopeWarning"><span class="hs-identifier hs-var">scopeWarning</span></a></span><span> </span><span class="annot"><span class="annottext">(DeclarationWarning' -&gt; ScopeM ())
-&gt; ([Name] -&gt; DeclarationWarning') -&gt; [Name] -&gt; ScopeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; DeclarationWarning'
</span><a href="Agda.Syntax.Concrete.Definitions.Errors.html#UnknownFixityInMixfixDecl"><span class="hs-identifier hs-var">UnknownFixityInMixfixDecl</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span id="local-6989586621680700733"><span class="annot"><span class="annottext">warnPolarityPragmasButNotPostulates :: [Name] -&gt; ScopeM ()
</span><a href="Agda.Syntax.Concrete.Fixity.html#warnPolarityPragmasButNotPostulates"><span class="hs-identifier hs-var hs-var hs-var hs-var">warnPolarityPragmasButNotPostulates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; DeclarationWarning' -&gt; ScopeM ()
DeclarationWarning' -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#scopeWarning"><span class="hs-identifier hs-var">scopeWarning</span></a></span><span> </span><span class="annot"><span class="annottext">(DeclarationWarning' -&gt; ScopeM ())
-&gt; ([Name] -&gt; DeclarationWarning') -&gt; [Name] -&gt; ScopeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; DeclarationWarning'
</span><a href="Agda.Syntax.Concrete.Definitions.Errors.html#PolarityPragmasButNotPostulates"><span class="hs-identifier hs-var">PolarityPragmasButNotPostulates</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="hs-comment">-- | Collect the fixity/syntax declarations and polarity pragmas from the list</span><span>
</span><span id="line-431"></span><span class="hs-comment">--   of declarations and store them in the scope.</span><span>
</span><span id="line-432"></span><span id="local-6989586621680700730"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#computeFixitiesAndPolarities"><span class="hs-identifier hs-type">computeFixitiesAndPolarities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Fixity.html#DoWarn"><span class="hs-identifier hs-type">DoWarn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.html#Declaration"><span class="hs-identifier hs-type">C.Declaration</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700730"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700730"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-433"></span><span id="computeFixitiesAndPolarities"><span class="annot"><span class="annottext">computeFixitiesAndPolarities :: DoWarn -&gt; [Declaration] -&gt; ScopeM a -&gt; ScopeM a
</span><a href="Agda.Syntax.Scope.Monad.html#computeFixitiesAndPolarities"><span class="hs-identifier hs-var hs-var">computeFixitiesAndPolarities</span></a></span></span><span> </span><span id="local-6989586621680700728"><span class="annot"><span class="annottext">DoWarn
</span><a href="#local-6989586621680700728"><span class="hs-identifier hs-var">warn</span></a></span></span><span> </span><span id="local-6989586621680700727"><span class="annot"><span class="annottext">[Declaration]
</span><a href="#local-6989586621680700727"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621680700726"><span class="annot"><span class="annottext">ScopeM a
</span><a href="#local-6989586621680700726"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>  </span><span id="local-6989586621680700725"><span class="annot"><span class="annottext">(Map Name Fixity', Map Name [Occurrence])
</span><a href="#local-6989586621680700725"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DoWarn
-&gt; [Declaration]
-&gt; TCMT IO (Map Name Fixity', Map Name [Occurrence])
forall (m :: * -&gt; *).
MonadFixityError m =&gt;
DoWarn
-&gt; [Declaration] -&gt; m (Map Name Fixity', Map Name [Occurrence])
</span><a href="Agda.Syntax.Concrete.Fixity.html#fixitiesAndPolarities"><span class="hs-identifier hs-var">fixitiesAndPolarities</span></a></span><span> </span><span class="annot"><span class="annottext">DoWarn
</span><a href="#local-6989586621680700728"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">[Declaration]
</span><a href="#local-6989586621680700727"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-comment">-- Andreas, 2019-08-16:</span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-comment">-- Since changing fixities and polarities does not affect the name sets,</span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-comment">-- we do not need to invoke @modifyScope@ here</span><span>
</span><span id="line-438"></span><span>  </span><span class="hs-comment">-- (which does @recomputeInverseScopeMaps@).</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-comment">-- A simple @locallyScope@ is sufficient.</span><span>
</span><span id="line-440"></span><span>  </span><span class="annot"><span class="annottext">Lens' (Map Name Fixity', Map Name [Occurrence]) ScopeInfo
-&gt; ((Map Name Fixity', Map Name [Occurrence])
    -&gt; (Map Name Fixity', Map Name [Occurrence]))
-&gt; ScopeM a
-&gt; ScopeM a
forall (m :: * -&gt; *) a b.
ReadTCState m =&gt;
Lens' a ScopeInfo -&gt; (a -&gt; a) -&gt; m b -&gt; m b
</span><a href="Agda.TypeChecking.Monad.State.html#locallyScope"><span class="hs-identifier hs-var">locallyScope</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (Map Name Fixity', Map Name [Occurrence]) ScopeInfo
</span><a href="Agda.Syntax.Scope.Base.html#scopeFixitiesAndPolarities"><span class="hs-identifier hs-var">scopeFixitiesAndPolarities</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name Fixity', Map Name [Occurrence])
-&gt; (Map Name Fixity', Map Name [Occurrence])
-&gt; (Map Name Fixity', Map Name [Occurrence])
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Map Name Fixity', Map Name [Occurrence])
</span><a href="#local-6989586621680700725"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeM a
</span><a href="#local-6989586621680700726"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="hs-comment">-- | Get the notation of a name. The name is assumed to be in scope.</span><span>
</span><span id="line-443"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#getNotation"><span class="hs-identifier hs-type">getNotation</span></a></span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">A.Name</span></a></span><span>
</span><span id="line-446"></span><span>     </span><span class="hs-comment">-- ^ The name must correspond to one of the names in this set.</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Notation.html#NewNotation"><span class="hs-identifier hs-type">NewNotation</span></a></span><span>
</span><span id="line-448"></span><span id="getNotation"><span class="annot"><span class="annottext">getNotation :: QName -&gt; Set Name -&gt; ScopeM NewNotation
</span><a href="Agda.Syntax.Scope.Monad.html#getNotation"><span class="hs-identifier hs-var hs-var">getNotation</span></a></span></span><span> </span><span id="local-6989586621680700720"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700720"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700719"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680700719"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-449"></span><span>  </span><span id="local-6989586621680700718"><span class="annot"><span class="annottext">ResolvedName
</span><a href="#local-6989586621680700718"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">KindsOfNames -&gt; Maybe (Set Name) -&gt; QName -&gt; ScopeM ResolvedName
</span><a href="Agda.Syntax.Scope.Monad.html#resolveName%27"><span class="hs-identifier hs-var">resolveName'</span></a></span><span> </span><span class="annot"><span class="annottext">KindsOfNames
</span><a href="Agda.Syntax.Scope.Base.html#allKindsOfNames"><span class="hs-identifier hs-var">allKindsOfNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Name -&gt; Maybe (Set Name)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680700719"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700720"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ResolvedName
</span><a href="#local-6989586621680700718"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-451"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span> </span><span id="local-6989586621680700717"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700717"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="annot"><span class="annottext">BindingSource
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NewNotation -&gt; ScopeM NewNotation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NewNotation -&gt; ScopeM NewNotation)
-&gt; NewNotation -&gt; ScopeM NewNotation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name -&gt; NewNotation
</span><a href="Agda.Syntax.Notation.html#namesToNotation"><span class="hs-identifier hs-var">namesToNotation</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700720"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700717"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-452"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#DefinedName"><span class="hs-identifier hs-type">DefinedName</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680700715"><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700715"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">Suffix
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NewNotation -&gt; ScopeM NewNotation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NewNotation -&gt; ScopeM NewNotation)
-&gt; NewNotation -&gt; ScopeM NewNotation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; NewNotation
</span><a href="#local-6989586621680700714"><span class="hs-identifier hs-var">notation</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700715"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-453"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span id="local-6989586621680700713"><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700713"><span class="hs-identifier hs-var">ds</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NewNotation -&gt; ScopeM NewNotation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NewNotation -&gt; ScopeM NewNotation)
-&gt; NewNotation -&gt; ScopeM NewNotation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 AbstractName -&gt; NewNotation
</span><a href="#local-6989586621680700712"><span class="hs-identifier hs-var">oneNotation</span></a></span><span> </span><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700713"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-454"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ConstructorName"><span class="hs-identifier hs-type">ConstructorName</span></a></span><span> </span><span class="annot"><span class="annottext">Set Induction
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680700711"><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700711"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NewNotation -&gt; ScopeM NewNotation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NewNotation -&gt; ScopeM NewNotation)
-&gt; NewNotation -&gt; ScopeM NewNotation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 AbstractName -&gt; NewNotation
</span><a href="#local-6989586621680700712"><span class="hs-identifier hs-var">oneNotation</span></a></span><span> </span><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700711"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-455"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#PatternSynResName"><span class="hs-identifier hs-type">PatternSynResName</span></a></span><span> </span><span id="local-6989586621680700710"><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700710"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NewNotation -&gt; ScopeM NewNotation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NewNotation -&gt; ScopeM NewNotation)
-&gt; NewNotation -&gt; ScopeM NewNotation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 AbstractName -&gt; NewNotation
</span><a href="#local-6989586621680700712"><span class="hs-identifier hs-var">oneNotation</span></a></span><span> </span><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700710"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-456"></span><span>    </span><span class="annot"><span class="annottext">ResolvedName
</span><a href="Agda.Syntax.Scope.Base.html#UnknownName"><span class="hs-identifier hs-var">UnknownName</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeM NewNotation
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621680700714"><span class="annot"><span class="annottext">notation :: AbstractName -&gt; NewNotation
</span><a href="#local-6989586621680700714"><span class="hs-identifier hs-var hs-var">notation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name -&gt; NewNotation
</span><a href="Agda.Syntax.Notation.html#namesToNotation"><span class="hs-identifier hs-var">namesToNotation</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700720"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; NewNotation)
-&gt; (AbstractName -&gt; Name) -&gt; AbstractName -&gt; NewNotation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Name) -&gt; (AbstractName -&gt; QName) -&gt; AbstractName -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var hs-var">anameName</span></a></span><span>
</span><span id="line-459"></span><span>    </span><span id="local-6989586621680700712"><span class="annot"><span class="annottext">oneNotation :: List1 AbstractName -&gt; NewNotation
</span><a href="#local-6989586621680700712"><span class="hs-identifier hs-var hs-var">oneNotation</span></a></span></span><span> </span><span id="local-6989586621680700709"><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700709"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-460"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[NewNotation] -&gt; [NewNotation]
</span><a href="Agda.Syntax.Notation.html#mergeNotations"><span class="hs-identifier hs-var">mergeNotations</span></a></span><span> </span><span class="annot"><span class="annottext">([NewNotation] -&gt; [NewNotation]) -&gt; [NewNotation] -&gt; [NewNotation]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; NewNotation) -&gt; [AbstractName] -&gt; [NewNotation]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; NewNotation
</span><a href="#local-6989586621680700714"><span class="hs-identifier hs-var">notation</span></a></span><span> </span><span class="annot"><span class="annottext">([AbstractName] -&gt; [NewNotation])
-&gt; [AbstractName] -&gt; [NewNotation]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 AbstractName -&gt; [AbstractName]
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">List1.toList</span></span><span> </span><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700709"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-461"></span><span>        </span><span class="hs-special">[</span><span id="local-6989586621680700706"><span class="annot"><span class="annottext">NewNotation
</span><a href="#local-6989586621680700706"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NewNotation
</span><a href="#local-6989586621680700706"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-462"></span><span>        </span><span class="annot"><span class="annottext">[NewNotation]
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NewNotation
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- * Binding names</span><span>
</span><span id="line-466"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span class="hs-comment">-- | Bind a variable.</span><span>
</span><span id="line-469"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#bindVariable"><span class="hs-identifier hs-type">bindVariable</span></a></span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#BindingSource"><span class="hs-identifier hs-type">A.BindingSource</span></a></span><span> </span><span class="hs-comment">-- ^ @&#955;@, @&#928;@, @let@, ...?</span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span>          </span><span class="hs-comment">-- ^ Concrete name.</span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">A.Name</span></a></span><span>          </span><span class="hs-comment">-- ^ Abstract name.</span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span id="bindVariable"><span class="annot"><span class="annottext">bindVariable :: BindingSource -&gt; Name -&gt; Name -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#bindVariable"><span class="hs-identifier hs-var hs-var">bindVariable</span></a></span></span><span> </span><span id="local-6989586621680700704"><span class="annot"><span class="annottext">BindingSource
</span><a href="#local-6989586621680700704"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680700703"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700703"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700702"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700702"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocalVars -&gt; LocalVars) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyLocalVars"><span class="hs-identifier hs-var">modifyLocalVars</span></a></span><span> </span><span class="annot"><span class="annottext">((LocalVars -&gt; LocalVars) -&gt; ScopeM ())
-&gt; (LocalVars -&gt; LocalVars) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; LocalVar -&gt; LocalVars -&gt; LocalVars
forall k v. k -&gt; v -&gt; AssocList k v -&gt; AssocList k v
</span><a href="Agda.Utils.AssocList.html#insert"><span class="hs-identifier hs-var">AssocList.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700703"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(LocalVar -&gt; LocalVars -&gt; LocalVars)
-&gt; LocalVar -&gt; LocalVars -&gt; LocalVars
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; BindingSource -&gt; [AbstractName] -&gt; LocalVar
</span><a href="Agda.Syntax.Scope.Base.html#LocalVar"><span class="hs-identifier hs-var">LocalVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700702"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">BindingSource
</span><a href="#local-6989586621680700704"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="hs-comment">-- | Temporarily unbind a variable. Used for non-recursive lets.</span><span>
</span><span id="line-477"></span><span id="local-6989586621680700701"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#unbindVariable"><span class="hs-identifier hs-type">unbindVariable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700701"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680700701"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-478"></span><span id="unbindVariable"><span class="annot"><span class="annottext">unbindVariable :: Name -&gt; ScopeM a -&gt; ScopeM a
</span><a href="Agda.Syntax.Scope.Monad.html#unbindVariable"><span class="hs-identifier hs-var hs-var">unbindVariable</span></a></span></span><span> </span><span id="local-6989586621680700699"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700699"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO LocalVars
-&gt; (LocalVars -&gt; ScopeM ()) -&gt; ScopeM a -&gt; ScopeM a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a -&gt; (a -&gt; m ()) -&gt; m b -&gt; m b
</span><a href="Agda.Utils.Monad.html#bracket_"><span class="hs-identifier hs-var">bracket_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCMT IO LocalVars
forall (m :: * -&gt; *). ReadTCState m =&gt; m LocalVars
</span><a href="Agda.Syntax.Scope.Monad.html#getLocalVars"><span class="hs-identifier hs-var">getLocalVars</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO LocalVars -&gt; ScopeM () -&gt; TCMT IO LocalVars
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">(LocalVars -&gt; LocalVars) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyLocalVars"><span class="hs-identifier hs-var">modifyLocalVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LocalVars -&gt; LocalVars
forall k v. Eq k =&gt; k -&gt; AssocList k v -&gt; AssocList k v
</span><a href="Agda.Utils.AssocList.html#delete"><span class="hs-identifier hs-var">AssocList.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700699"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocalVars -&gt; LocalVars) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyLocalVars"><span class="hs-identifier hs-var">modifyLocalVars</span></a></span><span> </span><span class="annot"><span class="annottext">((LocalVars -&gt; LocalVars) -&gt; ScopeM ())
-&gt; (LocalVars -&gt; LocalVars -&gt; LocalVars) -&gt; LocalVars -&gt; ScopeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LocalVars -&gt; LocalVars -&gt; LocalVars
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="hs-comment">-- | Bind a defined name. Must not shadow anything.</span><span>
</span><span id="line-481"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#bindName"><span class="hs-identifier hs-type">bindName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Access"><span class="hs-identifier hs-type">Access</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#KindOfName"><span class="hs-identifier hs-type">KindOfName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span id="bindName"><span class="annot"><span class="annottext">bindName :: Access -&gt; KindOfName -&gt; Name -&gt; QName -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#bindName"><span class="hs-identifier hs-var hs-var">bindName</span></a></span></span><span> </span><span id="local-6989586621680700695"><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700695"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680700694"><span class="annot"><span class="annottext">KindOfName
</span><a href="#local-6989586621680700694"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621680700693"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700693"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700692"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700692"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Access -&gt; KindOfName -&gt; NameMetadata -&gt; Name -&gt; QName -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#bindName%27"><span class="hs-identifier hs-var">bindName'</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700695"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">KindOfName
</span><a href="#local-6989586621680700694"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">NameMetadata
</span><a href="Agda.Syntax.Scope.Base.html#NoMetadata"><span class="hs-identifier hs-var">NoMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700693"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700692"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#bindName%27"><span class="hs-identifier hs-type">bindName'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Access"><span class="hs-identifier hs-type">Access</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#KindOfName"><span class="hs-identifier hs-type">KindOfName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#NameMetadata"><span class="hs-identifier hs-type">NameMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span id="bindName%27"><span class="annot"><span class="annottext">bindName' :: Access -&gt; KindOfName -&gt; NameMetadata -&gt; Name -&gt; QName -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#bindName%27"><span class="hs-identifier hs-var hs-var">bindName'</span></a></span></span><span> </span><span id="local-6989586621680700689"><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700689"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680700688"><span class="annot"><span class="annottext">KindOfName
</span><a href="#local-6989586621680700688"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621680700687"><span class="annot"><span class="annottext">NameMetadata
</span><a href="#local-6989586621680700687"><span class="hs-identifier hs-var">meta</span></a></span></span><span> </span><span id="local-6989586621680700686"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700686"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700685"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700685"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Maybe TypeError) -&gt; (TypeError -&gt; ScopeM ()) -&gt; ScopeM ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Maybe a) -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJustM"><span class="hs-identifier hs-var">whenJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Access
-&gt; KindOfName
-&gt; NameMetadata
-&gt; Name
-&gt; QName
-&gt; TCMT IO (Maybe TypeError)
</span><a href="Agda.Syntax.Scope.Monad.html#bindName%27%27"><span class="hs-identifier hs-var">bindName''</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700689"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">KindOfName
</span><a href="#local-6989586621680700688"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">NameMetadata
</span><a href="#local-6989586621680700687"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700686"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700685"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ScopeM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="hs-comment">-- | Bind a name. Returns the 'TypeError' if exists, but does not throw it.</span><span>
</span><span id="line-488"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#bindName%27%27"><span class="hs-identifier hs-type">bindName''</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Access"><span class="hs-identifier hs-type">Access</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#KindOfName"><span class="hs-identifier hs-type">KindOfName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#NameMetadata"><span class="hs-identifier hs-type">NameMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span id="bindName%27%27"><span class="annot"><span class="annottext">bindName'' :: Access
-&gt; KindOfName
-&gt; NameMetadata
-&gt; Name
-&gt; QName
-&gt; TCMT IO (Maybe TypeError)
</span><a href="Agda.Syntax.Scope.Monad.html#bindName%27%27"><span class="hs-identifier hs-var hs-var">bindName''</span></a></span></span><span> </span><span id="local-6989586621680700682"><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700682"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680700681"><span class="annot"><span class="annottext">KindOfName
</span><a href="#local-6989586621680700681"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621680700680"><span class="annot"><span class="annottext">NameMetadata
</span><a href="#local-6989586621680700680"><span class="hs-identifier hs-var">meta</span></a></span></span><span> </span><span id="local-6989586621680700679"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700679"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700678"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700678"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-490"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ScopeM () -&gt; ScopeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
forall a. IsNoName a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Concrete.Name.html#isNoName"><span class="hs-identifier hs-var">isNoName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700679"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; ScopeM ()) -&gt; ScopeM () -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyScopes"><span class="hs-identifier hs-var">modifyScopes</span></a></span><span> </span><span class="annot"><span class="annottext">((Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ())
-&gt; (Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; Scope) -&gt; Map ModuleName Scope -&gt; Map ModuleName Scope
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="annot"><span class="annottext">((Scope -&gt; Scope) -&gt; Map ModuleName Scope -&gt; Map ModuleName Scope)
-&gt; (Scope -&gt; Scope) -&gt; Map ModuleName Scope -&gt; Map ModuleName Scope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSpaceId -&gt; Name -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#removeNameFromScope"><span class="hs-identifier hs-var">removeNameFromScope</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpaceId
</span><a href="Agda.Syntax.Scope.Base.html#PrivateNS"><span class="hs-identifier hs-var">PrivateNS</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700679"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-491"></span><span>  </span><span id="local-6989586621680700674"><span class="annot"><span class="annottext">ResolvedName
</span><a href="#local-6989586621680700674"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; ScopeM ResolvedName
</span><a href="Agda.Syntax.Scope.Monad.html#resolveName"><span class="hs-identifier hs-var">resolveName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; QName
</span><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-var">C.QName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700679"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680700673"><span class="hs-identifier hs-type">y'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractName"><span class="hs-identifier hs-type">AbstractName</span></a></span><span>
</span><span id="line-493"></span><span>      </span><span id="local-6989586621680700673"><span class="annot"><span class="annottext">y' :: Either TypeError AbstractName
</span><a href="#local-6989586621680700673"><span class="hs-identifier hs-var hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ResolvedName
</span><a href="#local-6989586621680700674"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-494"></span><span>        </span><span class="hs-comment">-- Binding an anonymous declaration always succeeds.</span><span>
</span><span id="line-495"></span><span>        </span><span class="hs-comment">-- In case it's not the first one, we simply remove the one that came before</span><span>
</span><span id="line-496"></span><span>        </span><span class="annot"><span class="annottext">ResolvedName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
forall a. IsNoName a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Concrete.Name.html#isNoName"><span class="hs-identifier hs-var">isNoName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700679"><span class="hs-identifier hs-var">x</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either TypeError AbstractName
</span><a href="#local-6989586621680700672"><span class="hs-identifier hs-var">success</span></a></span><span>
</span><span id="line-497"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#DefinedName"><span class="hs-identifier hs-type">DefinedName</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680700671"><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700671"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">Suffix
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Either TypeError AbstractName
</span><a href="#local-6989586621680700670"><span class="hs-identifier hs-var">clash</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Either TypeError AbstractName)
-&gt; QName -&gt; Either TypeError AbstractName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var hs-var">anameName</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700671"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-498"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span> </span><span id="local-6989586621680700669"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700669"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="annot"><span class="annottext">BindingSource
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Either TypeError AbstractName
</span><a href="#local-6989586621680700670"><span class="hs-identifier hs-var">clash</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Either TypeError AbstractName)
-&gt; QName -&gt; Either TypeError AbstractName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; QName
</span><a href="Agda.Syntax.Abstract.Name.html#qualify_"><span class="hs-identifier hs-var">A.qualify_</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700669"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-499"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span>       </span><span id="local-6989586621680700668"><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700668"><span class="hs-identifier hs-var">ds</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(KindOfName -&gt; Bool)
-&gt; List1 AbstractName -&gt; Either TypeError AbstractName
</span><a href="#local-6989586621680700667"><span class="hs-identifier hs-var">ambiguous</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindOfName -&gt; KindOfName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#FldName"><span class="hs-identifier hs-var">FldName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700668"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-500"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ConstructorName"><span class="hs-identifier hs-type">ConstructorName</span></a></span><span> </span><span id="local-6989586621680700666"><span class="annot"><span class="annottext">Set Induction
</span><a href="#local-6989586621680700666"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680700665"><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700665"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(KindOfName -&gt; Bool)
-&gt; List1 AbstractName -&gt; Either TypeError AbstractName
</span><a href="#local-6989586621680700667"><span class="hs-identifier hs-var">ambiguous</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Induction -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Induction -&gt; Bool)
-&gt; (KindOfName -&gt; Maybe Induction) -&gt; KindOfName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">KindOfName -&gt; Maybe Induction
</span><a href="Agda.Syntax.Scope.Base.html#isConName"><span class="hs-identifier hs-var">isConName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700665"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-501"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#PatternSynResName"><span class="hs-identifier hs-type">PatternSynResName</span></a></span><span> </span><span id="local-6989586621680700664"><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700664"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(KindOfName -&gt; Bool)
-&gt; List1 AbstractName -&gt; Either TypeError AbstractName
</span><a href="#local-6989586621680700667"><span class="hs-identifier hs-var">ambiguous</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindOfName -&gt; KindOfName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#PatternSynName"><span class="hs-identifier hs-var">PatternSynName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700664"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-502"></span><span>        </span><span class="annot"><span class="annottext">ResolvedName
</span><a href="Agda.Syntax.Scope.Base.html#UnknownName"><span class="hs-identifier hs-var">UnknownName</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either TypeError AbstractName
</span><a href="#local-6989586621680700672"><span class="hs-identifier hs-var">success</span></a></span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700663"><span class="annot"><span class="annottext">ns :: NameSpaceId
</span><a href="#local-6989586621680700663"><span class="hs-identifier hs-var hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
forall a. IsNoName a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Concrete.Name.html#isNoName"><span class="hs-identifier hs-var">isNoName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700679"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">NameSpaceId
</span><a href="Agda.Syntax.Scope.Base.html#PrivateNS"><span class="hs-identifier hs-var">PrivateNS</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Access -&gt; NameSpaceId
</span><a href="Agda.Syntax.Scope.Base.html#localNameSpace"><span class="hs-identifier hs-var">localNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700682"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-504"></span><span>  </span><span class="annot"><span class="annottext">(AbstractName -&gt; ScopeM ())
-&gt; Either TypeError AbstractName -&gt; ScopeM ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scope -&gt; Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentScope"><span class="hs-identifier hs-var">modifyCurrentScope</span></a></span><span> </span><span class="annot"><span class="annottext">((Scope -&gt; Scope) -&gt; ScopeM ())
-&gt; (AbstractName -&gt; Scope -&gt; Scope) -&gt; AbstractName -&gt; ScopeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NameSpaceId -&gt; Name -&gt; AbstractName -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#addNameToScope"><span class="hs-identifier hs-var">addNameToScope</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpaceId
</span><a href="#local-6989586621680700663"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700679"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either TypeError AbstractName
</span><a href="#local-6989586621680700673"><span class="hs-identifier hs-var">y'</span></a></span><span>
</span><span id="line-505"></span><span>  </span><span class="annot"><span class="annottext">Maybe TypeError -&gt; TCMT IO (Maybe TypeError)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe TypeError -&gt; TCMT IO (Maybe TypeError))
-&gt; Maybe TypeError -&gt; TCMT IO (Maybe TypeError)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; Maybe TypeError)
-&gt; (AbstractName -&gt; Maybe TypeError)
-&gt; Either TypeError AbstractName
-&gt; Maybe TypeError
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; Maybe TypeError
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TypeError -&gt; AbstractName -&gt; Maybe TypeError
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe TypeError
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either TypeError AbstractName
</span><a href="#local-6989586621680700673"><span class="hs-identifier hs-var">y'</span></a></span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-507"></span><span>    </span><span id="local-6989586621680700672"><span class="annot"><span class="annottext">success :: Either TypeError AbstractName
</span><a href="#local-6989586621680700672"><span class="hs-identifier hs-var hs-var">success</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; Either TypeError AbstractName
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; Either TypeError AbstractName)
-&gt; AbstractName -&gt; Either TypeError AbstractName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; KindOfName -&gt; WhyInScope -&gt; NameMetadata -&gt; AbstractName
</span><a href="Agda.Syntax.Scope.Base.html#AbsName"><span class="hs-identifier hs-var">AbsName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700678"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">KindOfName
</span><a href="#local-6989586621680700681"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">WhyInScope
</span><a href="Agda.Syntax.Scope.Base.html#Defined"><span class="hs-identifier hs-var">Defined</span></a></span><span> </span><span class="annot"><span class="annottext">NameMetadata
</span><a href="#local-6989586621680700680"><span class="hs-identifier hs-var">meta</span></a></span><span>
</span><span id="line-508"></span><span>    </span><span id="local-6989586621680700670"><span class="annot"><span class="annottext">clash :: QName -&gt; Either TypeError AbstractName
</span><a href="#local-6989586621680700670"><span class="hs-identifier hs-var hs-var">clash</span></a></span></span><span> </span><span id="local-6989586621680700658"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700658"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; Either TypeError AbstractName
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; Either TypeError AbstractName)
-&gt; TypeError -&gt; Either TypeError AbstractName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Maybe NiceDeclaration -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ClashingDefinition"><span class="hs-identifier hs-var">ClashingDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; QName
</span><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-var">C.QName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700679"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700658"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NiceDeclaration
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span>    </span><span id="local-6989586621680700667"><span class="annot"><span class="annottext">ambiguous :: (KindOfName -&gt; Bool)
-&gt; List1 AbstractName -&gt; Either TypeError AbstractName
</span><a href="#local-6989586621680700667"><span class="hs-identifier hs-var hs-var">ambiguous</span></a></span></span><span> </span><span id="local-6989586621680700656"><span class="annot"><span class="annottext">KindOfName -&gt; Bool
</span><a href="#local-6989586621680700656"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680700655"><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700655"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-511"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">KindOfName -&gt; Bool
</span><a href="#local-6989586621680700656"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">KindOfName
</span><a href="#local-6989586621680700681"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; Bool) -&gt; List1 AbstractName -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindOfName -&gt; Bool
</span><a href="#local-6989586621680700656"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(KindOfName -&gt; Bool)
-&gt; (AbstractName -&gt; KindOfName) -&gt; AbstractName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#anameKind"><span class="hs-identifier hs-var hs-var">anameKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700655"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-512"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Either TypeError AbstractName
</span><a href="#local-6989586621680700672"><span class="hs-identifier hs-var">success</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Either TypeError AbstractName
</span><a href="#local-6989586621680700670"><span class="hs-identifier hs-var">clash</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Either TypeError AbstractName)
-&gt; QName -&gt; Either TypeError AbstractName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var hs-var">anameName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 AbstractName -&gt; AbstractName
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">List1.head</span></span><span> </span><span class="annot"><span class="annottext">List1 AbstractName
</span><a href="#local-6989586621680700655"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="hs-comment">-- | Rebind a name. Use with care!</span><span>
</span><span id="line-515"></span><span class="hs-comment">--   Ulf, 2014-06-29: Currently used to rebind the name defined by an</span><span>
</span><span id="line-516"></span><span class="hs-comment">--   unquoteDecl, which is a 'QuotableName' in the body, but a 'DefinedName'</span><span>
</span><span id="line-517"></span><span class="hs-comment">--   later on.</span><span>
</span><span id="line-518"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#rebindName"><span class="hs-identifier hs-type">rebindName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Access"><span class="hs-identifier hs-type">Access</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#KindOfName"><span class="hs-identifier hs-type">KindOfName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span id="rebindName"><span class="annot"><span class="annottext">rebindName :: Access -&gt; KindOfName -&gt; Name -&gt; QName -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#rebindName"><span class="hs-identifier hs-var hs-var">rebindName</span></a></span></span><span> </span><span id="local-6989586621680700651"><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700651"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680700650"><span class="annot"><span class="annottext">KindOfName
</span><a href="#local-6989586621680700650"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621680700649"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700649"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700648"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700648"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-520"></span><span>  </span><span class="annot"><span class="annottext">(Scope -&gt; Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentScope"><span class="hs-identifier hs-var">modifyCurrentScope</span></a></span><span> </span><span class="annot"><span class="annottext">((Scope -&gt; Scope) -&gt; ScopeM ()) -&gt; (Scope -&gt; Scope) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSpaceId -&gt; Name -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#removeNameFromScope"><span class="hs-identifier hs-var">removeNameFromScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Access -&gt; NameSpaceId
</span><a href="Agda.Syntax.Scope.Base.html#localNameSpace"><span class="hs-identifier hs-var">localNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700651"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700649"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-521"></span><span>  </span><span class="annot"><span class="annottext">Access -&gt; KindOfName -&gt; Name -&gt; QName -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#bindName"><span class="hs-identifier hs-var">bindName</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700651"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">KindOfName
</span><a href="#local-6989586621680700650"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700649"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700648"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span class="hs-comment">-- | Bind a module name.</span><span>
</span><span id="line-524"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#bindModule"><span class="hs-identifier hs-type">bindModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Access"><span class="hs-identifier hs-type">Access</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span id="bindModule"><span class="annot"><span class="annottext">bindModule :: Access -&gt; Name -&gt; ModuleName -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#bindModule"><span class="hs-identifier hs-var hs-var">bindModule</span></a></span></span><span> </span><span id="local-6989586621680700646"><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700646"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680700645"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700645"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700644"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700644"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentScope"><span class="hs-identifier hs-var">modifyCurrentScope</span></a></span><span> </span><span class="annot"><span class="annottext">((Scope -&gt; Scope) -&gt; ScopeM ()) -&gt; (Scope -&gt; Scope) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-526"></span><span>  </span><span class="annot"><span class="annottext">NameSpaceId -&gt; Name -&gt; AbstractModule -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#addModuleToScope"><span class="hs-identifier hs-var">addModuleToScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Access -&gt; NameSpaceId
</span><a href="Agda.Syntax.Scope.Base.html#localNameSpace"><span class="hs-identifier hs-var">localNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700646"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700645"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; WhyInScope -&gt; AbstractModule
</span><a href="Agda.Syntax.Scope.Base.html#AbsModule"><span class="hs-identifier hs-var">AbsModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700644"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">WhyInScope
</span><a href="Agda.Syntax.Scope.Base.html#Defined"><span class="hs-identifier hs-var">Defined</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="hs-comment">-- | Bind a qualified module name. Adds it to the imports field of the scope.</span><span>
</span><span id="line-529"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#bindQModule"><span class="hs-identifier hs-type">bindQModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Access"><span class="hs-identifier hs-type">Access</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span id="bindQModule"><span class="annot"><span class="annottext">bindQModule :: Access -&gt; QName -&gt; ModuleName -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#bindQModule"><span class="hs-identifier hs-var hs-var">bindQModule</span></a></span></span><span> </span><span id="local-6989586621680700641"><span class="annot"><span class="annottext">Access
</span><a href="#local-6989586621680700641"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680700640"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700640"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680700639"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700639"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentScope"><span class="hs-identifier hs-var">modifyCurrentScope</span></a></span><span> </span><span class="annot"><span class="annottext">((Scope -&gt; Scope) -&gt; ScopeM ()) -&gt; (Scope -&gt; Scope) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680700638"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700638"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-531"></span><span>  </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700638"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scopeImports :: Map QName ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#scopeImports"><span class="hs-identifier hs-var">scopeImports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; ModuleName -&gt; Map QName ModuleName -&gt; Map QName ModuleName
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700640"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700639"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope -&gt; Map QName ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#scopeImports"><span class="hs-identifier hs-var hs-var">scopeImports</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700638"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-534"></span><span class="hs-comment">-- * Module manipulation operations</span><span>
</span><span id="line-535"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="hs-comment">-- | Clear the scope of any no names.</span><span>
</span><span id="line-538"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#stripNoNames"><span class="hs-identifier hs-type">stripNoNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span id="stripNoNames"><span class="annot"><span class="annottext">stripNoNames :: ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#stripNoNames"><span class="hs-identifier hs-var hs-var">stripNoNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyScopes"><span class="hs-identifier hs-var">modifyScopes</span></a></span><span> </span><span class="annot"><span class="annottext">((Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ())
-&gt; (Map ModuleName Scope -&gt; Map ModuleName Scope) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; Scope) -&gt; Map ModuleName Scope -&gt; Map ModuleName Scope
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="annot"><span class="annottext">((Scope -&gt; Scope) -&gt; Map ModuleName Scope -&gt; Map ModuleName Scope)
-&gt; (Scope -&gt; Scope) -&gt; Map ModuleName Scope -&gt; Map ModuleName Scope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NamesInScope -&gt; NamesInScope)
-&gt; (ModulesInScope -&gt; ModulesInScope)
-&gt; (InScopeSet -&gt; InScopeSet)
-&gt; Scope
-&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#mapScope_"><span class="hs-identifier hs-var">mapScope_</span></a></span><span> </span><span class="annot"><span class="annottext">NamesInScope -&gt; NamesInScope
forall b. Map Name b -&gt; Map Name b
</span><a href="#local-6989586621680700633"><span class="hs-identifier hs-var">stripN</span></a></span><span> </span><span class="annot"><span class="annottext">ModulesInScope -&gt; ModulesInScope
forall b. Map Name b -&gt; Map Name b
</span><a href="#local-6989586621680700633"><span class="hs-identifier hs-var">stripN</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; InScopeSet
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-540"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-541"></span><span>    </span><span id="local-6989586621680700633"><span class="annot"><span class="annottext">stripN :: Map Name b -&gt; Map Name b
</span><a href="#local-6989586621680700633"><span class="hs-identifier hs-var hs-var">stripN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; b -&gt; Bool) -&gt; Map Name b -&gt; Map Name b
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="annot"><span class="annottext">((Name -&gt; b -&gt; Bool) -&gt; Map Name b -&gt; Map Name b)
-&gt; (Name -&gt; b -&gt; Bool) -&gt; Map Name b -&gt; Map Name b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; b -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; b -&gt; Bool) -&gt; (Name -&gt; Bool) -&gt; Name -&gt; b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Name -&gt; Bool) -&gt; Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
forall a. IsNoName a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Concrete.Name.html#isNoName"><span class="hs-identifier hs-var">isNoName</span></a></span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span class="hs-keyword">type</span><span> </span><span id="WSM"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#WSM"><span class="hs-identifier hs-var">WSM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeMemo"><span class="hs-identifier hs-type">ScopeMemo</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="hs-keyword">data</span><span> </span><span id="ScopeMemo"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeMemo"><span class="hs-identifier hs-var">ScopeMemo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ScopeMemo"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeMemo"><span class="hs-identifier hs-var">ScopeMemo</span></a></span></span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="memoNames"><span class="annot"><span class="annottext">ScopeMemo -&gt; Ren QName
</span><a href="Agda.Syntax.Scope.Monad.html#memoNames"><span class="hs-identifier hs-var hs-var">memoNames</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Ren"><span class="hs-identifier hs-type">A.Ren</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span>
</span><span id="line-547"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="memoModules"><span class="annot"><span class="annottext">ScopeMemo -&gt; Map ModuleName (ModuleName, Bool)
</span><a href="Agda.Syntax.Scope.Monad.html#memoModules"><span class="hs-identifier hs-var hs-var">memoModules</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-comment">-- ^ Bool: did we copy recursively? We need to track this because we don't</span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-comment">--   copy recursively when creating new modules for reexported functions</span><span>
</span><span id="line-550"></span><span>    </span><span class="hs-comment">--   (issue1985), but we might need to copy recursively later.</span><span>
</span><span id="line-551"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#memoToScopeInfo"><span class="hs-identifier hs-type">memoToScopeInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeMemo"><span class="hs-identifier hs-type">ScopeMemo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ScopeCopyInfo"><span class="hs-identifier hs-type">ScopeCopyInfo</span></a></span><span>
</span><span id="line-554"></span><span id="memoToScopeInfo"><span class="annot"><span class="annottext">memoToScopeInfo :: ScopeMemo -&gt; ScopeCopyInfo
</span><a href="Agda.Syntax.Scope.Monad.html#memoToScopeInfo"><span class="hs-identifier hs-var hs-var">memoToScopeInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeMemo"><span class="hs-identifier hs-type">ScopeMemo</span></a></span><span> </span><span id="local-6989586621680700627"><span class="annot"><span class="annottext">Ren QName
</span><a href="#local-6989586621680700627"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621680700626"><span class="annot"><span class="annottext">Map ModuleName (ModuleName, Bool)
</span><a href="#local-6989586621680700626"><span class="hs-identifier hs-var">mods</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-555"></span><span>  </span><span class="annot"><span class="annottext">ScopeCopyInfo :: Ren ModuleName -&gt; Ren QName -&gt; ScopeCopyInfo
</span><a href="Agda.Syntax.Abstract.html#ScopeCopyInfo"><span class="hs-identifier hs-type">ScopeCopyInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">renNames :: Ren QName
</span><a href="Agda.Syntax.Abstract.html#renNames"><span class="hs-identifier hs-var">renNames</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ren QName
</span><a href="#local-6989586621680700627"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-556"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">renModules :: Ren ModuleName
</span><a href="Agda.Syntax.Abstract.html#renModules"><span class="hs-identifier hs-var">renModules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ModuleName, Bool) -&gt; List1 ModuleName)
-&gt; Map ModuleName (ModuleName, Bool) -&gt; Ren ModuleName
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; List1 ModuleName
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; List1 ModuleName)
-&gt; ((ModuleName, Bool) -&gt; ModuleName)
-&gt; (ModuleName, Bool)
-&gt; List1 ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ModuleName, Bool) -&gt; ModuleName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map ModuleName (ModuleName, Bool)
</span><a href="#local-6989586621680700626"><span class="hs-identifier hs-var">mods</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="hs-comment">-- | Create a new scope with the given name from an old scope. Renames</span><span>
</span><span id="line-559"></span><span class="hs-comment">--   public names in the old scope to match the new name and returns the</span><span>
</span><span id="line-560"></span><span class="hs-comment">--   renamings.</span><span>
</span><span id="line-561"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#copyScope"><span class="hs-identifier hs-type">copyScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ScopeCopyInfo"><span class="hs-identifier hs-type">ScopeCopyInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span id="copyScope"><span class="annot"><span class="annottext">copyScope :: QName -&gt; ModuleName -&gt; Scope -&gt; ScopeM (Scope, ScopeCopyInfo)
</span><a href="Agda.Syntax.Scope.Monad.html#copyScope"><span class="hs-identifier hs-var hs-var">copyScope</span></a></span></span><span> </span><span id="local-6989586621680700621"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700621"><span class="hs-identifier hs-var">oldc</span></a></span></span><span> </span><span id="local-6989586621680700620"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700620"><span class="hs-identifier hs-var">new0</span></a></span></span><span> </span><span id="local-6989586621680700619"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700619"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(WhyInScope -&gt; WhyInScope) -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#inScopeBecause"><span class="hs-identifier hs-var">inScopeBecause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; WhyInScope -&gt; WhyInScope
</span><a href="Agda.Syntax.Scope.Base.html#Applied"><span class="hs-identifier hs-var">Applied</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700621"><span class="hs-identifier hs-var">oldc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; Scope)
-&gt; (ScopeMemo -&gt; ScopeCopyInfo)
-&gt; (Scope, ScopeMemo)
-&gt; (Scope, ScopeCopyInfo)
forall (a :: * -&gt; * -&gt; *) b c b' c'.
Arrow a =&gt;
a b c -&gt; a b' c' -&gt; a (b, b') (c, c')
</span><span class="hs-operator hs-var">***</span></span><span> </span><span class="annot"><span class="annottext">ScopeMemo -&gt; ScopeCopyInfo
</span><a href="Agda.Syntax.Scope.Monad.html#memoToScopeInfo"><span class="hs-identifier hs-var">memoToScopeInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Scope, ScopeMemo) -&gt; (Scope, ScopeCopyInfo))
-&gt; ScopeM (Scope, ScopeMemo) -&gt; ScopeM (Scope, ScopeCopyInfo)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT ScopeMemo ScopeM Scope
-&gt; ScopeMemo -&gt; ScopeM (Scope, ScopeMemo)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; Scope -&gt; StateT ScopeMemo ScopeM Scope
</span><a href="#local-6989586621680700615"><span class="hs-identifier hs-var">copy</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700620"><span class="hs-identifier hs-var">new0</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700619"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ren QName -&gt; Map ModuleName (ModuleName, Bool) -&gt; ScopeMemo
</span><a href="Agda.Syntax.Scope.Monad.html#ScopeMemo"><span class="hs-identifier hs-var">ScopeMemo</span></a></span><span> </span><span class="annot"><span class="annottext">Ren QName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Map ModuleName (ModuleName, Bool)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-564"></span><span>    </span><span class="annot"><a href="#local-6989586621680700615"><span class="hs-identifier hs-type">copy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#WSM"><span class="hs-identifier hs-type">WSM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span>
</span><span id="line-565"></span><span>    </span><span id="local-6989586621680700615"><span class="annot"><span class="annottext">copy :: ModuleName -&gt; Scope -&gt; StateT ScopeMemo ScopeM Scope
</span><a href="#local-6989586621680700615"><span class="hs-identifier hs-var hs-var">copy</span></a></span></span><span> </span><span id="local-6989586621680700614"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700614"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621680700613"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700613"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-566"></span><span>      </span><span class="annot"><span class="annottext">ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; StateT ScopeMemo ScopeM ())
-&gt; ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scope.copy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ScopeM ()) -&gt; String -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Copying scope &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700612"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; to &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700614"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-567"></span><span>      </span><span class="annot"><span class="annottext">ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; StateT ScopeMemo ScopeM ())
-&gt; ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scope.copy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ScopeM ()) -&gt; String -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scope -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700613"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-568"></span><span>      </span><span id="local-6989586621680700611"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700611"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScopeM Scope -&gt; StateT ScopeMemo ScopeM Scope
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ScopeM Scope -&gt; StateT ScopeMemo ScopeM Scope)
-&gt; ScopeM Scope -&gt; StateT ScopeMemo ScopeM Scope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ScopeM Scope
</span><a href="Agda.Syntax.Scope.Monad.html#getNamedScope"><span class="hs-identifier hs-var">getNamedScope</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700614"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-569"></span><span>      </span><span class="hs-comment">-- Delete private names, then copy names and modules. Recompute inScope</span><span>
</span><span id="line-570"></span><span>      </span><span class="hs-comment">-- set rather than trying to copy it.</span><span>
</span><span id="line-571"></span><span>      </span><span id="local-6989586621680700610"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700610"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#recomputeInScopeSets"><span class="hs-identifier hs-var">recomputeInScopeSets</span></a></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; Scope)
-&gt; StateT ScopeMemo ScopeM Scope -&gt; StateT ScopeMemo ScopeM Scope
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(NamesInScope -&gt; StateT ScopeMemo ScopeM NamesInScope)
-&gt; (ModulesInScope -&gt; StateT ScopeMemo ScopeM ModulesInScope)
-&gt; (InScopeSet -&gt; StateT ScopeMemo ScopeM InScopeSet)
-&gt; Scope
-&gt; StateT ScopeMemo ScopeM Scope
forall (m :: * -&gt; *).
Applicative m =&gt;
(NamesInScope -&gt; m NamesInScope)
-&gt; (ModulesInScope -&gt; m ModulesInScope)
-&gt; (InScopeSet -&gt; m InScopeSet)
-&gt; Scope
-&gt; m Scope
</span><a href="Agda.Syntax.Scope.Base.html#mapScopeM_"><span class="hs-identifier hs-var">mapScopeM_</span></a></span><span> </span><span class="annot"><span class="annottext">NamesInScope -&gt; StateT ScopeMemo ScopeM NamesInScope
</span><a href="#local-6989586621680700607"><span class="hs-identifier hs-var">copyD</span></a></span><span> </span><span class="annot"><span class="annottext">ModulesInScope -&gt; StateT ScopeMemo ScopeM ModulesInScope
</span><a href="#local-6989586621680700606"><span class="hs-identifier hs-var">copyM</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; StateT ScopeMemo ScopeM InScopeSet
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSpaceId -&gt; NameSpace -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#setNameSpace"><span class="hs-identifier hs-var">setNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpaceId
</span><a href="Agda.Syntax.Scope.Base.html#PrivateNS"><span class="hs-identifier hs-var">PrivateNS</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="Agda.Syntax.Scope.Base.html#emptyNameSpace"><span class="hs-identifier hs-var">emptyNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700613"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>      </span><span class="hs-comment">-- Fix name and parent.</span><span>
</span><span id="line-573"></span><span>      </span><span class="annot"><span class="annottext">Scope -&gt; StateT ScopeMemo ScopeM Scope
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; StateT ScopeMemo ScopeM Scope)
-&gt; Scope -&gt; StateT ScopeMemo ScopeM Scope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700610"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scopeName :: ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#scopeName"><span class="hs-identifier hs-var">scopeName</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#scopeName"><span class="hs-identifier hs-var hs-var">scopeName</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700611"><span class="hs-identifier hs-var">s0</span></a></span><span>
</span><span id="line-574"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scopeParents :: [ModuleName]
</span><a href="Agda.Syntax.Scope.Base.html#scopeParents"><span class="hs-identifier hs-var">scopeParents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; [ModuleName]
</span><a href="Agda.Syntax.Scope.Base.html#scopeParents"><span class="hs-identifier hs-var hs-var">scopeParents</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700611"><span class="hs-identifier hs-var">s0</span></a></span><span>
</span><span id="line-575"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-576"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-577"></span><span>        </span><span id="local-6989586621680700603"><span class="annot"><span class="annottext">rnew :: Range
</span><a href="#local-6989586621680700603"><span class="hs-identifier hs-var hs-var">rnew</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700614"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-578"></span><span>        </span><span id="local-6989586621680700602"><span class="annot"><span class="annottext">new' :: ModuleName
</span><a href="#local-6989586621680700602"><span class="hs-identifier hs-var hs-var">new'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName
forall a. KillRange a =&gt; KillRangeT a
</span><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-var">killRange</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700614"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-579"></span><span>        </span><span id="local-6989586621680700600"><span class="annot"><span class="annottext">newL :: [Name]
</span><a href="#local-6989586621680700600"><span class="hs-identifier hs-var hs-var">newL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [Name]
</span><a href="Agda.Syntax.Abstract.Name.html#mnameToList"><span class="hs-identifier hs-var hs-var">A.mnameToList</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700602"><span class="hs-identifier hs-var">new'</span></a></span><span>
</span><span id="line-580"></span><span>        </span><span id="local-6989586621680700612"><span class="annot"><span class="annottext">old :: ModuleName
</span><a href="#local-6989586621680700612"><span class="hs-identifier hs-var hs-var">old</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#scopeName"><span class="hs-identifier hs-var hs-var">scopeName</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700613"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span>        </span><span class="annot"><a href="#local-6989586621680700607"><span class="hs-identifier hs-type">copyD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#NamesInScope"><span class="hs-identifier hs-type">NamesInScope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#WSM"><span class="hs-identifier hs-type">WSM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#NamesInScope"><span class="hs-identifier hs-type">NamesInScope</span></a></span><span>
</span><span id="line-583"></span><span>        </span><span id="local-6989586621680700607"><span class="annot"><span class="annottext">copyD :: NamesInScope -&gt; StateT ScopeMemo ScopeM NamesInScope
</span><a href="#local-6989586621680700607"><span class="hs-identifier hs-var hs-var">copyD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([AbstractName] -&gt; StateT ScopeMemo ScopeM [AbstractName])
-&gt; NamesInScope -&gt; StateT ScopeMemo ScopeM NamesInScope
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">(([AbstractName] -&gt; StateT ScopeMemo ScopeM [AbstractName])
 -&gt; NamesInScope -&gt; StateT ScopeMemo ScopeM NamesInScope)
-&gt; ([AbstractName] -&gt; StateT ScopeMemo ScopeM [AbstractName])
-&gt; NamesInScope
-&gt; StateT ScopeMemo ScopeM NamesInScope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; StateT ScopeMemo ScopeM AbstractName)
-&gt; [AbstractName] -&gt; StateT ScopeMemo ScopeM [AbstractName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">((AbstractName -&gt; StateT ScopeMemo ScopeM AbstractName)
 -&gt; [AbstractName] -&gt; StateT ScopeMemo ScopeM [AbstractName])
-&gt; (AbstractName -&gt; StateT ScopeMemo ScopeM AbstractName)
-&gt; [AbstractName]
-&gt; StateT ScopeMemo ScopeM [AbstractName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; WSM QName)
-&gt; AbstractName -&gt; StateT ScopeMemo ScopeM AbstractName
</span><a href="#local-6989586621680700596"><span class="hs-identifier hs-var">onName</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; WSM QName
</span><a href="#local-6989586621680700595"><span class="hs-identifier hs-var">renName</span></a></span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>        </span><span class="annot"><a href="#local-6989586621680700606"><span class="hs-identifier hs-type">copyM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ModulesInScope"><span class="hs-identifier hs-type">ModulesInScope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#WSM"><span class="hs-identifier hs-type">WSM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ModulesInScope"><span class="hs-identifier hs-type">ModulesInScope</span></a></span><span>
</span><span id="line-586"></span><span>        </span><span id="local-6989586621680700606"><span class="annot"><span class="annottext">copyM :: ModulesInScope -&gt; StateT ScopeMemo ScopeM ModulesInScope
</span><a href="#local-6989586621680700606"><span class="hs-identifier hs-var hs-var">copyM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([AbstractModule] -&gt; StateT ScopeMemo ScopeM [AbstractModule])
-&gt; ModulesInScope -&gt; StateT ScopeMemo ScopeM ModulesInScope
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">(([AbstractModule] -&gt; StateT ScopeMemo ScopeM [AbstractModule])
 -&gt; ModulesInScope -&gt; StateT ScopeMemo ScopeM ModulesInScope)
-&gt; ([AbstractModule] -&gt; StateT ScopeMemo ScopeM [AbstractModule])
-&gt; ModulesInScope
-&gt; StateT ScopeMemo ScopeM ModulesInScope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(AbstractModule -&gt; StateT ScopeMemo ScopeM AbstractModule)
-&gt; [AbstractModule] -&gt; StateT ScopeMemo ScopeM [AbstractModule]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">((AbstractModule -&gt; StateT ScopeMemo ScopeM AbstractModule)
 -&gt; [AbstractModule] -&gt; StateT ScopeMemo ScopeM [AbstractModule])
-&gt; (AbstractModule -&gt; StateT ScopeMemo ScopeM AbstractModule)
-&gt; [AbstractModule]
-&gt; StateT ScopeMemo ScopeM [AbstractModule]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName)
-&gt; AbstractModule -&gt; StateT ScopeMemo ScopeM AbstractModule
Lens' ModuleName AbstractModule
</span><a href="Agda.Syntax.Scope.Base.html#lensAmodName"><span class="hs-identifier hs-var">lensAmodName</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName
</span><a href="#local-6989586621680700593"><span class="hs-identifier hs-var">renMod</span></a></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span>        </span><span class="annot"><a href="#local-6989586621680700596"><span class="hs-identifier hs-type">onName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#WSM"><span class="hs-identifier hs-type">WSM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractName"><span class="hs-identifier hs-type">AbstractName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#WSM"><span class="hs-identifier hs-type">WSM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractName"><span class="hs-identifier hs-type">AbstractName</span></a></span><span>
</span><span id="line-589"></span><span>        </span><span id="local-6989586621680700596"><span class="annot"><span class="annottext">onName :: (QName -&gt; WSM QName)
-&gt; AbstractName -&gt; StateT ScopeMemo ScopeM AbstractName
</span><a href="#local-6989586621680700596"><span class="hs-identifier hs-var hs-var">onName</span></a></span></span><span> </span><span id="local-6989586621680700592"><span class="annot"><span class="annottext">QName -&gt; WSM QName
</span><a href="#local-6989586621680700592"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680700591"><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700591"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-590"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#anameKind"><span class="hs-identifier hs-var hs-var">anameKind</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700591"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-591"></span><span>            </span><span class="annot"><span class="annottext">KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#PatternSynName"><span class="hs-identifier hs-var">PatternSynName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; StateT ScopeMemo ScopeM AbstractName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700591"><span class="hs-identifier hs-var">d</span></a></span><span>  </span><span class="hs-comment">-- Pattern synonyms are simply aliased, not renamed</span><span>
</span><span id="line-592"></span><span>            </span><span class="annot"><span class="annottext">KindOfName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; WSM QName)
-&gt; AbstractName -&gt; StateT ScopeMemo ScopeM AbstractName
Lens' QName AbstractName
</span><a href="Agda.Syntax.Scope.Base.html#lensAnameName"><span class="hs-identifier hs-var">lensAnameName</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; WSM QName
</span><a href="#local-6989586621680700592"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700591"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-comment">-- Adding to memo structure.</span><span>
</span><span id="line-595"></span><span>        </span><span id="local-6989586621680700589"><span class="annot"><span class="annottext">addName :: QName -&gt; QName -&gt; m ()
</span><a href="#local-6989586621680700589"><span class="hs-identifier hs-var hs-var">addName</span></a></span></span><span> </span><span id="local-6989586621680700588"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700588"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700587"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700587"><span class="hs-identifier hs-var">y</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeMemo -&gt; ScopeMemo) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((ScopeMemo -&gt; ScopeMemo) -&gt; m ())
-&gt; (ScopeMemo -&gt; ScopeMemo) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700585"><span class="annot"><span class="annottext">ScopeMemo
</span><a href="#local-6989586621680700585"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeMemo
</span><a href="#local-6989586621680700585"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">memoNames :: Ren QName
</span><a href="Agda.Syntax.Scope.Monad.html#memoNames"><span class="hs-identifier hs-var">memoNames</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(List1 QName -&gt; List1 QName -&gt; List1 QName)
-&gt; QName -&gt; List1 QName -&gt; Ren QName -&gt; Ren QName
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span> </span><span class="annot"><span class="annottext">List1 QName -&gt; List1 QName -&gt; List1 QName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700588"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; List1 QName
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700587"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeMemo -&gt; Ren QName
</span><a href="Agda.Syntax.Scope.Monad.html#memoNames"><span class="hs-identifier hs-var hs-var">memoNames</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeMemo
</span><a href="#local-6989586621680700585"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-596"></span><span>        </span><span id="local-6989586621680700584"><span class="annot"><span class="annottext">addMod :: ModuleName -&gt; ModuleName -&gt; Bool -&gt; m ()
</span><a href="#local-6989586621680700584"><span class="hs-identifier hs-var hs-var">addMod</span></a></span></span><span>  </span><span id="local-6989586621680700583"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700583"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700582"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700582"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621680700581"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680700581"><span class="hs-identifier hs-var">rec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeMemo -&gt; ScopeMemo) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((ScopeMemo -&gt; ScopeMemo) -&gt; m ())
-&gt; (ScopeMemo -&gt; ScopeMemo) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700580"><span class="annot"><span class="annottext">ScopeMemo
</span><a href="#local-6989586621680700580"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeMemo
</span><a href="#local-6989586621680700580"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">memoModules :: Map ModuleName (ModuleName, Bool)
</span><a href="Agda.Syntax.Scope.Monad.html#memoModules"><span class="hs-identifier hs-var">memoModules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName
-&gt; (ModuleName, Bool)
-&gt; Map ModuleName (ModuleName, Bool)
-&gt; Map ModuleName (ModuleName, Bool)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700583"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700582"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680700581"><span class="hs-identifier hs-var">rec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeMemo -&gt; Map ModuleName (ModuleName, Bool)
</span><a href="Agda.Syntax.Scope.Monad.html#memoModules"><span class="hs-identifier hs-var hs-var">memoModules</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeMemo
</span><a href="#local-6989586621680700580"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span>        </span><span class="hs-comment">-- Querying the memo structure.</span><span>
</span><span id="line-599"></span><span>        </span><span id="local-6989586621680700579"><span class="annot"><span class="annottext">findName :: QName -&gt; m (Maybe (List1 QName))
</span><a href="#local-6989586621680700579"><span class="hs-identifier hs-var hs-var">findName</span></a></span></span><span> </span><span id="local-6989586621680700578"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700578"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeMemo -&gt; Maybe (List1 QName)) -&gt; m (Maybe (List1 QName))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Ren QName -&gt; Maybe (List1 QName)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700578"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Ren QName -&gt; Maybe (List1 QName))
-&gt; (ScopeMemo -&gt; Ren QName) -&gt; ScopeMemo -&gt; Maybe (List1 QName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScopeMemo -&gt; Ren QName
</span><a href="Agda.Syntax.Scope.Monad.html#memoNames"><span class="hs-identifier hs-var hs-var">memoNames</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NB:: Defined but not used</span><span>
</span><span id="line-600"></span><span>        </span><span id="local-6989586621680700576"><span class="annot"><span class="annottext">findMod :: ModuleName -&gt; m (Maybe (ModuleName, Bool))
</span><a href="#local-6989586621680700576"><span class="hs-identifier hs-var hs-var">findMod</span></a></span></span><span>  </span><span id="local-6989586621680700575"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700575"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeMemo -&gt; Maybe (ModuleName, Bool))
-&gt; m (Maybe (ModuleName, Bool))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
-&gt; Map ModuleName (ModuleName, Bool) -&gt; Maybe (ModuleName, Bool)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700575"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Map ModuleName (ModuleName, Bool) -&gt; Maybe (ModuleName, Bool))
-&gt; (ScopeMemo -&gt; Map ModuleName (ModuleName, Bool))
-&gt; ScopeMemo
-&gt; Maybe (ModuleName, Bool)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScopeMemo -&gt; Map ModuleName (ModuleName, Bool)
</span><a href="Agda.Syntax.Scope.Monad.html#memoModules"><span class="hs-identifier hs-var hs-var">memoModules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>        </span><span class="annot"><a href="#local-6989586621680700574"><span class="hs-identifier hs-type">refresh</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">A.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#WSM"><span class="hs-identifier hs-type">WSM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">A.Name</span></a></span><span>
</span><span id="line-603"></span><span>        </span><span id="local-6989586621680700574"><span class="annot"><span class="annottext">refresh :: Name -&gt; WSM Name
</span><a href="#local-6989586621680700574"><span class="hs-identifier hs-var hs-var">refresh</span></a></span></span><span> </span><span id="local-6989586621680700573"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700573"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-604"></span><span>          </span><span id="local-6989586621680700572"><span class="annot"><span class="annottext">NameId
</span><a href="#local-6989586621680700572"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO NameId -&gt; StateT ScopeMemo ScopeM NameId
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO NameId
forall i (m :: * -&gt; *). MonadFresh i m =&gt; m i
</span><a href="Agda.TypeChecking.Monad.Base.html#fresh"><span class="hs-identifier hs-var">fresh</span></a></span><span>
</span><span id="line-605"></span><span>          </span><span class="annot"><span class="annottext">Name -&gt; WSM Name
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; WSM Name) -&gt; Name -&gt; WSM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700573"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nameId :: NameId
</span><a href="Agda.Syntax.Abstract.Name.html#nameId"><span class="hs-identifier hs-var">A.nameId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameId
</span><a href="#local-6989586621680700572"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span>        </span><span class="hs-comment">-- Change a binding M.x -&gt; old.M'.y to M.x -&gt; new.M'.y</span><span>
</span><span id="line-608"></span><span>        </span><span class="annot"><a href="#local-6989586621680700595"><span class="hs-identifier hs-type">renName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#WSM"><span class="hs-identifier hs-type">WSM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span>
</span><span id="line-609"></span><span>        </span><span id="local-6989586621680700595"><span class="annot"><span class="annottext">renName :: QName -&gt; WSM QName
</span><a href="#local-6989586621680700595"><span class="hs-identifier hs-var hs-var">renName</span></a></span></span><span> </span><span id="local-6989586621680700571"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700571"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-610"></span><span>          </span><span class="hs-comment">-- Issue 1985: For re-exported names we can't use new' as the</span><span>
</span><span id="line-611"></span><span>          </span><span class="hs-comment">-- module, since it has the wrong telescope. Example:</span><span>
</span><span id="line-612"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-613"></span><span>          </span><span class="hs-comment">--    module M1 (A : Set) where</span><span>
</span><span id="line-614"></span><span>          </span><span class="hs-comment">--      module M2 (B : Set) where</span><span>
</span><span id="line-615"></span><span>          </span><span class="hs-comment">--        postulate X : Set</span><span>
</span><span id="line-616"></span><span>          </span><span class="hs-comment">--      module M3 (C : Set) where</span><span>
</span><span id="line-617"></span><span>          </span><span class="hs-comment">--        module M4 (D E : Set) where</span><span>
</span><span id="line-618"></span><span>          </span><span class="hs-comment">--          open M2 public</span><span>
</span><span id="line-619"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-620"></span><span>          </span><span class="hs-comment">--    module M = M1.M3 A C</span><span>
</span><span id="line-621"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-622"></span><span>          </span><span class="hs-comment">-- Here we can't copy M1.M2.X to M.M4.X since we need</span><span>
</span><span id="line-623"></span><span>          </span><span class="hs-comment">-- X : (B : Set) &#8594; Set, but M.M4 has telescope (D E : Set). Thus, we</span><span>
</span><span id="line-624"></span><span>          </span><span class="hs-comment">-- would break the invariant that all functions in a module share the</span><span>
</span><span id="line-625"></span><span>          </span><span class="hs-comment">-- module telescope. Instead we copy M1.M2.X to M.M2.X for a fresh</span><span>
</span><span id="line-626"></span><span>          </span><span class="hs-comment">-- module M2 that gets the right telescope.</span><span>
</span><span id="line-627"></span><span>          </span><span id="local-6989586621680700570"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700570"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700571"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; ModuleName -&gt; Bool
</span><a href="Agda.Syntax.Abstract.Name.html#isInModule"><span class="hs-operator hs-var">`isInModule`</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700612"><span class="hs-identifier hs-var">old</span></a></span><span>
</span><span id="line-628"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700602"><span class="hs-identifier hs-var">new'</span></a></span><span>
</span><span id="line-629"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName
</span><a href="#local-6989586621680700568"><span class="hs-identifier hs-var">renMod'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; ModuleName
</span><a href="Agda.Syntax.Abstract.Name.html#qnameModule"><span class="hs-identifier hs-var hs-var">qnameModule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700571"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>                          </span><span class="hs-comment">-- Don't copy recursively here, we only know that the</span><span>
</span><span id="line-631"></span><span>                          </span><span class="hs-comment">-- current name x should be copied.</span><span>
</span><span id="line-632"></span><span>          </span><span class="hs-comment">-- Generate a fresh name for the target.</span><span>
</span><span id="line-633"></span><span>          </span><span class="hs-comment">-- Andreas, 2015-08-11 Issue 1619:</span><span>
</span><span id="line-634"></span><span>          </span><span class="hs-comment">-- Names copied by a module macro should get the module macro's</span><span>
</span><span id="line-635"></span><span>          </span><span class="hs-comment">-- range as declaration range</span><span>
</span><span id="line-636"></span><span>          </span><span class="hs-comment">-- (maybe rather the one of the open statement).</span><span>
</span><span id="line-637"></span><span>          </span><span class="hs-comment">-- For now, we just set their range</span><span>
</span><span id="line-638"></span><span>          </span><span class="hs-comment">-- to the new module name's one, which fixes issue 1619.</span><span>
</span><span id="line-639"></span><span>          </span><span id="local-6989586621680700566"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700566"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Range -&gt; QName -&gt; QName
forall a. SetRange a =&gt; Range -&gt; a -&gt; a
</span><a href="Agda.Syntax.Position.html#setRange"><span class="hs-identifier hs-var">setRange</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700603"><span class="hs-identifier hs-var">rnew</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; QName) -&gt; (Name -&gt; QName) -&gt; Name -&gt; QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Name -&gt; QName
</span><a href="Agda.Syntax.Abstract.Name.html#qualify"><span class="hs-identifier hs-var">A.qualify</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700570"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; QName) -&gt; WSM Name -&gt; WSM QName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; WSM Name
</span><a href="#local-6989586621680700574"><span class="hs-identifier hs-var">refresh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700571"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>          </span><span class="annot"><span class="annottext">ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; StateT ScopeMemo ScopeM ())
-&gt; ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scope.copy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ScopeM ()) -&gt; String -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  Copying &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700571"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; to &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700566"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-641"></span><span>          </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; StateT ScopeMemo ScopeM ()
forall (m :: * -&gt; *).
MonadState ScopeMemo m =&gt;
QName -&gt; QName -&gt; m ()
</span><a href="#local-6989586621680700589"><span class="hs-identifier hs-var">addName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700571"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700566"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-642"></span><span>          </span><span class="annot"><span class="annottext">QName -&gt; WSM QName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700566"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span>        </span><span class="hs-comment">-- Change a binding M.x -&gt; old.M'.y to M.x -&gt; new.M'.y</span><span>
</span><span id="line-645"></span><span>        </span><span class="annot"><a href="#local-6989586621680700593"><span class="hs-identifier hs-type">renMod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#WSM"><span class="hs-identifier hs-type">WSM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span>
</span><span id="line-646"></span><span>        </span><span id="local-6989586621680700593"><span class="annot"><span class="annottext">renMod :: ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName
</span><a href="#local-6989586621680700593"><span class="hs-identifier hs-var hs-var">renMod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName
</span><a href="#local-6989586621680700568"><span class="hs-identifier hs-var">renMod'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span>        </span><span id="local-6989586621680700568"><span class="annot"><span class="annottext">renMod' :: Bool -&gt; ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName
</span><a href="#local-6989586621680700568"><span class="hs-identifier hs-var hs-var">renMod'</span></a></span></span><span> </span><span id="local-6989586621680700565"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680700565"><span class="hs-identifier hs-var">rec</span></a></span></span><span> </span><span id="local-6989586621680700564"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700564"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-649"></span><span>          </span><span class="hs-comment">-- Andreas, issue 1607:</span><span>
</span><span id="line-650"></span><span>          </span><span class="hs-comment">-- If we have already copied this module, return the copy.</span><span>
</span><span id="line-651"></span><span>          </span><span id="local-6989586621680700563"><span class="annot"><span class="annottext">Maybe (ModuleName, Bool)
</span><a href="#local-6989586621680700563"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; StateT ScopeMemo ScopeM (Maybe (ModuleName, Bool))
forall (m :: * -&gt; *).
MonadState ScopeMemo m =&gt;
ModuleName -&gt; m (Maybe (ModuleName, Bool))
</span><a href="#local-6989586621680700576"><span class="hs-identifier hs-var">findMod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700564"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-652"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ModuleName, Bool)
</span><a href="#local-6989586621680700563"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-653"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700562"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700562"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680700565"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700562"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
-&gt; StateT ScopeMemo ScopeM () -&gt; StateT ScopeMemo ScopeM ModuleName
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; StateT ScopeMemo ScopeM ()
</span><a href="#local-6989586621680700560"><span class="hs-identifier hs-var">copyRec</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700564"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700562"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-654"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700559"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700559"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700559"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-655"></span><span>            </span><span class="annot"><span class="annottext">Maybe (ModuleName, Bool)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-656"></span><span>            </span><span class="hs-comment">-- Ulf (issue 1985): If copying a reexported module we put it at the</span><span>
</span><span id="line-657"></span><span>            </span><span class="hs-comment">-- top-level, to make sure we don't mess up the invariant that all</span><span>
</span><span id="line-658"></span><span>            </span><span class="hs-comment">-- (abstract) names M.f share the argument telescope of M.</span><span>
</span><span id="line-659"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700558"><span class="annot"><span class="annottext">newM :: [Name]
</span><a href="#local-6989586621680700558"><span class="hs-identifier hs-var hs-var">newM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700564"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
</span><a href="Agda.Syntax.Abstract.Name.html#isLtChildModuleOf"><span class="hs-operator hs-var">`isLtChildModuleOf`</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700612"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680700600"><span class="hs-identifier hs-var">newL</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [Name]
</span><a href="Agda.Syntax.Abstract.Name.html#mnameToList"><span class="hs-identifier hs-var hs-var">mnameToList</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700620"><span class="hs-identifier hs-var">new0</span></a></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span>            </span><span id="local-6989586621680700556"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700556"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-662"></span><span>               </span><span class="hs-comment">-- Andreas, Jesper, 2015-07-02: Issue 1597</span><span>
</span><span id="line-663"></span><span>               </span><span class="hs-comment">-- Don't blindly drop a prefix of length of the old qualifier.</span><span>
</span><span id="line-664"></span><span>               </span><span class="hs-comment">-- If things are imported by open public they do not have the old qualifier</span><span>
</span><span id="line-665"></span><span>               </span><span class="hs-comment">-- as prefix.  Those need just to be linked, not copied.</span><span>
</span><span id="line-666"></span><span>               </span><span class="hs-comment">-- return $ A.mnameFromList $ (newL ++) $ drop (size old) $ A.mnameToList x</span><span>
</span><span id="line-667"></span><span>               </span><span class="hs-comment">-- caseMaybe (stripPrefix (A.mnameToList old) (A.mnameToList x)) (return x) $ \ suffix -&gt; do</span><span>
</span><span id="line-668"></span><span>               </span><span class="hs-comment">--   return $ A.mnameFromList $ newL ++ suffix</span><span>
</span><span id="line-669"></span><span>               </span><span class="hs-comment">-- Ulf, 2016-02-22: #1726</span><span>
</span><span id="line-670"></span><span>               </span><span class="hs-comment">-- We still need to copy modules from 'open public'. Same as in renName.</span><span>
</span><span id="line-671"></span><span>               </span><span id="local-6989586621680700555"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700555"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; WSM Name
</span><a href="#local-6989586621680700574"><span class="hs-identifier hs-var">refresh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Name
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Name) -&gt; [Name] -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [Name]
</span><a href="Agda.Syntax.Abstract.Name.html#mnameToList"><span class="hs-identifier hs-var hs-var">A.mnameToList</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700564"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span>               </span><span class="annot"><span class="annottext">ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName)
-&gt; ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; ModuleName
</span><a href="Agda.Syntax.Abstract.Name.html#mnameFromList"><span class="hs-identifier hs-var">A.mnameFromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; ModuleName) -&gt; [Name] -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680700558"><span class="hs-identifier hs-var">newM</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700555"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-673"></span><span>            </span><span class="hs-comment">-- Andreas, Jesper, 2015-07-02: Issue 1597</span><span>
</span><span id="line-674"></span><span>            </span><span class="hs-comment">-- Don't copy a module over itself, it will just be emptied of its contents.</span><span>
</span><span id="line-675"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700564"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700556"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700564"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-676"></span><span>            </span><span class="annot"><span class="annottext">ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; StateT ScopeMemo ScopeM ())
-&gt; ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scope.copy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ScopeM ()) -&gt; String -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  Copying module &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700564"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; to &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700556"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-677"></span><span>            </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool -&gt; StateT ScopeMemo ScopeM ()
forall (m :: * -&gt; *).
MonadState ScopeMemo m =&gt;
ModuleName -&gt; ModuleName -&gt; Bool -&gt; m ()
</span><a href="#local-6989586621680700584"><span class="hs-identifier hs-var">addMod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700564"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700556"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680700565"><span class="hs-identifier hs-var">rec</span></a></span><span>
</span><span id="line-678"></span><span>            </span><span class="annot"><span class="annottext">ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; StateT ScopeMemo ScopeM ())
-&gt; ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataOrRecordModule -&gt; ModuleName -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#createModule"><span class="hs-identifier hs-var">createModule</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DataOrRecordModule
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700556"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-679"></span><span>            </span><span class="hs-comment">-- We need to copy the contents of included modules recursively (only when 'rec')</span><span>
</span><span id="line-680"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; StateT ScopeMemo ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680700565"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT ScopeMemo ScopeM () -&gt; StateT ScopeMemo ScopeM ())
-&gt; StateT ScopeMemo ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; StateT ScopeMemo ScopeM ()
</span><a href="#local-6989586621680700560"><span class="hs-identifier hs-var">copyRec</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700564"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700556"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-681"></span><span>            </span><span class="annot"><span class="annottext">ModuleName -&gt; StateT ScopeMemo ScopeM ModuleName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700556"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-682"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-683"></span><span>            </span><span id="local-6989586621680700560"><span class="annot"><span class="annottext">copyRec :: ModuleName -&gt; ModuleName -&gt; StateT ScopeMemo ScopeM ()
</span><a href="#local-6989586621680700560"><span class="hs-identifier hs-var hs-var">copyRec</span></a></span></span><span> </span><span id="local-6989586621680700552"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700552"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700551"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700551"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-684"></span><span>              </span><span id="local-6989586621680700550"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700550"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScopeM Scope -&gt; StateT ScopeMemo ScopeM Scope
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ScopeM Scope -&gt; StateT ScopeMemo ScopeM Scope)
-&gt; ScopeM Scope -&gt; StateT ScopeMemo ScopeM Scope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ScopeM Scope
</span><a href="Agda.Syntax.Scope.Monad.html#getNamedScope"><span class="hs-identifier hs-var">getNamedScope</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700552"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-685"></span><span>              </span><span id="local-6989586621680700549"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700549"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleName
-&gt; StateT ScopeMemo ScopeM Scope -&gt; StateT ScopeMemo ScopeM Scope
forall (t :: (* -&gt; *) -&gt; * -&gt; *) a.
(MonadTrans t, Monad (t ScopeM)) =&gt;
ModuleName -&gt; t ScopeM a -&gt; t ScopeM a
</span><a href="Agda.Syntax.Scope.Monad.html#withCurrentModule%27"><span class="hs-identifier hs-var">withCurrentModule'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700551"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT ScopeMemo ScopeM Scope -&gt; StateT ScopeMemo ScopeM Scope)
-&gt; StateT ScopeMemo ScopeM Scope -&gt; StateT ScopeMemo ScopeM Scope
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Scope -&gt; StateT ScopeMemo ScopeM Scope
</span><a href="#local-6989586621680700615"><span class="hs-identifier hs-var">copy</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700551"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700550"><span class="hs-identifier hs-var">s0</span></a></span><span>
</span><span id="line-686"></span><span>              </span><span class="annot"><span class="annottext">ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; StateT ScopeMemo ScopeM ())
-&gt; ScopeM () -&gt; StateT ScopeMemo ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; (Scope -&gt; Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyNamedScope"><span class="hs-identifier hs-var">modifyNamedScope</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700551"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope -&gt; Scope -&gt; Scope
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700549"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>
</span><span id="line-688"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-689"></span><span class="hs-comment">-- * Import directives</span><span>
</span><span id="line-690"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span class="hs-comment">-- | Warn about useless fixity declarations in @renaming@ directives.</span><span>
</span><span id="line-693"></span><span class="hs-comment">--   Monadic for the sake of error reporting.</span><span>
</span><span id="line-694"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#checkNoFixityInRenamingModule"><span class="hs-identifier hs-type">checkNoFixityInRenamingModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.html#Renaming"><span class="hs-identifier hs-type">C.Renaming</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span id="checkNoFixityInRenamingModule"><span class="annot"><span class="annottext">checkNoFixityInRenamingModule :: [Renaming] -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#checkNoFixityInRenamingModule"><span class="hs-identifier hs-var hs-var">checkNoFixityInRenamingModule</span></a></span></span><span> </span><span id="local-6989586621680700547"><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700547"><span class="hs-identifier hs-var">ren</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-696"></span><span>  </span><span class="annot"><span class="annottext">Maybe (NonEmpty Range)
-&gt; (NonEmpty Range -&gt; ScopeM ()) -&gt; ScopeM ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-var">whenJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Range] -&gt; Maybe (NonEmpty Range)
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><span class="hs-identifier hs-var">nonEmpty</span></span><span> </span><span class="annot"><span class="annottext">([Range] -&gt; Maybe (NonEmpty Range))
-&gt; [Range] -&gt; Maybe (NonEmpty Range)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Renaming -&gt; Maybe Range) -&gt; [Renaming] -&gt; [Range]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Renaming -&gt; Maybe Range
</span><a href="#local-6989586621680700544"><span class="hs-identifier hs-var">rangeOfUselessInfix</span></a></span><span> </span><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700547"><span class="hs-identifier hs-var">ren</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((NonEmpty Range -&gt; ScopeM ()) -&gt; ScopeM ())
-&gt; (NonEmpty Range -&gt; ScopeM ()) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700543"><span class="annot"><span class="annottext">NonEmpty Range
</span><a href="#local-6989586621680700543"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-697"></span><span>    </span><span class="annot"><span class="annottext">NonEmpty Range -&gt; ScopeM () -&gt; ScopeM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Range
</span><a href="#local-6989586621680700543"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; ScopeM ()) -&gt; ScopeM () -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-698"></span><span>      </span><span class="annot"><span class="annottext">Warning -&gt; ScopeM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; ScopeM ()) -&gt; Warning -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Range -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#FixityInRenamingModule"><span class="hs-identifier hs-var">FixityInRenamingModule</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Range
</span><a href="#local-6989586621680700543"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-700"></span><span>  </span><span class="annot"><a href="#local-6989586621680700544"><span class="hs-identifier hs-type">rangeOfUselessInfix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#Renaming"><span class="hs-identifier hs-type">C.Renaming</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span>
</span><span id="line-701"></span><span>  </span><span id="local-6989586621680700544"><span class="annot"><span class="annottext">rangeOfUselessInfix :: Renaming -&gt; Maybe Range
</span><a href="#local-6989586621680700544"><span class="hs-identifier hs-var hs-var">rangeOfUselessInfix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-702"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#Renaming"><span class="hs-identifier hs-type">Renaming</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-type">ImportedModule</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680700539"><span class="annot"><span class="annottext">Maybe Fixity
</span><a href="#local-6989586621680700539"><span class="hs-identifier hs-var">mfx</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Fixity -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">(Fixity -&gt; Range) -&gt; Maybe Fixity -&gt; Maybe Range
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Fixity
</span><a href="#local-6989586621680700539"><span class="hs-identifier hs-var">mfx</span></a></span><span>
</span><span id="line-703"></span><span>    </span><span class="annot"><span class="annottext">Renaming
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span class="hs-comment">-- Moved here carefully from Parser.y to preserve the archaeological artefact</span><span>
</span><span id="line-706"></span><span class="hs-comment">-- dating from Oct 2005 (5ba14b647b9bd175733f9563e744176425c39126).</span><span>
</span><span id="line-707"></span><span class="hs-comment">-- | Check that an import directive doesn't contain repeated names.</span><span>
</span><span id="line-708"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#verifyImportDirective"><span class="hs-identifier hs-type">verifyImportDirective</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.html#ImportedName"><span class="hs-identifier hs-type">C.ImportedName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#HidingDirective"><span class="hs-identifier hs-type">C.HidingDirective</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#RenamingDirective"><span class="hs-identifier hs-type">C.RenamingDirective</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span id="verifyImportDirective"><span class="annot"><span class="annottext">verifyImportDirective :: [ImportedName' Name Name]
-&gt; [ImportedName' Name Name] -&gt; [Renaming] -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#verifyImportDirective"><span class="hs-identifier hs-var hs-var">verifyImportDirective</span></a></span></span><span> </span><span id="local-6989586621680700534"><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700534"><span class="hs-identifier hs-var">usn</span></a></span></span><span> </span><span id="local-6989586621680700533"><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700533"><span class="hs-identifier hs-var">hdn</span></a></span></span><span> </span><span id="local-6989586621680700532"><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700532"><span class="hs-identifier hs-var">ren</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-710"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">([ImportedName' Name Name] -&gt; Bool)
-&gt; [[ImportedName' Name Name]] -&gt; [[ImportedName' Name Name]]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool)
-&gt; ([ImportedName' Name Name] -&gt; Int)
-&gt; [ImportedName' Name Name]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span class="hs-special">)</span><span>
</span><span id="line-711"></span><span>         </span><span class="annot"><span class="annottext">([[ImportedName' Name Name]] -&gt; [[ImportedName' Name Name]])
-&gt; [[ImportedName' Name Name]] -&gt; [[ImportedName' Name Name]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; [[ImportedName' Name Name]]
forall a. Eq a =&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">List.group</span></span><span>
</span><span id="line-712"></span><span>         </span><span class="annot"><span class="annottext">([ImportedName' Name Name] -&gt; [[ImportedName' Name Name]])
-&gt; [ImportedName' Name Name] -&gt; [[ImportedName' Name Name]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sort</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700528"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-713"></span><span>    </span><span class="hs-keyword">of</span><span>
</span><span id="line-714"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ScopeM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>        </span><span id="local-6989586621680700527"><span class="annot"><span class="annottext">[[ImportedName' Name Name]]
</span><a href="#local-6989586621680700527"><span class="hs-identifier hs-var">yss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[[ImportedName' Name Name]] -&gt; ScopeM () -&gt; ScopeM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">[[ImportedName' Name Name]]
</span><a href="#local-6989586621680700527"><span class="hs-identifier hs-var">yss</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; ScopeM ()) -&gt; ScopeM () -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ScopeM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
String -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#genericError"><span class="hs-identifier hs-var">genericError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ScopeM ()) -&gt; String -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-716"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Repeated name&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680700525"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; in import directive: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-717"></span><span>                </span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.intersperse</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([ImportedName' Name Name] -&gt; String)
-&gt; [[ImportedName' Name Name]] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">(ImportedName' Name Name -&gt; String)
-&gt; ([ImportedName' Name Name] -&gt; ImportedName' Name Name)
-&gt; [ImportedName' Name Name]
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; ImportedName' Name Name
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[ImportedName' Name Name]]
</span><a href="#local-6989586621680700527"><span class="hs-identifier hs-var">yss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-719"></span><span>                </span><span id="local-6989586621680700525"><span class="annot"><span class="annottext">s :: String
</span><a href="#local-6989586621680700525"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[[ImportedName' Name Name]]
</span><a href="#local-6989586621680700527"><span class="hs-identifier hs-var">yss</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-720"></span><span>                        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-721"></span><span>                        </span><span class="annot"><span class="annottext">[[ImportedName' Name Name]]
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;s&quot;</span></span><span>
</span><span id="line-722"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-723"></span><span>        </span><span id="local-6989586621680700528"><span class="annot"><span class="annottext">xs :: [ImportedName' Name Name]
</span><a href="#local-6989586621680700528"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700534"><span class="hs-identifier hs-var">usn</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700533"><span class="hs-identifier hs-var">hdn</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Renaming -&gt; ImportedName' Name Name)
-&gt; [Renaming] -&gt; [ImportedName' Name Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Renaming -&gt; ImportedName' Name Name
forall n m. Renaming' n m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#renFrom"><span class="hs-identifier hs-var hs-var">renFrom</span></a></span><span> </span><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700532"><span class="hs-identifier hs-var">ren</span></a></span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span class="hs-comment">-- | Apply an import directive and check that all the names mentioned actually</span><span>
</span><span id="line-726"></span><span class="hs-comment">--   exist.</span><span>
</span><span id="line-727"></span><span class="hs-comment">--</span><span>
</span><span id="line-728"></span><span class="hs-comment">--   Monadic for the sake of error reporting.</span><span>
</span><span id="line-729"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#applyImportDirectiveM"><span class="hs-identifier hs-type">applyImportDirectiveM</span></a></span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span>                           </span><span class="hs-comment">-- ^ Name of the scope, only for error reporting.</span><span>
</span><span id="line-731"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#ImportDirective"><span class="hs-identifier hs-type">C.ImportDirective</span></a></span><span>                 </span><span class="hs-comment">-- ^ Description of how scope is to be modified.</span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span>                             </span><span class="hs-comment">-- ^ Input scope.</span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ImportDirective"><span class="hs-identifier hs-type">A.ImportDirective</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Scope-checked description, output scope.</span><span>
</span><span id="line-734"></span><span id="applyImportDirectiveM"><span class="annot"><span class="annottext">applyImportDirectiveM :: QName
-&gt; ImportDirective -&gt; Scope -&gt; ScopeM (ImportDirective, Scope)
</span><a href="Agda.Syntax.Scope.Monad.html#applyImportDirectiveM"><span class="hs-identifier hs-var hs-var">applyImportDirectiveM</span></a></span></span><span> </span><span id="local-6989586621680700519"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700519"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ImportDirective"><span class="hs-identifier hs-type">ImportDirective</span></a></span><span> </span><span id="local-6989586621680700517"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700517"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621680700516"><span class="annot"><span class="annottext">Using' Name Name
</span><a href="#local-6989586621680700516"><span class="hs-identifier hs-var">usn'</span></a></span></span><span> </span><span id="local-6989586621680700515"><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700515"><span class="hs-identifier hs-var">hdn'</span></a></span></span><span> </span><span id="local-6989586621680700514"><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700514"><span class="hs-identifier hs-var">ren'</span></a></span></span><span> </span><span id="local-6989586621680700513"><span class="annot"><span class="annottext">Maybe Range
</span><a href="#local-6989586621680700513"><span class="hs-identifier hs-var">public</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680700512"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700512"><span class="hs-identifier hs-var">scope0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span>    </span><span class="hs-comment">-- Module names do not come with fixities, thus, we should complain if the</span><span>
</span><span id="line-737"></span><span>    </span><span class="hs-comment">-- user has supplied fixity annotations to @renaming module@ clauses.</span><span>
</span><span id="line-738"></span><span>    </span><span class="annot"><span class="annottext">[Renaming] -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#checkNoFixityInRenamingModule"><span class="hs-identifier hs-var">checkNoFixityInRenamingModule</span></a></span><span> </span><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700514"><span class="hs-identifier hs-var">ren'</span></a></span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span>    </span><span class="hs-comment">-- Andreas, 2020-06-06, issue #4707</span><span>
</span><span id="line-741"></span><span>    </span><span class="hs-comment">-- Duplicates in @using@ directive are dropped with a warning.</span><span>
</span><span id="line-742"></span><span>    </span><span id="local-6989586621680700511"><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700511"><span class="hs-identifier hs-var">usingList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Using' Name Name -&gt; ScopeM [ImportedName' Name Name]
</span><a href="#local-6989586621680700510"><span class="hs-identifier hs-var">discardDuplicatesInUsing</span></a></span><span> </span><span class="annot"><span class="annottext">Using' Name Name
</span><a href="#local-6989586621680700516"><span class="hs-identifier hs-var">usn'</span></a></span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span>    </span><span class="hs-comment">-- The following check was originally performed by the parser.</span><span>
</span><span id="line-745"></span><span>    </span><span class="hs-comment">-- The Great Ulf Himself added the check back in the dawn of time</span><span>
</span><span id="line-746"></span><span>    </span><span class="hs-comment">-- (5ba14b647b9bd175733f9563e744176425c39126)</span><span>
</span><span id="line-747"></span><span>    </span><span class="hs-comment">-- when Agda 2 wasn't even believed to exist yet.</span><span>
</span><span id="line-748"></span><span>    </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; [ImportedName' Name Name] -&gt; [Renaming] -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#verifyImportDirective"><span class="hs-identifier hs-var">verifyImportDirective</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700511"><span class="hs-identifier hs-var">usingList</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700515"><span class="hs-identifier hs-var">hdn'</span></a></span><span> </span><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700514"><span class="hs-identifier hs-var">ren'</span></a></span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span>    </span><span class="hs-comment">-- We start by checking that all of the names talked about in the import</span><span>
</span><span id="line-751"></span><span>    </span><span class="hs-comment">-- directive do exist.  If some do not then we remove them and raise a warning.</span><span>
</span><span id="line-752"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700509"><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700509"><span class="hs-identifier hs-var">missingExports</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700508"><span class="annot"><span class="annottext">[ImportedName' (Name, QName) (Name, ModuleName)]
</span><a href="#local-6989586621680700508"><span class="hs-identifier hs-var">namesA</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; ([ImportedName' Name Name],
    [ImportedName' (Name, QName) (Name, ModuleName)])
</span><a href="#local-6989586621680700507"><span class="hs-identifier hs-var">checkExist</span></a></span><span> </span><span class="annot"><span class="annottext">([ImportedName' Name Name]
 -&gt; ([ImportedName' Name Name],
     [ImportedName' (Name, QName) (Name, ModuleName)]))
-&gt; [ImportedName' Name Name]
-&gt; ([ImportedName' Name Name],
    [ImportedName' (Name, QName) (Name, ModuleName)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700511"><span class="hs-identifier hs-var">usingList</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700515"><span class="hs-identifier hs-var">hdn'</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Renaming -&gt; ImportedName' Name Name)
-&gt; [Renaming] -&gt; [ImportedName' Name Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Renaming -&gt; ImportedName' Name Name
forall n m. Renaming' n m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#renFrom"><span class="hs-identifier hs-var hs-var">renFrom</span></a></span><span> </span><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700514"><span class="hs-identifier hs-var">ren'</span></a></span><span>
</span><span id="line-753"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ScopeM () -&gt; ScopeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700509"><span class="hs-identifier hs-var">missingExports</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; ScopeM ()) -&gt; ScopeM () -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; ScopeM () -&gt; ScopeM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700517"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; ScopeM ()) -&gt; ScopeM () -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-754"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scope.import.apply&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ScopeM ()) -&gt; String -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;non existing names: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700509"><span class="hs-identifier hs-var">missingExports</span></a></span><span>
</span><span id="line-755"></span><span>      </span><span class="annot"><span class="annottext">Warning -&gt; ScopeM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; ScopeM ()) -&gt; Warning -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [Name] -&gt; [Name] -&gt; [ImportedName' Name Name] -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#ModuleDoesntExport"><span class="hs-identifier hs-var">ModuleDoesntExport</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700519"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamesInScope -&gt; [Name]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">NamesInScope
</span><a href="#local-6989586621680700502"><span class="hs-identifier hs-var">namesInScope</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModulesInScope -&gt; [Name]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">ModulesInScope
</span><a href="#local-6989586621680700501"><span class="hs-identifier hs-var">modulesInScope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700509"><span class="hs-identifier hs-var">missingExports</span></a></span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span>    </span><span class="hs-comment">-- We can now define a cleaned-up version of the import directive.</span><span>
</span><span id="line-758"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700500"><span class="annot"><span class="annottext">notMissing :: ImportedName' Name Name -&gt; Bool
</span><a href="#local-6989586621680700500"><span class="hs-identifier hs-var hs-var">notMissing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (ImportedName' Name Name -&gt; Bool)
-&gt; ImportedName' Name Name
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700509"><span class="hs-identifier hs-var">missingExports</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; ImportedName' Name Name -&gt; Bool
forall a. Ord a =&gt; [a] -&gt; a -&gt; Bool
</span><a href="Agda.Utils.List.html#hasElem"><span class="hs-operator hs-var">`hasElem`</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- #3997, efficient lookup in missingExports</span><span>
</span><span id="line-759"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700498"><span class="annot"><span class="annottext">usn :: [ImportedName' Name Name]
</span><a href="#local-6989586621680700498"><span class="hs-identifier hs-var hs-var">usn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImportedName' Name Name -&gt; Bool)
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; Bool
</span><a href="#local-6989586621680700500"><span class="hs-identifier hs-var">notMissing</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700511"><span class="hs-identifier hs-var">usingList</span></a></span><span>        </span><span class="hs-comment">-- remove missingExports from usn'</span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700497"><span class="annot"><span class="annottext">hdn :: [ImportedName' Name Name]
</span><a href="#local-6989586621680700497"><span class="hs-identifier hs-var hs-var">hdn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImportedName' Name Name -&gt; Bool)
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; Bool
</span><a href="#local-6989586621680700500"><span class="hs-identifier hs-var">notMissing</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700515"><span class="hs-identifier hs-var">hdn'</span></a></span><span>             </span><span class="hs-comment">-- remove missingExports from hdn'</span><span>
</span><span id="line-761"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700496"><span class="annot"><span class="annottext">ren :: [Renaming]
</span><a href="#local-6989586621680700496"><span class="hs-identifier hs-var hs-var">ren</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Renaming -&gt; Bool) -&gt; [Renaming] -&gt; [Renaming]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; Bool
</span><a href="#local-6989586621680700500"><span class="hs-identifier hs-var">notMissing</span></a></span><span> </span><span class="annot"><span class="annottext">(ImportedName' Name Name -&gt; Bool)
-&gt; (Renaming -&gt; ImportedName' Name Name) -&gt; Renaming -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Renaming -&gt; ImportedName' Name Name
forall n m. Renaming' n m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#renFrom"><span class="hs-identifier hs-var hs-var">renFrom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700514"><span class="hs-identifier hs-var">ren'</span></a></span><span>                   </span><span class="hs-comment">-- and from ren'</span><span>
</span><span id="line-762"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700495"><span class="annot"><span class="annottext">dir :: ImportDirective
</span><a href="#local-6989586621680700495"><span class="hs-identifier hs-var hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range
-&gt; Using' Name Name
-&gt; [ImportedName' Name Name]
-&gt; [Renaming]
-&gt; Maybe Range
-&gt; ImportDirective
forall n m.
Range
-&gt; Using' n m
-&gt; HidingDirective' n m
-&gt; RenamingDirective' n m
-&gt; Maybe Range
-&gt; ImportDirective' n m
</span><a href="Agda.Syntax.Common.html#ImportDirective"><span class="hs-identifier hs-var">ImportDirective</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700517"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([ImportedName' Name Name] -&gt; [ImportedName' Name Name])
-&gt; Using' Name Name -&gt; Using' Name Name
forall n1 m1 n2 m2.
([ImportedName' n1 m1] -&gt; [ImportedName' n2 m2])
-&gt; Using' n1 m1 -&gt; Using' n2 m2
</span><a href="Agda.Syntax.Common.html#mapUsing"><span class="hs-identifier hs-var">mapUsing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700498"><span class="hs-identifier hs-var">usn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Using' Name Name
</span><a href="#local-6989586621680700516"><span class="hs-identifier hs-var">usn'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700497"><span class="hs-identifier hs-var">hdn</span></a></span><span> </span><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700496"><span class="hs-identifier hs-var">ren</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
</span><a href="#local-6989586621680700513"><span class="hs-identifier hs-var">public</span></a></span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span>    </span><span class="hs-comment">-- Convenient shorthands for defined names and names brought into scope:</span><span>
</span><span id="line-765"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700493"><span class="annot"><span class="annottext">names :: [ImportedName' Name Name]
</span><a href="#local-6989586621680700493"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Renaming -&gt; ImportedName' Name Name)
-&gt; [Renaming] -&gt; [ImportedName' Name Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Renaming -&gt; ImportedName' Name Name
forall n m. Renaming' n m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#renFrom"><span class="hs-identifier hs-var hs-var">renFrom</span></a></span><span> </span><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700496"><span class="hs-identifier hs-var">ren</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700497"><span class="hs-identifier hs-var">hdn</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700498"><span class="hs-identifier hs-var">usn</span></a></span><span>
</span><span id="line-766"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700492"><span class="annot"><span class="annottext">definedNames :: [ImportedName' Name Name]
</span><a href="#local-6989586621680700492"><span class="hs-identifier hs-var hs-var">definedNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Renaming -&gt; ImportedName' Name Name)
-&gt; [Renaming] -&gt; [ImportedName' Name Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Renaming -&gt; ImportedName' Name Name
forall n m. Renaming' n m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#renTo"><span class="hs-identifier hs-var hs-var">renTo</span></a></span><span> </span><span class="annot"><span class="annottext">[Renaming]
</span><a href="#local-6989586621680700496"><span class="hs-identifier hs-var">ren</span></a></span><span>
</span><span id="line-767"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700490"><span class="annot"><span class="annottext">targetNames :: [ImportedName' Name Name]
</span><a href="#local-6989586621680700490"><span class="hs-identifier hs-var hs-var">targetNames</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700498"><span class="hs-identifier hs-var">usn</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700492"><span class="hs-identifier hs-var">definedNames</span></a></span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span>    </span><span class="hs-comment">-- Efficient test of (`elem` names):</span><span>
</span><span id="line-770"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700489"><span class="annot"><span class="annottext">inNames :: ImportedName' Name Name -&gt; Bool
</span><a href="#local-6989586621680700489"><span class="hs-identifier hs-var hs-var">inNames</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700493"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; ImportedName' Name Name -&gt; Bool
forall a. Ord a =&gt; [a] -&gt; a -&gt; Bool
</span><a href="Agda.Utils.List.html#hasElem"><span class="hs-operator hs-var">`hasElem`</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-771"></span><span>
</span><span id="line-772"></span><span>    </span><span class="hs-comment">-- Efficient test of whether a module import should be added to the import</span><span>
</span><span id="line-773"></span><span>    </span><span class="hs-comment">-- of a definition (like a data or record definition).</span><span>
</span><span id="line-774"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700488"><span class="annot"><span class="annottext">extra :: Name -&gt; Bool
</span><a href="#local-6989586621680700488"><span class="hs-identifier hs-var hs-var">extra</span></a></span></span><span> </span><span id="local-6989586621680700487"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700487"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; Bool
</span><a href="#local-6989586621680700489"><span class="hs-identifier hs-var">inNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ImportedName' Name Name
forall n m. n -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-var">ImportedName</span></a></span><span>   </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700487"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; Bool
</span><a href="#local-6989586621680700500"><span class="hs-identifier hs-var">notMissing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ImportedName' Name Name
forall n m. m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-var">ImportedModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700487"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-776"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (ImportedName' Name Name -&gt; Bool)
-&gt; ImportedName' Name Name
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; Bool
</span><a href="#local-6989586621680700489"><span class="hs-identifier hs-var">inNames</span></a></span><span> </span><span class="annot"><span class="annottext">(ImportedName' Name Name -&gt; Bool)
-&gt; ImportedName' Name Name -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ImportedName' Name Name
forall n m. m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-var">ImportedModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700487"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-777"></span><span>                  </span><span class="hs-comment">-- The last test implies that @hiding (module M)@ prevents @module M@</span><span>
</span><span id="line-778"></span><span>                  </span><span class="hs-comment">-- from entering the @using@ list in @addExtraModule@.</span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span>    </span><span id="local-6989586621680700485"><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700485"><span class="hs-identifier hs-var">dir'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImportedName' Name Name -&gt; Bool)
-&gt; ImportDirective -&gt; TCMT IO ImportDirective
forall (m :: * -&gt; *) m.
MonadWarning m =&gt;
(ImportedName' Name m -&gt; Bool)
-&gt; ImportDirective -&gt; m ImportDirective
</span><a href="#local-6989586621680700484"><span class="hs-identifier hs-var">sanityCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (ImportedName' Name Name -&gt; Bool)
-&gt; ImportedName' Name Name
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; Bool
</span><a href="#local-6989586621680700489"><span class="hs-identifier hs-var">inNames</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImportDirective -&gt; TCMT IO ImportDirective)
-&gt; ImportDirective -&gt; TCMT IO ImportDirective
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; ImportDirective -&gt; ImportDirective
</span><a href="#local-6989586621680700483"><span class="hs-identifier hs-var">addExtraModules</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621680700488"><span class="hs-identifier hs-var">extra</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700495"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span>    </span><span class="hs-comment">-- Check for duplicate imports in a single import directive.</span><span>
</span><span id="line-783"></span><span>    </span><span class="hs-comment">-- @dup@ : To be imported names that are mentioned more than once.</span><span>
</span><span id="line-784"></span><span>    </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; ([ImportedName' Name Name] -&gt; ScopeM ()) -&gt; ScopeM ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="Agda.Utils.List.html#allDuplicates"><span class="hs-identifier hs-var">allDuplicates</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700490"><span class="hs-identifier hs-var">targetNames</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([ImportedName' Name Name] -&gt; ScopeM ()) -&gt; ScopeM ())
-&gt; ([ImportedName' Name Name] -&gt; ScopeM ()) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700481"><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700481"><span class="hs-identifier hs-var">dup</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-785"></span><span>      </span><span class="annot"><span class="annottext">TypeError -&gt; ScopeM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ScopeM ()) -&gt; TypeError -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [ImportedName' Name Name] -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#DuplicateImports"><span class="hs-identifier hs-var">DuplicateImports</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700519"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700481"><span class="hs-identifier hs-var">dup</span></a></span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span>    </span><span class="hs-comment">-- Apply the import directive.</span><span>
</span><span id="line-788"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700479"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700479"><span class="hs-identifier hs-var">scope'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700478"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680700478"><span class="hs-identifier hs-var">nameClashes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700477"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680700477"><span class="hs-identifier hs-var">moduleClashes</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDirective -&gt; Scope -&gt; (Scope, (Set Name, Set Name))
</span><a href="Agda.Syntax.Scope.Base.html#applyImportDirective_"><span class="hs-identifier hs-var">applyImportDirective_</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700485"><span class="hs-identifier hs-var">dir'</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700475"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-789"></span><span>
</span><span id="line-790"></span><span>    </span><span class="hs-comment">-- Andreas, 2019-11-08, issue #4154, report clashes</span><span>
</span><span id="line-791"></span><span>    </span><span class="hs-comment">-- introduced by the @renaming@.</span><span>
</span><span id="line-792"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ScopeM () -&gt; ScopeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Name -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680700478"><span class="hs-identifier hs-var">nameClashes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; ScopeM ()) -&gt; ScopeM () -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-793"></span><span>      </span><span class="annot"><span class="annottext">Warning -&gt; ScopeM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; ScopeM ()) -&gt; Warning -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameOrModule -&gt; [Name] -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#ClashesViaRenaming"><span class="hs-identifier hs-var">ClashesViaRenaming</span></a></span><span> </span><span class="annot"><span class="annottext">NameOrModule
</span><a href="Agda.Syntax.Scope.Base.html#NameNotModule"><span class="hs-identifier hs-var">NameNotModule</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Warning) -&gt; [Name] -&gt; Warning
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; [Name]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680700478"><span class="hs-identifier hs-var">nameClashes</span></a></span><span>
</span><span id="line-794"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ScopeM () -&gt; ScopeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Name -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680700477"><span class="hs-identifier hs-var">moduleClashes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; ScopeM ()) -&gt; ScopeM () -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-795"></span><span>      </span><span class="annot"><span class="annottext">Warning -&gt; ScopeM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; ScopeM ()) -&gt; Warning -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameOrModule -&gt; [Name] -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#ClashesViaRenaming"><span class="hs-identifier hs-var">ClashesViaRenaming</span></a></span><span> </span><span class="annot"><span class="annottext">NameOrModule
</span><a href="Agda.Syntax.Scope.Base.html#ModuleNotName"><span class="hs-identifier hs-var">ModuleNotName</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Warning) -&gt; [Name] -&gt; Warning
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; [Name]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680700477"><span class="hs-identifier hs-var">moduleClashes</span></a></span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span>    </span><span class="hs-comment">-- Look up the defined names in the new scope.</span><span>
</span><span id="line-798"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700470"><span class="annot"><span class="annottext">namesInScope' :: NamesInScope
</span><a href="#local-6989586621680700470"><span class="hs-identifier hs-var hs-var">namesInScope'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope -&gt; NamesInScope
forall a. InScope a =&gt; Scope -&gt; ThingsInScope a
</span><a href="Agda.Syntax.Scope.Base.html#allNamesInScope"><span class="hs-identifier hs-var">allNamesInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700479"><span class="hs-identifier hs-var">scope'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ThingsInScope"><span class="hs-identifier hs-type">ThingsInScope</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractName"><span class="hs-identifier hs-type">AbstractName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700468"><span class="annot"><span class="annottext">modulesInScope' :: ModulesInScope
</span><a href="#local-6989586621680700468"><span class="hs-identifier hs-var hs-var">modulesInScope'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope -&gt; ModulesInScope
forall a. InScope a =&gt; Scope -&gt; ThingsInScope a
</span><a href="Agda.Syntax.Scope.Base.html#allNamesInScope"><span class="hs-identifier hs-var">allNamesInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700479"><span class="hs-identifier hs-var">scope'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ThingsInScope"><span class="hs-identifier hs-type">ThingsInScope</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractModule"><span class="hs-identifier hs-type">AbstractModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700467"><span class="annot"><span class="annottext">look :: k -&gt; Map k [c] -&gt; c
</span><a href="#local-6989586621680700467"><span class="hs-identifier hs-var hs-var">look</span></a></span></span><span> </span><span id="local-6989586621680700466"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680700466"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c -&gt; [c] -&gt; c
forall a. a -&gt; [a] -&gt; a
</span><a href="Agda.Utils.List.html#headWithDefault"><span class="hs-identifier hs-var">headWithDefault</span></a></span><span> </span><span class="annot"><span class="annottext">c
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">([c] -&gt; c) -&gt; (Map k [c] -&gt; [c]) -&gt; Map k [c] -&gt; c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[c] -&gt; k -&gt; Map k [c] -&gt; [c]
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">Map.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">[c]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680700466"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-801"></span><span>    </span><span class="hs-comment">-- We set the ranges to the ranges of the concrete names in order to get</span><span>
</span><span id="line-802"></span><span>    </span><span class="hs-comment">-- highlighting for the names in the import directive.</span><span>
</span><span id="line-803"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700464"><span class="annot"><span class="annottext">definedA :: [ImportedName' (Name, QName) (Name, ModuleName)]
</span><a href="#local-6989586621680700464"><span class="hs-identifier hs-var hs-var">definedA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; (ImportedName' Name Name
    -&gt; ImportedName' (Name, QName) (Name, ModuleName))
-&gt; [ImportedName' (Name, QName) (Name, ModuleName)]
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700492"><span class="hs-identifier hs-var">definedNames</span></a></span><span> </span><span class="annot"><span class="annottext">((ImportedName' Name Name
  -&gt; ImportedName' (Name, QName) (Name, ModuleName))
 -&gt; [ImportedName' (Name, QName) (Name, ModuleName)])
-&gt; (ImportedName' Name Name
    -&gt; ImportedName' (Name, QName) (Name, ModuleName))
-&gt; [ImportedName' (Name, QName) (Name, ModuleName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-804"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-type">ImportedName</span></a></span><span>   </span><span id="local-6989586621680700462"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700462"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name, QName) -&gt; ImportedName' (Name, QName) (Name, ModuleName)
forall n m. n -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-var">ImportedName</span></a></span><span>   </span><span class="annot"><span class="annottext">((Name, QName) -&gt; ImportedName' (Name, QName) (Name, ModuleName))
-&gt; (AbstractName -&gt; (Name, QName))
-&gt; AbstractName
-&gt; ImportedName' (Name, QName) (Name, ModuleName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700462"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; (Name, QName))
-&gt; (AbstractName -&gt; QName) -&gt; AbstractName -&gt; (Name, QName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; QName -&gt; QName
forall a. SetRange a =&gt; Range -&gt; a -&gt; a
</span><a href="Agda.Syntax.Position.html#setRange"><span class="hs-identifier hs-var">setRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700462"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; QName)
-&gt; (AbstractName -&gt; QName) -&gt; AbstractName -&gt; QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var hs-var">anameName</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; ImportedName' (Name, QName) (Name, ModuleName))
-&gt; AbstractName -&gt; ImportedName' (Name, QName) (Name, ModuleName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NamesInScope -&gt; AbstractName
forall k c. Ord k =&gt; k -&gt; Map k [c] -&gt; c
</span><a href="#local-6989586621680700467"><span class="hs-identifier hs-var">look</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700462"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">NamesInScope
</span><a href="#local-6989586621680700470"><span class="hs-identifier hs-var">namesInScope'</span></a></span><span>
</span><span id="line-805"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-type">ImportedModule</span></a></span><span> </span><span id="local-6989586621680700461"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700461"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name, ModuleName)
-&gt; ImportedName' (Name, QName) (Name, ModuleName)
forall n m. m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-var">ImportedModule</span></a></span><span> </span><span class="annot"><span class="annottext">((Name, ModuleName)
 -&gt; ImportedName' (Name, QName) (Name, ModuleName))
-&gt; (AbstractModule -&gt; (Name, ModuleName))
-&gt; AbstractModule
-&gt; ImportedName' (Name, QName) (Name, ModuleName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700461"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; (Name, ModuleName))
-&gt; (AbstractModule -&gt; ModuleName)
-&gt; AbstractModule
-&gt; (Name, ModuleName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; ModuleName -&gt; ModuleName
forall a. SetRange a =&gt; Range -&gt; a -&gt; a
</span><a href="Agda.Syntax.Position.html#setRange"><span class="hs-identifier hs-var">setRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700461"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; ModuleName)
-&gt; (AbstractModule -&gt; ModuleName) -&gt; AbstractModule -&gt; ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractModule -&gt; ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#amodName"><span class="hs-identifier hs-var hs-var">amodName</span></a></span><span>  </span><span class="annot"><span class="annottext">(AbstractModule -&gt; ImportedName' (Name, QName) (Name, ModuleName))
-&gt; AbstractModule -&gt; ImportedName' (Name, QName) (Name, ModuleName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ModulesInScope -&gt; AbstractModule
forall k c. Ord k =&gt; k -&gt; Map k [c] -&gt; c
</span><a href="#local-6989586621680700467"><span class="hs-identifier hs-var">look</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700461"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ModulesInScope
</span><a href="#local-6989586621680700468"><span class="hs-identifier hs-var">modulesInScope'</span></a></span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700460"><span class="annot"><span class="annottext">adir :: ImportDirective
</span><a href="#local-6989586621680700460"><span class="hs-identifier hs-var hs-var">adir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ImportedName' (Name, QName) (Name, ModuleName)]
-&gt; [ImportedName' (Name, QName) (Name, ModuleName)]
-&gt; ImportDirective
-&gt; ImportDirective
forall n1 m1 n2 m2.
(Ord n1, Ord m1) =&gt;
[ImportedName' (n1, n2) (m1, m2)]
-&gt; [ImportedName' (n1, n2) (m1, m2)]
-&gt; ImportDirective' n1 m1
-&gt; ImportDirective' n2 m2
</span><a href="Agda.Syntax.Scope.Monad.html#mapImportDir"><span class="hs-identifier hs-var">mapImportDir</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' (Name, QName) (Name, ModuleName)]
</span><a href="#local-6989586621680700508"><span class="hs-identifier hs-var">namesA</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' (Name, QName) (Name, ModuleName)]
</span><a href="#local-6989586621680700464"><span class="hs-identifier hs-var">definedA</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700495"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-808"></span><span>    </span><span class="annot"><span class="annottext">(ImportDirective, Scope) -&gt; ScopeM (ImportDirective, Scope)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700460"><span class="hs-identifier hs-var">adir</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700479"><span class="hs-identifier hs-var">scope'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO Issue 1714: adir</span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-811"></span><span>    </span><span class="hs-comment">-- Andreas, 2020-06-23, issue #4773, fixing regression in 2.5.1.</span><span>
</span><span id="line-812"></span><span>    </span><span class="hs-comment">-- Import directive may not mention private things.</span><span>
</span><span id="line-813"></span><span>    </span><span class="hs-comment">-- ```agda</span><span>
</span><span id="line-814"></span><span>    </span><span class="hs-comment">--   module M where private X = Set</span><span>
</span><span id="line-815"></span><span>    </span><span class="hs-comment">--   module N = M using (X)</span><span>
</span><span id="line-816"></span><span>    </span><span class="hs-comment">-- ```</span><span>
</span><span id="line-817"></span><span>    </span><span class="hs-comment">-- Further, modules (N) need not copy private things (X) from other</span><span>
</span><span id="line-818"></span><span>    </span><span class="hs-comment">-- modules (M) ever, since they cannot legally referred to</span><span>
</span><span id="line-819"></span><span>    </span><span class="hs-comment">-- (neither through qualification (N.X) nor open N).</span><span>
</span><span id="line-820"></span><span>    </span><span class="hs-comment">-- Thus, we can unconditionally remove private definitions</span><span>
</span><span id="line-821"></span><span>    </span><span class="hs-comment">-- before we apply the import directive.</span><span>
</span><span id="line-822"></span><span>    </span><span id="local-6989586621680700475"><span class="annot"><span class="annottext">scope :: Scope
</span><a href="#local-6989586621680700475"><span class="hs-identifier hs-var hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#restrictPrivate"><span class="hs-identifier hs-var">restrictPrivate</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700512"><span class="hs-identifier hs-var">scope0</span></a></span><span>
</span><span id="line-823"></span><span>
</span><span id="line-824"></span><span>    </span><span class="hs-comment">-- | Return names in the @using@ directive, discarding duplicates.</span><span>
</span><span id="line-825"></span><span>    </span><span class="hs-comment">-- Monadic for the sake of throwing warnings.</span><span>
</span><span id="line-826"></span><span>    </span><span class="annot"><a href="#local-6989586621680700510"><span class="hs-identifier hs-type">discardDuplicatesInUsing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#Using"><span class="hs-identifier hs-type">C.Using</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.html#ImportedName"><span class="hs-identifier hs-type">C.ImportedName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-827"></span><span>    </span><span id="local-6989586621680700510"><span class="annot"><span class="annottext">discardDuplicatesInUsing :: Using' Name Name -&gt; ScopeM [ImportedName' Name Name]
</span><a href="#local-6989586621680700510"><span class="hs-identifier hs-var hs-var">discardDuplicatesInUsing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-828"></span><span>      </span><span class="annot"><span class="annottext">Using' Name Name
</span><a href="Agda.Syntax.Common.html#UseEverything"><span class="hs-identifier hs-var">UseEverything</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; ScopeM [ImportedName' Name Name]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-829"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Common.html#Using"><span class="hs-identifier hs-type">Using</span></a></span><span>  </span><span id="local-6989586621680700454"><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700454"><span class="hs-identifier hs-var">xs</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-830"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700453"><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700453"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700452"><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700452"><span class="hs-identifier hs-var">dups</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImportedName' Name Name -&gt; ImportedName' Name Name)
-&gt; [ImportedName' Name Name]
-&gt; ([ImportedName' Name Name], [ImportedName' Name Name])
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; ([a], [a])
</span><a href="Agda.Utils.List.html#nubAndDuplicatesOn"><span class="hs-identifier hs-var">nubAndDuplicatesOn</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; ImportedName' Name Name
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700454"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-831"></span><span>        </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; (List1 (ImportedName' Name Name) -&gt; ScopeM ()) -&gt; ScopeM ()
forall m a. Null m =&gt; [a] -&gt; (List1 a -&gt; m) -&gt; m
</span><a href="Agda.Utils.List1.html#unlessNull"><span class="hs-identifier hs-var">List1.unlessNull</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700452"><span class="hs-identifier hs-var">dups</span></a></span><span> </span><span class="annot"><span class="annottext">((List1 (ImportedName' Name Name) -&gt; ScopeM ()) -&gt; ScopeM ())
-&gt; (List1 (ImportedName' Name Name) -&gt; ScopeM ()) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Warning -&gt; ScopeM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; ScopeM ())
-&gt; (List1 (ImportedName' Name Name) -&gt; Warning)
-&gt; List1 (ImportedName' Name Name)
-&gt; ScopeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">List1 (ImportedName' Name Name) -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#DuplicateUsing"><span class="hs-identifier hs-var">DuplicateUsing</span></a></span><span>
</span><span id="line-832"></span><span>        </span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; ScopeM [ImportedName' Name Name]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700453"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span>    </span><span class="hs-comment">-- | If both @using@ and @hiding@ directive are present,</span><span>
</span><span id="line-835"></span><span>    </span><span class="hs-comment">-- the hiding directive may only contain modules whose twins are mentioned.</span><span>
</span><span id="line-836"></span><span>    </span><span class="hs-comment">-- Monadic for the sake of error reporting.</span><span>
</span><span id="line-837"></span><span>    </span><span id="local-6989586621680700484"><span class="annot"><span class="annottext">sanityCheck :: (ImportedName' Name m -&gt; Bool)
-&gt; ImportDirective -&gt; m ImportDirective
</span><a href="#local-6989586621680700484"><span class="hs-identifier hs-var hs-var">sanityCheck</span></a></span></span><span> </span><span id="local-6989586621680700448"><span class="annot"><span class="annottext">ImportedName' Name m -&gt; Bool
</span><a href="#local-6989586621680700448"><span class="hs-identifier hs-var">notMentioned</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-838"></span><span>      </span><span id="local-6989586621680700447"><span class="annot"><span class="annottext">dir :: ImportDirective
</span><a href="#local-6989586621680700447"><span class="hs-identifier hs-var">dir</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ImportDirective"><span class="hs-identifier hs-type">ImportDirective</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">using :: forall n m. ImportDirective' n m -&gt; Using' n m
</span><a href="Agda.Syntax.Common.html#using"><span class="hs-identifier hs-var">using</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Using"><span class="hs-identifier hs-type">Using</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hiding :: forall n m. ImportDirective' n m -&gt; HidingDirective' n m
</span><a href="Agda.Syntax.Common.html#hiding"><span class="hs-keyword hs-var">hiding</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680700444"><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700444"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-839"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700443"><span class="annot"><span class="annottext">useless :: ImportedName' Name Name -&gt; Bool
</span><a href="#local-6989586621680700443"><span class="hs-identifier hs-var hs-var">useless</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-840"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-type">ImportedName</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-841"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-type">ImportedModule</span></a></span><span> </span><span id="local-6989586621680700442"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700442"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImportedName' Name m -&gt; Bool
</span><a href="#local-6989586621680700448"><span class="hs-identifier hs-var">notMentioned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ImportedName' Name m
forall n m. n -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-var">ImportedName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700442"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-842"></span><span>          </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; ([ImportedName' Name Name] -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ImportedName' Name Name -&gt; Bool)
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; Bool
</span><a href="#local-6989586621680700443"><span class="hs-identifier hs-var">useless</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700444"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([ImportedName' Name Name] -&gt; m ()) -&gt; m ())
-&gt; ([ImportedName' Name Name] -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Warning -&gt; m ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; m ())
-&gt; ([ImportedName' Name Name] -&gt; Warning)
-&gt; [ImportedName' Name Name]
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name] -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#UselessHiding"><span class="hs-identifier hs-var">UselessHiding</span></a></span><span>
</span><span id="line-843"></span><span>          </span><span class="hs-comment">-- We can empty @hiding@ now, since there is an explicit @using@ directive</span><span>
</span><span id="line-844"></span><span>          </span><span class="hs-comment">-- and @hiding@ served its purpose to prevent modules to enter the @Using@ list.</span><span>
</span><span id="line-845"></span><span>          </span><span class="annot"><span class="annottext">ImportDirective -&gt; m ImportDirective
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700447"><span class="hs-identifier hs-var">dir</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hiding :: [ImportedName' Name Name]
</span><a href="Agda.Syntax.Common.html#hiding"><span class="hs-keyword hs-var">hiding</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-846"></span><span>      </span><span id="local-6989586621680700440"><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700440"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImportDirective -&gt; m ImportDirective
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700440"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span>    </span><span class="annot"><a href="#local-6989586621680700483"><span class="hs-identifier hs-type">addExtraModules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#ImportDirective"><span class="hs-identifier hs-type">C.ImportDirective</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#ImportDirective"><span class="hs-identifier hs-type">C.ImportDirective</span></a></span><span>
</span><span id="line-849"></span><span>    </span><span id="local-6989586621680700483"><span class="annot"><span class="annottext">addExtraModules :: (Name -&gt; Bool) -&gt; ImportDirective -&gt; ImportDirective
</span><a href="#local-6989586621680700483"><span class="hs-identifier hs-var hs-var">addExtraModules</span></a></span></span><span> </span><span id="local-6989586621680700439"><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621680700439"><span class="hs-identifier hs-var">extra</span></a></span></span><span> </span><span id="local-6989586621680700438"><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700438"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-850"></span><span>      </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700438"><span class="hs-identifier hs-var">dir</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">using :: Using' Name Name
</span><a href="Agda.Syntax.Common.html#using"><span class="hs-identifier hs-var">using</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([ImportedName' Name Name] -&gt; [ImportedName' Name Name])
-&gt; Using' Name Name -&gt; Using' Name Name
forall n1 m1 n2 m2.
([ImportedName' n1 m1] -&gt; [ImportedName' n2 m2])
-&gt; Using' n1 m1 -&gt; Using' n2 m2
</span><a href="Agda.Syntax.Common.html#mapUsing"><span class="hs-identifier hs-var">mapUsing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ImportedName' Name Name -&gt; [ImportedName' Name Name])
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; [ImportedName' Name Name]
</span><a href="#local-6989586621680700436"><span class="hs-identifier hs-var">addExtra</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Using' Name Name -&gt; Using' Name Name)
-&gt; Using' Name Name -&gt; Using' Name Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportDirective -&gt; Using' Name Name
forall n m. ImportDirective' n m -&gt; Using' n m
</span><a href="Agda.Syntax.Common.html#using"><span class="hs-identifier hs-var hs-var">using</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700438"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-851"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hiding :: [ImportedName' Name Name]
</span><a href="Agda.Syntax.Common.html#hiding"><span class="hs-keyword hs-var">hiding</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImportedName' Name Name -&gt; [ImportedName' Name Name])
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name -&gt; [ImportedName' Name Name]
</span><a href="#local-6989586621680700436"><span class="hs-identifier hs-var">addExtra</span></a></span><span>            </span><span class="annot"><span class="annottext">([ImportedName' Name Name] -&gt; [ImportedName' Name Name])
-&gt; [ImportedName' Name Name] -&gt; [ImportedName' Name Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportDirective -&gt; [ImportedName' Name Name]
forall n m. ImportDirective' n m -&gt; HidingDirective' n m
</span><a href="Agda.Syntax.Common.html#hiding"><span class="hs-keyword hs-var hs-var">hiding</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700438"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-852"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">impRenaming :: [Renaming]
</span><a href="Agda.Syntax.Common.html#impRenaming"><span class="hs-identifier hs-var">impRenaming</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Renaming -&gt; [Renaming]) -&gt; [Renaming] -&gt; [Renaming]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Renaming -&gt; [Renaming]
</span><a href="#local-6989586621680700434"><span class="hs-identifier hs-var">extraRenaming</span></a></span><span>       </span><span class="annot"><span class="annottext">([Renaming] -&gt; [Renaming]) -&gt; [Renaming] -&gt; [Renaming]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportDirective -&gt; [Renaming]
forall n m. ImportDirective' n m -&gt; RenamingDirective' n m
</span><a href="Agda.Syntax.Common.html#impRenaming"><span class="hs-identifier hs-var hs-var">impRenaming</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700438"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-853"></span><span>         </span><span class="hs-special">}</span><span>
</span><span id="line-854"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-855"></span><span>        </span><span id="local-6989586621680700436"><span class="annot"><span class="annottext">addExtra :: ImportedName' Name Name -&gt; [ImportedName' Name Name]
</span><a href="#local-6989586621680700436"><span class="hs-identifier hs-var hs-var">addExtra</span></a></span></span><span> </span><span id="local-6989586621680700433"><span class="annot"><span class="annottext">f :: ImportedName' Name Name
</span><a href="#local-6989586621680700433"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-type">ImportedName</span></a></span><span> </span><span id="local-6989586621680700432"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700432"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621680700439"><span class="hs-identifier hs-var">extra</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700432"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ImportedName' Name Name
</span><a href="#local-6989586621680700433"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ImportedName' Name Name
forall n m. m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-var">ImportedModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700432"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-856"></span><span>        </span><span class="annot"><a href="#local-6989586621680700436"><span class="hs-identifier hs-var">addExtra</span></a></span><span> </span><span id="local-6989586621680700431"><span class="annot"><span class="annottext">ImportedName' Name Name
</span><a href="#local-6989586621680700431"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ImportedName' Name Name
</span><a href="#local-6989586621680700431"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span>        </span><span id="local-6989586621680700434"><span class="annot"><span class="annottext">extraRenaming :: Renaming -&gt; [Renaming]
</span><a href="#local-6989586621680700434"><span class="hs-identifier hs-var hs-var">extraRenaming</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-859"></span><span>          </span><span id="local-6989586621680700430"><span class="annot"><span class="annottext">r :: Renaming
</span><a href="#local-6989586621680700430"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Renaming"><span class="hs-identifier hs-type">Renaming</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-type">ImportedName</span></a></span><span> </span><span id="local-6989586621680700429"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700429"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-type">ImportedName</span></a></span><span> </span><span id="local-6989586621680700428"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700428"><span class="hs-identifier hs-var">z</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680700427"><span class="annot"><span class="annottext">Maybe Fixity
</span><a href="#local-6989586621680700427"><span class="hs-identifier hs-var">_fixity</span></a></span></span><span> </span><span id="local-6989586621680700426"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700426"><span class="hs-identifier hs-var">rng</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621680700439"><span class="hs-identifier hs-var">extra</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700429"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-860"></span><span>             </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Renaming
</span><a href="#local-6989586621680700430"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name
-&gt; ImportedName' Name Name -&gt; Maybe Fixity -&gt; Range -&gt; Renaming
forall n m.
ImportedName' n m
-&gt; ImportedName' n m -&gt; Maybe Fixity -&gt; Range -&gt; Renaming' n m
</span><a href="Agda.Syntax.Common.html#Renaming"><span class="hs-identifier hs-var">Renaming</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ImportedName' Name Name
forall n m. m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-var">ImportedModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700429"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ImportedName' Name Name
forall n m. m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-var">ImportedModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700428"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Fixity
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700426"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-861"></span><span>          </span><span id="local-6989586621680700425"><span class="annot"><span class="annottext">Renaming
</span><a href="#local-6989586621680700425"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Renaming
</span><a href="#local-6989586621680700425"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span>    </span><span class="hs-comment">-- | Names and modules (abstract) in scope before the import.</span><span>
</span><span id="line-864"></span><span>    </span><span id="local-6989586621680700502"><span class="annot"><span class="annottext">namesInScope :: NamesInScope
</span><a href="#local-6989586621680700502"><span class="hs-identifier hs-var hs-var">namesInScope</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope -&gt; NamesInScope
forall a. InScope a =&gt; Scope -&gt; ThingsInScope a
</span><a href="Agda.Syntax.Scope.Base.html#allNamesInScope"><span class="hs-identifier hs-var">allNamesInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700475"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ThingsInScope"><span class="hs-identifier hs-type">ThingsInScope</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractName"><span class="hs-identifier hs-type">AbstractName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-865"></span><span>    </span><span id="local-6989586621680700501"><span class="annot"><span class="annottext">modulesInScope :: ModulesInScope
</span><a href="#local-6989586621680700501"><span class="hs-identifier hs-var hs-var">modulesInScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope -&gt; ModulesInScope
forall a. InScope a =&gt; Scope -&gt; ThingsInScope a
</span><a href="Agda.Syntax.Scope.Base.html#allNamesInScope"><span class="hs-identifier hs-var">allNamesInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700475"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#ThingsInScope"><span class="hs-identifier hs-type">ThingsInScope</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#AbstractModule"><span class="hs-identifier hs-type">AbstractModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-866"></span><span>    </span><span id="local-6989586621680700424"><span class="annot"><span class="annottext">concreteNamesInScope :: [Name]
</span><a href="#local-6989586621680700424"><span class="hs-identifier hs-var hs-var">concreteNamesInScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamesInScope -&gt; [Name]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">NamesInScope
</span><a href="#local-6989586621680700502"><span class="hs-identifier hs-var">namesInScope</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ModulesInScope -&gt; [Name]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">ModulesInScope
</span><a href="#local-6989586621680700501"><span class="hs-identifier hs-var">modulesInScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-867"></span><span>
</span><span id="line-868"></span><span>    </span><span class="hs-comment">-- | AST versions of the concrete names passed as an argument.</span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-comment">--   We get back a pair consisting of a list of missing exports first,</span><span>
</span><span id="line-870"></span><span>    </span><span class="hs-comment">--   and a list of successful imports second.</span><span>
</span><span id="line-871"></span><span>    </span><span class="annot"><a href="#local-6989586621680700507"><span class="hs-identifier hs-type">checkExist</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.html#ImportedName"><span class="hs-identifier hs-type">ImportedName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Concrete.html#ImportedName"><span class="hs-identifier hs-type">ImportedName</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName%27"><span class="hs-identifier hs-type">ImportedName'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">A.QName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#Name"><span class="hs-identifier hs-type">C.Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-872"></span><span>    </span><span id="local-6989586621680700507"><span class="annot"><span class="annottext">checkExist :: [ImportedName' Name Name]
-&gt; ([ImportedName' Name Name],
    [ImportedName' (Name, QName) (Name, ModuleName)])
</span><a href="#local-6989586621680700507"><span class="hs-identifier hs-var hs-var">checkExist</span></a></span></span><span> </span><span id="local-6989586621680700423"><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700423"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either
   (ImportedName' Name Name)
   (ImportedName' (Name, QName) (Name, ModuleName))]
-&gt; ([ImportedName' Name Name],
    [ImportedName' (Name, QName) (Name, ModuleName)])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">([Either
    (ImportedName' Name Name)
    (ImportedName' (Name, QName) (Name, ModuleName))]
 -&gt; ([ImportedName' Name Name],
     [ImportedName' (Name, QName) (Name, ModuleName)]))
-&gt; [Either
      (ImportedName' Name Name)
      (ImportedName' (Name, QName) (Name, ModuleName))]
-&gt; ([ImportedName' Name Name],
    [ImportedName' (Name, QName) (Name, ModuleName)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
-&gt; (ImportedName' Name Name
    -&gt; Either
         (ImportedName' Name Name)
         (ImportedName' (Name, QName) (Name, ModuleName)))
-&gt; [Either
      (ImportedName' Name Name)
      (ImportedName' (Name, QName) (Name, ModuleName))]
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' Name Name]
</span><a href="#local-6989586621680700423"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">((ImportedName' Name Name
  -&gt; Either
       (ImportedName' Name Name)
       (ImportedName' (Name, QName) (Name, ModuleName)))
 -&gt; [Either
       (ImportedName' Name Name)
       (ImportedName' (Name, QName) (Name, ModuleName))])
-&gt; (ImportedName' Name Name
    -&gt; Either
         (ImportedName' Name Name)
         (ImportedName' (Name, QName) (Name, ModuleName)))
-&gt; [Either
      (ImportedName' Name Name)
      (ImportedName' (Name, QName) (Name, ModuleName))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700422"><span class="annot"><span class="annottext">ImportedName' Name Name
</span><a href="#local-6989586621680700422"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name
</span><a href="#local-6989586621680700422"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-873"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-type">ImportedName</span></a></span><span> </span><span id="local-6989586621680700421"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700421"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name, QName) -&gt; ImportedName' (Name, QName) (Name, ModuleName)
forall n m. n -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-var">ImportedName</span></a></span><span>   </span><span class="annot"><span class="annottext">((Name, QName) -&gt; ImportedName' (Name, QName) (Name, ModuleName))
-&gt; (AbstractName -&gt; (Name, QName))
-&gt; AbstractName
-&gt; ImportedName' (Name, QName) (Name, ModuleName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700421"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; (Name, QName))
-&gt; (AbstractName -&gt; QName) -&gt; AbstractName -&gt; (Name, QName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; QName -&gt; QName
forall a. SetRange a =&gt; Range -&gt; a -&gt; a
</span><a href="Agda.Syntax.Position.html#setRange"><span class="hs-identifier hs-var">setRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700421"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; QName)
-&gt; (AbstractName -&gt; QName) -&gt; AbstractName -&gt; QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var hs-var">anameName</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; ImportedName' (Name, QName) (Name, ModuleName))
-&gt; Either (ImportedName' Name Name) AbstractName
-&gt; Either
     (ImportedName' Name Name)
     (ImportedName' (Name, QName) (Name, ModuleName))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name
-&gt; Name
-&gt; NamesInScope
-&gt; Either (ImportedName' Name Name) AbstractName
forall a err b. Ord a =&gt; err -&gt; a -&gt; Map a [b] -&gt; Either err b
</span><a href="#local-6989586621680700420"><span class="hs-identifier hs-var">resolve</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name
</span><a href="#local-6989586621680700422"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700421"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">NamesInScope
</span><a href="#local-6989586621680700502"><span class="hs-identifier hs-var">namesInScope</span></a></span><span>
</span><span id="line-874"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-type">ImportedModule</span></a></span><span> </span><span id="local-6989586621680700419"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700419"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name, ModuleName)
-&gt; ImportedName' (Name, QName) (Name, ModuleName)
forall n m. m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-var">ImportedModule</span></a></span><span> </span><span class="annot"><span class="annottext">((Name, ModuleName)
 -&gt; ImportedName' (Name, QName) (Name, ModuleName))
-&gt; (AbstractModule -&gt; (Name, ModuleName))
-&gt; AbstractModule
-&gt; ImportedName' (Name, QName) (Name, ModuleName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700419"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; (Name, ModuleName))
-&gt; (AbstractModule -&gt; ModuleName)
-&gt; AbstractModule
-&gt; (Name, ModuleName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; ModuleName -&gt; ModuleName
forall a. SetRange a =&gt; Range -&gt; a -&gt; a
</span><a href="Agda.Syntax.Position.html#setRange"><span class="hs-identifier hs-var">setRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700419"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; ModuleName)
-&gt; (AbstractModule -&gt; ModuleName) -&gt; AbstractModule -&gt; ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AbstractModule -&gt; ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#amodName"><span class="hs-identifier hs-var hs-var">amodName</span></a></span><span>  </span><span class="annot"><span class="annottext">(AbstractModule -&gt; ImportedName' (Name, QName) (Name, ModuleName))
-&gt; Either (ImportedName' Name Name) AbstractModule
-&gt; Either
     (ImportedName' Name Name)
     (ImportedName' (Name, QName) (Name, ModuleName))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name
-&gt; Name
-&gt; ModulesInScope
-&gt; Either (ImportedName' Name Name) AbstractModule
forall a err b. Ord a =&gt; err -&gt; a -&gt; Map a [b] -&gt; Either err b
</span><a href="#local-6989586621680700420"><span class="hs-identifier hs-var">resolve</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedName' Name Name
</span><a href="#local-6989586621680700422"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700419"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ModulesInScope
</span><a href="#local-6989586621680700501"><span class="hs-identifier hs-var">modulesInScope</span></a></span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680701151"><span id="local-6989586621680701152"><span id="local-6989586621680701153"><span class="annot"><a href="#local-6989586621680700420"><span class="hs-identifier hs-type">resolve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680701153"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701152"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680701153"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680701153"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680701151"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680701152"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701151"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-877"></span><span>            </span><span id="local-6989586621680700420"><span class="annot"><span class="annottext">resolve :: err -&gt; a -&gt; Map a [b] -&gt; Either err b
</span><a href="#local-6989586621680700420"><span class="hs-identifier hs-var hs-var">resolve</span></a></span></span><span> </span><span id="local-6989586621680700418"><span class="annot"><span class="annottext">err
</span><a href="#local-6989586621680700418"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621680700417"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680700417"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680700416"><span class="annot"><span class="annottext">Map a [b]
</span><a href="#local-6989586621680700416"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either err b -&gt; ([b] -&gt; Either err b) -&gt; Maybe [b] -&gt; Either err b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">err -&gt; Either err b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">err
</span><a href="#local-6989586621680700418"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Either err b
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Either err b) -&gt; ([b] -&gt; b) -&gt; [b] -&gt; Either err b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[b] -&gt; b
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe [b] -&gt; Either err b) -&gt; Maybe [b] -&gt; Either err b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Map a [b] -&gt; Maybe [b]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680700417"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map a [b]
</span><a href="#local-6989586621680700416"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span class="hs-comment">-- | Translation of @ImportDirective@.</span><span>
</span><span id="line-880"></span><span id="local-6989586621680701163"><span id="local-6989586621680701164"><span id="local-6989586621680701165"><span id="local-6989586621680701166"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#mapImportDir"><span class="hs-identifier hs-type">mapImportDir</span></a></span><span>
</span><span id="line-881"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680701166"><span class="hs-identifier hs-type">n1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680701165"><span class="hs-identifier hs-type">m1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName%27"><span class="hs-identifier hs-type">ImportedName'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680701166"><span class="hs-identifier hs-type">n1</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680701164"><span class="hs-identifier hs-type">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680701165"><span class="hs-identifier hs-type">m1</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680701163"><span class="hs-identifier hs-type">m2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ Translation of imported names.</span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName%27"><span class="hs-identifier hs-type">ImportedName'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680701166"><span class="hs-identifier hs-type">n1</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680701164"><span class="hs-identifier hs-type">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680701165"><span class="hs-identifier hs-type">m1</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680701163"><span class="hs-identifier hs-type">m2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ Translation of names defined by this import.</span><span>
</span><span id="line-884"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportDirective%27"><span class="hs-identifier hs-type">ImportDirective'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701166"><span class="hs-identifier hs-type">n1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701165"><span class="hs-identifier hs-type">m1</span></a></span><span>
</span><span id="line-885"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportDirective%27"><span class="hs-identifier hs-type">ImportDirective'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701164"><span class="hs-identifier hs-type">n2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701163"><span class="hs-identifier hs-type">m2</span></a></span></span></span></span></span><span>
</span><span id="line-886"></span><span id="mapImportDir"><span class="annot"><span class="annottext">mapImportDir :: [ImportedName' (n1, n2) (m1, m2)]
-&gt; [ImportedName' (n1, n2) (m1, m2)]
-&gt; ImportDirective' n1 m1
-&gt; ImportDirective' n2 m2
</span><a href="Agda.Syntax.Scope.Monad.html#mapImportDir"><span class="hs-identifier hs-var hs-var">mapImportDir</span></a></span></span><span> </span><span id="local-6989586621680700414"><span class="annot"><span class="annottext">[ImportedName' (n1, n2) (m1, m2)]
</span><a href="#local-6989586621680700414"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621680700413"><span class="annot"><span class="annottext">[ImportedName' (n1, n2) (m1, m2)]
</span><a href="#local-6989586621680700413"><span class="hs-identifier hs-var">tgt0</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ImportDirective"><span class="hs-identifier hs-type">ImportDirective</span></a></span><span> </span><span id="local-6989586621680700412"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700412"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680700411"><span class="annot"><span class="annottext">Using' n1 m1
</span><a href="#local-6989586621680700411"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621680700410"><span class="annot"><span class="annottext">HidingDirective' n1 m1
</span><a href="#local-6989586621680700410"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621680700409"><span class="annot"><span class="annottext">RenamingDirective' n1 m1
</span><a href="#local-6989586621680700409"><span class="hs-identifier hs-var">ren</span></a></span></span><span> </span><span id="local-6989586621680700408"><span class="annot"><span class="annottext">Maybe Range
</span><a href="#local-6989586621680700408"><span class="hs-identifier hs-var">open</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-887"></span><span>  </span><span class="annot"><span class="annottext">Range
-&gt; Using' n2 m2
-&gt; HidingDirective' n2 m2
-&gt; RenamingDirective' n2 m2
-&gt; Maybe Range
-&gt; ImportDirective' n2 m2
forall n m.
Range
-&gt; Using' n m
-&gt; HidingDirective' n m
-&gt; RenamingDirective' n m
-&gt; Maybe Range
-&gt; ImportDirective' n m
</span><a href="Agda.Syntax.Common.html#ImportDirective"><span class="hs-identifier hs-var">ImportDirective</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700412"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-888"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HidingDirective' n1 m1 -&gt; HidingDirective' n2 m2)
-&gt; Using' n1 m1 -&gt; Using' n2 m2
forall n1 m1 n2 m2.
([ImportedName' n1 m1] -&gt; [ImportedName' n2 m2])
-&gt; Using' n1 m1 -&gt; Using' n2 m2
</span><a href="Agda.Syntax.Common.html#mapUsing"><span class="hs-identifier hs-var">mapUsing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ImportedName' n1 m1 -&gt; ImportedName' n2 m2)
-&gt; HidingDirective' n1 m1 -&gt; HidingDirective' n2 m2
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' n1 m1 -&gt; ImportedName' n2 m2
forall n1 m1 n2 m2.
(Ord n1, Ord m1) =&gt;
ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' n1 m1 -&gt; ImportedName' n2 m2
</span><a href="Agda.Syntax.Scope.Monad.html#lookupImportedName"><span class="hs-identifier hs-var">lookupImportedName</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700406"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Using' n1 m1
</span><a href="#local-6989586621680700411"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-889"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ImportedName' n1 m1 -&gt; ImportedName' n2 m2)
-&gt; HidingDirective' n1 m1 -&gt; HidingDirective' n2 m2
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' n1 m1 -&gt; ImportedName' n2 m2
forall n1 m1 n2 m2.
(Ord n1, Ord m1) =&gt;
ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' n1 m1 -&gt; ImportedName' n2 m2
</span><a href="Agda.Syntax.Scope.Monad.html#lookupImportedName"><span class="hs-identifier hs-var">lookupImportedName</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700406"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HidingDirective' n1 m1
</span><a href="#local-6989586621680700410"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-890"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Renaming' n1 m1 -&gt; Renaming' n2 m2)
-&gt; RenamingDirective' n1 m1 -&gt; RenamingDirective' n2 m2
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
-&gt; ImportedNameMap n1 n2 m1 m2
-&gt; Renaming' n1 m1
-&gt; Renaming' n2 m2
forall n1 m1 n2 m2.
(Ord n1, Ord m1) =&gt;
ImportedNameMap n1 n2 m1 m2
-&gt; ImportedNameMap n1 n2 m1 m2
-&gt; Renaming' n1 m1
-&gt; Renaming' n2 m2
</span><a href="Agda.Syntax.Scope.Monad.html#mapRenaming"><span class="hs-identifier hs-var">mapRenaming</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700406"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700404"><span class="hs-identifier hs-var">tgt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RenamingDirective' n1 m1
</span><a href="#local-6989586621680700409"><span class="hs-identifier hs-var">ren</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>    </span><span class="annot"><span class="annottext">Maybe Range
</span><a href="#local-6989586621680700408"><span class="hs-identifier hs-var">open</span></a></span><span>
</span><span id="line-892"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-893"></span><span>  </span><span id="local-6989586621680700406"><span class="annot"><span class="annottext">src :: ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700406"><span class="hs-identifier hs-var hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ImportedName' (n1, n2) (m1, m2)] -&gt; ImportedNameMap n1 n2 m1 m2
forall n1 m1 n2 m2.
(Ord n1, Ord m1) =&gt;
[ImportedName' (n1, n2) (m1, m2)] -&gt; ImportedNameMap n1 n2 m1 m2
</span><a href="Agda.Syntax.Scope.Monad.html#importedNameMapFromList"><span class="hs-identifier hs-var">importedNameMapFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' (n1, n2) (m1, m2)]
</span><a href="#local-6989586621680700414"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-894"></span><span>  </span><span id="local-6989586621680700404"><span class="annot"><span class="annottext">tgt :: ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700404"><span class="hs-identifier hs-var hs-var">tgt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ImportedName' (n1, n2) (m1, m2)] -&gt; ImportedNameMap n1 n2 m1 m2
forall n1 m1 n2 m2.
(Ord n1, Ord m1) =&gt;
[ImportedName' (n1, n2) (m1, m2)] -&gt; ImportedNameMap n1 n2 m1 m2
</span><a href="Agda.Syntax.Scope.Monad.html#importedNameMapFromList"><span class="hs-identifier hs-var">importedNameMapFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedName' (n1, n2) (m1, m2)]
</span><a href="#local-6989586621680700413"><span class="hs-identifier hs-var">tgt0</span></a></span><span>
</span><span id="line-895"></span><span>
</span><span id="line-896"></span><span class="hs-comment">-- | A finite map for @ImportedName@s.</span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span class="hs-keyword">data</span><span> </span><span id="ImportedNameMap"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ImportedNameMap"><span class="hs-identifier hs-var">ImportedNameMap</span></a></span></span><span> </span><span id="local-6989586621680701107"><span class="annot"><a href="#local-6989586621680701107"><span class="hs-identifier hs-type">n1</span></a></span></span><span> </span><span id="local-6989586621680701106"><span class="annot"><a href="#local-6989586621680701106"><span class="hs-identifier hs-type">n2</span></a></span></span><span> </span><span id="local-6989586621680701105"><span class="annot"><a href="#local-6989586621680701105"><span class="hs-identifier hs-type">m1</span></a></span></span><span> </span><span id="local-6989586621680701104"><span class="annot"><a href="#local-6989586621680701104"><span class="hs-identifier hs-type">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ImportedNameMap"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ImportedNameMap"><span class="hs-identifier hs-var">ImportedNameMap</span></a></span></span><span>
</span><span id="line-899"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="inameMap"><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2 -&gt; Map n1 n2
</span><a href="Agda.Syntax.Scope.Monad.html#inameMap"><span class="hs-identifier hs-var hs-var">inameMap</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680701107"><span class="hs-identifier hs-type">n1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701106"><span class="hs-identifier hs-type">n2</span></a></span><span>
</span><span id="line-900"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="imoduleMap"><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2 -&gt; Map m1 m2
</span><a href="Agda.Syntax.Scope.Monad.html#imoduleMap"><span class="hs-identifier hs-var hs-var">imoduleMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680701105"><span class="hs-identifier hs-type">m1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701104"><span class="hs-identifier hs-type">m2</span></a></span><span>
</span><span id="line-901"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span class="hs-comment">-- | Create a 'ImportedNameMap'.</span><span>
</span><span id="line-904"></span><span id="local-6989586621680701129"><span id="local-6989586621680701130"><span id="local-6989586621680701131"><span id="local-6989586621680701132"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#importedNameMapFromList"><span class="hs-identifier hs-type">importedNameMapFromList</span></a></span><span>
</span><span id="line-905"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680701132"><span class="hs-identifier hs-type">n1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680701131"><span class="hs-identifier hs-type">m1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-906"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName%27"><span class="hs-identifier hs-type">ImportedName'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680701132"><span class="hs-identifier hs-type">n1</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680701130"><span class="hs-identifier hs-type">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680701131"><span class="hs-identifier hs-type">m1</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680701129"><span class="hs-identifier hs-type">m2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-907"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ImportedNameMap"><span class="hs-identifier hs-type">ImportedNameMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701132"><span class="hs-identifier hs-type">n1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701130"><span class="hs-identifier hs-type">n2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701131"><span class="hs-identifier hs-type">m1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701129"><span class="hs-identifier hs-type">m2</span></a></span></span></span></span></span><span>
</span><span id="line-908"></span><span id="importedNameMapFromList"><span class="annot"><span class="annottext">importedNameMapFromList :: [ImportedName' (n1, n2) (m1, m2)] -&gt; ImportedNameMap n1 n2 m1 m2
</span><a href="Agda.Syntax.Scope.Monad.html#importedNameMapFromList"><span class="hs-identifier hs-var hs-var">importedNameMapFromList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImportedName' (n1, n2) (m1, m2)
 -&gt; ImportedNameMap n1 n2 m1 m2 -&gt; ImportedNameMap n1 n2 m1 m2)
-&gt; ImportedNameMap n1 n2 m1 m2
-&gt; [ImportedName' (n1, n2) (m1, m2)]
-&gt; ImportedNameMap n1 n2 m1 m2
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ImportedNameMap n1 n2 m1 m2
 -&gt; ImportedName' (n1, n2) (m1, m2) -&gt; ImportedNameMap n1 n2 m1 m2)
-&gt; ImportedName' (n1, n2) (m1, m2)
-&gt; ImportedNameMap n1 n2 m1 m2
-&gt; ImportedNameMap n1 n2 m1 m2
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' (n1, n2) (m1, m2) -&gt; ImportedNameMap n1 n2 m1 m2
forall n1 m1 n2 m2.
(Ord n1, Ord m1) =&gt;
ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' (n1, n2) (m1, m2) -&gt; ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700397"><span class="hs-identifier hs-var">add</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImportedNameMap n1 n2 m1 m2
 -&gt; [ImportedName' (n1, n2) (m1, m2)]
 -&gt; ImportedNameMap n1 n2 m1 m2)
-&gt; ImportedNameMap n1 n2 m1 m2
-&gt; [ImportedName' (n1, n2) (m1, m2)]
-&gt; ImportedNameMap n1 n2 m1 m2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map n1 n2 -&gt; Map m1 m2 -&gt; ImportedNameMap n1 n2 m1 m2
forall n1 n2 m1 m2.
Map n1 n2 -&gt; Map m1 m2 -&gt; ImportedNameMap n1 n2 m1 m2
</span><a href="Agda.Syntax.Scope.Monad.html#ImportedNameMap"><span class="hs-identifier hs-var">ImportedNameMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map n1 n2
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Map m1 m2
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-909"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-910"></span><span>  </span><span id="local-6989586621680700397"><span class="annot"><span class="annottext">add :: ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' (n1, n2) (m1, m2) -&gt; ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700397"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ImportedNameMap"><span class="hs-identifier hs-type">ImportedNameMap</span></a></span><span> </span><span id="local-6989586621680700395"><span class="annot"><span class="annottext">Map n1 n2
</span><a href="#local-6989586621680700395"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621680700394"><span class="annot"><span class="annottext">Map m1 m2
</span><a href="#local-6989586621680700394"><span class="hs-identifier hs-var">mm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-911"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-type">ImportedName</span></a></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621680700393"><span class="annot"><span class="annottext">n1
</span><a href="#local-6989586621680700393"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680700392"><span class="annot"><span class="annottext">n2
</span><a href="#local-6989586621680700392"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map n1 n2 -&gt; Map m1 m2 -&gt; ImportedNameMap n1 n2 m1 m2
forall n1 n2 m1 m2.
Map n1 n2 -&gt; Map m1 m2 -&gt; ImportedNameMap n1 n2 m1 m2
</span><a href="Agda.Syntax.Scope.Monad.html#ImportedNameMap"><span class="hs-identifier hs-var">ImportedNameMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n1 -&gt; n2 -&gt; Map n1 n2 -&gt; Map n1 n2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">n1
</span><a href="#local-6989586621680700393"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">n2
</span><a href="#local-6989586621680700392"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Map n1 n2
</span><a href="#local-6989586621680700395"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map m1 m2
</span><a href="#local-6989586621680700394"><span class="hs-identifier hs-var">mm</span></a></span><span>
</span><span id="line-912"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-type">ImportedModule</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700391"><span class="annot"><span class="annottext">m1
</span><a href="#local-6989586621680700391"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680700390"><span class="annot"><span class="annottext">m2
</span><a href="#local-6989586621680700390"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map n1 n2 -&gt; Map m1 m2 -&gt; ImportedNameMap n1 n2 m1 m2
forall n1 n2 m1 m2.
Map n1 n2 -&gt; Map m1 m2 -&gt; ImportedNameMap n1 n2 m1 m2
</span><a href="Agda.Syntax.Scope.Monad.html#ImportedNameMap"><span class="hs-identifier hs-var">ImportedNameMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map n1 n2
</span><a href="#local-6989586621680700395"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m1 -&gt; m2 -&gt; Map m1 m2 -&gt; Map m1 m2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">m1
</span><a href="#local-6989586621680700391"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">m2
</span><a href="#local-6989586621680700390"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Map m1 m2
</span><a href="#local-6989586621680700394"><span class="hs-identifier hs-var">mm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span class="hs-comment">-- | Apply a 'ImportedNameMap'.</span><span>
</span><span id="line-915"></span><span id="local-6989586621680701137"><span id="local-6989586621680701138"><span id="local-6989586621680701139"><span id="local-6989586621680701140"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#lookupImportedName"><span class="hs-identifier hs-type">lookupImportedName</span></a></span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680701140"><span class="hs-identifier hs-type">n1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680701139"><span class="hs-identifier hs-type">m1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-917"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ImportedNameMap"><span class="hs-identifier hs-type">ImportedNameMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701140"><span class="hs-identifier hs-type">n1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701138"><span class="hs-identifier hs-type">n2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701139"><span class="hs-identifier hs-type">m1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701137"><span class="hs-identifier hs-type">m2</span></a></span><span>
</span><span id="line-918"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName%27"><span class="hs-identifier hs-type">ImportedName'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701140"><span class="hs-identifier hs-type">n1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701139"><span class="hs-identifier hs-type">m1</span></a></span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName%27"><span class="hs-identifier hs-type">ImportedName'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701138"><span class="hs-identifier hs-type">n2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701137"><span class="hs-identifier hs-type">m2</span></a></span></span></span></span></span><span>
</span><span id="line-920"></span><span id="lookupImportedName"><span class="annot"><span class="annottext">lookupImportedName :: ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' n1 m1 -&gt; ImportedName' n2 m2
</span><a href="Agda.Syntax.Scope.Monad.html#lookupImportedName"><span class="hs-identifier hs-var hs-var">lookupImportedName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ImportedNameMap"><span class="hs-identifier hs-type">ImportedNameMap</span></a></span><span> </span><span id="local-6989586621680700389"><span class="annot"><span class="annottext">Map n1 n2
</span><a href="#local-6989586621680700389"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621680700388"><span class="annot"><span class="annottext">Map m1 m2
</span><a href="#local-6989586621680700388"><span class="hs-identifier hs-var">mm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-921"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-type">ImportedName</span></a></span><span>   </span><span id="local-6989586621680700387"><span class="annot"><span class="annottext">n1
</span><a href="#local-6989586621680700387"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">n2 -&gt; ImportedName' n2 m2
forall n m. n -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedName"><span class="hs-identifier hs-var">ImportedName</span></a></span><span>   </span><span class="annot"><span class="annottext">(n2 -&gt; ImportedName' n2 m2) -&gt; n2 -&gt; ImportedName' n2 m2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n2 -&gt; n1 -&gt; Map n1 n2 -&gt; n2
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">Map.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">n2
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">n1
</span><a href="#local-6989586621680700387"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map n1 n2
</span><a href="#local-6989586621680700389"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-922"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-type">ImportedModule</span></a></span><span> </span><span id="local-6989586621680700386"><span class="annot"><span class="annottext">m1
</span><a href="#local-6989586621680700386"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m2 -&gt; ImportedName' n2 m2
forall n m. m -&gt; ImportedName' n m
</span><a href="Agda.Syntax.Common.html#ImportedModule"><span class="hs-identifier hs-var">ImportedModule</span></a></span><span> </span><span class="annot"><span class="annottext">(m2 -&gt; ImportedName' n2 m2) -&gt; m2 -&gt; ImportedName' n2 m2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m2 -&gt; m1 -&gt; Map m1 m2 -&gt; m2
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">Map.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">m2
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">m1
</span><a href="#local-6989586621680700386"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map m1 m2
</span><a href="#local-6989586621680700388"><span class="hs-identifier hs-var">mm</span></a></span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span class="hs-comment">-- | Translation of @Renaming@.</span><span>
</span><span id="line-925"></span><span id="local-6989586621680701133"><span id="local-6989586621680701134"><span id="local-6989586621680701135"><span id="local-6989586621680701136"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#mapRenaming"><span class="hs-identifier hs-type">mapRenaming</span></a></span><span>
</span><span id="line-926"></span><span>  </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680701136"><span class="hs-identifier hs-type">n1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680701135"><span class="hs-identifier hs-type">m1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-927"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ImportedNameMap"><span class="hs-identifier hs-type">ImportedNameMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701136"><span class="hs-identifier hs-type">n1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701134"><span class="hs-identifier hs-type">n2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701135"><span class="hs-identifier hs-type">m1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701133"><span class="hs-identifier hs-type">m2</span></a></span><span>  </span><span class="hs-comment">-- ^ Translation of 'renFrom' names and module names.</span><span>
</span><span id="line-928"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ImportedNameMap"><span class="hs-identifier hs-type">ImportedNameMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701136"><span class="hs-identifier hs-type">n1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701134"><span class="hs-identifier hs-type">n2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701135"><span class="hs-identifier hs-type">m1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701133"><span class="hs-identifier hs-type">m2</span></a></span><span>  </span><span class="hs-comment">-- ^ Translation of 'rento'   names and module names.</span><span>
</span><span id="line-929"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Renaming%27"><span class="hs-identifier hs-type">Renaming'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701136"><span class="hs-identifier hs-type">n1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701135"><span class="hs-identifier hs-type">m1</span></a></span><span>  </span><span class="hs-comment">-- ^ Renaming before translation (1).</span><span>
</span><span id="line-930"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Renaming%27"><span class="hs-identifier hs-type">Renaming'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701134"><span class="hs-identifier hs-type">n2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680701133"><span class="hs-identifier hs-type">m2</span></a></span><span>  </span><span class="hs-comment">-- ^ Renaming after  translation (2).</span></span></span></span></span><span>
</span><span id="line-931"></span><span id="mapRenaming"><span class="annot"><span class="annottext">mapRenaming :: ImportedNameMap n1 n2 m1 m2
-&gt; ImportedNameMap n1 n2 m1 m2
-&gt; Renaming' n1 m1
-&gt; Renaming' n2 m2
</span><a href="Agda.Syntax.Scope.Monad.html#mapRenaming"><span class="hs-identifier hs-var hs-var">mapRenaming</span></a></span></span><span> </span><span id="local-6989586621680700385"><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700385"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621680700384"><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700384"><span class="hs-identifier hs-var">tgt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Renaming"><span class="hs-identifier hs-type">Renaming</span></a></span><span> </span><span id="local-6989586621680700383"><span class="annot"><span class="annottext">ImportedName' n1 m1
</span><a href="#local-6989586621680700383"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621680700382"><span class="annot"><span class="annottext">ImportedName' n1 m1
</span><a href="#local-6989586621680700382"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span id="local-6989586621680700381"><span class="annot"><span class="annottext">Maybe Fixity
</span><a href="#local-6989586621680700381"><span class="hs-identifier hs-var">fixity</span></a></span></span><span> </span><span id="local-6989586621680700380"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700380"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-932"></span><span>  </span><span class="annot"><span class="annottext">ImportedName' n2 m2
-&gt; ImportedName' n2 m2 -&gt; Maybe Fixity -&gt; Range -&gt; Renaming' n2 m2
forall n m.
ImportedName' n m
-&gt; ImportedName' n m -&gt; Maybe Fixity -&gt; Range -&gt; Renaming' n m
</span><a href="Agda.Syntax.Common.html#Renaming"><span class="hs-identifier hs-var">Renaming</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' n1 m1 -&gt; ImportedName' n2 m2
forall n1 m1 n2 m2.
(Ord n1, Ord m1) =&gt;
ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' n1 m1 -&gt; ImportedName' n2 m2
</span><a href="Agda.Syntax.Scope.Monad.html#lookupImportedName"><span class="hs-identifier hs-var">lookupImportedName</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700385"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedName' n1 m1
</span><a href="#local-6989586621680700383"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' n1 m1 -&gt; ImportedName' n2 m2
forall n1 m1 n2 m2.
(Ord n1, Ord m1) =&gt;
ImportedNameMap n1 n2 m1 m2
-&gt; ImportedName' n1 m1 -&gt; ImportedName' n2 m2
</span><a href="Agda.Syntax.Scope.Monad.html#lookupImportedName"><span class="hs-identifier hs-var">lookupImportedName</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedNameMap n1 n2 m1 m2
</span><a href="#local-6989586621680700384"><span class="hs-identifier hs-var">tgt</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedName' n1 m1
</span><a href="#local-6989586621680700382"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Fixity
</span><a href="#local-6989586621680700381"><span class="hs-identifier hs-var">fixity</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680700380"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-935"></span><span class="hs-comment">-- * Opening a module</span><span>
</span><span id="line-936"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span class="hs-keyword">data</span><span> </span><span id="OpenKind"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#OpenKind"><span class="hs-identifier hs-var">OpenKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LetOpenModule"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#LetOpenModule"><span class="hs-identifier hs-var">LetOpenModule</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="TopOpenModule"><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#TopOpenModule"><span class="hs-identifier hs-var">TopOpenModule</span></a></span></span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#noGeneralizedVarsIfLetOpen"><span class="hs-identifier hs-type">noGeneralizedVarsIfLetOpen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#OpenKind"><span class="hs-identifier hs-type">OpenKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span>
</span><span id="line-941"></span><span id="noGeneralizedVarsIfLetOpen"><span class="annot"><span class="annottext">noGeneralizedVarsIfLetOpen :: OpenKind -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Monad.html#noGeneralizedVarsIfLetOpen"><span class="hs-identifier hs-var hs-var">noGeneralizedVarsIfLetOpen</span></a></span></span><span> </span><span class="annot"><span class="annottext">OpenKind
</span><a href="Agda.Syntax.Scope.Monad.html#TopOpenModule"><span class="hs-identifier hs-var">TopOpenModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; Scope
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-942"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#noGeneralizedVarsIfLetOpen"><span class="hs-identifier hs-var">noGeneralizedVarsIfLetOpen</span></a></span><span> </span><span class="annot"><span class="annottext">OpenKind
</span><a href="Agda.Syntax.Scope.Monad.html#LetOpenModule"><span class="hs-identifier hs-var">LetOpenModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#disallowGeneralizedVars"><span class="hs-identifier hs-var">disallowGeneralizedVars</span></a></span><span>
</span><span id="line-943"></span><span>
</span><span id="line-944"></span><span class="hs-comment">-- | Open a module.</span><span>
</span><span id="line-945"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#openModule_"><span class="hs-identifier hs-type">openModule_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#OpenKind"><span class="hs-identifier hs-type">OpenKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#ImportDirective"><span class="hs-identifier hs-type">C.ImportDirective</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ImportDirective"><span class="hs-identifier hs-type">A.ImportDirective</span></a></span><span>
</span><span id="line-946"></span><span id="openModule_"><span class="annot"><span class="annottext">openModule_ :: OpenKind -&gt; QName -&gt; ImportDirective -&gt; ScopeM ImportDirective
</span><a href="Agda.Syntax.Scope.Monad.html#openModule_"><span class="hs-identifier hs-var hs-var">openModule_</span></a></span></span><span> </span><span id="local-6989586621680700374"><span class="annot"><span class="annottext">OpenKind
</span><a href="#local-6989586621680700374"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621680700373"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700373"><span class="hs-identifier hs-var">cm</span></a></span></span><span> </span><span id="local-6989586621680700372"><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700372"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenKind
-&gt; Maybe ModuleName
-&gt; QName
-&gt; ImportDirective
-&gt; ScopeM ImportDirective
</span><a href="Agda.Syntax.Scope.Monad.html#openModule"><span class="hs-identifier hs-var">openModule</span></a></span><span> </span><span class="annot"><span class="annottext">OpenKind
</span><a href="#local-6989586621680700374"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700373"><span class="hs-identifier hs-var">cm</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700372"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span class="hs-comment">-- | Open a module, possibly given an already resolved module name.</span><span>
</span><span id="line-949"></span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#openModule"><span class="hs-identifier hs-type">openModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#OpenKind"><span class="hs-identifier hs-type">OpenKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">A.ModuleName</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-type">C.QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#ImportDirective"><span class="hs-identifier hs-type">C.ImportDirective</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Monad.html#ScopeM"><span class="hs-identifier hs-type">ScopeM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ImportDirective"><span class="hs-identifier hs-type">A.ImportDirective</span></a></span><span>
</span><span id="line-950"></span><span id="openModule"><span class="annot"><span class="annottext">openModule :: OpenKind
-&gt; Maybe ModuleName
-&gt; QName
-&gt; ImportDirective
-&gt; ScopeM ImportDirective
</span><a href="Agda.Syntax.Scope.Monad.html#openModule"><span class="hs-identifier hs-var hs-var">openModule</span></a></span></span><span> </span><span id="local-6989586621680700370"><span class="annot"><span class="annottext">OpenKind
</span><a href="#local-6989586621680700370"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621680700369"><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621680700369"><span class="hs-identifier hs-var">mam</span></a></span></span><span> </span><span id="local-6989586621680700368"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700368"><span class="hs-identifier hs-var">cm</span></a></span></span><span> </span><span id="local-6989586621680700367"><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700367"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-951"></span><span>  </span><span id="local-6989586621680700366"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700366"><span class="hs-identifier hs-var">current</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleName
</span><a href="Agda.Syntax.Scope.Monad.html#getCurrentModule"><span class="hs-identifier hs-var">getCurrentModule</span></a></span><span>
</span><span id="line-952"></span><span>  </span><span id="local-6989586621680700365"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700365"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
-&gt; ScopeM ModuleName
-&gt; (ModuleName -&gt; ScopeM ModuleName)
-&gt; ScopeM ModuleName
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621680700369"><span class="hs-identifier hs-var">mam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractModule -&gt; ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#amodName"><span class="hs-identifier hs-var hs-var">amodName</span></a></span><span> </span><span class="annot"><span class="annottext">(AbstractModule -&gt; ModuleName)
-&gt; ScopeM AbstractModule -&gt; ScopeM ModuleName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; ScopeM AbstractModule
</span><a href="Agda.Syntax.Scope.Monad.html#resolveModule"><span class="hs-identifier hs-var">resolveModule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700368"><span class="hs-identifier hs-var">cm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ScopeM ModuleName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-953"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700364"><span class="annot"><span class="annottext">acc :: NameSpaceId
</span><a href="#local-6989586621680700364"><span class="hs-identifier hs-var hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Range
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImportDirective -&gt; Maybe Range
forall n m. ImportDirective' n m -&gt; Maybe Range
</span><a href="Agda.Syntax.Common.html#publicOpen"><span class="hs-identifier hs-var hs-var">publicOpen</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700367"><span class="hs-identifier hs-var">dir</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSpaceId
</span><a href="Agda.Syntax.Scope.Base.html#PrivateNS"><span class="hs-identifier hs-var">PrivateNS</span></a></span><span>
</span><span id="line-954"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700365"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
</span><a href="Agda.Syntax.Abstract.Name.html#isLtChildModuleOf"><span class="hs-operator hs-var">`isLtChildModuleOf`</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700366"><span class="hs-identifier hs-var">current</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSpaceId
</span><a href="Agda.Syntax.Scope.Base.html#PublicNS"><span class="hs-identifier hs-var">PublicNS</span></a></span><span>
</span><span id="line-955"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSpaceId
</span><a href="Agda.Syntax.Scope.Base.html#ImportedNS"><span class="hs-identifier hs-var">ImportedNS</span></a></span><span>
</span><span id="line-956"></span><span>
</span><span id="line-957"></span><span>  </span><span class="hs-comment">-- Get the scope exported by module to be opened.</span><span>
</span><span id="line-958"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680700360"><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700360"><span class="hs-identifier hs-var">adir</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700359"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700359"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; ImportDirective -&gt; Scope -&gt; ScopeM (ImportDirective, Scope)
</span><a href="Agda.Syntax.Scope.Monad.html#applyImportDirectiveM"><span class="hs-identifier hs-var">applyImportDirectiveM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700368"><span class="hs-identifier hs-var">cm</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700367"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; ScopeM (ImportDirective, Scope))
-&gt; (Scope -&gt; Scope) -&gt; Scope -&gt; ScopeM (ImportDirective, Scope)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(WhyInScope -&gt; WhyInScope) -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#inScopeBecause"><span class="hs-identifier hs-var">inScopeBecause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; WhyInScope -&gt; WhyInScope
</span><a href="Agda.Syntax.Scope.Base.html#Opened"><span class="hs-identifier hs-var">Opened</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621680700368"><span class="hs-identifier hs-var">cm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; Scope) -&gt; (Scope -&gt; Scope) -&gt; Scope -&gt; Scope
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-959"></span><span>                </span><span class="annot"><span class="annottext">OpenKind -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Monad.html#noGeneralizedVarsIfLetOpen"><span class="hs-identifier hs-var">noGeneralizedVarsIfLetOpen</span></a></span><span> </span><span class="annot"><span class="annottext">OpenKind
</span><a href="#local-6989586621680700370"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; ScopeM (ImportDirective, Scope))
-&gt; ScopeM Scope -&gt; ScopeM (ImportDirective, Scope)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ScopeM Scope
</span><a href="Agda.Syntax.Scope.Monad.html#getNamedScope"><span class="hs-identifier hs-var">getNamedScope</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680700365"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-960"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700357"><span class="annot"><span class="annottext">s :: Scope
</span><a href="#local-6989586621680700357"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSpaceId -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#setScopeAccess"><span class="hs-identifier hs-var">setScopeAccess</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpaceId
</span><a href="#local-6989586621680700364"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700359"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-961"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700355"><span class="annot"><span class="annottext">ns :: NameSpace
</span><a href="#local-6989586621680700355"><span class="hs-identifier hs-var hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSpaceId -&gt; Scope -&gt; NameSpace
</span><a href="Agda.Syntax.Scope.Base.html#scopeNameSpace"><span class="hs-identifier hs-var">scopeNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpaceId
</span><a href="#local-6989586621680700364"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700357"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-962"></span><span>  </span><span class="annot"><span class="annottext">(Scope -&gt; Scope) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyCurrentScope"><span class="hs-identifier hs-var">modifyCurrentScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope -&gt; Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#mergeScope"><span class="hs-operator hs-var">`mergeScope`</span></a></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680700357"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-comment">-- Andreas, 2018-06-03, issue #3057:</span><span>
</span><span id="line-964"></span><span>  </span><span class="hs-comment">-- If we simply check for ambiguous exported identifiers _after_</span><span>
</span><span id="line-965"></span><span>  </span><span class="hs-comment">-- importing the new identifiers into the current scope, we also</span><span>
</span><span id="line-966"></span><span>  </span><span class="hs-comment">-- catch the case of importing an ambiguous identifier.</span><span>
</span><span id="line-967"></span><span>  </span><span class="annot"><span class="annottext">ScopeM ()
</span><a href="#local-6989586621680700353"><span class="hs-identifier hs-var">checkForClashes</span></a></span><span>
</span><span id="line-968"></span><span>
</span><span id="line-969"></span><span>  </span><span class="hs-comment">-- Importing names might shadow existing locals.</span><span>
</span><span id="line-970"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; ScopeM () -&gt; ScopeM ()
forall (m :: * -&gt; *). MonadDebug m =&gt; String -&gt; Int -&gt; m () -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseS"><span class="hs-identifier hs-var">verboseS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scope.locals&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; ScopeM ()) -&gt; ScopeM () -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-971"></span><span>    </span><span id="local-6989586621680700352"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680700352"><span class="hs-identifier hs-var">locals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Name, LocalVar) -&gt; Maybe Name) -&gt; LocalVars -&gt; [Name]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700351"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700351"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680700350"><span class="annot"><span class="annottext">LocalVar
</span><a href="#local-6989586621680700350"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700351"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name -&gt; Maybe Name
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">LocalVar -&gt; Maybe Name
</span><a href="Agda.Syntax.Scope.Base.html#notShadowedLocal"><span class="hs-identifier hs-var">notShadowedLocal</span></a></span><span> </span><span class="annot"><span class="annottext">LocalVar
</span><a href="#local-6989586621680700350"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LocalVars -&gt; [Name]) -&gt; TCMT IO LocalVars -&gt; TCMT IO [Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO LocalVars
forall (m :: * -&gt; *). ReadTCState m =&gt; m LocalVars
</span><a href="Agda.Syntax.Scope.Monad.html#getLocalVars"><span class="hs-identifier hs-var">getLocalVars</span></a></span><span>
</span><span id="line-972"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700348"><span class="annot"><span class="annottext">newdefs :: [Name]
</span><a href="#local-6989586621680700348"><span class="hs-identifier hs-var hs-var">newdefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamesInScope -&gt; [Name]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">(NamesInScope -&gt; [Name]) -&gt; NamesInScope -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; NamesInScope
</span><a href="Agda.Syntax.Scope.Base.html#nsNames"><span class="hs-identifier hs-var hs-var">nsNames</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621680700355"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-973"></span><span>        </span><span id="local-6989586621680700346"><span class="annot"><span class="annottext">shadowed :: [Name]
</span><a href="#local-6989586621680700346"><span class="hs-identifier hs-var hs-var">shadowed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680700352"><span class="hs-identifier hs-var">locals</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`List.intersect`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680700348"><span class="hs-identifier hs-var">newdefs</span></a></span><span>
</span><span id="line-974"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String -&gt; ScopeM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Int -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scope.locals&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ScopeM ()) -&gt; String -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;opening module shadows the following locals vars: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Utils.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680700346"><span class="hs-identifier hs-var">shadowed</span></a></span><span>
</span><span id="line-975"></span><span>  </span><span class="hs-comment">-- Andreas, 2014-09-03, issue 1266: shadow local variables by imported defs.</span><span>
</span><span id="line-976"></span><span>  </span><span class="annot"><span class="annottext">(LocalVars -&gt; LocalVars) -&gt; ScopeM ()
</span><a href="Agda.Syntax.Scope.Monad.html#modifyLocalVars"><span class="hs-identifier hs-var">modifyLocalVars</span></a></span><span> </span><span class="annot"><span class="annottext">((LocalVars -&gt; LocalVars) -&gt; ScopeM ())
-&gt; (LocalVars -&gt; LocalVars) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; LocalVar -&gt; LocalVar) -&gt; LocalVars -&gt; LocalVars
forall k v. (k -&gt; v -&gt; v) -&gt; AssocList k v -&gt; AssocList k v
</span><a href="Agda.Utils.AssocList.html#mapWithKey"><span class="hs-identifier hs-var">AssocList.mapWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">((Name -&gt; LocalVar -&gt; LocalVar) -&gt; LocalVars -&gt; LocalVars)
-&gt; (Name -&gt; LocalVar -&gt; LocalVar) -&gt; LocalVars -&gt; LocalVars
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700343"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700343"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680700342"><span class="annot"><span class="annottext">LocalVar
</span><a href="#local-6989586621680700342"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-977"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NamesInScope -&gt; Maybe [AbstractName]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700343"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(NamesInScope -&gt; Maybe [AbstractName])
-&gt; NamesInScope -&gt; Maybe [AbstractName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; NamesInScope
</span><a href="Agda.Syntax.Scope.Base.html#nsNames"><span class="hs-identifier hs-var hs-var">nsNames</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621680700355"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-978"></span><span>      </span><span class="annot"><span class="annottext">Maybe [AbstractName]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocalVar
</span><a href="#local-6989586621680700342"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-979"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680700341"><span class="annot"><span class="annottext">[AbstractName]
</span><a href="#local-6989586621680700341"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[AbstractName] -&gt; LocalVar -&gt; LocalVar
</span><a href="Agda.Syntax.Scope.Base.html#shadowLocal"><span class="hs-identifier hs-var">shadowLocal</span></a></span><span> </span><span class="annot"><span class="annottext">[AbstractName]
</span><a href="#local-6989586621680700341"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">LocalVar
</span><a href="#local-6989586621680700342"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-980"></span><span>
</span><span id="line-981"></span><span>  </span><span class="annot"><span class="annottext">ImportDirective -&gt; ScopeM ImportDirective
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700360"><span class="hs-identifier hs-var">adir</span></a></span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-984"></span><span>    </span><span class="hs-comment">-- Only checks for clashes that would lead to the same</span><span>
</span><span id="line-985"></span><span>    </span><span class="hs-comment">-- name being exported twice from the module.</span><span>
</span><span id="line-986"></span><span>    </span><span id="local-6989586621680700353"><span class="annot"><span class="annottext">checkForClashes :: ScopeM ()
</span><a href="#local-6989586621680700353"><span class="hs-identifier hs-var hs-var">checkForClashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ScopeM () -&gt; ScopeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Range -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Range -&gt; Bool) -&gt; Maybe Range -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportDirective -&gt; Maybe Range
forall n m. ImportDirective' n m -&gt; Maybe Range
</span><a href="Agda.Syntax.Common.html#publicOpen"><span class="hs-identifier hs-var hs-var">publicOpen</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDirective
</span><a href="#local-6989586621680700367"><span class="hs-identifier hs-var">dir</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScopeM () -&gt; ScopeM ()) -&gt; ScopeM () -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-987"></span><span>
</span><span id="line-988"></span><span>        </span><span id="local-6989586621680700339"><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621680700339"><span class="hs-identifier hs-var">exported</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scope -&gt; NameSpace
</span><a href="Agda.Syntax.Scope.Base.html#allThingsInScope"><span class="hs-identifier hs-var">allThingsInScope</span></a></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; NameSpace) -&gt; (Scope -&gt; Scope) -&gt; Scope -&gt; NameSpace
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Scope -&gt; Scope
</span><a href="Agda.Syntax.Scope.Base.html#restrictPrivate"><span class="hs-identifier hs-var">restrictPrivate</span></a></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; NameSpace) -&gt; ScopeM Scope -&gt; TCMT IO NameSpace
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; ScopeM Scope
</span><a href="Agda.Syntax.Scope.Monad.html#getNamedScope"><span class="hs-identifier hs-var">getNamedScope</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; ScopeM Scope) -&gt; ScopeM ModuleName -&gt; ScopeM Scope
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ScopeM ModuleName
forall (m :: * -&gt; *). ReadTCState m =&gt; m ModuleName
</span><a href="Agda.Syntax.Scope.Monad.html#getCurrentModule"><span class="hs-identifier hs-var">getCurrentModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>
</span><span id="line-990"></span><span>        </span><span class="hs-comment">-- Get all exported concrete names that are mapped to at least 2 abstract names</span><span>
</span><span id="line-991"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680700337"><span class="annot"><span class="annottext">defClashes :: [(Name, [AbstractName])]
</span><a href="#local-6989586621680700337"><span class="hs-identifier hs-var hs-var">defClashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, [AbstractName]) -&gt; Bool)
-&gt; [(Name, [AbstractName])] -&gt; [(Name, [AbstractName])]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700336"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700336"><span class="hs-identifier hs-var">_c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700335"><span class="annot"><span class="annottext">[AbstractName]
</span><a href="#local-6989586621680700335"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[AbstractName] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[AbstractName]
</span><a href="#local-6989586621680700335"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Name, [AbstractName])] -&gt; [(Name, [AbstractName])])
-&gt; [(Name, [AbstractName])] -&gt; [(Name, [AbstractName])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamesInScope -&gt; [(Name, [AbstractName])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(NamesInScope -&gt; [(Name, [AbstractName])])
-&gt; NamesInScope -&gt; [(Name, [AbstractName])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; NamesInScope
</span><a href="Agda.Syntax.Scope.Base.html#nsNames"><span class="hs-identifier hs-var hs-var">nsNames</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621680700339"><span class="hs-identifier hs-var">exported</span></a></span><span>
</span><span id="line-992"></span><span>            </span><span id="local-6989586621680700334"><span class="annot"><span class="annottext">modClashes :: [(Name, [AbstractModule])]
</span><a href="#local-6989586621680700334"><span class="hs-identifier hs-var hs-var">modClashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, [AbstractModule]) -&gt; Bool)
-&gt; [(Name, [AbstractModule])] -&gt; [(Name, [AbstractModule])]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700333"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700333"><span class="hs-identifier hs-var">_c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700332"><span class="annot"><span class="annottext">[AbstractModule]
</span><a href="#local-6989586621680700332"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[AbstractModule] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[AbstractModule]
</span><a href="#local-6989586621680700332"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Name, [AbstractModule])] -&gt; [(Name, [AbstractModule])])
-&gt; [(Name, [AbstractModule])] -&gt; [(Name, [AbstractModule])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModulesInScope -&gt; [(Name, [AbstractModule])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(ModulesInScope -&gt; [(Name, [AbstractModule])])
-&gt; ModulesInScope -&gt; [(Name, [AbstractModule])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; ModulesInScope
</span><a href="Agda.Syntax.Scope.Base.html#nsModules"><span class="hs-identifier hs-var hs-var">nsModules</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621680700339"><span class="hs-identifier hs-var">exported</span></a></span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span>            </span><span class="hs-comment">-- No ambiguity if concrete identifier is only mapped to</span><span>
</span><span id="line-995"></span><span>            </span><span class="hs-comment">-- constructor names or only to projection names.</span><span>
</span><span id="line-996"></span><span>            </span><span id="local-6989586621680700330"><span class="annot"><span class="annottext">defClash :: (a, [AbstractName]) -&gt; Bool
</span><a href="#local-6989586621680700330"><span class="hs-identifier hs-var hs-var">defClash</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700329"><span class="annot"><span class="annottext">[AbstractName]
</span><a href="#local-6989586621680700329"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(KindOfName -&gt; Bool) -&gt; [KindOfName] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Induction -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Induction -&gt; Bool)
-&gt; (KindOfName -&gt; Maybe Induction) -&gt; KindOfName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">KindOfName -&gt; Maybe Induction
</span><a href="Agda.Syntax.Scope.Base.html#isConName"><span class="hs-identifier hs-var">isConName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[KindOfName]
</span><a href="#local-6989586621680700328"><span class="hs-identifier hs-var">ks</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(KindOfName -&gt; Bool) -&gt; [KindOfName] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindOfName -&gt; KindOfName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#FldName"><span class="hs-identifier hs-var">FldName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[KindOfName]
</span><a href="#local-6989586621680700328"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-997"></span><span>              </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680700328"><span class="annot"><span class="annottext">ks :: [KindOfName]
</span><a href="#local-6989586621680700328"><span class="hs-identifier hs-var hs-var">ks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; KindOfName) -&gt; [AbstractName] -&gt; [KindOfName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; KindOfName
</span><a href="Agda.Syntax.Scope.Base.html#anameKind"><span class="hs-identifier hs-var hs-var">anameKind</span></a></span><span> </span><span class="annot"><span class="annottext">[AbstractName]
</span><a href="#local-6989586621680700329"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-998"></span><span>        </span><span class="hs-comment">-- We report the first clashing exported identifier.</span><span>
</span><span id="line-999"></span><span>        </span><span class="annot"><span class="annottext">[(Name, [AbstractName])]
-&gt; ([(Name, [AbstractName])] -&gt; ScopeM ()) -&gt; ScopeM ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, [AbstractName]) -&gt; Bool)
-&gt; [(Name, [AbstractName])] -&gt; [(Name, [AbstractName])]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680700326"><span class="annot"><span class="annottext">(Name, [AbstractName])
</span><a href="#local-6989586621680700326"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name, [AbstractName]) -&gt; Bool
forall a. (a, [AbstractName]) -&gt; Bool
</span><a href="#local-6989586621680700330"><span class="hs-identifier hs-var">defClash</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, [AbstractName])
</span><a href="#local-6989586621680700326"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, [AbstractName])]
</span><a href="#local-6989586621680700337"><span class="hs-identifier hs-var">defClashes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([(Name, [AbstractName])] -&gt; ScopeM ()) -&gt; ScopeM ())
-&gt; ([(Name, [AbstractName])] -&gt; ScopeM ()) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1000"></span><span>          </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680700325"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700325"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700324"><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700324"><span class="hs-identifier hs-var">q</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[AbstractName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(Name, [AbstractName])]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; ScopeM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ScopeM ()) -&gt; TypeError -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; QName -&gt; Maybe NiceDeclaration -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ClashingDefinition"><span class="hs-identifier hs-var">ClashingDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; QName
</span><a href="Agda.Syntax.Concrete.Name.html#QName"><span class="hs-identifier hs-var">C.QName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680700325"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var hs-var">anameName</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractName
</span><a href="#local-6989586621680700324"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe NiceDeclaration
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span>        </span><span class="annot"><span class="annottext">[(Name, [AbstractModule])]
-&gt; ([(Name, [AbstractModule])] -&gt; ScopeM ()) -&gt; ScopeM ()
forall (m :: * -&gt; *) a.
(Monad m, Null a) =&gt;
a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Null.html#unlessNull"><span class="hs-identifier hs-var">unlessNull</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, [AbstractModule])]
</span><a href="#local-6989586621680700334"><span class="hs-identifier hs-var">modClashes</span></a></span><span> </span><span class="annot"><span class="annottext">(([(Name, [AbstractModule])] -&gt; ScopeM ()) -&gt; ScopeM ())
-&gt; ([(Name, [AbstractModule])] -&gt; ScopeM ()) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700323"><span class="annot"><span class="annottext">[AbstractModule]
</span><a href="#local-6989586621680700323"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(Name, [AbstractModule])]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1003"></span><span>          </span><span class="annot"><span class="annottext">Maybe (AbstractModule, AbstractModule)
-&gt; ScopeM ()
-&gt; ((AbstractModule, AbstractModule) -&gt; ScopeM ())
-&gt; ScopeM ()
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[AbstractModule] -&gt; Maybe (AbstractModule, AbstractModule)
forall a. [a] -&gt; Maybe (a, a)
</span><a href="Agda.Utils.List.html#last2"><span class="hs-identifier hs-var">last2</span></a></span><span> </span><span class="annot"><span class="annottext">[AbstractModule]
</span><a href="#local-6989586621680700323"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(((AbstractModule, AbstractModule) -&gt; ScopeM ()) -&gt; ScopeM ())
-&gt; ((AbstractModule, AbstractModule) -&gt; ScopeM ()) -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680700321"><span class="annot"><span class="annottext">AbstractModule
</span><a href="#local-6989586621680700321"><span class="hs-identifier hs-var">m0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680700320"><span class="annot"><span class="annottext">AbstractModule
</span><a href="#local-6989586621680700320"><span class="hs-identifier hs-var">m1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1004"></span><span>            </span><span class="annot"><span class="annottext">TypeError -&gt; ScopeM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; ScopeM ()) -&gt; TypeError -&gt; ScopeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#ClashingModule"><span class="hs-identifier hs-var">ClashingModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractModule -&gt; ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#amodName"><span class="hs-identifier hs-var hs-var">amodName</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractModule
</span><a href="#local-6989586621680700321"><span class="hs-identifier hs-var">m0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractModule -&gt; ModuleName
</span><a href="Agda.Syntax.Scope.Base.html#amodName"><span class="hs-identifier hs-var hs-var">amodName</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractModule
</span><a href="#local-6989586621680700320"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1005"></span></pre></body></html>